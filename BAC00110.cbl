000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. BAC00110.
       AUTHOR.     PLANET CONSULTING.
000300*****************************************************************
000270*                 BANKCARD PRELIMINARY EDIT                     *
000280*                 FOR MERCHANT TRANSACTIONS.                    *
000300*****************************************************************
000310*                                                               *
000320*               TRAN CODES HANDLED BY BAC00110                  *
000330*                                                               *
000340*   2000  3000  3100  0601  0602  0603  0607                    *
000350*   0701  0702  0703  0707  0O06  0O07  3200  5800              *
000350*   AM07                                                        *
000360*                                                               *
000370*****************************************************************
000380 ENVIRONMENT DIVISION.
000390 CONFIGURATION SECTION.
000400 INPUT-OUTPUT SECTION.
000410 FILE-CONTROL.
000420     SELECT DAILY-TRANS           ASSIGN TO INTRANS.
           SELECT REF-NO-ID             ASSIGN TO REFNOID.
           SELECT DOWN-FILE             ASSIGN TO DOWNFILE.
000430     SELECT REMOTE-ID-IN          ASSIGN TO RMOTEIDI.
000440     SELECT REMOTE-ID-OUT         ASSIGN TO RMOTEIDO.
000450     SELECT WORK-FILE             ASSIGN TO WORKFILE.
000460     SELECT OUT-TRANS             ASSIGN TO BALTRANS.
           SELECT RECN-FILE             ASSIGN TO RECNFILE.
           SELECT TT-SETL-FILE          ASSIGN TO TTSTFILE.
           SELECT RPT-FILE              ASSIGN TO RPTFILE.
           SELECT PASSTHRU-RPT-FILE     ASSIGN TO PASSTHFL.
           SELECT DOWNGRADE-RPT-FILE    ASSIGN TO DWNGRDFL.
           SELECT PBD-EBT-RPT-FILE      ASSIGN TO PBDEBTFL.
           SELECT REJECT-RPT-FILE       ASSIGN TO RJTRECFL.
           SELECT DEFAULT-RPT-FILE      ASSIGN TO DEFRECFL.
           SELECT AUTO-PLAN-FILE        ASSIGN TO AUTOPLFL.             02.38
           SELECT GEN-PLAN-FILE         ASSIGN TO GENPLFL.              02.38
           SELECT BALANCE-FILE          ASSIGN TO BALFILE.              02.64
           SELECT BATCH-FILE            ASSIGN TO BTCHFILE.             02.87
           SELECT RECON-DATA-FILE       ASSIGN TO RCNDFILE.             02.87
           SELECT INTCHG-RATES          ASSIGN TO INTRATES.             02.51
000480     SELECT TTL-PAGE              ASSIGN TO TTLPAGE.
000490     SELECT SORT-FILE-2           ASSIGN TO SORTFILE.
000510     SELECT ADDENDUM-FILE-OUT     ASSIGN TO ADDENDUM.
000510     SELECT REJECT-TRAN-FILE      ASSIGN TO REJECTTR.
000520     SELECT SYSTEM-ASSN-WORK      ASSIGN TO SYSASSN.
000530     SELECT SYSTEM-INST-WORK      ASSIGN TO SYSINST.
000540     SELECT SYSTEM-TTL-WORK       ASSIGN TO SYSTTL.
000650     SELECT FEICF-FILE            ASSIGN TO FEICF
000660                                  ORGANIZATION IS INDEXED
000670                                  ACCESS IS DYNAMIC
000680                                  FILE STATUS IS FEICF-BYTES
000690                                  RECORD KEY IS FEICF-KEY-X.
000650     SELECT FEPKG-FILE            ASSIGN TO FEPKG
000660                                  ORGANIZATION IS INDEXED
000670                                  ACCESS IS DYNAMIC
000680                                  FILE STATUS IS FEPKG-BYTES
000690                                  RECORD KEY IS FEPKG-KEY-X.
000850 DATA DIVISION.
000860 FILE SECTION.
000870*
000880 FD  DAILY-TRANS
000890     RECORDING MODE IS F
000900     BLOCK CONTAINS 0 RECORDS
000910     LABEL RECORDS ARE STANDARD.
000930 01  DAILY-REC       PIC X(100).
      *
       FD  REF-NO-ID
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS
           LABEL RECORDS ARE STANDARD.
       01  REF-NO-ID-REC                 PIC X(80).
      *
       FD  DOWN-FILE
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS
           LABEL RECORDS ARE STANDARD.
       01  DOWN-FILE-REC                 PIC X(99).
000940*
000950 FD  REMOTE-ID-IN
000960     RECORDING MODE IS F
000970     BLOCK CONTAINS 0 RECORDS
000980     LABEL RECORDS ARE STANDARD.
001000 01  REMOTE-ID-IN-REC              PIC X(20).
001010*
001020 FD  REMOTE-ID-OUT
001030     RECORDING MODE IS F
001040     BLOCK CONTAINS 0 RECORDS
001050     LABEL RECORDS ARE STANDARD.
001070 01  REMOTE-ID-OUT-REC             PIC X(20).
001080*
001090 FD  WORK-FILE
001100     RECORDING MODE IS F
001110     BLOCK CONTAINS 0 RECORDS
001120     LABEL RECORDS ARE STANDARD.
001140 01  WORK-REC.
001150   02 WORK-REC-KEY.
001160     03  WORK-INST-ASSN          PIC S9(6)      COMP-3 VALUE +0.
001170     03  WORK-ID                 PIC X VALUE SPACE.
001180     03  WORK-BATCH-ID           PIC S9(6)      COMP-3 VALUE +0.
001190     03  WORK-SOURCE-ID          PIC X VALUE SPACE.
001200     03  WORK-SEQ-NO             PIC S9(11)     COMP-3 VALUE +0.
001210   02 WORK-BATCH-AMT             PIC S9(15)V999 COMP-3.
001210   02 WORK-REIMB-AMT             PIC S9(15)V999 COMP-3.
001210   02 WORK-IIIAAA-AMT            PIC S9(15)V999 COMP-3.
001220   02 WORK-III999-AMT            PIC S9(15)V999 COMP-3.
001230   02 WORK-CENTER-AMT            PIC S9(15)V999 COMP-3.
         02 WORK-DATA                  PIC X(1000).                     03.27
001240   02 WORK-ERROR-CODES           PIC X(60).
         02 WORK-EXTRA-DATA            PIC X(40).                       02.88
001250*
001260 FD  OUT-TRANS
001270     RECORDING MODE IS F
001280     BLOCK CONTAINS 0 RECORDS
001290     LABEL RECORDS ARE STANDARD.
001310 01  OUT-TRANS-REC.
001320   02  OTR-KEY.
001330     03  OTR-INST-ASSN           PIC S9(6)      COMP-3.
001340     03  OTR-ID                  PIC X.
001350     03  OTR-BATCH-ID            PIC S9(6)       COMP-3.
001360     03  OTR-SOURCE-ID           PIC X.
001370     03  OTR-SEQ-NO              PIC S9(11)      COMP-3.
001380   02  OTR-IIIAAA-AMT            PIC S9(15)V999  COMP-3.
001390   02  OTR-III999-AMT            PIC S9(15)V999  COMP-3.
001400   02  OTR-CENTER-AMT            PIC S9(15)V999  COMP-3.
         02  OTR-DATA                  PIC X(1000).                     03.27
      *
       FD  RPT-FILE
           RECORDING MODE F.
       01  RPT-REC                 PIC X(200).
      *
       FD  PASSTHRU-RPT-FILE
           RECORDING MODE F.
       01  PASSTHRU-RPT-REC        PIC X(200).
      *
       FD  DOWNGRADE-RPT-FILE
           RECORDING MODE F.
       01  DOWNGRADE-RPT-REC       PIC X(200).
      *
       FD  PBD-EBT-RPT-FILE
           RECORDING MODE F.
       01  PBD-EBT-RPT-REC         PIC X(200).
      *
       FD  REJECT-RPT-FILE
           RECORDING MODE F.
       01  REJECT-RPT-REC          PIC X(200).
      *
       FD  DEFAULT-RPT-FILE
           RECORDING MODE F.
       01  DEFAULT-RPT-REC         PIC X(200).
      *                                                                 02.38
       FD  AUTO-PLAN-FILE                                               02.38
           RECORDING MODE F.                                            02.38
       01  AUTO-PLAN-REC           PIC X(2205).                         02.38
      *                                                                 02.38
       FD  GEN-PLAN-FILE                                                02.38
           RECORDING MODE F.                                            02.38
       01  GEN-PLAN-REC            PIC X(30).                           02.59
      *                                                                 02.51
       FD  INTCHG-RATES                                                 02.51
           RECORDING MODE F.                                            02.51
       01  INTCHG-RATES-RECORD     PIC X(20).                           02.51
      *                                                                 02.64
       FD  BALANCE-FILE                                                 02.64
           RECORDING MODE F.                                            02.64
       01  BALANCE-FILE-RECORD     PIC X(900).                          02.64
      *                                                                 02.64
       FD  BATCH-FILE                                                   02.87
           RECORDING MODE F.                                            02.87
       01  BATCH-FILE-RECORD       PIC X(313).                          02.87
      *                                                                 02.87
       FD  RECON-DATA-FILE                                              02.87
           RECORDING MODE F.                                            02.87
       01  RECON-DATA-FILE-RECORD  PIC X(1756).                         02.87
001420*
001430 FD  RECN-FILE
001440     RECORDING MODE IS F.
001480 01  RECN-RECORD.
001480     05  RECN-REC-CC         PIC X(01).
001480     05  RECN-REC-DATA       PIC X(80).
001490*
       FD  TT-SETL-FILE
           RECORDING MODE F.
       01  TT-SETL-REC             PIC X(164).
      *
001500 FD  TTL-PAGE
001510     RECORDING MODE IS F
001520     BLOCK CONTAINS 0 RECORDS
001530     LABEL RECORDS ARE STANDARD.
001550 01  TTL-REC                 PIC X(133).
001560*
001570 SD  SORT-FILE-2.
001590 01  SORT-TTL-RPT-REC.
001600      03  SORT-SORT-KEY.
001610        04  SORT-BANK-KEY.
001620          05  SORT-BANK-INST     PIC 9(3).
001630          05  SORT-BANK-ASSOC    PIC 9(3).
001640        04  SORT-CURR-CODE       PIC XXX.
001650        04  SORT-BATCH-NMBR.
001660          05  SORT-BATCH-FRST-2  PIC XX.
001670          05  SORT-BATCH-LAST-4  PIC X(4).
            03  SORT-INT-SETL-GRP      PIC 9(06).                       02.87
001680      03  SORT-REJ               PIC XX.
001690      03  SORT-REF               PIC X(18).
001700      03  SORT-CNT               PIC S9(6)       COMP-3.
001710      03  SORT-BATCH-ORIG-AMT    PIC S9(15)V999     COMP-3.
001720      03  SORT-BATCH-AMT         PIC S9(15)V999     COMP-3.
001720      03  SORT-REIMB-AMT         PIC S9(15)V999     COMP-3.
001720      03  SORT-IIIAAA-AMT        PIC S9(15)V999     COMP-3.
001720      03  SORT-III999-AMT        PIC S9(15)V999     COMP-3.
001720      03  SORT-CENTER-AMT        PIC S9(15)V999     COMP-3.
015000      03  SORT-IIIAAA-CURR-CODE  PIC XXX.
015000      03  SORT-III999-CURR-CODE  PIC XXX.
015000      03  SORT-CENTER-CURR-CODE  PIC XXX.
015000      03  SORT-BATCH-CURR-DEC    PIC S9(4)          COMP.
015000      03  SORT-IIIAAA-CURR-DEC   PIC S9(4)          COMP.
015000      03  SORT-III999-CURR-DEC   PIC S9(4)          COMP.
015000      03  SORT-CENTER-CURR-DEC   PIC S9(4)          COMP.
007060      03  SORT-BATCH-CURR-NAME   PIC X(30).
007060      03  SORT-IIIAAA-CURR-NAME  PIC X(30).
007060      03  SORT-III999-CURR-NAME  PIC X(30).
007060      03  SORT-CENTER-CURR-NAME  PIC X(30).
001840*
001850 COPY KMCADDFO.
001860*
001870 FD  SYSTEM-INST-WORK
001880     RECORDING MODE IS F
001890     LABEL RECORDS ARE STANDARD.
       01  SYS-INST-REC            PIC X(242).                          02.87
001920*
001930 FD  SYSTEM-ASSN-WORK
001940     RECORDING MODE IS F
001950     LABEL RECORDS ARE STANDARD.
       01  SYS-ASSN-REC            PIC X(242).                          02.87
001980*
001990 FD  SYSTEM-TTL-WORK
002000     RECORDING MODE IS F
002010     LABEL RECORDS ARE STANDARD.
       01  SYS-TTL-REC             PIC X(242).                          02.87
002040*
       FD  REJECT-TRAN-FILE
           RECORDING MODE F.
       01  REJECT-TRAN-REC.
         02  RTR-KEY.
           03  RTR-INST-ASSN           PIC S9(6)      COMP-3.
           03  RTR-ID                  PIC X.
           03  RTR-BATCH-ID            PIC S9(6)       COMP-3.
           03  RTR-SOURCE-ID           PIC X.
           03  RTR-SEQ-NO              PIC S9(11)      COMP-3.
         02  RTR-IIIAAA-AMT            PIC S9(15)V999  COMP-3.
         02  RTR-III999-AMT            PIC S9(15)V999  COMP-3.
         02  RTR-CENTER-AMT            PIC S9(15)V999  COMP-3.
         02  RTR-DATA                  PIC X(1000).                     03.27
      *
002090 COPY FDFEICF.
002080*
002090 COPY FDFEPKG.
002100*
002290 WORKING-STORAGE SECTION.
       01  INVENTORY-LEVEL  PIC X(20) VALUE 'RELEASE VV.LL 03.66 '.     03.66
002310 01  WS-DATE-COMPILED              PIC X(20).
002320 01  WS-DISP-COMPILED              PIC X(08)BX(12).
002350*
002340     COPY KMCCRATE.
002350*
           COPY KMCFEPLN.                                               02.38
      *                                                                 02.38
           COPY KMCGNPLN.                                               02.38
      *                                                                 02.38
002360 01  CHECK-DIGIT-DATA.
002370     COPY KMCCKDGT.
002380*
002420     COPY KMCRPTWK.
002060*
           COPY MEINNME REPLACING LEADING ==NME==  BY ==SNF==.          02.77
002380*
001480 01  WS-RECN-RECORD.
001480     05  WS-RECN-REC-CC            PIC X(01).
001480     05  WS-RECN-REC-DATA          PIC X(80).
002430*
002440 01  MISCELLANEOUS-FIELDS.
002470     05  CALL-BASCKDGT       PIC X(8)       VALUE 'BASCKDGT'.
002480     05  BACONDEC            PIC X(8)       VALUE 'BACONDEC'.
002490     05  ABEND               PIC X(8)       VALUE 'ILBOABN0'.
002500     05  DATECONV            PIC X(8)       VALUE 'DATECONV'.
002530     05  BAS10001            PIC X(8)       VALUE 'BAS10001'.
002540     05  BAS10002            PIC X(8)       VALUE 'BAS10002'.
002540     05  BAS10004            PIC X(8)       VALUE 'BAS10004'.
002550     05  BAS110AR            PIC X(8)       VALUE 'BAS110AR'.
           05  BAS110AU            PIC X(8)       VALUE 'BAS110AU'.     02.29
           05  BAS110AE            PIC X(8)       VALUE 'BAS110AE'.     03.16A
002550     05  BAS110DU            PIC X(8)       VALUE 'BAS110DU'.
002550     05  BAS110MI            PIC X(8)       VALUE 'BAS110MI'.
002550     05  BAS110MU            PIC X(8)       VALUE 'BAS110MU'.
           05  BAS110PU            PIC X(8)       VALUE 'BAS110PU'.     02.29
002550     05  BAS110VI            PIC X(8)       VALUE 'BAS110VI'.
002550     05  BAS110VU            PIC X(8)       VALUE 'BAS110VU'.
002550     05  BASCRATE            PIC X(8)       VALUE 'BASCRATE'.
002550     05  BASDTDTA            PIC X(8)       VALUE 'BASDTDTA'.     03.13
           05  BASDTRAN            PIC X(8)       VALUE 'BASDTRAN'.     02.88
           05  BASDADDM            PIC X(8)       VALUE 'BASDADDM'.     02.88
           05  MESNMERD            PIC X(8)       VALUE 'MESNMERD'.     02.77
018410     05  DISPLAY-AMOUNT      PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
018410     05  DISPLAY-RATE        PIC 99999999.9999999.
           05  DISPLAY-COUNT       PIC ZZZ,ZZZ,ZZ9.                     02.38
002570     05  WSBK-BIN            PIC 9(6)       VALUE ZEROS.
002580     05  WSBK-BIN-X REDEFINES WSBK-BIN.
002600         10  WSBK-MC-REF     PIC 9(6).
002610     05  WS-ERR-CD-X.
002610         10  WS-ERR-CD       PIC 999                 VALUE 0.
002610     05  AMT-ERR-CD          PIC 99                  VALUE 0.
002620     05  MERCH-ERR-CD        PIC 99                  VALUE 0.
002630     05  MAX-ERR-CNT         PIC S9(3)               VALUE +20.
           05  WS-HEADER-REF-ID.
               10  WS-HRI-WAO      PIC 9(5) COMP-3   VALUE 0.
      *        BELOW TIME FIELD CONTAINS TIME HHMMS + 2 BYTE SOURCE ID  03.24
               10  WS-HRI-TIME     PIC 9(7) COMP-3   VALUE 0.
               10  WS-HRI-SEQ-NUM  PIC 9(5) COMP-3   VALUE 0.
           05  WS-GROUP-REF-ID.
               10  WS-GRI-WAO      PIC 9(5) COMP-3   VALUE 0.
      *        BELOW TIME FIELD CONTAINS TIME HHMMS + 2 BYTE SOURCE ID  03.24
               10  WS-GRI-TIME     PIC 9(7) COMP-3   VALUE 0.
               10  WS-GRI-SEQ-NUM  PIC 9(5) COMP-3   VALUE 0.
002740     05  WS-ADDENDUM-REF-ID.
002750         10  WS-ARI-CARD     PIC X.
002760         10  WS-ARI-WAO      PIC 9(5) COMP-3   VALUE 0.
      *        BELOW TIME FIELD CONTAINS TIME HHMMS + 2 BYTE SOURCE ID  03.24
002770         10  WS-ARI-TIME     PIC 9(7) COMP-3   VALUE 0.
002780         10  WS-ARI-SEQ-NUM  PIC 9(9)          VALUE 0.
           05  WS-ADDENDUM-REF-WORK.
               10  WS-ARW-SOURCE   PIC X.
               10  WS-ARW-WAO      PIC 9(5) COMP-3   VALUE 0.
      *        BELOW TIME FIELD CONTAINS TIME HHMMS + 2 BYTE SOURCE ID  03.24
               10  WS-ARW-TIME     PIC 9(7) COMP-3   VALUE 0.
               10  WS-ARW-SEQ-NUM  PIC 9(9)          VALUE 0.
      *    WS-UNIQUE-NO IS MOVED TO WS-ARI-TIME (& GRI/HRI-TIME)        03.24
           05  WS-UNIQUE-NO        PIC 9(7)          VALUE 0.           03.24
           05  FILLER REDEFINES WS-UNIQUE-NO.                           03.24
               10 WS-UN-TIME-HHMMS PIC 9(5).                            03.24
               10 WS-UN-SRC-ID     PIC 9(2).                            03.24
002790     05  WS-ACCEPT-DATE.
002800         10  WSA-RUN-DATE    PIC 9(6)          VALUE 0.
002810     05  WS-ACCEPT-TIME.
002820         10  WSA-RUN-TIME    PIC 9(7)          VALUE 0.
002820         10  FILLER REDEFINES WSA-RUN-TIME.
                   15  WSA-RT-HH-MM.
                     17  WSA-RT-HH PIC 9(2).
                     17  WSA-RT-MM PIC 9(2).
002830             15  WSA-RT-SS   PIC 9(2).
002830             15  WSA-RT-T    PIC 9(1).
               10  FILLER REDEFINES WSA-RUN-TIME.                       03.24
                   15  WSA-RT-HH-MM-S PIC 9(5).                         03.24
                   15  WSA-RT-ST      PIC 9(2).                         03.24
002830         10  FILLER          PIC 9(1)          VALUE 0.
           05  WS-DATE-WORK.                                            02.88
               10  WS-DW-CCYY      PIC X(04).                           02.88
               10  FILLER          PIC X(01) VALUE '-'.                 02.88
               10  WS-DW-MM        PIC X(02).                           02.88
               10  FILLER          PIC X(01) VALUE '-'.                 02.88
               10  WS-DW-DD        PIC X(02).                           02.88
           05  WS-FE-PP-SW         PIC X                   VALUE ' '.   03.47
002810     05  WS-PLAN-CODE.
               10  WS-PLAN-CODE-NUM                                     02.77
002810                             PIC 9(4).
002810     05  WS-SAVE-AMX-PLAN-CODE-X.                                 03.34F
               10  WS-SAVE-AMX-PLAN-CODE                                03.34F
002810                             PIC 9(4)                VALUE 0.     03.34F
002810     05  WS-SAVE-DIS-PLAN-CODE-X.                                 03.34F
               10  WS-SAVE-DIS-PLAN-CODE                                03.34F
002810                             PIC 9(4)                VALUE 0.     03.34F
002810     05  WS-NEW-AMX-PLAN-CODE-X.                                  03.34F
               10  WS-NEW-AMX-PLAN-CODE                                 03.34F
002810                             PIC 9(4)                VALUE 0.     03.34F
002810     05  WS-NEW-DIS-PLAN-CODE-X.                                  03.34F
               10  WS-NEW-DIS-PLAN-CODE                                 03.34F
002810                             PIC 9(4)                VALUE 0.     03.34F
002810     05  WS-SEARCH-PLAN-X.
002810         10  WS-SEARCH-PLAN  PIC 9(04).
           05  WS-DOWN-FILE-REC.
               10  WS-DFR-KEY      PIC X(17).
               10  WS-DFR-CNT      PIC 9(02).
               10  WS-DFR-TABLE.
                   15  WS-DFR-ENTRY OCCURS 10.
                       20  WS-DFR-PLAN
                                   PIC 9(04).
                       20  WS-DFR-REASON
                                   PIC X(04).
           05  WS-REF-NO-ID.
               10  WS-RNI-LAST-X.
                   15  WS-RNI-LAST PIC 9(02).
               10  FILLER          PIC X(78).
002840     05  WS-REMOTE-TRANS.
002850         10  WS-RT-TRANS     PIC X(4).
002860         10  FILLER          PIC X.
002870         10  WS-RT-ID        PIC X(13).
002880         10  FILLER          PIC X(82).
002890     05  WS-REMOTE-ID.
002900         10  WS-RI-RUN       PIC X.
002910         10  WS-RI-WAO       PIC 9(6).
002920         10  WS-RI-ID        PIC X(13).
002930     05  WS-REMOTE-EOF       PIC X                   VALUE 'N'.
002940     05  WS-REMOTE-MATCH     PIC X                   VALUE 'N'.
002950     05  ABEND-CODE          PIC S9(4)  COMP         VALUE +0.
           05  WS-PSUB             PIC S9(8)  COMP         VALUE +0.    02.23
           05  WS-LGTH             PIC S9(4)  COMP         VALUE +0.    02.23
002960     05  WS-SUB1             PIC S9(4)  COMP         VALUE +0.
002960     05  WS-SUB2             PIC S9(4)  COMP         VALUE +0.
002960     05  WS-SUB3             PIC S9(4)  COMP         VALUE +0.
002960     05  WS-SUB4             PIC S9(4)  COMP         VALUE +0.
002960     05  WS-SUB5             PIC S9(4)  COMP         VALUE +0.
002960     05  WS-SUB6             PIC S9(4)  COMP         VALUE +0.
           05  BAL-SUB             PIC S9(4)  COMP         VALUE +0.    02.64
           05  EFR-SUB             PIC S9(4)  COMP         VALUE +0.    02.69
           05  SUB-VS              PIC S9(4)  COMP         VALUE +1.    02.87
           05  SUB-MC              PIC S9(4)  COMP         VALUE +2.    02.87
           05  SUB-OT              PIC S9(4)  COMP         VALUE +3.    02.87
           05  SUB-AX              PIC S9(4)  COMP         VALUE +4.    02.87
           05  SUB-DS              PIC S9(4)  COMP         VALUE +5.    02.87
           05  SUB-DB              PIC S9(4)  COMP         VALUE +6.    02.87
           05  SUB-PD              PIC S9(4)  COMP         VALUE +7.    02.87
           05  SUB-NS              PIC S9(4)  COMP         VALUE +8.    02.87
           05  SUB-NT              PIC S9(4)  COMP         VALUE +9.    02.87
           05  SUB-PP              PIC S9(4)  COMP         VALUE +10.   03.47
           05  SUB-PT              PIC S9(4)  COMP         VALUE +10.   03.47
           05  SUB-06              PIC S9(4)  COMP         VALUE +1.    02.87
           05  SUB-07              PIC S9(4)  COMP         VALUE +2.    02.87
           05  SUB-0O              PIC S9(4)  COMP         VALUE +3.    02.87
           05  SUB-RJ              PIC S9(4)  COMP         VALUE +4.    02.87
           05  SUB-DE              PIC S9(4)  COMP         VALUE +5.    02.87
           05  SUB-NM              PIC S9(4)  COMP         VALUE +6.    02.87
002960     05  SUB-T               PIC S9(3)  COMP         VALUE +0.
002970     05  SUB-Z               PIC S9(3)  COMP         VALUE +0.
002980     05  SUB                 PIC S9(2)  COMP         VALUE +0.
002990     05  SUB1                PIC S9(2)  COMP         VALUE +0.
002990     05  SUB2                PIC S9(2)  COMP         VALUE +0.
002990     05  SUB3                PIC S9(2)  COMP         VALUE +0.
           05  SUB-BTCH            PIC 9(06)               VALUE 0.     02.28
003030     05  SUB-PRT             PIC 999    COMP         VALUE 0.
003060     05  PRT-SUB             PIC 9(4)   COMP         VALUE 0.
003060     05  START-SUB           PIC 9(4)   COMP         VALUE 0.
003060     05  END-SUB             PIC 9(4)   COMP         VALUE 0.
003060     05  END2-SUB            PIC 9(4)   COMP         VALUE 0.
003070     05  HOLD-SEQ-NUMBER-X.
003070         10  HOLD-SEQ-NUMBER PIC 9(2)                VALUE 0.
003070     05  HOLD-LEG-NUMBER     PIC 9(2)                VALUE 0.
003120     05  CAT-CODE-VVAL       PIC X                   VALUE 'N'.
003130     05  CAT-CODE-MVAL       PIC X                   VALUE 'N'.
           05  CAT-CODE-AVAL       PIC X                   VALUE 'N'.   02.29
           05  CAT-CODE-DVAL       PIC X                   VALUE 'N'.   02.39
           05  WS-AMERCAT-1PT-EAP-FLAG PIC X               VALUE 'N'.   03.16A
               88  WS-VALID-AMERCAT-1PT-EAP                VALUE 'Y'.   03.16A
003140     05  WS-VISA-ERR-FLAG    PIC X                   VALUE 'N'.
003150     05  WS-HELD-REC         PIC X                   VALUE 'N'.
003140     05  WS-ADD-SUS-FLAG     PIC X                   VALUE SPACE.
003140     05  WS-LVL3-WORK-X.
003140         10  WS-LVL3-WORK        PIC 9(5).
003140     05  WS-ADD-REC-CNT          PIC S9(4) COMP.
001200     05  WS-SAVE-WORK-SEQ-NO     PIC S9(11) COMP-3   VALUE +0.
003140     05  WS-MOVE-DONE-SW         PIC X               VALUE 'N'.
003140         88  MOVE-DONE                               VALUE 'Y'.
           05  WS-ERROR-SW             PIC X               VALUE 'N'.
               88  ERROR-FOUND                             VALUE 'Y'.
003140     05  WS-PLAN-CODE-FOUND-SW   PIC X               VALUE 'N'.
003140         88  WS-PLAN-CODE-FOUND                      VALUE 'Y'.
003140     05  WS-FIND-HIERARCHY-ENTRY PIC X               VALUE 'N'.
003140         88  FIND-HIERARCHY-ENTRY                    VALUE 'Y'.
           05  WS-CAB-PROG-FOUND-SW    PIC X               VALUE 'N'.
               88  WS-CAB-PROG-FOUND                       VALUE 'Y'.
           05  WS-INSTALL-LINE-SW      PIC X               VALUE 'N'.   02.23
               88  WS-INSTALL-LINE                         VALUE 'Y'.   02.23
003160     05  BTCH-NMBR-COMPARE   PIC X(6)                VALUE ZERO.
003280     05  UNPACK-CTR          PIC 999                 VALUE 0.
003340     05  WS-WRITE-DEFER      PIC X                   VALUE 'N'.
003350         88 WRITE-DEFER                              VALUE 'Y'.
           05  WS-BAL-TRAN-TYPE    PIC X                   VALUE SPACE. 02.64
               88  WS-BAL-TRAN-IS-SALE            VALUE 'S'.            02.64
               88  WS-BAL-TRAN-IS-CASH            VALUE 'C'.            02.64
               88  WS-BAL-TRAN-IS-RETURN          VALUE 'R'.            02.64
           05  WS-NON-SETTLE-CLEAR PIC X          VALUE SPACE.          02.91
               88  WS-NSC-NON-CLEAR-AX            VALUE 'A'             02.91
                                                        'B'.            02.91
               88  WS-NSC-NON-CLEAR-DS            VALUE 'B'             02.91
                                                        'D'.            02.91
003390     05  WS-CARD-TYPE        PIC X                   VALUE SPACE.
           05  WS-SAVE-MIS3-TYPE   PIC XX                  VALUE SPACES.02.66
003390     05  WS-MIS3-CARD-TYPE   PIC XX                  VALUE SPACES.
003390         88  VALID-MIS3-SPACE               VALUE '  '.
003390         88  VALID-MIS3-VISA-MC-CARD-TYPE   VALUE 'M ' 'V '.      03.47
003390         88  VALID-MIS3-MC-CARD-TYPE        VALUE 'M '.
003390         88  VALID-MIS3-VISA-CARD-TYPE      VALUE 'V '.           03.47
003390         88  VALID-MIS3-DS-CARD-TYPE        VALUE 'DS'.
003390         88  VALID-MIS3-PP-CARD-TYPE        VALUE 'PP'.           03.47
               88  VALID-MIS3-AX-CARD-TYPE        VALUE 'AX'.           02.29
               88  VALID-MIS3-DB-CARD-TYPE        VALUE 'DB'.           02.64
               88  VALID-MIS3-EB-CARD-TYPE        VALUE 'EB'.           02.64
               88  VALID-MIS3-PD-NET              VALUE '01' THRU '99'. 02.29
               88  VALID-MIS3-CARD-TYPE-DEBIT     VALUE '01' THRU '99'  02.29
                                                        'DB'            02.64
                                                        'EB'.           02.64
           05  WS-MIS3-PRE-EDIT-ERROR-CODE                              02.78
                                   PIC X VALUE SPACE.                   02.78
               88  VALID-MIS3-PRE-EDIT-ERROR      VALUE 'A' THRU 'B'    02.78
                                                        'D'             02.78
                                                        'I'             02.78
                                                        'T'.            02.78
               88  WS-MIS3-PRE-EDIT-ERROR-IS-PAN  VALUE 'A'.            02.78
               88  WS-MIS3-PRE-EDIT-ERROR-IS-RET  VALUE 'B'.            02.78
               88  WS-MIS3-PRE-EDIT-ERROR-IS-DUP  VALUE 'D'.            02.78
               88  WS-MIS3-PRE-EDIT-ERROR-IS-MID  VALUE 'I'.            02.78
               88  WS-MIS3-PRE-EDIT-ERROR-IS-AMT  VALUE 'T'.            02.78
           05  WS-MIS3-PRE-EDIT-FLAGS.                                  03.02
               10  WS-MIGR-PEF-SUSP-NET-CR PIC X  VALUE SPACE.          03.02
               10  WS-MIS3-PEF-MID         PIC X  VALUE SPACE.          03.02
               10  WS-MIS3-PEF-DUPE        PIC X  VALUE SPACE.          03.02
               10  WS-MIS3-PEF-PAN         PIC X  VALUE SPACE.          03.02
               10  WS-MIS3-PEF-TRAN-AMT    PIC X  VALUE SPACE.          03.02
               10  WS-MIS3-PEF-CR-BATCH    PIC X  VALUE SPACE.          03.02
           05  WS-MC-TRAN-CAT-IND  PIC X(02) VALUE SPACES.              02.33
               88  WS-MC-TRAN-CAT-IND-00          VALUE '00'.           02.33
               88  WS-VC-MC-TRAN-CAT-IND          VALUE '  '            02.33
                                                        '01' THRU '03'. 03.46 REMOVED 04 AS IT REJECTS IN EDIT PACK
           05  WS-MVV-BYTE         PIC X VALUE SPACE.
               88  VALID-MVV-BYTE                 VALUE 'A' THRU 'F'
                                                        '0' THRU '9'.
      *  THREE POSSIBLE FIELDS TO MOVE TO PET-AMEX-CONTACT,             02.37
      *  CUST SVC PHONE (CS), URL (U), EMAIL ADDRESS (E)                02.37
      *  DESCR-FORMAT-IND SETS THE HEIRARCHY OF FIELDS TO LOAD:         02.37
      *   1 - CS,U,E        3 - U,CS,E        5 - E,CS,U                02.37
      *   2 - CS,E,U        4 - U,E,CS        6 - E,U,CS                02.37
      *                                                                 02.37
           05  WS-AX-DESCR-FORMAT-IND    PIC X     VALUE '1'.           02.37
               88  WS-VALID-AX-DESCR-FORMAT-IND    VALUE '1' THRU '6'.  02.37
               88  WS-VALID-AX-DESCR-FORMAT-1-2    VALUE '1' THRU '2'.  02.37
               88  WS-VALID-AX-DESCR-FORMAT-1-OR-6 VALUE '1'            02.37
                                                         '6'.           02.37
               88  WS-VALID-AX-DESCR-FORMAT-2-OR-5 VALUE '2'            02.37
                                                         '5'.           02.37
               88  WS-VALID-AX-DESCR-FORMAT-3-4    VALUE '3' THRU '4'.  02.37
               88  WS-VALID-AX-DESCR-FORMAT-3-OR-5 VALUE '3'            02.37
                                                         '5'.           02.37
               88  WS-VALID-AX-DESCR-FORMAT-4-OR-6 VALUE '4'            02.37
                                                         '6'.           02.37
               88  WS-VALID-AX-DESCR-FORMAT-5-6    VALUE '5' THRU '6'.  02.37
           05  WS-URL                    PIC X(40).                     02.37
           05  WS-EMAIL                  PIC X(40).                     02.37
           05  WS-US-CAN-CS-PHONE        PIC X(14)       VALUE SPACES.  02.45
003400     05  FIRST-BATCHREC-SW   PIC X                   VALUE 'Y'.
003410     05  SEL-ALL-BATCH-TRANS PIC X                   VALUE 'N'.
003440     05  ST-DIFF             PIC S9(15)V999 COMP-3   VALUE +0.
003470     05  WS-BALANCE-DATE-X.
003480         10  WS-BALANCE-DATE PIC 9(6)                VALUE 0.
003490     05  SUS-COUNTER         PIC S9(6)  COMP         VALUE +0.
003500     05  SEARCH-BANK-KEY     PIC S9(6)  COMP-3       VALUE +0.
003550     05  AUTH-ERR-SW         PIC X                   VALUE 'N'.
003550         88  AUTH-ERR                                VALUE 'Y'.
           05  AUTH-CHAR-WORK            PIC X(1).
               88  AUTH-CHAR-VALID       VALUE ' ' 'A' THRU 'Z'
                                                   '0' THRU '9'.
003560     05  AUTH-SPACE-WORK           PIC X(6).
003570     05  FILLER  REDEFINES  AUTH-SPACE-WORK.
003580         10  ASW-SW-POS OCCURS 6   PIC X.
003570     05  FILLER  REDEFINES  AUTH-SPACE-WORK.
003580         10  FILLER                PIC X.
003580         10  ASW-SW-POS-LAST-5     PIC X(5).
003580             88  ASW-SW-BAD-AUTH-LAST5 VALUES '0000N' '0000Y'
                                                    '00000' '0000 '
                                                    '     ' '0000P'.
003650     05  FEICF-BYTES         PIC X(02)              VALUE SPACES.
003650     05  FEPKG-BYTES         PIC X(02)              VALUE SPACES.
           05  FEPLN-EOF-SW        PIC X(01)              VALUE 'N'.    02.38
             88  FEPLN-EOF                                VALUE 'Y'.    02.38
           05  INTCHG-RATES-EOF-SW PIC X(01)              VALUE 'N'.    02.51
             88  INTCHG-RATES-EOF                         VALUE 'Y'.    02.51
           05  WS-FOUND-SW         PIC X(01)              VALUE 'N'.    02.51
             88  WS-FOUND                                 VALUE 'Y'.    02.51
           05  HOLD-WSAK-HI-ACCT-X.                                     02.68
             07  HOLD-WSAK-HI-ACCT PIC 9(16).                           02.68
003740     05  SRCH-CURR-CODE-X.
003750         07  SRCH-CURR-CODE  PIC 9(3)               VALUE 0.
003760     05  SRCH-COUNTRY        PIC X(3)               VALUE SPACES.
003770     05  INVAL-CURR-SW       PIC X                  VALUE 'N'.
003780     05  INVAL-CNTRY-SW      PIC X                  VALUE 'N'.
003780     05  ANMTR-SRCH-SW       PIC X                  VALUE 'N'.    03.16B
003800     05  SECOND-BYTES        PIC XX                 VALUE '00'.
003810     05  WSAK-ACCT-LEN-X     PIC XX                 VALUE '00'.
003820     05  WSAK-ACCT-LEN  REDEFINES WSAK-ACCT-LEN-X   PIC 99.
003750     05  HOLD-FIELD          PIC X(40)              VALUE SPACES.
003750     05  HOLD2-FIELD         PIC X(40)              VALUE SPACES.
003750     05  HOLD-FILE-NAME      PIC X(150)             VALUE SPACES.
           05  WK-ZERO-FIELD       PIC X(80)              VALUE SPACES. 02.41
           05  WK-SETL-TOT-AMT     PIC S9(15)V999 COMP-3   VALUE +0.    02.94
           05  WK-SETL-TOT-CNT     PIC S9(09) COMP-3   VALUE +0.        02.94
003440     05  WK-SETL-AMT         PIC S9(15)V999 COMP-3   VALUE +0.
003440     05  WK-SETL-CNT         PIC S9(09) COMP-3   VALUE +0.
004000     05  WK-NON-SETL-REIMB-AMT   PIC S9(12)V999 COMP-3 VALUE +0.
004000     05  WK-NON-SETL-IIIAAA-AMT  PIC S9(12)V999 COMP-3 VALUE +0.
004000     05  WK-NON-SETL-III999-AMT  PIC S9(12)V999 COMP-3 VALUE +0.
004000     05  WK-NON-SETL-CENTER-AMT  PIC S9(12)V999 COMP-3 VALUE +0.
004000     05  WK-NON-SETL-AMT         PIC S9(12)V999 COMP-3 VALUE +0.
004000     05  WK-NON-SETL-CARD-TYPE   PIC 9(02) VALUE ZEROS.
004000     05  WK-NON-SETL-TRANS       PIC X(04) VALUE SPACES.
004000     05  FILLER REDEFINES WK-NON-SETL-TRANS.
004000         10  WK-NON-SETL-TRAN-PREF PIC X(02).
004000         10  WK-NON-SETL-TRAN-SUFF PIC X(02).
004000     05  WK-GROUP-REF-NMBR   PIC X(18)              VALUE SPACES.
003830*
           05  WS-TRANSCODE.                                            03.31
             07  WS-TRANSCODE-PREF       PIC X(02).                     03.31
             07  WS-TRANSCODE-SUF        PIC X(02).                     03.31
               88  WS-QUAD-RECORD        VALUE  '07'.                   03.31
003840     05  WS-ADD-REM-LGTH           PIC S9(04)V COMP.
003840     05  WS-ADD-VALID-1ST          PIC X(01).
003840*        VALUE OF 'M' - CAN HAVE MORE THAN ONE PER TRANSACTION BUT
003840*                       MUST BE FOLLOWED BY ANOTHER TYPE
003840*        VALUE OF 'N' - CAN NOT BE FIRST
003840*        VALUE OF 'R' - CAN ONLY HAVE ONE PER TRANSACTION AND MUST
003840*                       BE FOLLOWED BY ANOTHER TYPE
003840*        VALUE OF 'Y' - CAN BE FIRST AND OCCUR AS MANY TIMES AS
003840*                       IT'S CORRESPONDING MAX NO VALUE
003840         88  ADD-IS-VALID-1ST      VALUE 'M' 'R' 'Y'.
003840         88  ADD-IS-VALID-MANY     VALUE 'M'.
003840         88  ADD-IS-VALID-2ND-REQ  VALUE 'M' 'R'.
003840     05  WS-ADD-MAX-NO             PIC 9(04) VALUE ZERO.
003840     05  WS-ADD-MAX-CNT            PIC 9(04) VALUE ZERO.
           05  WS-MAX-ATE-ENTRIES        PIC S9(04)V COMP VALUE +61.    03.42V
003840     05  WS-ADDENDUM-TABLE.
003840         10  FILLER             PIC X(15) VALUE '0100000606Y0001'.
003840         10  FILLER             PIC X(15) VALUE '0100010468N0998'.
003840         10  FILLER             PIC X(15) VALUE '0100020415Y0999'.
003840         10  FILLER             PIC X(15) VALUE '0500000742Y0999'.
003840         10  FILLER             PIC X(15) VALUE '0600001032Y0999'.
003840         10  FILLER             PIC X(15) VALUE '0700000887Y0999'.
003840         10  FILLER             PIC X(15) VALUE '0800002317Y0999'.
003840         10  FILLER             PIC X(15) VALUE '0900001404M0001'.
003840         10  FILLER             PIC X(15) VALUE '0900012070N0006'.
               10  FILLER             PIC X(15) VALUE '1000000182Y0999'.02.23
003840         10  FILLER             PIC X(15) VALUE '1100001553Y0001'.
003840         10  FILLER             PIC X(15) VALUE '1100010971N0998'.03.36
003840         10  FILLER             PIC X(15) VALUE '1200000149Y0999'.
003840         10  FILLER             PIC X(15) VALUE '1300000331Y0999'.
               10  FILLER             PIC X(15) VALUE '1400002173Y0001'.02.48
               10  FILLER             PIC X(15) VALUE '1400013000N0998'.02.48
               10  FILLER             PIC X(15) VALUE '1500000079Y0999'.02.23
003840         10  FILLER             PIC X(15) VALUE '9800000765Y0001'.
003840         10  FILLER             PIC X(15) VALUE '9800020507Y0001'.
003840         10  FILLER             PIC X(15) VALUE '9809500624N0998'.
003840         10  FILLER             PIC X(15) VALUE '9900001009Y0999'.
003840         10  FILLER             PIC X(15) VALUE 'AD00000108Y0001'.
003840         10  FILLER             PIC X(15) VALUE 'AI00000155Y0001'.03.42V
003840         10  FILLER             PIC X(15) VALUE 'AN00000097Y0001'.03.42V
               10  FILLER             PIC X(15) VALUE 'AX03040142Y0001'.
               10  FILLER             PIC X(15) VALUE 'AX03050296Y0001'.02.72
               10  FILLER             PIC X(15) VALUE 'AX03110124Y0001'.
               10  FILLER             PIC X(15) VALUE 'AX03130170Y0001'.03.36
003840         10  FILLER             PIC X(15) VALUE 'AX03200280Y0001'.
               10  FILLER             PIC X(15) VALUE 'AX03220121Y0001'.
               10  FILLER             PIC X(15) VALUE 'AX05000341Y0001'.02.72
003840         10  FILLER             PIC X(15) VALUE 'AX99000160Y0001'.02.29
003840         10  FILLER             PIC X(15) VALUE 'BB00000154Y0001'.
003840         10  FILLER             PIC X(15) VALUE 'CA00000146Y0001'.
003840         10  FILLER             PIC X(15) VALUE 'CI00000175M0001'.
003840         10  FILLER             PIC X(15) VALUE 'CS00000155N0099'.
003840         10  FILLER             PIC X(15) VALUE 'DS04000061Y0001'.
003840         10  FILLER             PIC X(15) VALUE 'DS06000652Y0099'.
003840         10  FILLER             PIC X(15) VALUE 'DS07000745Y0099'.
003840         10  FILLER             PIC X(15) VALUE 'DS08000247Y0099'.
003840         10  FILLER             PIC X(15) VALUE 'DS09000549Y0099'.
               10  FILLER             PIC X(15) VALUE 'FL00000150Y0001'.03.25
003840         10  FILLER             PIC X(15) VALUE 'JA00000079Y0001'.
003840         10  FILLER             PIC X(15) VALUE 'LG00000119Y0001'.
003840         10  FILLER             PIC X(15) VALUE 'LU00000161Y0001'.
003840         10  FILLER             PIC X(15) VALUE 'M100000099Y0001'.
003840         10  FILLER             PIC X(15) VALUE 'PA00000174Y0001'.03.42V
003840         10  FILLER             PIC X(15) VALUE 'PL00000175N0999'.03.42V
003840         10  FILLER             PIC X(15) VALUE 'XA00000174Y0001'.03.42V
003840         10  FILLER             PIC X(15) VALUE 'XL00000175N0999'.03.42V
               10  FILLER             PIC X(15) VALUE 'EV00000173Y0001'.02.95
               10  FILLER             PIC X(15) VALUE 'EM00000280Y0001'.02.95
003840         10  FILLER             PIC X(15) VALUE 'DS12000098Y0001'.03.36
               10  FILLER             PIC X(15) VALUE 'DS13000347Y0001'.02.95
               10  FILLER             PIC X(15) VALUE 'AX07010172Y0001'.02.95
               10  FILLER             PIC X(15) VALUE 'AX03010374Y0001'.03.03
               10  FILLER             PIC X(15) VALUE 'DS51000397Y0001'.03.03
               10  FILLER             PIC X(15) VALUE 'DS52000169N0004'.03.03
               10  FILLER             PIC X(15) VALUE 'DS17000055Y0001'.03.16D
               10  FILLER             PIC X(15) VALUE 'DS18000143Y0001'.03.16D
               10  FILLER             PIC X(15) VALUE 'CF00000441Y0001'.03.25
003840     05  FILLER REDEFINES WS-ADDENDUM-TABLE.
               10  WS-AT-ENTRY OCCURS 61                                03.42V
003840                         ASCENDING KEY IS WS-ATE-TRAN
003848                         INDEXED BY ATE-INDX.
003840             15  WS-ATE-TRAN.
003840                 20  WS-ATE-CODE           PIC X(02).
003840                 20  WS-ATE-SUB-CODE       PIC X(04).
003840             15  WS-ATE-LGTH               PIC 9(04).
003840             15  WS-ATE-VALID-1ST          PIC X(01).
003840             15  WS-ATE-MAX-NO             PIC 9(04).
003840     05  WS-2ND-RECEIVED-FLAG              PIC X(01) VALUE 'N'.
003850         88  WS-2ND-RECEIVED                         VALUE 'Y'.
003840     05  WS-LAST-ADD-TRAN.
003840         10  WS-LAST-SUB-TRAN      PIC X(02) VALUE SPACES.
003840         10  WS-LAST-SUB-CODE      PIC X(03) VALUE SPACES.
003850             88  WLSC-MC-BASE                VALUE '000'.
003850             88  WLSC-MC-DETAIL              VALUE '001'.
003850             88  WLSC-MC-FLEET               VALUE '002'.
003850             88  WLSC-MC-RAIL                VALUE '002'.
003850             88  WLSC-MC-PURCHASE            VALUE '950'.
003840         10  WS-LAST-SUB-CODE2     PIC X(01) VALUE SPACES.        03.03
003840     05  WS-CHECK-ADD-TRAN.
003840         10  WS-CHECK-SUB-TRAN     PIC X(2) VALUE SPACES.
003850             88  WCST-TEMP-SVC              VALUES '07'.
003850             88  WCST-SHIP-SVC              VALUES '08'.
003850             88  WCST-ELEC-INV              VALUES '09'.
003850             88  WCST-PAYMENT               VALUES '10'.
003850             88  WCST-TELEPHONY             VALUES '11'.
003850             88  WCST-TRAVEL-AGENCY         VALUES '12'.
003850             88  WCST-LODGED-ACCT           VALUES '13'.
                   88  WCST-PRIVATE-LABEL         VALUES '14'.          02.48
                   88  WCST-HEALTH-CARE           VALUES '15'.          02.23
003850             88  WCST-MC-XTRA-TRAN-DATA     VALUES 'M1'.
003850             88  WCST-DIS-TRANS             VALUES 'DS'.
003850             88  WCST-AMEX-TRANS            VALUES 'AD' 'AX'.
003850             88  WCST-PASSENGER-TRANS       VALUES 'AI' '01' 'JA' 03.42V
003850                                                   'AN'.          03.42V
003850             88  WCST-PASSENGER-TRANS-AI    VALUES 'AI'.          03.42V
003850             88  WCST-PASSENGER-TRANS-AN    VALUES 'AN'.          03.42V
003850             88  WCST-CAR-RENTAL            VALUES 'CA' '05'.     02.52
003850             88  WCST-LODGING               VALUES 'LG' '06'.     02.52
003850             88  WCST-PURCHASE-CARD         VALUES '98'.          02.52
003850             88  WCST-GENERIC               VALUES '99'.          02.52
003850             88  WCST-FLEET-CARD            VALUES 'FL'.
                   88  WCST-COMM-FLEET            VALUES 'CF'.          03.25
003850             88  WCST-B2B                   VALUES 'BB'.
003850             88  WCST-LIMITED-USE           VALUES 'LU'.
                   88  WCST-VISA-EMV              VALUE 'EV'.           02.95
                   88  WCST-MC-EMV                VALUE 'EM'.           02.95
003850             88  WCST-LVL3-CORPORATE        VALUES 'XA' 'XL'.     02.75
003850             88  WCST-LVL3-PURCHASE         VALUES 'PA' 'PL'.
003850             88  WCST-LVL3-AIRLINE          VALUES 'CI' 'CS'.
003850             88  WCST-LVL3-TRANS            VALUES 'CI' 'CS' 'PA'
                                                         'PL' 'XA' 'XL'.02.75
003850             88  WCST-LVL2-VISA             VALUES 'AI' 'CA' 'LG'.
003850             88  WCST-MC-TRANS              VALUES '01'
003860                                                   '05' THRU '15' 02.52
003860                                                   '98' '99' 'M1' 02.95
                                                         'EM'.          02.95
003840         10  WS-CHECK-SUB-CODE     PIC X(4).
003850             88  WCSC-MC-BASE               VALUE '0000'.
003850             88  WCSC-MC-DETAIL             VALUE '0001'.
003850             88  WCSC-MC-FLEET              VALUE '0002'.
003850             88  WCSC-MC-RAIL               VALUE '0002'.
003850             88  WCSC-MC-PURCHASE           VALUE '0950'.
                   88  WCSC-AMEX-AIRLINE          VALUE '0301'.         03.03
                   88  WCSC-AMEX-INSURE           VALUE '0304'.
                   88  WCSC-AMEX-CAR-RENTAL       VALUE '0305'.
                   88  WCSC-AMEX-LODGING          VALUE '0311'.
                   88  WCSC-AMEX-COMMUNICATIONS   VALUE '0313'.         03.36
                   88  WCSC-AMEX-RETAIL           VALUE '0320'.
                   88  WCSC-AMEX-ENT-TKT          VALUE '0322'.
                   88  WCSC-AMEX-CPS              VALUE '0500'.         CPS
                   88  WCSC-AMEX-EMV              VALUE '0701'.         02.95
                   88  WCSC-AMEX-LOCATION         VALUE '9900'.
                   88  WCSC-DS-GEOGRAPHIC         VALUE '0400'.
                   88  WCSC-DS-CAR-RENTAL         VALUE '0600'.
                   88  WCSC-DS-MOTO               VALUE '0700'.
                   88  WCSC-DS-FLEET              VALUE '0800'.
                   88  WCSC-DS-LODGING            VALUE '0900'.
                   88  WCSC-DS-TELECOM            VALUE '1200'.         03.36
                   88  WCSC-DS-EMV                VALUE '1300'.         02.95
                   88  WCSC-DS-AIRLINE            VALUE '5100'.         03.03
                   88  WCSC-DS-AT-LEGS            VALUE '5200'.         03.03
                   88  WCSC-DS-PROMO-PGM          VALUE '1700'.         03.16D
                   88  WCSC-DS-REF-ID             VALUE '1800'.         03.16D
003910     05  WORK-FIELDS.
003940       07  WS-US-EQUIVALENT-AMT   PIC S9(12)V999 COMP-3 VALUE +0.
003950       07  WS-BATCH-AMT           PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-REIMB-AMT           PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-IIIAAA-AMT          PIC S9(15)V999 COMP-3 VALUE +0.
003960       07  WS-III999-AMT          PIC S9(15)V999 COMP-3 VALUE +0.
003970       07  WS-CENTER-AMT          PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-BATCH-AMT       PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-REIMB-AMT       PIC S9(15)V999 COMP-3 VALUE +0.
003980       07  WS-GRP-IIIAAA-AMT      PIC S9(15)V999 COMP-3 VALUE +0.
003990       07  WS-GRP-III999-AMT      PIC S9(15)V999 COMP-3 VALUE +0.
004000       07  WS-GRP-CENTER-AMT      PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-REIMB-AMT-VISA  PIC S9(15)V999 COMP-3 VALUE +0.
003980       07  WS-GRP-IIIAAA-AMT-VISA PIC S9(15)V999 COMP-3 VALUE +0.
003990       07  WS-GRP-III999-AMT-VISA PIC S9(15)V999 COMP-3 VALUE +0.
004000       07  WS-GRP-CENTER-AMT-VISA PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-REIMB-AMT-MC    PIC S9(15)V999 COMP-3 VALUE +0.
003980       07  WS-GRP-IIIAAA-AMT-MC   PIC S9(15)V999 COMP-3 VALUE +0.
003990       07  WS-GRP-III999-AMT-MC   PIC S9(15)V999 COMP-3 VALUE +0.
004000       07  WS-GRP-CENTER-AMT-MC   PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-REIMB-AMT-AMEX  PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-REIMB-AMT-AMEX-NS                               03.34F
                                        PIC S9(15)V999 COMP-3 VALUE +0. 03.34F
003980       07  WS-GRP-IIIAAA-AMT-AMEX PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-IIIAAA-AMT-AMEX-NS                              03.34F
                                        PIC S9(15)V999 COMP-3 VALUE +0. 03.34F
003990       07  WS-GRP-III999-AMT-AMEX PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-III999-AMT-AMEX-NS                              03.34F
                                        PIC S9(15)V999 COMP-3 VALUE +0. 03.34F
004000       07  WS-GRP-CENTER-AMT-AMEX PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-CENTER-AMT-AMEX-NS                              03.34F
                                        PIC S9(15)V999 COMP-3 VALUE +0. 03.34F
003950       07  WS-GRP-REIMB-AMT-DISC  PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-REIMB-AMT-DISC-NS                               03.34F
                                        PIC S9(15)V999 COMP-3 VALUE +0. 03.34F
003980       07  WS-GRP-IIIAAA-AMT-DISC PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-IIIAAA-AMT-DISC-NS                              03.34F
                                        PIC S9(15)V999 COMP-3 VALUE +0. 03.34F
003990       07  WS-GRP-III999-AMT-DISC PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-III999-AMT-DISC-NS                              03.34F
                                        PIC S9(15)V999 COMP-3 VALUE +0. 03.34F
004000       07  WS-GRP-CENTER-AMT-DISC PIC S9(15)V999 COMP-3 VALUE +0.
003950       07  WS-GRP-CENTER-AMT-DISC-NS                              03.34F
                                        PIC S9(15)V999 COMP-3 VALUE +0. 03.34F
003950       07  WS-GRP-REIMB-AMT-PP    PIC S9(15)V999 COMP-3 VALUE +0. 03.47
003950       07  WS-GRP-REIMB-AMT-PP-NS                                 03.47
                                        PIC S9(15)V999 COMP-3 VALUE +0. 03.47
003980       07  WS-GRP-IIIAAA-AMT-PP   PIC S9(15)V999 COMP-3 VALUE +0. 03.47
003950       07  WS-GRP-IIIAAA-AMT-PP-NS                                03.47
                                        PIC S9(15)V999 COMP-3 VALUE +0. 03.47
003990       07  WS-GRP-III999-AMT-PP   PIC S9(15)V999 COMP-3 VALUE +0. 03.47
003950       07  WS-GRP-III999-AMT-PP-NS                                03.47
                                        PIC S9(15)V999 COMP-3 VALUE +0. 03.47
004000       07  WS-GRP-CENTER-AMT-PP   PIC S9(15)V999 COMP-3 VALUE +0. 03.47
003950       07  WS-GRP-CENTER-AMT-PP-NS                                03.47
                                        PIC S9(15)V999 COMP-3 VALUE +0. 03.47
004000       07  WORK-NON-SETL-AMT      PIC S9(15)V999 COMP-3 VALUE +0.
004000       07  WORK-NON-SETL-REIMB-AMT
004000                                  PIC S9(15)V999 COMP-3 VALUE +0.
             07  WORK-NON-SETL-CNT      PIC S9(07) COMP-3 VALUE +0.     02.86
             07  WS-TT-SETL-FILE-TOTALS.
               10  WS-TSF-TRN-ACCEPT    PIC S9(09) VALUE +0.
               10  WS-TSF-TRN-REJECT    PIC S9(09) VALUE +0.
               10  WS-TSF-AMT-ACCEPT    PIC S9(15)V999 VALUE +0.
               10  WS-TSF-AMT-REJECT    PIC S9(15)V999 VALUE +0.
             07  WS-CENTER-BREAKDOWN-TOTALS.
               10  WS-CBT-MC-TOTALS COMP-3.
                 15  WS-CBT-MC-06-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-MC-07-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-MC-0O-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-MC-RJ-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-MC-DE-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-MC-06-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-MC-07-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-MC-0O-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-MC-RJ-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-MC-DE-AMT   PIC S9(15)V999 VALUE +0.
               10  WS-CBT-VS-TOTALS COMP-3.
                 15  WS-CBT-VS-06-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-VS-07-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-VS-0O-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-VS-RJ-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-VS-DE-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-VS-06-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-VS-07-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-VS-0O-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-VS-RJ-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-VS-DE-AMT   PIC S9(15)V999 VALUE +0.
               10  WS-CBT-DS-TOTALS COMP-3.
                 15  WS-CBT-DS-06-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-DS-07-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-DS-0O-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-DS-RJ-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-DS-DE-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-DS-06-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-DS-07-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-DS-0O-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-DS-RJ-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-DS-DE-AMT   PIC S9(15)V999 VALUE +0.
               10  WS-CBT-AX-TOTALS COMP-3.                             02.31
                 15  WS-CBT-AX-06-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-AX-07-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-AX-0O-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-AX-RJ-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-AX-DE-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-AX-06-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CBT-AX-07-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CBT-AX-0O-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CBT-AX-RJ-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CBT-AX-DE-AMT   PIC S9(15)V999 VALUE +0.        02.31
               10  WS-CBT-DB-TOTALS COMP-3.                             02.31
                 15  WS-CBT-DB-06-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-DB-07-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-DB-0O-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-DB-RJ-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-DB-DE-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-DB-06-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CBT-DB-07-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CBT-DB-0O-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CBT-DB-RJ-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CBT-DB-DE-AMT   PIC S9(15)V999 VALUE +0.        02.31
               10  WS-CBT-PD-TOTALS COMP-3.                             02.31
                 15  WS-CBT-PD-06-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-PD-07-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-PD-0O-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-PD-RJ-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-PD-DE-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CBT-PD-06-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CBT-PD-07-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CBT-PD-0O-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CBT-PD-RJ-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CBT-PD-DE-AMT   PIC S9(15)V999 VALUE +0.        02.31
               10  WS-CBT-OT-TOTALS COMP-3.
                 15  WS-CBT-OT-06-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-OT-07-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-OT-0O-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-OT-RJ-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-OT-DE-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-OT-06-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-OT-07-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-OT-0O-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-OT-RJ-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-OT-DE-AMT   PIC S9(15)V999 VALUE +0.
               10  WS-CBT-NS-TOTALS COMP-3.
                 15  WS-CBT-NS-06-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-NS-07-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-NS-0O-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-NS-RJ-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-NS-DE-CNT   PIC S9(09) VALUE +0.
                 15  WS-CBT-NS-06-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-NS-07-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-NS-0O-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-NS-RJ-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CBT-NS-DE-AMT   PIC S9(15)V999 VALUE +0.
               10  WS-CBT-PP-TOTALS COMP-3.                             03.47
                 15  WS-CBT-PP-06-CNT   PIC S9(09) VALUE +0.            03.47
                 15  WS-CBT-PP-07-CNT   PIC S9(09) VALUE +0.            03.47
                 15  WS-CBT-PP-0O-CNT   PIC S9(09) VALUE +0.            03.47
                 15  WS-CBT-PP-RJ-CNT   PIC S9(09) VALUE +0.            03.47
                 15  WS-CBT-PP-DE-CNT   PIC S9(09) VALUE +0.            03.47
                 15  WS-CBT-PP-06-AMT   PIC S9(15)V999 VALUE +0.        03.47
                 15  WS-CBT-PP-07-AMT   PIC S9(15)V999 VALUE +0.        03.47
                 15  WS-CBT-PP-0O-AMT   PIC S9(15)V999 VALUE +0.        03.47
                 15  WS-CBT-PP-RJ-AMT   PIC S9(15)V999 VALUE +0.        03.47
                 15  WS-CBT-PP-DE-AMT   PIC S9(15)V999 VALUE +0.        03.47
             07  FILLER REDEFINES WS-CENTER-BREAKDOWN-TOTALS.
               10  WS-CBT-TOTALS COMP-3 OCCURS 9.                       03.47
                 15  WS-CBT-CNT OCCURS 5 PIC S9(09).
                 15  WS-CBT-AMT OCCURS 5 PIC S9(15)V999.
             07  WS-CENTER-TEMP-TOTALS.
               10  WS-CTT-MC-TOTALS COMP-3.
                 15  WS-CTT-MC-06-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-MC-07-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-MC-0O-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-MC-RJ-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-MC-DE-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-MC-06-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-MC-07-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-MC-0O-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-MC-RJ-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-MC-DE-AMT   PIC S9(15)V999 VALUE +0.
               10  WS-CTT-VS-TOTALS COMP-3.
                 15  WS-CTT-VS-06-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-VS-07-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-VS-0O-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-VS-RJ-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-VS-DE-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-VS-06-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-VS-07-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-VS-0O-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-VS-RJ-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-VS-DE-AMT   PIC S9(15)V999 VALUE +0.
               10  WS-CTT-DS-TOTALS COMP-3.
                 15  WS-CTT-DS-06-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-DS-07-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-DS-0O-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-DS-RJ-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-DS-DE-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-DS-06-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-DS-07-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-DS-0O-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-DS-RJ-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-DS-DE-AMT   PIC S9(15)V999 VALUE +0.
               10  WS-CTT-AX-TOTALS COMP-3.                             02.31
                 15  WS-CTT-AX-06-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-AX-07-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-AX-0O-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-AX-RJ-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-AX-DE-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-AX-06-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CTT-AX-07-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CTT-AX-0O-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CTT-AX-RJ-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CTT-AX-DE-AMT   PIC S9(15)V999 VALUE +0.        02.31
               10  WS-CTT-DB-TOTALS COMP-3.                             02.31
                 15  WS-CTT-DB-06-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-DB-07-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-DB-0O-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-DB-RJ-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-DB-DE-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-DB-06-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CTT-DB-07-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CTT-DB-0O-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CTT-DB-RJ-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CTT-DB-DE-AMT   PIC S9(15)V999 VALUE +0.        02.31
               10  WS-CTT-PD-TOTALS COMP-3.                             02.31
                 15  WS-CTT-PD-06-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-PD-07-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-PD-0O-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-PD-RJ-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-PD-DE-CNT   PIC S9(09) VALUE +0.            02.31
                 15  WS-CTT-PD-06-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CTT-PD-07-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CTT-PD-0O-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CTT-PD-RJ-AMT   PIC S9(15)V999 VALUE +0.        02.31
                 15  WS-CTT-PD-DE-AMT   PIC S9(15)V999 VALUE +0.        02.31
               10  WS-CTT-OT-TOTALS COMP-3.
                 15  WS-CTT-OT-06-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-OT-07-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-OT-0O-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-OT-RJ-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-OT-DE-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-OT-06-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-OT-07-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-OT-0O-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-OT-RJ-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-OT-DE-AMT   PIC S9(15)V999 VALUE +0.
               10  WS-CTT-NS-TOTALS COMP-3.
                 15  WS-CTT-NS-06-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-NS-07-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-NS-0O-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-NS-RJ-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-NS-DE-CNT   PIC S9(09) VALUE +0.
                 15  WS-CTT-NS-06-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-NS-07-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-NS-0O-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-NS-RJ-AMT   PIC S9(15)V999 VALUE +0.
                 15  WS-CTT-NS-DE-AMT   PIC S9(15)V999 VALUE +0.
               10  WS-CTT-PP-TOTALS COMP-3.                             03.47
                 15  WS-CTT-PP-06-CNT   PIC S9(09) VALUE +0.            03.47
                 15  WS-CTT-PP-07-CNT   PIC S9(09) VALUE +0.            03.47
                 15  WS-CTT-PP-0O-CNT   PIC S9(09) VALUE +0.            03.47
                 15  WS-CTT-PP-RJ-CNT   PIC S9(09) VALUE +0.            03.47
                 15  WS-CTT-PP-DE-CNT   PIC S9(09) VALUE +0.            03.47
                 15  WS-CTT-PP-06-AMT   PIC S9(15)V999 VALUE +0.        03.47
                 15  WS-CTT-PP-07-AMT   PIC S9(15)V999 VALUE +0.        03.47
                 15  WS-CTT-PP-0O-AMT   PIC S9(15)V999 VALUE +0.        03.47
                 15  WS-CTT-PP-RJ-AMT   PIC S9(15)V999 VALUE +0.        03.47
                 15  WS-CTT-PP-DE-AMT   PIC S9(15)V999 VALUE +0.        03.47
             07  FILLER REDEFINES WS-CENTER-TEMP-TOTALS.
               10  WS-CTT-TOTALS COMP-3 OCCURS 9.                       03.47
                 15  WS-CTT-CNT OCCURS 5 PIC S9(09).
                 15  WS-CTT-AMT OCCURS 5 PIC S9(15)V999.
004010     05  AMOUNT-WORK-AREA.
004040       07  MC-AMOUNT-MAX        PIC S9(9)V999  VALUE +0.
004050       07  AMOUNT-MAX-09-0      PIC S9(9)      VALUE +999999999.
004060       07  AMOUNT-MAX-08-1      PIC S9(8)V9    VALUE +99999999.9.
004070       07  AMOUNT-MAX-07-2      PIC S9(7)V99   VALUE +9999999.99.
004080       07  AMOUNT-MAX-06-3      PIC S9(6)V999  VALUE +999999.999.
004090*
004100       07  AMOUNT-CHK-X.
004110         10  AMOUNT-CHK         PIC S9(12)V9(3).
004120*
004130       07  BREAK-AMOUNT         PIC 9(15)V9(3).
004140       07  FILLER  REDEFINES  BREAK-AMOUNT.
004150         10  FILLER             PIC X(5).
004160         10  BRK-AMOUNT-10      PIC 9(10).
004170         10  FILLER             PIC XXX.
      *
004180     05  HOLD-MERCH-ID          PIC X(15).
004181     05  WS-BANKNET-REF-ALL-9S  PIC X(9)    VALUE '999999999'.
004181     05  WS-MC-BANKNET-REF-NO   PIC X(9)    VALUE SPACES.
004181     05  WS-MC-BANKNET-DATE-X.
004181         10  WS-MC-BANKNET-DATE PIC 9(4)    VALUE ZEROS.
004181     05  WS-TRAN-DATE-X.
004181         10  WS-TRAN-DATE       PIC 9(4)    VALUE ZEROS.
           05  WS-MC-ACCT-LVL-DATE    PIC S9(05) COMP-3.                02.25
PROMST     05  WS-USER-ADJ-REASON-CODES.
PROMST         10  FILLER             PIC X VALUE SPACE.
PROMST             88  WS-ARC-SET-E07             VALUE 'Y'.
PROMST         10  FILLER             PIC X VALUE SPACE.
PROMST             88  WS-ARC-SET-E10             VALUE 'Y'.
PROMST         10  FILLER             PIC X VALUE SPACE.
PROMST             88  WS-ARC-SET-E27             VALUE 'Y'.
PROMST         10  FILLER             PIC X VALUE SPACE.
PROMST             88  WS-ARC-SET-E36             VALUE 'Y'.
PROMST         10  FILLER             PIC X VALUE SPACE.
PROMST             88  WS-ARC-SET-E37             VALUE 'Y'.
PROMST         10  FILLER             PIC X VALUE SPACE.
PROMST             88  WS-ARC-SET-E38             VALUE 'Y'.
           05  WS-DESCR-NAME          PIC X(25)   VALUE SPACES.         03.12
           05  WS-HLD-AMERCAT-EAP-VALIND PIC X    VALUE SPACES.         03.33
           05  WS-HLD-AMERCAT-VALIND     PIC X    VALUE SPACES.         03.33
           05  WS-HLD-AMERCAT-1PT-FLAG   PIC X    VALUE SPACES.         03.34F
           05  WS-HLD-AMERCAT-EAP-FLAG   PIC X    VALUE SPACES.         03.34F
           05  WS-ACI-PH-ORD-CMB-ERR     PIC X    VALUE SPACES.         03.40
004220*
       COPY KMCVSMAX.                                                   02.81
      *                                                                 02.81
004390 01  HOLD-M1-ADDENDUM.
004410     05  HOLD-M11.
               10  FILLER                   PIC X(17).
               10  HOLD-M11-CUSTOM-ID.
                   15  HOLD-M11-CI-TYPE     PIC X(06).
                   15  HOLD-M11-CI-DETAIL   PIC X(76).
               10  FILLER                   PIC X(01).
004220*
004390 01  HOLD-LU-ADDENDUM.
004410     05  HOLD-LU1                     PIC X(100).
004410     05  HOLD-LU2                     PIC X(100).
004220*
       01  HOLD-TRANSACTION-1               PIC X(100).                 02.64
004380*
004390 01  HOLD-TRANSACTION.
004400     05  HT-FIRST-100.
004410         10  HT-TRANSCODE             PIC X(4).
004420         10  FILLER                   PIC X(96).
004400     05  HT-SECOND-100                PIC X(100).
004400     05  HT-THIRD-100                 PIC X(100).
004400     05  HT-FOURTH-100                PIC X(100).
004400     05  HT-FIFTH-100                 PIC X(100).
004450*
005810 01  MERCH-CHK.
005820     05  MERCH-CHK-NUM        PIC 9(16).
005830     05  FILLER   REDEFINES  MERCH-CHK-NUM.
005840         07  FILLER           PIC X(6).
005850         07  MERCH-CHK-NUM-10 PIC 9(10).
005860*
005870 01  WS-BATCH-BIN-DATA.
005880     05  WS-BATCH-BIN-TYPE          PIC X       VALUE 'V'.
005920         88  WS-BATCH-IS-VISA                   VALUE 'V'.
005890     05  WS-BATCH-BIN-COUNTRY       PIC XX      VALUE 'US'.
005900     05  WS-BATCH-BIN               PIC 9(6) COMP-3 VALUE ZEROES.
005930     05  WS-CHD-AR-CHECK-DIG-ALGO               VALUE '1 '.
005940         10  WS-CHD-AR-CD-METHOD    PIC X.
005950             88  WS-CHD-AR-MOD10                VALUE '1'.
005950             88  WS-CHD-AR-MOD00                VALUE '0'.
005950             88  WS-CHD-AR-MOD-VALID            VALUE '0' '1'.
005960         10  FILLER                 PIC X.
006130     05  WS-CHD-AR-BIN-COUNTRY      PIC XX      VALUE SPACES.
006130     05  WS-CHD-AR-PRODUCT-ID       PIC XX      VALUE SPACES.
006140     05  WS-CHD-AR-REPORT-BIN       PIC 9(6) COMP-3 VALUE ZEROES.
006150     05  WS-CHD-ICA                 PIC 9(11)   VALUE ZEROS.
006310*
006320 01  WS-BATCH-ICA-DATA.
005880     05  WS-BATCH-ICA-TYPE          PIC X       VALUE 'M'.
005920         88  WS-BATCH-IS-MASTERCARD             VALUE 'M'.
006330     05  WS-BATCH-ICA-REGN-SUBR.
006340         10  WS-BATCH-ICA-REGN      PIC X       VALUE '1'.
               10  FILLER                 PIC X       VALUE ' '.        02.41
006370     05  WS-BATCH-ICA               PIC 9(11) COMP-3 VALUE ZEROES.
           05  WS-BATCH-ICA-REGIONS.                                    02.41
               10  WS-BATCH-ICA-REGION    PIC X OCCURS 6.               02.41
           05  WS-BATCH-ICA-COUNTRIES.                                  02.41
               10  WS-BATCH-ICA-COUNTRY   PIC X(03) OCCURS 8.           02.41
       01  WS-MRCH-REF-DATA.                                            02.41
           05  WS-MRCH-REF-TYPE           PIC X       VALUE 'N'.        02.41
               88  WS-MRCH-REF-IS-VALID               VALUE 'Y'.        02.41
       01  WS-CHD-ICA-DATA.                                             02.39
006480     05  WS-CHD-ICA-REGN-SUBR.
006490         10  WS-CHD-ICA-REGN        PIC X       VALUE '1'.
               10  FILLER                 PIC X       VALUE ' '.        02.41
           05  WS-CHD-ICA-BANKNET-DATE        PIC 9(06).
           05  WS-CHD-ICA-MPE-ACCEPT-BRAND    PIC X.                    02.39
           05  WS-CHD-ICA-MPE-CARD-TYPE       PIC X(03).                02.39
           05  WS-CHD-ICA-REF-CARD-TYPE       PIC X(03).                02.39
           05  WS-CHD-ICA-MPE-PREPAID         PIC X(01).                02.81
           05  WS-CHD-ICA-PROC-PREPAID        PIC X(01).                02.81
           05  WS-CHD-ICA-PROC-CARD-TYPE      PIC X(03).                02.39
               88  WS-CHD-ICA-IS-MC-HIGH-VALUE                          02.39
                                              VALUE 'MCW' 'MFD' 'MFL'   02.61
                                                    'TCW'.              02.61
               88  WS-CHD-ICA-IS-MC-ENHANCED  VALUE 'MCC' 'MCG' 'MCS'   02.39
                                                    'MCV' 'MCW' 'MFH'   02.95
                                                    'MFW' 'MPL' 'MRJ'   02.95
                                                    'TCC' 'TCG' 'TCS'   02.95
                                                    'TPL'.              02.95
               88  WS-CHD-ICA-IS-MC-BUS-LVL   VALUE 'MAB' 'MCB' 'MEB'   02.95
                                                    'MPC' 'MWB'.        02.95
           05  WS-BANKNET-REF-FLAG            PIC X(01).                02.39
               88  VALID-BANKNET-REF-CRD-TYP  VALUES 'Y'.               02.39
           05  WS-CHD-ICA-ACCT-CAT-TYP-VAL    PIC X(01).
               88  VALID-CHD-ICA-ACCT-CAT     VALUES 'B' THRU 'H'       02.95
                                                     'J' THRU 'K'       02.95
                                                     'M' 'P' 'S' 'T'    02.95
                                                     'W' 'Y' 'Z'.       02.95
               88  VALID-CHD-ICA-ACCT-CAT-ENH VALUES 'B' 'M'.
               88  VALID-CHD-ICA-ACCT-CAT-GRD VALUES 'D' 'F' 'H' 'K'    02.95
                                                     'K' 'M' 'P' 'T'.   02.95
               88  VALID-CHD-ICA-ACCT-CAT-HGH VALUE  'S' 'T'.           02.29
               88  VALID-CHD-ICA-ACCT-BUS-LVL VALUE  'C' THRU 'H'       02.95
                                                     'J' THRU 'K'.      02.95
               88  VALID-CHD-ICA-ACCT-WEL-RED VALUE  'W' 'Y'.           02.61
               88  VALID-CHD-ICA-ACCT-WLD-ELT VALUE  'W'.               02.61
               88  VALID-CHD-ICA-ACCT-WEL-GRD VALUE  'Y'.               02.61
               88  VALID-CHD-ICA-ACCT-CAT-TYP VALUES 'B' 'M' 'P' 'S'    02.62
                                                     'T' 'W' 'Y'.       02.62
           05  WS-CHD-DS-ACCT-PROD-TYP-VAL    PIC X(01).                02.48
               88  VALID-CHD-DS-ACCT-PROD-CCR VALUE  'C'.               02.48
               88  VALID-CHD-DS-ACCT-PROD-CRC VALUE  'R'.               02.48
               88  VALID-CHD-DS-ACCT-PROD-CPC VALUE  'P'.               02.48
               88  VALID-CHD-DS-ACCT-PROD-BCR VALUE  'B'.               02.48
               88  VALID-CHD-DS-ACCT-PROD-UPT VALUE  'Z'.               02.48
      *
       01  WS-MISC-MC-DATA.                                             02.39
           05  WS-MC-ACCEPT-BRAND             PIC X   VALUE SPACE.      02.39
               88  VALID-MC-ACCEPT-BRAND              VALUE ' ' 'C' 'D'.02.39
      *
      * FOLLOWING TABLE IS IN ORDER BY WS-MC-LP2P-LIC                   02.23
           05  WS-MC-LP2P-ACCEPT-BRAND        PIC X   VALUE SPACE.      02.69
           05  WS-MC-LP2P-LIC-TO-PROD.                                  02.23
               10  WS-MC-LP2P-MAX             PIC S9(04) COMP           02.23
                                                         VALUE +200.    02.23
               10  WS-MC-LP2P-CNT             PIC S9(04) COMP VALUE +0. 02.23
               10  WS-MC-LP2P-TABLE           PIC X(2600) VALUE SPACES. 02.23
               10  FILLER REDEFINES WS-MC-LP2P-TABLE.
                   15  WS-MC-LP2P-ENTRY OCCURS 200 INDEXED BY LP2P-INDX.02.23
                       20  WS-MC-LP2P-LIC     PIC X(03).                02.23
                       20  WS-MC-LP2P-PROD    PIC X(03).                02.23
                       20  WS-MC-LP2P-ACCEPT  PIC X(03).                02.23
                       20  WS-MC-LP2P-CLASS   PIC X(03).                02.23
                       20  WS-MC-LP2P-TYPE    PIC X(01).                02.23
                       20  WS-MC-LP2P-CAT     PIC X(01).                03.42M
      *
      * TEMP TABLE RECORDS                                              02.39
           05  WS-MC-TEMP-PROD-GRAD-TABLE.                              02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'MMCC          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'MMCG          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'MMCS          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'MMCU          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'MMPL          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMAB          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMAC          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMCB          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMCC          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMCD          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMCG          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMCO          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMCS          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMCT          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMCU          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMCW          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMDG          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMDH          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMDO          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMDP          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMDQ          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMDR          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMDS          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMDU          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMEB          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMEO          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMEP          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMPC          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMPL          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMUP          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMWB          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMWE          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMWO          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMXO          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMXR          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'PMXS          '.                                02.39
             07  FILLER                     PIC X(14)                   02.39
                 VALUE 'TMCW          '.                                02.39
      *      07  FILLER                     PIC X(40)                   02.39
      *          VALUE 'MMCCMMCGMMCSMMCUMMPLPMABPMACPMCBPMCCPMCD'.      02.39
      *      07  FILLER                     PIC X(40)                   02.39
      *          VALUE 'PMCGPMCOPMCSPMCTPMCUPMCWPMDGPMDHPMDOPMDP'.      02.39
      *      07  FILLER                     PIC X(40)                   02.39
      *          VALUE 'PMDQPMDRPMDSPMDUPMEBPMEOPMEPPMPCPMPLPMUP'.      02.39
      *      07  FILLER                     PIC X(40)                   02.39
      *          VALUE 'PMWBPMWEPMWOPMXOPMXRPMXSTMCW            '.      02.39
      * FOLLOWING TABLE IS USED TO VALIDATE MC PRODUCT GRADUATION       02.39
           05  WS-MC-PROD-GRAD-TABLE.                                   02.39
             07  WS-MC-PGT-MAX              PIC S9(04) COMP VALUE +200. 02.39
             07  WS-MC-PGT-SEARCH           PIC X(04).                  02.39
             07  WS-MC-ALMPG-DATA.                                      02.39
               09  WS-MC-PGT-CNT            PIC S9(04) COMP VALUE +0.   02.39
               09  WS-MC-PGT-ENTRIES        PIC X(2800) VALUE SPACES.   02.39
               09  FILLER REDEFINES WS-MC-PGT-ENTRIES.                  02.39
                 11  WS-MC-PGT-ENTRY OCCURS 200 INDEXED BY PGT-INDX.    02.39
                   13  WS-MC-PGT-CAT-LIC.                               02.39
                     15  WS-MC-PGT-ACCT-CAT PIC X(01).                  02.39
                     15  WS-MC-PGT-LIC-PROD PIC X(03).                  02.39
                   13  WS-MC-PGT-IRD        PIC X(02).                  02.39
                   13  WS-MC-PGT-GCMS-PROD-ID                           02.39
                                            PIC X(03).                  02.39
                   13  WS-MC-PGT-PROD-CLASS PIC X(03).                  02.39
                   13  WS-MC-PGT-PROD-TYPE  PIC X.                      02.39
                   13  WS-MC-PGT-ACCT-TYPE-CAT-CD                       02.39
                                            PIC X.                      02.39
      *                                                                 02.39
       01  WS-VALID-VS-DATA.
           05  WS-VALID-VS-INSTL-FREQUENCY    PIC X(01).                02.23
               88  VALID-VS-INSTL-FREQUENCY   VALUE 'B' 'M' 'W'.        02.23
           05  WS-VALID-VS-DYNAM-CURR-CONV    PIC X(01).                02.61
               88  VALID-VS-DYNAM-CURR-CONV   VALUE ' ' '1'.            02.61
               88  VALID-VS-IS-DYNAM-CURR-CONV                          02.61
                                              VALUE '1'.                02.61
           05  WS-VALID-VS-NBR-PAY-FORMS      PIC X(01).                03.16V
               88  VALID-VS-NBR-PAY-FORMS     VALUE ' ' '+'             03.16V
                                                    '1' THRU '9'.       03.16V
      *
       01  WS-VALID-MC-DATA.
           05  WS-VALID-MC-INSTALL-BONUS-CD  PIC X(01).
               88  VALID-MC-INSTALL-BONUS-CD VALUE '0' '1'.
           05  WS-VALID-MC-DEVICE-TYPE       PIC X(02) VALUE SPACES.    03.16M
               88  VALID-MC-DEVICE-TYPE      VALUE '00' THRU '13'       03.18
                                                   '  '.                03.18
           05  WS-VALID-MC-TRANSIT-PGM.                                 03.16M
             10  WS-VALID-MC-TRAN-TYPE       PIC X(02) VALUE ZEROES.    03.18
               88  VALID-MC-TRAN-TYPE        VALUE '01' THRU '07'       03.18
                                                   '  '.                03.18
             10  WS-VALID-MC-TRAN-MODE       PIC X(02) VALUE ZEROES.    03.18
               88  VALID-MC-TRAN-MODE        VALUE '00' THRU '22'       03.18
                                                   '  '.                03.18
      *
       01  WS-CHD-AMEX-DATA.
         05  WS-CHD-AMEX-ACCT-NO-RANGE-X.
           10  WS-CHD-AMEX-ACCT-NO-RANGE  PIC 9(6).
             88  VALID-CHD-AMEX-ACCT-NO-RANGE  VALUE 340000 THRU 349999
                                                     370000 THRU 379999.
      *
       01  WS-MRCH-AMX-DATA.                                            02.29
           05  WS-MRCH-AMX-TYPE           PIC X       VALUE 'N'.        02.29
               88  WS-MRCH-IS-AMX-NON-SETL            VALUE 'N'.        02.29
               88  WS-MRCH-IS-AMX-SETL                VALUE 'S'.        02.29
               88  WS-MRCH-IS-AMX-EAP                 VALUE 'E'.        03.16A
               88  WS-MRCH-IS-INVALID-AMX             VALUE 'Z'.        03.34F
           05  WS-SAVE-MRCH-AMX-TYPE      PIC X       VALUE ' '.        03.34F
005880*
       01  WS-BATCH-AMX-DATA.                                           CPS
         05  WS-BATCH-AMX-TYPE            PIC X       VALUE 'N'.        CPS
           88  WS-BATCH-IS-AMX-NON-SETL               VALUE 'N'.        CPS
           88  WS-BATCH-IS-AMX-REJECT                 VALUE 'R'.        02.29
           88  WS-BATCH-IS-AMX-BOTH                   VALUE 'B'.        02.29
           88  WS-BATCH-IS-AMX-SETL                   VALUE 'S'.        CPS
      *                                                                 CPS
       01  WS-MRCH-DIS-DATA.
           05  WS-MRCH-DIS-TYPE           PIC X       VALUE 'N'.
               88  WS-MRCH-IS-DIS-NON-SETL            VALUE 'N'.
               88  WS-MRCH-IS-DIS-SETL                VALUE 'S'.
               88  WS-MRCH-IS-INVALID-DIS             VALUE 'Z'.        03.34F
           05  WS-SAVE-MRCH-DIS-TYPE      PIC X       VALUE ' '.        03.34F
      *
       01  WS-BATCH-DIS-DATA.
           05  WS-BATCH-DIS-COUNTRY       PIC X(03)   VALUE 'USA'.      02.39
           05  WS-BATCH-DIS-TYPE          PIC X       VALUE 'N'.
               88  WS-BATCH-IS-DIS-NON-SETL           VALUE 'N'.
               88  WS-BATCH-IS-DIS-REJECT             VALUE 'R'.
               88  WS-BATCH-IS-DIS-BOTH               VALUE 'B'.
               88  WS-BATCH-IS-DIS-SETL               VALUE 'S'.
006560*
006570 01  WS-CHD-DIS-DATA.
005880     05  WS-CHD-DIS-ACCT-NO-RANGE-X.
005880         10  WS-CHD-DIS-ACCT-NO-RANGE   PIC 9(08).
       01  WS-VALID-DIS-DATA.
           05  WS-VALID-DIS-PART-SHIP-IND    PIC X(01).
               88  VALID-DIS-PART-SHIP-IND   VALUE 'N' 'Y'.
006560*
006620 01  BCSETPAR-PASSAREA.
006630     05  TCR2-CALL-TYPE          PIC X.
006640     05  CALCED-SETL-AMT         PIC S9(12)V999  VALUE +0.
006650     05  SPCL-REFNO              PIC X(16).
      *                                                                 02.95
       01  WS-ACCOUNT                PIC 9(16) VALUE ZEROES.            02.95
       01  FILLER REDEFINES WS-ACCOUNT.                                 02.95
           05  WS-ACCOUNT-INST       PIC X(06).                         03.16A
           05  WS-ACCOUNT-MID        PIC X(10).                         02.95
006660*
006730 01  HLD-ZIP-WORK.
006750     05  HLD-ZIP-FRST-5      PIC 99999 VALUE ZEROS.
006770     05  HLD-ZIP-LAST-4      PIC 9999  VALUE ZEROS.
006780*
006790 01  WORK-BANK-NUMBER-2      PIC 9(8).
006800 01  FILLER REDEFINES WORK-BANK-NUMBER-2.
006820     05  WRK-MC-PREFIX       PIC 9(6).
006830     05  FILLER              PIC XX.
006840*
006850 01  WORK-ACCT.
006860     05  WORK-ACCT-17        PIC 9(17).
006870     05  FILLER  REDEFINES  WORK-ACCT-17.
006880         10  FILLER          PIC X.
006890         10  WORK-ACCT-16    PIC 9(16).
006900*
006990 01  BREAKDOWN-ERROR-CODE.
007000     05  FILLER                 PIC X.
007010     05  BEC-CODE-2             PIC XX.
006990 01  FILLER REDEFINES BREAKDOWN-ERROR-CODE.
007010     05  BEC-CODE-NUM           PIC 999.
007020*
007030 01  WS-WORKING-FIELDS.
007070   03  WS-UNKNOWN-CURRENCY         PIC X(30) VALUE
007080     'UNKNOWN CURRENCY CODE        '.
007140   03  WS-CENTER-NAME-1            PIC X(30).
007150   03  WS-CENTER-NAME-2            PIC X(30).
007160   03  WS-CENTER-DATE-FORMAT       PIC X.
007170   03  WS-CENTER-DATE              PIC 9(7).
007060   03  WS-BATCH-CURRENCY-NAME      PIC X(30).
007060   03  WS-REIMB-CURRENCY-NAME      PIC X(30).
007060   03  WS-IIIAAA-CURRENCY-NAME     PIC X(30).
007060   03  WS-III999-CURRENCY-NAME     PIC X(30).
007060   03  WS-CENTER-CURRENCY-NAME     PIC X(30).
007230   03  WS-BATCH-NMBR.
007240       10  WS-BN-FIRST-TWO      PIC 9(2).
007250       10  WS-BN-LAST-FOUR      PIC 9(4).
007260   03  WS-REPORT-LIT            PIC X(40) VALUE
007270                 '           BANKCARD EDIT LIST           '.
007280   03  WS-REPORT-LIT-2          PIC X(40) VALUE
007290                 '      FINAL MONETARY BATCH TOTALS       '.
007300   03  WS-PREV-BANK.
007310      05 WS-PREV-INST       PIC 9(3).
007320      05 WS-PREV-ASSOC      PIC 9(3).
007330   03  WS-BATCHES-READ.
007340      05  WS-BR-BATCH-CNT   PIC S9(6)     VALUE +0.
007350      05  WS-BR-ITEM-CNT    PIC S9(10) VALUE +0.
007360      05  WS-BR-ORIG-AMT    PIC S9(15)V999 VALUE +0.
007370      05  WS-BR-BATCH-AMT   PIC S9(15)V999 VALUE +0.
007380      05  WS-BR-SETTLE-AMT  PIC S9(15)V999 VALUE +0.
007390   03  WS-BATCHES-DELETED.
007400      05  WS-BD-BATCH-CNT   PIC S9(6) VALUE +0.
007410      05  WS-BD-ITEM-CNT    PIC S9(10) VALUE +0.
007420      05  WS-BD-ORIG-AMT    PIC S9(15)V999 VALUE +0.
007430      05  WS-BD-BATCH-AMT   PIC S9(15)V999 VALUE +0.
007440      05  WS-BD-SETTLE-AMT  PIC S9(15)V999 VALUE +0.
007450   03  WS-BATCHES-ACCEPTED.
007460      05  WS-BA-BATCH-CNT   PIC S9(6) VALUE +0.
007470      05  WS-BA-ITEM-CNT    PIC S9(10) VALUE +0.
007480      05  WS-BA-ORIG-AMT    PIC S9(15)V999 VALUE +0.
007490      05  WS-BA-BATCH-AMT   PIC S9(15)V999 VALUE +0.
007500      05  WS-BA-SETTLE-AMT  PIC S9(15)V999 VALUE +0.
007510   03  WS-CURRENCY-TOTALS.
007520      05  WS-CT-BATCH-CNT   PIC S9(6) VALUE +0.
007530      05  WS-CT-ITEM-CNT    PIC S9(10) VALUE +0.
007540      05  WS-CT-BATCH-AMT   PIC S9(15)V999 VALUE +0.
007550      05  WS-CT-SETTLE-AMT  PIC S9(15)V999 VALUE +0.
007560   03  WS-INST-CURR-TOTALS.
007570      05 WS-IC-BATCH-CNT    PIC S9(6) VALUE +0.
007580      05 WS-IC-ITEM-CNT     PIC S9(10) VALUE +0.
007590      05 WS-IC-BATCH-AMT    PIC S9(15)V999 VALUE +0.
007600      05 WS-IC-SETTL-AMT    PIC S9(15)V999 VALUE +0.
007610      05 WS-IC-INST-AMT     PIC S9(15)V999 VALUE +0.
007620   03  WS-INST-TOTAL-TOTALS.
007630      05 WS-IT-BATCH-CNT    PIC S9(6) VALUE +0.
007640      05 WS-IT-ITEM-CNT     PIC S9(10) VALUE +0.
007650      05 WS-IT-BATCH-AMT    PIC S9(15)V999 VALUE +0.
007660      05 WS-IT-INST-AMT     PIC S9(15)V999 VALUE +0.
007670      05 WS-IT-SETTL-AMT    PIC S9(15)V999 VALUE +0.
007680      05 WS-IT-TOTAL-AMT    PIC S9(15)V999 VALUE +0.
007710   03  WS-PREV-CURR         PIC XXX    VALUE SPACES.
007720   03  WS-PREV-BATCH        PIC 9(6).
007730   03  WS-BAC-DEC           PIC S9(4) COMP VALUE +0.
007740   03  WS-BANK.
007750       05 WS-BANK-INST         PIC 999.
007760       05 WS-BANK-ASSN         PIC 999.
007770   03  WS-BANK-2 REDEFINES WS-BANK PIC 9(6).
007780   03  WS-BANK-999999          PIC S9(7) COMP-3 VALUE +999999.
007790   03  WS-IS-THIS-INST-BREAK   PIC 9.
007800       88  WS-INST-BREAK       VALUE 1.
007810   03  WS-IS-INST-ENDED        PIC 9.
007820       88  WS-END-OF-INST      VALUE 1.
007830   03  WS-IS-TTL-ENDED        PIC 9.
007840       88  WS-END-OF-TTL       VALUE 1.
007850   03  WS-PREV-ASSN-CURR       PIC XXX.
007860   03  WS-SAVE-SUB-SEQ         PIC 9(4).
007860   03  WS-NEXT-SUB-SEQ         PIC 9(4).
007870   03  WS-SAVE-SUB-SEQ-TOT     PIC 9(4).
007870   03  WS-LAST-98-SEQ-TOT      PIC 9(4).
007880   03  WS-IS-FIRST-RECORD       PIC 9.
007890       88  WS-FIRST-RECORD     VALUE 1.
007900   03  WS-END-OF-ASSN           PIC 9.
007910       88  WS-ASSN-ENDED        VALUE 1.
007980   03  WS-ASSN-RECS            PIC 9.
007990       88 WS-HAVE-ASSN-RECS    VALUE 1.
008000   03  WS-HOLD-BANK-NBR        PIC 9(6) VALUE ZEROS.
008090   03  WS-CREDIT-OR-DEBIT      PIC X VALUE 'D'.
008100       88  WS-CREDIT           VALUE 'C'.
008110       88  WS-DEBIT            VALUE 'D'.
008120   03  WS-OTR-KEY.
008130     05  WS-OTR-INST-ASSN           PIC S9(6)   COMP-3.
008140     05  WS-OTR-ID                  PIC X.
008150     05  WS-OTR-BATCH-ID            PIC S9(6)   COMP-3.
008160     05  WS-OTR-SOURCE-ID           PIC X.
008170     05  WS-OTR-SEQ-NO              PIC S9(11)  COMP-3 VALUE +0.
         03  WS-OTR-TIME                  PIC 9(11) VALUE 0.
         03  FILLER REDEFINES WS-OTR-TIME.
           05  WS-OTR-TIME-HH-MM          PIC X(04).
           05  FILLER                     PIC X(07).
         03  WS-X-BORDER-COUNTRY                     VALUE SPACES.
           05  WS-X-BORDER-COUNTRY-2 PIC XX.
           05  FILLER                PIC X.
         03  WS-COUNTRY-WORK         PIC XXX.
           88  WS-COUNTRY-IS-US      VALUES 'GUM' 'MHL' 'MNP' 'PRI'
                                            'USA' 'US ' 'VIR'.
       01  WS-LOWER-TO-UPPER.
           03  WS-LC2UC-HALF-WORD.
             05  FILLER                PIC X VALUE LOW-VALUES.
             05  WS-LC2UC-CHAR         PIC X VALUE LOW-VALUES.
           03  WS-LC2UC-ORD REDEFINES WS-LC2UC-HALF-WORD
                                       PIC S9(4) COMP.
           03  WS-LC2UC-SPACE          PIC X VALUE SPACE.
             88 WS-LC2UC-EBCDIC              VALUE X'40'.
             88 WS-LC2UC-ASCII               VALUE X'20'.
      *
008190 01  CONTROL-PARAMETERS.
008200     03  BANK-CTL-TAB-LIM   PIC S9(4) COMP SYNC  VALUE +950.
008210     03  MON-BATCH-TAB-LIM  PIC S9(5) COMP SYNC  VALUE +450.
008220*
008230 01  MNAME-KEY.
008240   03  MNK-BANK-KEY              PIC S9(06) COMP-3 VALUE +0.
008250   03  MNK-MERCH-NMBR            PIC S9(10) COMP-3 VALUE +0.
008260*
008270 01  SWITCH-AREA.
008280     03  FIRST-REC-SW            PIC X           VALUE 'Y'.
008290     03  FIRST-GROUP-SW          PIC X           VALUE 'Y'.
008300     03  MON-BATCH-SW            PIC X           VALUE SPACE.
008310       88  MON-BATCH                             VALUE 'Y'.
008320     03  BATCH-HDR-MISSING-SW    PIC X           VALUE SPACE.
008330       88  BATCH-HDR-MISSING                     VALUE 'Y'.
008340     03  BATCH-REJ-SW            PIC X           VALUE SPACE.
           03  CRITICAL-BATCH-REJ-SW   PIC X           VALUE SPACE.     02.73
008350     03  GRP-REJ-SW              PIC X           VALUE SPACE.
008360     03  VALID-BATCH-ICA-SW      PIC X           VALUE 'N'.
008370       88  BATCH-ICA-NOT-VALID                   VALUE 'N'.
008380     03  BATCH-BYPASSED-SW       PIC X           VALUE SPACE.
008390       88  BATCH-BYPASSED                        VALUE 'Y'.
008400     03  GROUP-SUS-SW            PIC X           VALUE SPACE.
008410     03  END-OF-INPUT-SW         PIC X           VALUE SPACE.
008420       88  END-OF-INPUT                          VALUE 'Y'.
008410     03  END-OF-AM07-SW          PIC X           VALUE SPACE.
008420       88  END-OF-AM07                           VALUE 'Y'.
008450     03  END-OF-WORK-FILE-SW     PIC X           VALUE SPACE.
008460       88  END-OF-WORK-FILE                      VALUE 'Y'.
           03  WS-MC-PROD-GRAD-SW      PIC X           VALUE 'N'.
             88  WS-MC-IS-PROD-GRAD                    VALUE 'Y'.
             88  WS-MC-IS-EVP-PROD-GRAD-STD            VALUE 'S'.
008470     03  INVALID-REF-SW          PIC X           VALUE SPACE.
008480     03  INVALID-MERCH-SW        PIC X           VALUE 'Y'.
008490     03  INVALID-MERCH-TYPE      PIC X           VALUE 'N'.
008500     03  INVALID-ACCT-SW         PIC X           VALUE SPACE.
008510     03  INVALID-DATE-SW         PIC X           VALUE SPACE.
008520     03  INVALID-BIN-SW          PIC X           VALUE SPACE.
           03  INVALID-NAME-ADDR-SW VALUE SPACES.
             05  INVALID-NAME-SW       PIC X.
             05  INVALID-CITY-SW       PIC X.
             05  INVALID-ST-CNTRY-SW   PIC X.
008540     03  INVALID-MCEDFILE-SW     PIC X           VALUE SPACE.
008580     03  INV-GRP-TC-SW           PIC X           VALUE SPACE.
083310     03  WS-SEQ-TOTAL-REACHED    PIC X           VALUE 'N'.
083310     03  WS-FIRST-ADDENDUM-SW    PIC X           VALUE 'Y'.
008590     03  ABORT-RUN-SW            PIC X           VALUE 'N'.
008600*
008610 01  COUNTER-AREA.
008620     03  GROUP-CTR               PIC 9(4)        VALUE ZERO.
008630     03  GROUP-SUS-CTR           PIC 9(4)        VALUE ZERO.
008650     03  BANK-CTR                PIC S9(4) COMP  VALUE +0.
008660     03  INVALID-TRANS-CTR       PIC 99          VALUE ZERO.
008670     03  INV-DET-CTR             PIC 99          VALUE ZERO.
008680     03  INV-DATE-CTR            PIC S9(7)       VALUE +0.
008690     03  GR-SUM-ITEMS-CTR        PIC S9(6)       VALUE +0.
           03  BALANCE-RECS-CNT        PIC S9(4)       VALUE +0.        02.64
           03  BATCH-RECS-CNT          PIC S9(4)       VALUE +0.        02.87
           03  RECON-DATA-RECS-CNT     PIC S9(4)       VALUE +0.        02.87
           03  INTCHG-RATES-CNT        PIC S9(4)       VALUE +0.        02.51
           03  AU-CTR                  PIC S9(4)       VALUE +0.        02.51
           03  AE-CTR                  PIC S9(4)       VALUE +0.        03.16A
           03  DU-CTR                  PIC S9(4)       VALUE +0.        02.51
           03  MI-CTR                  PIC S9(4)       VALUE +0.        02.51
           03  MU-CTR                  PIC S9(4)       VALUE +0.        02.51
           03  PU-CTR                  PIC S9(4)       VALUE +0.        02.51
           03  VI-CTR                  PIC S9(4)       VALUE +0.        02.51
           03  VU-CTR                  PIC S9(4)       VALUE +0.        02.51
           03  BYPASS-CTR              PIC S9(4)       VALUE +0.        02.51
           03  NOT-FND-CTR             PIC S9(4)       VALUE +0.        02.51
008700*
008710 01  PRINT-CTR-AREA.
008720     03  PGE-CTR                 PIC 9999999     VALUE ZERO.      03.64
008730     03  TTL-PGE-CTR             PIC 9999999     VALUE ZERO.      03.64
008740     03  WS-TTL-LINE-CNT         PIC 9(4) COMP   VALUE 60.
008750     03  WS-RPT-LINE-CNT         PIC 9(4) COMP   VALUE 60.
008750     03  WS-RPT-MAX-CNT          PIC 9(4) COMP   VALUE 54.
           03  WS-RPT-VS-LINE-CNT      PIC 9(4) COMP   VALUE 15.        03.42V
           03  WS-RPT-MC-LINE-CNT      PIC 9(4) COMP   VALUE 15.        03.16M
           03  WS-RPT-DS-LINE-CNT      PIC 9(4) COMP   VALUE 15.        03.47
           03  WS-RPT-AX-LINE-CNT      PIC 9(4) COMP   VALUE 15.        03.47
           03  WS-RPT-PD-LINE-CNT      PIC 9(4) COMP   VALUE 12.        02.95
           03  WS-RPT-OT-LINE-CNT      PIC 9(4) COMP   VALUE 10.        02.95
008750     03  WS-RCN-LINE-CNT         PIC 9(4) COMP   VALUE 60.
008750     03  WS-RCN-HEADER-SW        PIC X(1) VALUE '1'.
008750         88  WS-RCN-HEADER-1              VALUE '1'.
008750         88  WS-RCN-HEADER-2              VALUE '2'.
           03  WS-10-POST-PLAN-ADD-IND PIC X(01) VALUE SPACE.           02.95
008760*
008770 01  HOLD-GRP-SUM-INFO-AREA.
008780     03  HOLD-GRP-SUM-SPEC-COND-IND    PIC XX    VALUE SPACES.
008790     03  HOLD-GRP-SUM-MAIL-PHONE-IND   PIC X     VALUE SPACES.
008800     03  HOLD-MRCH-INT-SETL-GRP     PIC 9(6) COMP-3 VALUE ZEROES.
008810*    HOLD-VISA-INT-SETL-GRP CONTAINS THE INST/ASSN NUMBER FOR THE
008820*    OWNER OF THE VISA REFERENCE NUMBER PREFIX. USED FOR ALL
008830*    ORIGINAL MERCHANT DEPOSIT TRANSACTIONS.
008840     03  HOLD-VISA-INT-SETL-GRP     PIC 9(6) COMP-3 VALUE ZEROES.
008850*    HOLD-MC-INT-SETL-GRP CONTAINS THE INST/ASSN NUMBER FOR THE
008860*    OWNER OF THE MASTERCARD REFERENCE NUMBER PREFIX. USED FOR ALL
008870*    ORIGINAL MERCHANT DEPOSIT TRANSACTIONS.
008880     03  HOLD-MC-INT-SETL-GRP       PIC 9(6) COMP-3 VALUE ZEROES.
           03  HOLD-AX-INT-SETL-GRP       PIC 9(6) COMP-3 VALUE ZEROES. 02.29
           03  HOLD-AX-INT-SETL-GRP-NS    PIC 9(6) COMP-3 VALUE ZEROES. 03.61
           03  HOLD-DS-INT-SETL-GRP       PIC 9(6) COMP-3 VALUE ZEROES. 02.29
008900*
       01  WORK-REF-NMBR.
           05  PL-REF-NMBR-X.
               10  PL-REF-DATE               PIC 9(08)     VALUE ZEROS.
               10  PL-REF-SEQ                PIC 9(11)     VALUE ZEROS.
      *
       01  WS-AUTO-PLAN-WORK.                                           02.38
           05  WS-APW-SUB                    PIC S9(04) COMP VALUE +0.  02.38
           05  WS-APW-MAX-FEPLN-RECS         PIC S9(04) COMP VALUE +10. 02.38
           05  WS-APW-MAX-PLANS              PIC S9(04) COMP VALUE +10. 02.38
           05  WS-APW-MAX-ENTRIES            PIC S9(04) COMP            02.38
                                             VALUE +1000.               02.38
           05  WS-APW-NO-ENTRIES             PIC S9(04) COMP VALUE +0.  02.38
       01  WS-AUTO-PLAN-TABLE.                                          02.38
           05  WS-APT-1-100                  PIC X(2200).               02.38
           05  WS-APT-101-200                PIC X(2200).               02.38
           05  WS-APT-201-300                PIC X(2200).               02.38
           05  WS-APT-301-400                PIC X(2200).               02.38
           05  WS-APT-401-500                PIC X(2200).               02.38
           05  WS-APT-501-600                PIC X(2200).               02.38
           05  WS-APT-601-700                PIC X(2200).               02.38
           05  WS-APT-701-800                PIC X(2200).               02.38
           05  WS-APT-801-900                PIC X(2200).               02.38
           05  WS-APT-901-1000               PIC X(2200).               02.38
       01  FILLER REDEFINES WS-AUTO-PLAN-TABLE.                         02.38
           05  WS-APT-RECORD OCCURS 10       PIC X(2200).               02.38
       01  FILLER REDEFINES WS-AUTO-PLAN-TABLE.                         02.38
           05  WS-APT-ENTRY OCCURS 1000                                 02.38
                            INDEXED BY APT-INDX.                        02.38
             07  WS-APT-BASE-PLAN            PIC S9(04) COMP.           02.38
             07  WS-APT-GEN-PLAN-ENTRY OCCURS 10.                       02.38
               09  WS-APT-GPE-PLAN           PIC S9(04) COMP.           02.38
      *                                                                 02.38
           COPY KMCSITBL.                                               02.80
      *                                                                 02.80
       01  WS-REF-NO-WORK.
           05  WS-REF-NO-11-DIGITS           PIC 9(11).
           05  WS-REF-NO-CALC                PIC 9(11)     VALUE ZEROS.
           05  FILLER REDEFINES WS-REF-NO-CALC.
               10  WS-RNC-1-2-DIGITS         PIC 9(02).
               10  WS-RNC-3-4-DIGITS         PIC 9(02).
               10  FILLER                    PIC 9(07).
009090*
009310 01  HOLD-AREA.
009380     03  HLD-HDR-TC.
009390       05  HLD-HDR-TC-PREF       PIC XX          VALUE SPACE.
               88  HLD-VALID-MONETARY-PREF  VALUE '06' THRU '07'        03.31
                                                  '12' THRU '14'        03.31
                                                  '0O'.                 03.31
               88  HLD-VALID-BATCH          VALUE '20' THRU '21'.       03.31
               88  HLD-VALID-1-SIDED-BATCH  VALUE '21'.                 03.31
               88  HLD-VALID-2-SIDED-BATCH  VALUE '20'.                 03.31
               88  HLD-VALID-GROUP          VALUE '30' THRU '31'        03.31
                                                  '28'.                 03.31
               88  HLD-VALID-1-SIDED-GROUP  VALUE '28'.                 03.31
               88  HLD-VALID-2-SIDED-GROUP  VALUE '30' THRU '31'.       03.31
009400       05  HLD-HDR-TC-SUF        PIC XX          VALUE SPACE.
009410     03  HLD-SUM-GROUP-TYPE      PIC X           VALUE SPACE.
009410     03  HLD-SUM-TC.
009420       05  HLD-SUM-TC-PREF       PIC XX          VALUE SPACE.
               88  HLD-VALID-SUM-GROUP      VALUE '30' THRU '31'        03.31
                                                  '28'.                 03.31
009430       05  HLD-SUM-TC-SUF        PIC XX          VALUE SPACE.
009440     03  HLD-HDR-REF-NMBR-23.
009450         05  HLD-HDR-REF-23-FIRST    PIC X(1)    VALUE SPACE.
009460         05  HLD-HDR-REF-NMBR.
009470           07  HLD-HDR-REF-NMBR-PREF PIC 9(6)    VALUE ZERO.
009480           07  HLD-HDR-REF-YDDD      PIC 9(4)    VALUE ZERO.
009490           07  HLD-HDR-REF-LAST-8    PIC 9(8)    VALUE ZERO.
009500         05  HLD-HDR-REF-23-LAST     PIC X(3)    VALUE SPACE.
009510         05  HLD-HDR-REF-23-CHKDGT   PIC X(1)    VALUE SPACE.
009520     03  HLD-SUM-REF-NMBR-23.
009530         05  HLD-SUM-REF-23-FIRST    PIC X(1)    VALUE SPACE.
009540         05  HLD-SUM-REF-NMBR.
009550           07  HLD-SUM-FRST-10       PIC 9(10)   VALUE ZEROS.
009560           07  HLD-SUM-LAST-8        PIC 9(8)    VALUE ZEROS.
009570         05  HLD-SUM-REF-23-LAST     PIC X(3)    VALUE SPACE.
009580         05  HLD-SUM-REF-23-CHKDGT   PIC X(1)    VALUE SPACE.
009590     03  HLD-BANK-NMBR           PIC S9(8) COMP-3 VALUE +0.
           03  HLD-BANK-KEY-X.                                          02.23
             05  HLD-BANK-KEY          PIC 9(6)      VALUE ZEROS.       02.23
           03  HLD-INT-SETL-GRP        PIC 9(06)     VALUE ZEROS.       02.87
           03  HLD-WAO-DATE-CCYYMMDD-X.
             05  HLD-WAO-DATE-CCYYMMDD PIC 9(8)      VALUE ZEROS.
009610     03  HLD-WAO-DATE-7          PIC 9(7)      VALUE ZEROS.
009620     03  FILLER  REDEFINES  HLD-WAO-DATE-7.
009630       05  FILLER                PIC X.
09640       05  HLD-WORK-AS-OF-DATE   PIC 9(6).
009650       05  FILLER  REDEFINES  HLD-WORK-AS-OF-DATE.
009660         07  HLD-WAO-MM-DD.
009670           09  HLD-WAO-MM        PIC 99.
009680           09  HLD-WAO-DD-X.
009690             11  HLD-WAO-DD      PIC 99.
009700         07  HLD-WAO-YY          PIC 99.
009710     03  HLD-REF-DATE            PIC 9(4) VALUE ZEROS.
009720     03  HLD-JULIAN-DATE         PIC S9(5) COMP-3  VALUE +0.
009730     03  HLD-DAY-OF-WEEK.
009740       05  HLD-DAY-OF-WEEK-9     PIC 9.
009750     03  HLD-BTCH-NMBR           PIC 9(6)        VALUE ZERO.
           03  HLD-TRAN-MERCH-NMBR-X.
             05  HLD-TRAN-MERCH-NMBR   PIC 9(16)       VALUE ZERO.
           03  HLD-SUM-MERCH-NMBR-X.
             05  HLD-SUM-MERCH-NMBR    PIC 9(16)       VALUE ZERO.
           03  HLD-RESET-CUST-SVC-PHONE
                                       PIC X(14)       VALUE SPACES.    02.45
           03  HLD-RESET-US-CAN-CS-PHONE                                02.37
                                       PIC X(14)       VALUE SPACES.    02.45
           03  HLD-RESET-URL           PIC X(40).                       02.37
           03  HLD-RESET-EMAIL         PIC X(40).                       02.37
           03  HLD-RESET-DESCR         PIC X(40).
           03  HLD-DESCR-ADDR          PIC X(25)       VALUE SPACES.    02.63
009810     03  HLD-DESCR.
009820       05  HLD-DESCR-NAME        PIC X(25)       VALUE SPACE.
009830       05  HLD-DESCR-CITY        PIC X(13)       VALUE SPACE.
009830       05  FILLER REDEFINES HLD-DESCR-CITY.
009830           10  HLD-DESCR-PHONE   PIC X(07).
009830           10  FILLER            PIC X(06).
009840       05  HLD-DESCR-STATE       PIC XX          VALUE SPACE.
009850     03  HLD-DESCR-COUNTRY                       VALUE SPACE.
009860       05  HLD-DESCR-COUNTRY-2   PIC XX.
009870       05  FILLER                PIC X.
009880     03  HLD-INET-COUNTRY        PIC X(3)        VALUE SPACE.
009880     03  HLD-INET-COUNTRY-NUM-X.
009880       05  HLD-INET-COUNTRY-NUM  PIC 9(3)        VALUE ZEROS.
009880     03  HLD-MRCH-VE-COUNTRY     PIC XX          VALUE SPACES.
009890     03  HLD-VOLUME-TIER-IND     PIC X           VALUE SPACE.
009850     03  HLD-DESCR-CITY-WORK     PIC X(13).
           03  HOLD-MC-CAT-CODE-X.
             05  HOLD-MC-CAT-CODE      PIC 9(04) VALUE ZEROS.
           03  LAST-MC-CAT-CODE-X.
             05  LAST-MC-CAT-CODE      PIC 9(04) VALUE 9999.
           03  HOLD-VS-CAT-CODE-X.
             05  HOLD-VS-CAT-CODE      PIC 9(04) VALUE ZEROS.
           03  LAST-VS-CAT-CODE-X.
             05  LAST-VS-CAT-CODE      PIC 9(04) VALUE 9999.
           03  HOLD-AX-CAT-CODE-X.                                      02.29
             05  HOLD-AX-CAT-CODE      PIC 9(04) VALUE ZEROS.           02.29
           03  LAST-AX-CAT-CODE-X.                                      02.29
             05  LAST-AX-CAT-CODE      PIC 9(04) VALUE 9999.            02.29
           03  HOLD-DS-CAT-CODE-X.                                      02.39
             05  HOLD-DS-CAT-CODE      PIC 9(04) VALUE ZEROS.           02.39
           03  LAST-DS-CAT-CODE-X.                                      02.39
             05  LAST-DS-CAT-CODE      PIC 9(04) VALUE 9999.            02.39
           03  HOLD-MC-PROG-REGIST-ID  PIC X(03) VALUE SPACES.
           03  HOLD-MC-ASSIGN-MRCH-ID  PIC X(06) VALUE SPACES.          02.39
           03  HOLD-CUST-ID-1          PIC S9(16) COMP-3 VALUE +0.
           03  HOLD-CUST-ID-2          PIC S9(16) COMP-3 VALUE +0.
           03  HOLD-MRCH-TAX-ID-FED    PIC S9(09) COMP-3 VALUE +0.
           03  HOLD-MRCH-TAX-ID-ST     PIC S9(09) COMP-3 VALUE +0.
           03  HOLD-NAF-MVV            PIC X(10)       VALUE SPACES.
           03  HOLD-PET-MVV            PIC X(10)       VALUE SPACES.
           03  HOLD-AMEX-SE-FC         PIC 9(02)       VALUE ZEROS.
               88  VALID-AMEX-SE-FC    VALUE 01 02                      03.03
                                             04 THRU 05
                                             11 13 20 22.               03.36
               88  VALID-AMEX-AI       VALUE 01.                        03.03
               88  VALID-AMEX-NO-IND   VALUE 02.
               88  VALID-AMEX-II       VALUE 04.
               88  VALID-AMEX-VR       VALUE 05.
               88  VALID-AMEX-LG       VALUE 11.
               88  VALID-AMEX-CM       VALUE 13.                        03.36
               88  VALID-AMEX-RI       VALUE 20.
               88  VALID-AMEX-ET       VALUE 22.
           03  HOLD-AMEX-SE            PIC 9(10)       VALUE ZEROS.
           03  HOLD-DISCOVER-NO        PIC 9(15)       VALUE ZEROS.
           03  HOLD-DISCOVER-PREFIX    PIC 9(02)       VALUE ZEROS.
           03  HOLD-DISCOVER-COUNTRY-A PIC X(03)       VALUE SPACES.
           03  HOLD-DISCOVER-COUNTRY-N PIC 9(03)       VALUE ZEROS.
010580     03  HLD-SEND-ICA-COUNTRY    PIC X(3)        VALUE SPACES.
010630     03  HLD-MRCH-ER-CD          PIC 99          VALUE ZERO.
010640     03  HLD-STATE               PIC XX          VALUE SPACE.
010650     03  HLD-COUNTRY             PIC X(3)        VALUE SPACES.
010670     03  HLD-ACCOUNT-IN.
010680       05  HLD-ACCOUNT-IN-9      PIC 9(16).
010690     03  FILLER REDEFINES HLD-ACCOUNT-IN.
010700       05  HLD-ACCOUNT-HI-ACCT.
010710         07  HLD-ACCOUNT-BIN     PIC X(6).
010720         07  FILLER              PIC XXX.
010730       05  FILLER                PIC X(7).
010740     03  HLD-ACCOUNT-IN-EXT.
010750       05  HLD-ACCOUNT-IN-EXT-9  PIC 9(7).
010760     03  FILLER  REDEFINES  HLD-ACCOUNT-IN-EXT.
010770       05  HLD-ACCOUNT-IN-EXT-3-X.
010780         07  HLD-ACCOUNT-IN-EXT-3
010790                                 PIC 999.
010800       05  FILLER                PIC X(4).
010810     03  HLD-ACCT-LGTH           PIC 99.
010850     03  HLD-ICA-NMBR-X.
010850       05  HLD-ICA-NMBR          PIC 9(11)           VALUE ZERO.
010930     03  HLD-ITEM-CNT            PIC S9(6)           VALUE +0.
010940     03  HLD-BTCH-AMOUNT       PIC S9(15)V999 COMP-3 VALUE +0.
010950     03  HLD-GRP-AMOUNT        PIC S9(12)V999        VALUE +0.
010960     03  HLD-OPER-NMBR           PIC XXX             VALUE SPACE.
010970     03  HLD-RETURN-CD           PIC 99              VALUE ZERO.
011010*
011020 01  CALCULATE-AMOUNT-AREA.
011030     03  CALC-GRP-AMOUNT         PIC S9(12)V999     VALUE +0.
011040     03  CALC-CH-DEBIT-ITMS      PIC 9(7)           VALUE ZERO.
011050     03  CALC-CH-CREDIT-ITMS     PIC 9(7)           VALUE ZERO.
011060     03  CALC-CH-DEBIT-AMT       PIC S9(15)V999     VALUE +0.
011070     03  CALC-CH-CREDIT-AMT      PIC S9(15)V999     VALUE +0.
011080     03  CALC-RUN-AMT-ACC        PIC S9(15)V999      VALUE +0.
011090     03  CALC-RUN-CNT-ACC        PIC S9(06)          VALUE +0.
011100     03  CALC-RUN-CNT-REJ        PIC S9(06)          VALUE +0.
011110     03  CALC-RUN-AMT-REJ        PIC S9(15)V999      VALUE +0.
011180*
       01  WS-WORK-EXTRA-DATA.                                          02.88
           05  WS-WED-NAME              PIC X(40).                      02.88
      *
011190 01  ERROR-CODE-HOLD-TABLE.
011200*
011210*   3-DIGIT ERROR CODE IS USED FOR NON-MONETARY ERRORS
011220*     (201 - 599)
011230*   2-DIGIT ERROR CODE IS USED FOR MONETARY ERRORS
011240*     AND ERRORS COMMON TO BOTH (EX., ACCOUNT NUMBER ERRORS)
011250*     (01 - 99)
011260*
011270     03  ER-CD-ENTRY     OCCURS 20
011280                         INDEXED BY ER-INDX.
011290       05  ER-CD-3-DIG           PIC 999.
011300       05  ER-CD-BREAK REDEFINES ER-CD-3-DIG.
011310         07  FILLER              PIC 9.
011320         07  ER-CD               PIC 99.
011330       05  ER-CD-ALPH REDEFINES ER-CD-3-DIG.
011340         07  FILLER              PIC X.
011350         07  ER-CD-X             PIC XX.
011360 01  ADD-ERR-CODE-TABLE.
011370*
011380     03  ADD-ER-CD-ENTRY OCCURS 20
011390                         INDEXED BY ADD-ER-INDX.
011400       05  ADD-ER-CD-3-DIG       PIC 999.
011490*
011500 01  VALIDATE-DATE.
011510     03  VD-MM-DD.
011520       05  VD-MM                 PIC 99             VALUE ZEROS.
011530       05  VD-DD                 PIC 99             VALUE ZEROS.
011540     03  VD-MM-DD9 REDEFINES VD-MM-DD    PIC 9(4).
011550     03  VD-YY                   PIC 99             VALUE ZEROS.
011560 01  VALID-DATE REDEFINES VALIDATE-DATE       PIC 9(6).
011570*
011580     COPY DCPASS.
011590*
           COPY KMCADDM.
      *
           COPY KMCINTBL.
011630*
011620     COPY KMCINTEP.
      *
           COPY KMCSDATE.
      *
           COPY KMC110AU.                                               02.51
      *                                                                 02.51
           COPY KMC110AE.                                               03.16A
      *                                                                 03.16A
           COPY KMC110DU.                                               02.51
      *                                                                 02.51
           COPY KMC110MI.                                               02.51
      *                                                                 02.51
           COPY KMC110MU.                                               02.51
      *                                                                 02.51
           COPY KMC110PU.                                               02.51
      *                                                                 02.51
           COPY KMC110VI.                                               02.51
      *                                                                 02.51
           COPY KMC110VU.                                               02.51
      *                                                                 02.51
           COPY MEINPLAN.                                               02.77
      *                                                                 02.51
           COPY KMC90000.                                               02.64
      *                                                                 02.64
           COPY MEINNME.                                                02.77
      *                                                                 02.77
           COPY MEINMERD.                                               02.77
      *                                                                 02.77
       01  WS-MIMFCC-DATA.
           05  WS-MIMFCC-TOTAL-TAXES-X.
               10  WS-MIMFCC-TOTAL-TAXES       PIC S9(12)V9(3).
           05  WS-MIMFCC-FUEL-INFO.
               10  WS-MIMFCC-FI-PRODUCT-CD     PIC X(3).
               10  WS-MIMFCC-FI-UNIT-PRICE-X.
                   15  WS-MIMFCC-FI-UNIT-PRICE PIC S9(12)V9(3).
               10  WS-MIMFCC-FI-UNIT-MEASURE   PIC X(1).
               10  WS-MIMFCC-FI-QUANTITY-X.
                   15  WS-MIMFCC-FI-QUANTITY   PIC 9(6).
               10  WS-MIMFCC-FI-QUANTITY-EXP-X.
                   15  WS-MIMFCC-FI-QUANTITY-EXP
                                               PIC 9.
               10  WS-MIMFCC-FI-SALE-AMT-X.
                   15  WS-MIMFCC-FI-SALE-AMT   PIC S9(12)V9(3).
           05  WS-MIMFCC-ODOMETER-READING      PIC X(07).
      *
       01  WS-MCC-00-STALE-DATE-WORK.
           03  WS-MCC-00-TYP-DATA OCCURS 6.                             02.23
             05  WS-MCC-00-TYP                 PIC 9(02).
             05  WS-MCC-00-TYP-CNT             PIC S9(4) COMP.
             05  WS-MCC-00-DATA.
               07  WS-MCC-00-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-MCC-00-KEY             PIC X(09).
                 10  WS-MCC-00-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-MCC-00-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-MCC-01-STALE-DATE-WORK.
           03  WS-MCC-01-TYP-DATA OCCURS 6.                             02.23
             05  WS-MCC-01-TYP                 PIC 9(02).
             05  WS-MCC-01-TYP-CNT             PIC S9(4) COMP.
             05  WS-MCC-01-DATA.
               07  WS-MCC-01-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-MCC-01-KEY             PIC X(09).
                 10  WS-MCC-01-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-MCC-01-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-MCC-12-STALE-DATE-WORK.
           03  WS-MCC-12-TYP-DATA OCCURS 6.                             02.23
             05  WS-MCC-12-TYP                 PIC 9(02).
             05  WS-MCC-12-TYP-CNT             PIC S9(4) COMP.
             05  WS-MCC-12-DATA.
               07  WS-MCC-12-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-MCC-12-KEY             PIC X(09).
                 10  WS-MCC-12-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-MCC-12-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-MCC-18-STALE-DATE-WORK.
           03  WS-MCC-18-TYP-DATA OCCURS 6.                             02.23
             05  WS-MCC-18-TYP                 PIC 9(02).
             05  WS-MCC-18-TYP-CNT             PIC S9(4) COMP.
             05  WS-MCC-18-DATA.
               07  WS-MCC-18-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-MCC-18-KEY             PIC X(09).
                 10  WS-MCC-18-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-MCC-18-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-MCC-20-STALE-DATE-WORK.
           03  WS-MCC-20-TYP-DATA OCCURS 6.                             02.23
             05  WS-MCC-20-TYP                 PIC 9(02).
             05  WS-MCC-20-TYP-CNT             PIC S9(4) COMP.
             05  WS-MCC-20-DATA.
               07  WS-MCC-20-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-MCC-20-KEY             PIC X(09).
                 10  WS-MCC-20-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-MCC-20-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-MCC-28-STALE-DATE-WORK.
           03  WS-MCC-28-TYP-DATA OCCURS 6.                             02.23
             05  WS-MCC-28-TYP                 PIC 9(02).
             05  WS-MCC-28-TYP-CNT             PIC S9(4) COMP.
             05  WS-MCC-28-DATA.
               07  WS-MCC-28-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-MCC-28-KEY             PIC X(09).
                 10  WS-MCC-28-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-MCC-28-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-DMC-00-STALE-DATE-WORK.
           03  WS-DMC-00-TYP-DATA OCCURS 6.                             02.23
             05  WS-DMC-00-TYP                 PIC 9(02).
             05  WS-DMC-00-TYP-CNT             PIC S9(4) COMP.
             05  WS-DMC-00-DATA.
               07  WS-DMC-00-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-DMC-00-KEY             PIC X(09).
                 10  WS-DMC-00-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-DMC-00-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-DMC-01-STALE-DATE-WORK.
           03  WS-DMC-01-TYP-DATA OCCURS 6.                             02.23
             05  WS-DMC-01-TYP                 PIC 9(02).
             05  WS-DMC-01-TYP-CNT             PIC S9(4) COMP.
             05  WS-DMC-01-DATA.
               07  WS-DMC-01-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-DMC-01-KEY             PIC X(09).
                 10  WS-DMC-01-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-DMC-01-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-DMC-09-STALE-DATE-WORK.
           03  WS-DMC-09-TYP-DATA OCCURS 6.                             02.23
             05  WS-DMC-09-TYP                 PIC 9(02).
             05  WS-DMC-09-TYP-CNT             PIC S9(4) COMP.
             05  WS-DMC-09-DATA.
               07  WS-DMC-09-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-DMC-09-KEY             PIC X(09).
                 10  WS-DMC-09-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-DMC-09-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-DMC-12-STALE-DATE-WORK.
           03  WS-DMC-12-TYP-DATA OCCURS 6.                             02.23
             05  WS-DMC-12-TYP                 PIC 9(02).
             05  WS-DMC-12-TYP-CNT             PIC S9(4) COMP.
             05  WS-DMC-12-DATA.
               07  WS-DMC-12-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-DMC-12-KEY             PIC X(09).
                 10  WS-DMC-12-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-DMC-12-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-DMC-18-STALE-DATE-WORK.
           03  WS-DMC-18-TYP-DATA OCCURS 6.                             02.23
             05  WS-DMC-18-TYP                 PIC 9(02).
             05  WS-DMC-18-TYP-CNT             PIC S9(4) COMP.
             05  WS-DMC-18-DATA.
               07  WS-DMC-18-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-DMC-18-KEY             PIC X(09).
                 10  WS-DMC-18-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-DMC-18-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-DMC-20-STALE-DATE-WORK.
           03  WS-DMC-20-TYP-DATA OCCURS 6.                             02.23
             05  WS-DMC-20-TYP                 PIC 9(02).
             05  WS-DMC-20-TYP-CNT             PIC S9(4) COMP.
             05  WS-DMC-20-DATA.
               07  WS-DMC-20-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-DMC-20-KEY             PIC X(09).
                 10  WS-DMC-20-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-DMC-20-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-DMC-28-STALE-DATE-WORK.
           03  WS-DMC-28-TYP-DATA OCCURS 6.                             02.23
             05  WS-DMC-28-TYP                 PIC 9(02).
             05  WS-DMC-28-TYP-CNT             PIC S9(4) COMP.
             05  WS-DMC-28-DATA.
               07  WS-DMC-28-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-DMC-28-KEY             PIC X(09).
                 10  WS-DMC-28-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-DMC-28-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  WS-WRK-STALE-DATE-WORK.
           03  WS-WRK-SD-TYP-DATA OCCURS 6.                             02.23
             05  WS-WRK-SD-TYP                 PIC 9(02).
             05  WS-WRK-SD-DATA.
               07  WS-WRK-SD-TYP-CNT           PIC S9(4) COMP.
               07  WS-WRK-SD-DATA-ENTRY OCCURS 350.                     02.95
                 10  WS-WRK-SD-KEY             PIC X(09).
                 10  WS-WRK-SD-NON-AIR-DATE    PIC S9(05) COMP-3.
                 10  WS-WRK-SD-AIR-DATE        PIC S9(05) COMP-3.
      *
       01  BANKCTRL-EDIT-INFO.
           05  BE-BCTRL-KEY              PIC S9(6) COMP-3 VALUE +0.
           05  BE-ICA-NMBR               PIC S9(11) COMP-3.
           05  BE-REF-NMBR-PREFIX        PIC S9(6) COMP-3.
           05  BE-MC-REF-PREFIX          PIC S9(6) COMP-3.
           05  BE-ACQ-MEMBER-ID          PIC S9(8) COMP-3.
           05  BE-INT-SETL-GRP           PIC S9(6) COMP-3.
           05  BE-DATE-FORMAT            PIC X.
           05  BE-OWNER-IND              PIC X.
           05  BE-DISCOVER-OWNER-IND     PIC 9.
           05  BE-DISCOVER-CLIENT-ID     PIC 999.
           05  BE-DISCOVER-ACQUIRER-ID   PIC S9(11) COMP-3.
           05  BE-AMEX-OWNER-IND         PIC 9.                         02.29
           05  BE-AMEX-ESA-SUBMITTER-ID  PIC X(11).                     03.16A
           05  BE-AMEX-1PT-SUBMITTER-ID  PIC X(11).                     02.29
           05  BE-AMEX-EAP-SUBMITTER-ID  PIC X(11).                     03.16A
           05  BE-BILL-CURR-CODE.
               10  BE-BILL-CURR-CODE-NUM PIC 999.
           05  BE-ALT-CURR-CODE.
               10  BE-ALT-CURR-CODE-NUM  PIC 999.
           05  BE-SETTLEMENT-CURR-CODE.
               10  BE-SETTLEMENT-CURR-CODE-NUM
                                         PIC 999.
           05  BE-CF-VS-SETL             PIC X(01).
           05  BE-CF-MC-SETL             PIC X(01).
           05  BE-CF-AX-SETL             PIC X(01).
           05  BE-CF-DS-SETL             PIC X(01).
           05  BE-CF-VS                  PIC 9(02).
           05  BE-CF-MC                  PIC 9(02).
           05  BE-CF-AX                  PIC 9(02).
           05  BE-CF-DS                  PIC 9(02).
           05  BE-MULTI-CURRENCY-FLAG    PIC X(01).
           05  BE-CUST-BANK-ID           PIC S9(04) COMP-3.
           05  BE-SETTL-PARTIC           PIC S9(04) COMP.
           05  BE-COUNTRY                PIC X(03).                     02.39
      *
121800 01  WS-PEM-NOTONUS-FLAGS.
121900     05  WS-PEM-NF-VISA            PIC X(01).
121900     05  WS-PEM-NF-MC              PIC X(01).
           05  FILLER                    PIC X(01).                     02.41
           05  FILLER                    PIC X(01).
121900     05  WS-PEM-NF-AMEX            PIC X(01).
122000     05  WS-PEM-NF-DISC            PIC X(01).
           05  FILLER                    PIC X(01).                     02.41
           05  WS-PEM-NF-PP              PIC X(01).                     03.47
       01  WS-SAVE-PEM-NOTONUS-FLAGS     PIC X(08) VALUE SPACES.
011830*
011840 01  WS-CHECK-ACCOUNT.
011850     03  WCA-ACCT-16.
011860         05  WCA-ACCT-1-9.
011870             07  WCA-ACCT-1-6.
011880                 09  WCA-ACCT-1      PIC X.
011890                 09  FILLER          PIC X(5).
011900             07  FILLER              PIC XXX.
011910         05  FILLER              PIC X(7).
011920     03  WCA-ACCT-17-19          PIC XXX.
011930 01  FILLER REDEFINES WS-CHECK-ACCOUNT.
011940     03  WS-CK-ACCNUM            PIC X OCCURS 19 TIMES.
011950*
011960 01  WS-LEFT-ZERO-FILL-ACCT.
011970     03  WS-LEFT-ZERO-NUM          PIC X(19).
011980     03  WS-LZERO-ACCNUM  REDEFINES  WS-LEFT-ZERO-NUM
011990         OCCURS 19 TIMES           PIC X.
012000 01  WS-LEFT-ZERO-HOLD  REDEFINES  WS-LEFT-ZERO-FILL-ACCT.
012010     03  WSL-HOLD-ZERO-16.
012020         05  WSL-HOLD-ZERO-16-NUM  PIC 9(16).
012030         05  FILLER  REDEFINES  WSL-HOLD-ZERO-16-NUM.
012040           07  FILLER              PIC X(14).
012050           07  WSL-ONE-POS-SEQ     PIC 9(01).
012060           07  FILLER              PIC X(01).
012070         05  FILLER  REDEFINES  WSL-HOLD-ZERO-16-NUM.
012080           07  WSL-HOLD-ZERO-13    PIC X(13).
012090           07  WSL-HOLD-ZERO-POS-14-16.
012100               09  WSL-TWO-POS-SEQ PIC 9(02).
012110               09  FILLER          PIC X(01).
012120         05  FILLER  REDEFINES  WSL-HOLD-ZERO-16-NUM.
012130           07  FILLER              PIC X(12).
012140           07  WSL-THREE-POS-SEQ   PIC 9(03).
012150           07  FILLER              PIC X(01).
012160         05  FILLER  REDEFINES  WSL-HOLD-ZERO-16-NUM.
012170           07  FILLER              PIC X(11).
012180           07  WSL-FOUR-POS-SEQ    PIC 9(04).
012190           07  FILLER              PIC X(01).
012200         05  FILLER  REDEFINES  WSL-HOLD-ZERO-16-NUM.
012210           07  FILLER              PIC X(10).
012220           07  WSL-FIVE-POS-SEQ    PIC 9(05).
012230           07  FILLER              PIC X(01).
012240     03  WSL-HOLD-ZERO-LAST-3-X.
012250         05  WSL-HOLD-ZERO-LAST-3  PIC 999.
012260 01  WS-LEFT-ACCT.
012270     03  WS-LEFT-SHIFT-NUM       PIC X(19).
012280     03  WS-LSHIFT-ACCNUM REDEFINES WS-LEFT-SHIFT-NUM PIC X
012290         OCCURS 19 TIMES.
012300 01  WS-LEFT-ACCT-HOLD REDEFINES WS-LEFT-ACCT.
012310       05  WSL-HOLD-ACCT-16.
012320         07  WSL-HOLD-ACCT-16-NUM PIC 9(16).
012330       05  WSL-HOLD-ACCT-LAST-3  PIC X(3).
012340 01  WSL-ACCT-BNK REDEFINES WS-LEFT-ACCT.
012350       05  WSL-FIRST-13.
012360         07  WSL-PREFIX.
012370           09  WSL-FRST-1        PIC X.
012380           09  FILLER            PIC X(5).
012390         07  WSL-ACCT-7-11     PIC X(5).
012400         07  WSL-ACCT-12       PIC X.
012410         07  WSL-ACCT-13       PIC X.
012420       05  WSL-ACCT-14           PIC X.
012430       05  WSL-ACCT-15           PIC X.
012440       05  WSL-ACCT-16           PIC X.
012450       05  FILLER                PIC XXX.
012460 01  FILLER REDEFINES WS-LEFT-ACCT.
012470       05  WSL-ACCT-1-9-X.
012480         07  WSL-ACCT-1-9        PIC 9(9).
012490       05  FILLER                PIC X(10).
012500*
       01  WS-MC-LAST-CAB-PROGRAMS       VALUE SPACES.
           05  WS-MC-LAST-CAB-PROG OCCURS 70                            02.29
                                         PIC X(04).
       01  WS-MC-LAST-STALE-KEY          VALUE SPACES.
           05  FILLER                    PIC X(01).
           05  WS-MC-LSK-TRAN-TYPE       PIC X(02).
           05  WS-MC-LSK-FROM-TYPE       PIC X(02).
           05  WS-MC-LSK-ACCEPT-BRAND    PIC X(01).
           05  FILLER                    PIC X(15).
       01  WS-MC-LAST-PREFIX-HIGH-BIN    PIC X(19) VALUE SPACES.
       01  WS-MC-LAST-BIN-ID             PIC X(06) VALUE SPACES.
       01  WS-MC-MAX-CAB-CNT             PIC 9(03) VALUE ZEROS.
       01  WS-MC-MAX-CAB-BSA-CNT         PIC 9(03) VALUE ZEROS.         02.29
012510 01  WS-MC-PREFIX-HIGH-BIN         PIC X(19).
012510 01  WS-MC-REF-NO-PREFIX           PIC X(06).
012500*
012940 01  WS-MC-AMS-CLEAR-TABLE.
013120     05  FILLER                    PIC X(03) VALUE '101'.
013120     05  FILLER                    PIC X(03) VALUE 'A02'.
013120     05  FILLER                    PIC X(03) VALUE 'B03'.
013120     05  FILLER                    PIC X(03) VALUE 'C04'.
013120     05  FILLER                    PIC X(03) VALUE 'D05'.
013120     05  FILLER                    PIC X(03) VALUE 'E06'.
012940 01  FILLER REDEFINES WS-MC-AMS-CLEAR-TABLE.
011660     05  WS-MC-ACT-ENTRY OCCURS 6 INDEXED BY ACT-INDX.
013000         10 WS-MC-ACT-AMS-REGN     PIC X.
013000         10 WS-MC-ACT-CLR-REGN     PIC 99.
013060*
013070     COPY KMCDSDAT.
013060*
013070     COPY KMCVSDAT.
013080*
013070     COPY KMCEUDAT.
013080*
013090     COPY KMCEFREC.
013080*
013090     COPY KMCMCREC.
013080*
           COPY KMC10004.
      *
           COPY KMCMCCPW.
      *
       01  WS-WRK-ISS-AREA.
           05  WS-WRK-IA-MAX-ENTRIES         PIC S9(04) COMP VALUE +50.
           05  WS-WRK-IA-PREFIX-HIGH-BIN     PIC X(19) VALUE ZEROS.
           05  WS-WRK-IA-ACCEPT-BRAND        PIC X(03) VALUE SPACES.
           05  WS-WRK-IA-DATA.
             07  WS-WRK-IA-CNT               PIC S9(04) COMP.
             07  WS-WRK-IA-ENTRY OCCURS 50.
               10  WS-WRK-IA-BSA.
                 12  WS-WRK-IA-BSA-LVL       PIC X(01).
                 12  WS-WRK-IA-BSA-ID        PIC X(06).
               10  WS-WRK-IA-BSA-ENF-IND     PIC X(01).
      *
       01  WS-MCC-ACQ-WORK-AREA.
           05  WS-MCC-ACQ-CNT                PIC S9(04) COMP.
           05  WS-MCC-ACQ-DATA.
             07  WS-MCC-ACQ-ENTRY OCCURS 50.
               10  WS-MCC-ACQ-BSA.
                 12  WS-MCC-ACQ-BSA-LVL      PIC X(01).
                 12  WS-MCC-ACQ-BSA-ID       PIC X(06).
      *
       01  WS-DMC-ACQ-WORK-AREA.
           05  WS-DMC-ACQ-CNT                PIC S9(04) COMP.
           05  WS-DMC-ACQ-DATA.
             07  WS-DMC-ACQ-ENTRY OCCURS 50.
               10  WS-DMC-ACQ-BSA.
                 12  WS-DMC-ACQ-BSA-LVL      PIC X(01).
                 12  WS-DMC-ACQ-BSA-ID       PIC X(06).
      *
       01  WS-WRK-ACQ-AREA.
           05  WS-WRK-AA-MAX-ENTRIES         PIC S9(04) COMP VALUE +50.
           05  WS-WRK-AA-BIN-ID              PIC X(06) VALUE ZEROS.
           05  WS-WRK-AA-DATA.
             07  WS-WRK-AA-CNT               PIC S9(04) COMP.
             07  WS-WRK-AA-ENTRY OCCURS 50.
               10  WS-WRK-AA-BSA.
                 12  WS-WRK-AA-BSA-LVL       PIC X(01).
                 12  WS-WRK-AA-BSA-ID        PIC X(06).
      *
       01  WS-WRK-COMMON-AREA.
           05  WS-WRK-CA-MAX-ENTRIES         PIC S9(04) COMP VALUE +75.
           05  WS-WRK-CA-DATA.
             07  WS-WRK-CA-CNT               PIC S9(04) COMP.
             07  WS-WRK-CA-ENTRY OCCURS 75.
               10  WS-WRK-CA-BSA.
                 12  WS-WRK-CA-BSA-LVL       PIC X(01).
                 12  WS-WRK-CA-BSA-ID        PIC X(06).
               10  WS-WRK-CA-BSA-ENF-IND     PIC X(01).
      *
       01  WS-WRK-COMMON-BSA-IRD-AREA.
           05  WS-WRK-CBIA-CNT               PIC S9(04) COMP.
           05  WS-WRK-CBIA-ENTRY OCCURS 3200.
             07  WS-WRK-CBIA-BSA.
               10  WS-WRK-CBIA-BSA-LVL       PIC X(01).
               10  WS-WRK-CBIA-BSA-ID        PIC X(06).
             07  WS-WRK-CBIA-BSA-ENF-IND     PIC X(01).
             07  WS-WRK-CBIA-IRD             PIC X(02).
      *
       01  WS-PRODUCT-ID-HOLD-AREA.
           05  WS-PIH-MAX-PROD-ENTRIES       PIC S9(04) COMP VALUE +150.02.73
           05  WS-PIH-MAX-IRD-ENTRIES        PIC S9(04) COMP VALUE +99. 02.29
           05  WS-PIH-MAX-BSA-ENTRIES        PIC S9(04) COMP VALUE +10. 02.68
           05  WS-PIH-PROD-CNT               PIC S9(04) COMP VALUE +0.
           05  WS-PIH-TSUB                   PIC S9(04) COMP VALUE +0.
           05  WS-PIH-ISUB                   PIC S9(04) COMP VALUE +0.
           05  WS-PIH-BSUB                   PIC S9(04) COMP VALUE +0.
      *
       01  WS-MCC-PRODUCT-DATA.
           05  WS-MCC-PROD-NO-ENTRIES        PIC S9(04) COMP VALUE +0.
           05  WS-MCC-PROD-OCCUR OCCURS 150.                            02.73
             07  WS-MCC-PRODUCT-ID           PIC X(03).
             07  WS-MCC-PROD-DATA.
               10  WS-MCC-PROD-CNT           PIC S9(04) COMP.
               10  WS-MCC-PROD-ENTRY OCCURS 15.                         02.95
                 12  WS-MCC-PROD-BSA.
                   15  WS-MCC-PROD-BSA-LVL   PIC X(01).
                   15  WS-MCC-PROD-BSA-ID    PIC X(06).
                 12  WS-MCC-PROD-IRD-CNT     PIC S9(04) COMP.
                 12  WS-MCC-PROD-IRD-ENTRY OCCURS 120.                  02.95
                   15  WS-MCC-PROD-IRD       PIC X(02).
      *
       01  WS-DMC-PRODUCT-DATA.
           05  WS-DMC-PROD-NO-ENTRIES        PIC S9(04) COMP VALUE +0.
           05  WS-DMC-PROD-OCCUR OCCURS 150.                            02.73
             07  WS-DMC-PRODUCT-ID           PIC X(03).
             07  WS-DMC-PROD-DATA.
               10  WS-DMC-PROD-CNT           PIC S9(04) COMP.
               10  WS-DMC-PROD-ENTRY OCCURS 15.                         02.95
                 12  WS-DMC-PROD-BSA.
                   15  WS-DMC-PROD-BSA-LVL   PIC X(01).
                   15  WS-DMC-PROD-BSA-ID    PIC X(06).
                 12  WS-DMC-PROD-IRD-CNT     PIC S9(04) COMP.
                 12  WS-DMC-PROD-IRD-ENTRY OCCURS 120.                  02.95
                   15  WS-DMC-PROD-IRD       PIC X(02).
      *
       01  WS-WRK-PRODUCT-ENTRY.
           05  WS-WRK-PRODUCT-ID             PIC X(03) VALUE SPACES.
           05  WS-WRK-PROD-ACCEPT-BRAND      PIC X(03) VALUE SPACES.
           05  WS-WRK-PROD-DATA.
             07  WS-WRK-PROD-CNT             PIC S9(04) COMP.
             07  WS-WRK-PROD-ENTRY OCCURS 15.                           02.95
               10  WS-WRK-PROD-BSA.
                 12  WS-WRK-PROD-BSA-LVL     PIC X(01).
                 12  WS-WRK-PROD-BSA-ID      PIC X(06).
               10  WS-WRK-PROD-IRD-CNT       PIC S9(04) COMP.
               10  WS-WRK-PROD-IRD-ENTRY OCCURS 120.                    02.95
                 12  WS-WRK-PROD-IRD         PIC X(02).
      *
       01  WS-MCC-CAB-PROG-DATA.
           05  WS-MCC-CAB-CNT                PIC S9(04) COMP VALUE +0.
           05  WS-MCC-CAB-ENTRY OCCURS 70.                              02.27
             07  WS-MCC-CAB-PROG             PIC X(04).
             07  WS-MCC-CAB-DATA.
               10  WS-MCC-BSA-CNT            PIC S9(04) COMP.
               10  WS-MCC-BSA-ENTRY OCCURS 15.                          02.95
                 12  WS-MCC-BSA.
                   15  WS-MCC-BSA-LVL        PIC X(01).
                   15  WS-MCC-BSA-ID         PIC X(06).
                 12  WS-MCC-IRD-CNT          PIC S9(04) COMP.
                 12  WS-MCC-IRD-ENTRY OCCURS 120.                       02.95
                   15  WS-MCC-IRD            PIC X(02).
      *
       01  WS-DMC-CAB-PROG-DATA.
           05  WS-DMC-CAB-CNT                PIC S9(04) COMP VALUE +0.
           05  WS-DMC-CAB-ENTRY OCCURS 70.                              02.27
             07  WS-DMC-CAB-PROG             PIC X(04).
             07  WS-DMC-CAB-DATA.
               10  WS-DMC-BSA-CNT            PIC S9(04) COMP.
               10  WS-DMC-BSA-ENTRY OCCURS 15.                          02.95
                 12  WS-DMC-BSA.
                   15  WS-DMC-BSA-LVL        PIC X(01).
                   15  WS-DMC-BSA-ID         PIC X(06).
                 12  WS-DMC-IRD-CNT          PIC S9(04) COMP.
                 12  WS-DMC-IRD-ENTRY OCCURS 120.                       02.95
                   15  WS-DMC-IRD            PIC X(02).
      *
       01  WS-WRK-CAB-PROG-DATA.
           05  WS-WRK-CAB-CNT                PIC S9(04) COMP VALUE +0.
           05  WS-WRK-CAB-ENTRY OCCURS 70.                              02.27
             07  WS-WRK-CAB-PROG             PIC X(04).
             07  WS-WRK-CAB-DATA.
               10  WS-WRK-CAB-BSA-CNT        PIC S9(04) COMP.
               10  WS-WRK-CAB-BSA-ENTRY OCCURS 15.                      02.95
                 12  WS-WRK-CAB-BSA.
                   15  WS-WRK-CAB-BSA-LVL    PIC X(01).
                   15  WS-WRK-CAB-BSA-ID     PIC X(06).
                 12  WS-WRK-CAB-IRD-CNT      PIC S9(04) COMP.
                 12  WS-WRK-CAB-IRD-ENTRY OCCURS 120.                   02.95
                   15  WS-WRK-CAB-IRD        PIC X(02).
      *                                                                 02.23
           COPY KMC10002.                                               02.23
      *                                                                 02.23
013390 01  VISA-NOTONUS-TOTS.
013400     05  VISA-NOU-TOT OCCURS 3 TIMES.
013410       10  VISA-NOU-TC           PIC X(4).
013420       10  VISA-NOU-ITMS         PIC S9(7)       COMP-3.
013430       10  VISA-NOU-AMOUNT       PIC S9(15)V999  COMP-3.
013440 01  MC-NOTONUS-TOTS.
013450     05  MC-NOU-TOT OCCURS 3 TIMES.
013460       10  MC-NOU-TC             PIC X(4).
013470       10  MC-NOU-ITMS           PIC S9(7)       COMP-3.
013480       10  MC-NOU-AMOUNT         PIC S9(15)V999  COMP-3.
013440 01  AMEX-NOTONUS-TOTS.
013450     05  AMEX-NOU-TOT OCCURS 3 TIMES.
013460       10  AMEX-NOU-TC             PIC X(4).
013470       10  AMEX-NOU-ITMS           PIC S9(7)       COMP-3.
013480       10  AMEX-NOU-AMOUNT         PIC S9(15)V999  COMP-3.
013440 01  DISC-NOTONUS-TOTS.
013450     05  DISC-NOU-TOT OCCURS 3 TIMES.
013460       10  DISC-NOU-TC             PIC X(4).
013470       10  DISC-NOU-ITMS           PIC S9(7)       COMP-3.
013480       10  DISC-NOU-AMOUNT         PIC S9(15)V999  COMP-3.
013440 01  PP-NOTONUS-TOTS.                                             03.47
013450     05  PP-NOU-TOT OCCURS 3 TIMES.                               03.47
013460       10  PP-NOU-TC               PIC X(4).                      03.47
013470       10  PP-NOU-ITMS             PIC S9(7)       COMP-3.        03.47
013480       10  PP-NOU-AMOUNT           PIC S9(15)V999  COMP-3.        03.47
013440 01  PL-NOTONUS-TOTS.
013450     05  PL-NOU-TOT OCCURS 3 TIMES.
013460       10  PL-NOU-TC             PIC X(4).
013470       10  PL-NOU-ITMS           PIC S9(7)       COMP-3.
013480       10  PL-NOU-AMOUNT         PIC S9(15)V999  COMP-3.
013540 01  TRANSCODE-MERCHANT-TOTS.
013550     05  TC-MRCH-TOT OCCURS 10 TIMES.
013560       10  TC-MRCH-TRANS         PIC X(4).
013570       10  TC-MRCH-ITMS          PIC S9(7)       COMP-3.
013580       10  TC-MRCH-AMOUNT        PIC S9(12)V999  COMP-3.
013590*
013600 01  ST-BATCH-INFO.
013610   02  SB-CALC-AMT               PIC S9(15)V999 COMP-3 VALUE +0.
013620   02  SB-TOTAL-REC.
013630     03  SB-SORT-KEY.
013640       04  SB-BANK-KEY          PIC 9(6).
013650       04  SB-CURR-CODE         PIC XXX.
013660       04  SB-BATCH-NMBR.
013670         05  SB-BATCH-FRST-2    PIC XX.
013680         05  SB-BATCH-LAST-4    PIC X(4).
013690       04  SB-BATCH-NMBR-9 REDEFINES SB-BATCH-NMBR PIC 9(6).
           03  SB-INT-SETL-GRP        PIC 9(06).                        02.87
013700     03  SB-REJ                 PIC XX.
013710     03  SB-REF                 PIC X(18).
013720     03  SB-CNT              PIC S9(6)       COMP-3 VALUE +0.
013730     03  SB-BATCH-ORIG-AMT      PIC S9(15)V999  COMP-3 VALUE +0.
001340     03  SB-BATCH-AMT           PIC S9(15)V999  COMP-3 VALUE +0.
001340     03  SB-REIMB-AMT           PIC S9(15)V999  COMP-3 VALUE +0.
013750     03  SB-IIIAAA-AMT          PIC S9(15)V999  COMP-3 VALUE +0.
013760     03  SB-III999-AMT          PIC S9(15)V999  COMP-3 VALUE +0.
013770     03  SB-CENTER-AMT          PIC S9(15)V999  COMP-3 VALUE +0.
015000     03  SB-IIIAAA-CURR-CODE    PIC XXX.
015000     03  SB-III999-CURR-CODE    PIC XXX.
015000     03  SB-CENTER-CURR-CODE    PIC XXX.
015000     03  SB-BATCH-CURR-DEC      PIC S9(4)          COMP.
015000     03  SB-IIIAAA-CURR-DEC     PIC S9(4)          COMP.
015000     03  SB-III999-CURR-DEC     PIC S9(4)          COMP.
015000     03  SB-CENTER-CURR-DEC     PIC S9(4)          COMP.
007060     03  SB-BATCH-CURR-NAME     PIC X(30).
007060     03  SB-IIIAAA-CURR-NAME    PIC X(30).
007060     03  SB-III999-CURR-NAME    PIC X(30).
007060     03  SB-CENTER-CURR-NAME    PIC X(30).
013780*
013790     COPY VALTRNCD.
           COPY KMCCNTRY.                                               02.39
           COPY KMCCRNCY.                                               02.39
013830*
013840 01  CHECKING-FIELDS.
013850     03  CHK-SPEC-IND.
013860         05  CHK-SPEC-IND-1    PIC X.
013870         05  CHK-SPEC-IND-2    PIC X.
013880*
013890 01  LITERAL-AREA.
013900   03  ONE-AST                 PIC X(01)       VALUE '*'.
013900   03  AST-LIT                 PIC X(120)      VALUE ALL '*'.
013910   03  LIT-SALES               PIC X(30)       VALUE
013920       ' SALES, RETURNS, CASH ADVANCES'.
013930   03  LIT-BATCH-REJ           PIC X(22)       VALUE
013940       '*** BATCH REJECTED ***'.
013950*
013960**************************************************************
013970*                I N P U T   A R E A                         *
013980**************************************************************
013990 01  INP-LIT    PIC X(9)   VALUE 'I N P U T'.
014000*
           COPY KMCINTRT.                                               02.51
      *                                                                 02.51
           COPY KMCTRNIM.
014020*
014060     COPY KMC110WE.
014930*
014940 01  SORTED-ASSN-REC.
014950     03  SAR-SORT-KEY.
014960       04  SAR-BANK-KEY.
014970         05  SAR-BANK-INST      PIC 999.
014980         05  SAR-BANK-ASSOC     PIC 999.
014990       04  SAR-BANK-KEY-2 REDEFINES SAR-BANK-KEY PIC 9(6).
015000       04  SAR-CURR-CODE        PIC XXX.
015010       04  SAR-BATCH-NMBR.
015020         05  SAR-BATCH-FRST-2   PIC XX.
015030         05  SAR-BATCH-LAST-4   PIC X(4).
           03  SAR-INT-SETL-GRP       PIC 9(06).                        02.87
015040     03  SAR-REJ                PIC XX.
015050     03  SAR-REF                PIC X(18).
015060     03  SAR-CNT             PIC S9(6)             COMP-3.
015070     03  SAR-BATCH-ORIG-AMT     PIC S9(15)V999     COMP-3.
015080     03  SAR-BATCH-AMT          PIC S9(15)V999     COMP-3.
015080     03  SAR-REIMB-AMT          PIC S9(15)V999     COMP-3.
015090     03  SAR-IIIAAA-AMT         PIC S9(15)V999     COMP-3.
015100     03  SAR-III999-AMT         PIC S9(15)V999     COMP-3.
015110     03  SAR-CENTER-AMT         PIC S9(15)V999     COMP-3.
015000     03  SAR-IIIAAA-CURR-CODE   PIC XXX.
015000     03  SAR-III999-CURR-CODE   PIC XXX.
015000     03  SAR-CENTER-CURR-CODE   PIC XXX.
015000     03  SAR-BATCH-CURR-DEC     PIC S9(4)          COMP.
015000     03  SAR-IIIAAA-CURR-DEC    PIC S9(4)          COMP.
015000     03  SAR-III999-CURR-DEC    PIC S9(4)          COMP.
015000     03  SAR-CENTER-CURR-DEC    PIC S9(4)          COMP.
007060     03  SAR-BATCH-CURR-NAME    PIC X(30).
007060     03  SAR-IIIAAA-CURR-NAME   PIC X(30).
007060     03  SAR-III999-CURR-NAME   PIC X(30).
007060     03  SAR-CENTER-CURR-NAME   PIC X(30).
015120*
015130 01  SORTED-INST-REC.
015140     03  SIR-SORT-KEY.
015150       04  SIR-BANK-KEY.
015160         05  SIR-BANK-INST   PIC 999.
015170         05  SIR-BANK-ASSOC  PIC 999.
015180       04  SIR-CURR-CODE     PIC XXX.
015190       04  SIR-BATCH-NMBR.
015200         05  SIR-BATCH-FRST-2   PIC XX.
015210         05  SIR-BATCH-LAST-4   PIC X(4).
           03  SIR-INT-SETL-GRP       PIC 9(06).                        02.87
015220     03  SIR-REJ                PIC XX.
015230     03  SIR-REF                PIC X(18).
015240     03  SIR-CNT             PIC S9(6)          COMP-3.
015250     03  SIR-BATCH-ORIG-AMT     PIC S9(15)V999     COMP-3.
015260     03  SIR-BATCH-AMT          PIC S9(15)V999     COMP-3.
015260     03  SIR-REIMB-AMT          PIC S9(15)V999     COMP-3.
015270     03  SIR-IIIAAA-AMT         PIC S9(15)V999     COMP-3.
015280     03  SIR-III999-AMT         PIC S9(15)V999     COMP-3.
015290     03  SIR-CENTER-AMT         PIC S9(15)V999     COMP-3.
015000     03  SIR-IIIAAA-CURR-CODE   PIC XXX.
015000     03  SIR-III999-CURR-CODE   PIC XXX.
015000     03  SIR-CENTER-CURR-CODE   PIC XXX.
015000     03  SIR-BATCH-CURR-DEC     PIC S9(4)          COMP.
015000     03  SIR-IIIAAA-CURR-DEC    PIC S9(4)          COMP.
015000     03  SIR-III999-CURR-DEC    PIC S9(4)          COMP.
015000     03  SIR-CENTER-CURR-DEC    PIC S9(4)          COMP.
007060     03  SIR-BATCH-CURR-NAME    PIC X(30).
007060     03  SIR-IIIAAA-CURR-NAME   PIC X(30).
007060     03  SIR-III999-CURR-NAME   PIC X(30).
007060     03  SIR-CENTER-CURR-NAME   PIC X(30).
015300*
015310 01  SORTED-TTL-REC.
015320     03  STR-SORT-KEY.
015330       04  STR-BANK-KEY.
015340         05  STR-BANK-INST      PIC 999.
015350         05  STR-BANK-ASSOC     PIC 999.
015360       04  STR-CURR-CODE        PIC XXX.
015370       04  STR-BATCH-NMBR.
015380         05  STR-BATCH-FRST-2   PIC XX.
015390         05  STR-BATCH-LAST-4   PIC X(4).
           03  STR-INT-SETL-GRP       PIC 9(06).                        02.87
015400     03  STR-REJ                PIC XX.
015410     03  STR-REF                PIC X(18).
015420     03  STR-CNT             PIC S9(6)          COMP-3.
015430     03  STR-BATCH-ORIG-AMT     PIC S9(15)V999     COMP-3.
015440     03  STR-BATCH-AMT          PIC S9(15)V999     COMP-3.
015440     03  STR-REIMB-AMT          PIC S9(15)V999     COMP-3.
015450     03  STR-IIIAAA-AMT         PIC S9(15)V999     COMP-3.
015460     03  STR-III999-AMT         PIC S9(15)V999     COMP-3.
015470     03  STR-CENTER-AMT         PIC S9(15)V999     COMP-3.
015000     03  STR-IIIAAA-CURR-CODE   PIC XXX.
015000     03  STR-III999-CURR-CODE   PIC XXX.
015000     03  STR-CENTER-CURR-CODE   PIC XXX.
015000     03  STR-BATCH-CURR-DEC     PIC S9(4)          COMP.
015000     03  STR-IIIAAA-CURR-DEC    PIC S9(4)          COMP.
015000     03  STR-III999-CURR-DEC    PIC S9(4)          COMP.
015000     03  STR-CENTER-CURR-DEC    PIC S9(4)          COMP.
007060     03  STR-BATCH-CURR-NAME    PIC X(30).
007060     03  STR-IIIAAA-CURR-NAME   PIC X(30).
007060     03  STR-III999-CURR-NAME   PIC X(30).
007060     03  STR-CENTER-CURR-NAME   PIC X(30).
015480*
015490     COPY KFCICF.
015480*
015490     COPY KMCFEOWN.
015480*
015490     COPY KMCFEPKG.
015480*
           COPY KMCPKGPA.                                               02.23
      *                                                                 02.23
015510***************************************************************
015520*                  O U T P U T   A R E A                      *
015530***************************************************************
015540 01  OUT-LIT    PIC X(11)   VALUE 'O U T P U T'.
      *
           COPY KMCTTDBL.
015550*
015560     COPY KMCPETRC.
015570*
           COPY KMCDADDM.                                               02.88
      *                                                                 02.88
           COPY KMCDTRAN.                                               02.88
      *                                                                 02.88
           COPY KMCRCNRC.                                               02.87
      *                                                                 02.87
           COPY KMCBCHRC.                                               02.87
      *                                                                 02.87
           COPY KMCDTDTA.                                               03.13
      *                                                                 03.13
015580     COPY KMCONDLN.
015590*
015600     COPY KMCHEADS.
      *
       01  WS-REPORT-SWITCHES.
           03  WS-PASS-THRU-RPT-SW         PIC X(01) VALUE 'N'.
               88  WS-PASS-THRU-RPT-CREATED          VALUE 'Y'.
           03  WS-QUALIFICATION-RPT-SW     PIC X(01) VALUE 'N'.
               88  WS-QUALIFICATION-RPT-CREATED      VALUE 'Y'.
           03  WS-PBD-EBT-RPT-SW           PIC X(01) VALUE 'N'.
               88  WS-PBD-EBT-RPT-CREATED            VALUE 'Y'.
           03  WS-REJECT-RPT-SW            PIC X(01) VALUE 'N'.
               88  WS-REJECT-RPT-CREATED             VALUE 'Y'.
           03  WS-DEFAULT-RPT-SW           PIC X(01) VALUE 'N'.
               88  WS-DEFAULT-RPT-CREATED            VALUE 'Y'.
      *
       01  SAVE-REPORT-DATA.
           03  WS-SAVE-REPORT-EXTRA-DATA   PIC X(57).
           03  WS-SAVE-RLW-DETAIL-LINE     PIC X(133).
           03  WS-SAVE-LINE-TYPE           PIC X.
           03  WS-SAVE-REPORT-TYPE         PIC 9.
           03  WS-SAVE-TRAN-AMT            PIC S9(15)V999 COMP-3.
           03  WS-SAVE-BATCH-TYPE          PIC 9.
             88  WS-BATCH-TYPE-IS-PLAN-ADD  VALUE 1 3 5 7.
             88  WS-BATCH-TYPE-IS-DOWNGRADE VALUE 2 THRU 3
                                                  6 THRU 7.
             88  WS-BATCH-TYPE-IS-PBD-EBT   VALUE 4 THRU 7.
           03  WS-SAVE-GROUP-TYPE          PIC 9.
             88  WS-GROUP-TYPE-IS-PLAN-ADD  VALUE 1 3 5 7.
             88  WS-GROUP-TYPE-IS-DOWNGRADE VALUE 2 THRU 3
                                                  6 THRU 7.
             88  WS-GROUP-TYPE-IS-PBD-EBT   VALUE 4 THRU 7.
      *
       01  WS-REPORT-WORK-AREA.
           05  WS-RWA-BATCH-SWITCHES.
               10  WS-RBS-PASSTHRU-SW      PIC X(01).
                   88  WS-RBS-PASSTHRU     VALUE 'Y'.
               10  WS-RBS-DOWNGRADE-SW     PIC X(01).
                   88  WS-RBS-DOWNGRADE    VALUE 'Y'.
               10  WS-RBS-PBD-EBT-SW       PIC X(01).
                   88  WS-RBS-PBD-EBT      VALUE 'Y'.
               10  WS-RBS-REJECT-SW        PIC X(01).
                   88  WS-RBS-REJECT       VALUE 'Y'.
               10  WS-RBS-DEFAULT-SW       PIC X(01).
                   88  WS-RBS-DEFAULT      VALUE 'Y'.
           05  WS-RWA-GROUP-SWITCHES.
               10  WS-RGS-PASSTHRU-SW      PIC X(01).
                   88  WS-RGS-PASSTHRU     VALUE 'Y'.
               10  WS-RGS-DOWNGRADE-SW     PIC X(01).
                   88  WS-RGS-DOWNGRADE    VALUE 'Y'.
               10  WS-RGS-PBD-EBT-SW       PIC X(01).
                   88  WS-RGS-PBD-EBT      VALUE 'Y'.
               10  WS-RGS-REJECT-SW        PIC X(01).
                   88  WS-RGS-REJECT       VALUE 'Y'.
               10  WS-RGS-DEFAULT-SW       PIC X(01).
                   88  WS-RGS-DEFAULT      VALUE 'Y'.
           05  WS-RWA-TRAN-SWITCHES.
               10  WS-RTS-PASSTHRU-SW      PIC X(01).
                   88  WS-RTS-PASSTHRU     VALUE 'Y'.
               10  WS-RTS-DOWNGRADE-SW     PIC X(01).
                   88  WS-RTS-DOWNGRADE    VALUE 'Y'.
               10  WS-RTS-PBD-EBT-SW       PIC X(01).
                   88  WS-RTS-PBD-EBT      VALUE 'Y'.
               10  WS-RTS-REJECT-SW        PIC X(01).
                   88  WS-RTS-REJECT       VALUE 'Y'.
               10  WS-RTS-DEFAULT-SW       PIC X(01).
                   88  WS-RTS-DEFAULT      VALUE 'Y'.
           05  WS-RPT-REC.
               10  WS-RPT-REC-KEY.
                   15  WS-RRK-INST         PIC S9(06) COMP-3.
                     88  WS-RRK-INST-IS-DEFAULT VALUE +001001.
                   15  RW-RRK-PAGE         PIC S9(07) COMP-3.
                   15  WS-RRK-LINE         PIC S9(03) COMP-3.
               10  WS-RPT-REC-EXTRA        PIC X(057).
               10  WS-RPT-REC-LINE         PIC X(133).
      *
       01  REPORT-ADD-DATA.
           03  REPORT-SORT-KEY.
             05  RAD-SK-INST               PIC S9(06) COMP-3.
             05  RAD-SK-PAGE               PIC S9(07) COMP-3.
             05  RAD-SK-LINE               PIC S9(03) COMP-3.
           03  REPORT-EXTRA-DATA.
             05  RAD-ED-LINE-TYPE          PIC X.
               88  RAD-LINE-IS-MISC        VALUE '0'.
               88  RAD-LINE-IS-FIRST       VALUE '1'.
               88  RAD-LINE-IS-ADDENDUM-1  VALUE 'A'.
               88  RAD-LINE-IS-BATCH       VALUE 'B'.
               88  RAD-LINE-IS-DOWNGRADE   VALUE 'D'.
               88  RAD-LINE-IS-EMPTY       VALUE 'E'.
               88  RAD-LINE-IS-GROUP       VALUE 'G'.
               88  RAD-LINE-IS-REJECT      VALUE 'R'.
               88  RAD-LINE-IS-ADDENDUM-2  VALUE 'I'.
               88  RAD-LINE-IS-LINE        VALUE '9'.
               88  RAD-LINE-IS-OTHER       VALUE 'D' '9'.
               88  RAD-LINE-IS-DETAIL      VALUE '1' '9' 'D' 'E'.
               88  RAD-LINE-IS-ADDENDUM    VALUE 'A' 'I'.
             05  RAD-ED-REPORT-TYPE        PIC 9.
               88  RAD-REPORT-IS-MISC      VALUE 0.
               88  RAD-REPORT-IS-PLAN-ADD  VALUE 1 3 5 7.
               88  RAD-REPORT-IS-DOWNGRADE VALUE 2 THRU 3
                                                 6 THRU 7.
               88  RAD-REPORT-IS-PBD-EBT   VALUE 4 THRU 7.
               88  RAD-REPORT-IS-DEFAULT   VALUE 8.
               88  RAD-REPORT-IS-REJECT    VALUE 9.
             05  RAD-ED-SOURCE-ID          PIC X.
             05  RAD-ED-BATCH-ID           PIC X(06).
             05  RAD-ED-MRCH-NMBR          PIC X(10).
             05  RAD-ED-GROUP-REF-NO       PIC X(18).
             05  RAD-ED-REJECT-IND         PIC X(01) VALUE SPACE.
             05  RAD-ED-TRAN-DEC           PIC 9(01).
             05  RAD-ED-TRAN-AMT           PIC S9(15)V999 COMP-3.
             05  FILLER                    PIC X(08) VALUE SPACES.
      *
       01  DEFER-RPT-REC-STACK.
           03  DEFER-RRS-ENTRY OCCURS 17.                               03.42V
             05  DEFER-RRS-KEY.
               07  DEFER-RRS-INST          PIC S9(06) COMP-3.
               07  DEFER-RRS-PAGE          PIC S9(07) COMP-3.
               07  DEFER-RRS-LINE-NO       PIC S9(03) COMP-3.
             05  DEFER-RRS-LINE-TYPE       PIC X.
             05  DEFER-RRS-SAVE-CC         PIC X.
             05  DEFER-RRS-LINE.
               07  DEFER-RRS-LINE-CC       PIC X.
               07  FILLER                  PIC X(132).
015610*
015620 01  HEAD-LINE-BATCH.
015630       05  HLB-CC                    PIC X           VALUE SPACE.
015640       05  HLB-BANK-NMBR-LIT         PIC X(06)       VALUE
015650           'BATCH '.
015660       05  HLB-BATCH-NMBR.
015670           10  HLB-BN-FIRST-TWO      PIC 9(2).
015680           10  FILLER                PIC X VALUE '-'.
015690           10  HLB-BN-LAST-FOUR      PIC 9(4).
015700       05  FILLER                    PIC X(15)       VALUE
015710         '   SOURCE ID - '.
015720       05  HLB-SOURCE-ID             PIC X.
015730       05  FILLER                    PIC X(20)       VALUE SPACES.
015740       05  HLB-LIT                   PIC X(30)       VALUE SPACES.
015750       05  FILLER                    PIC X(53)       VALUE SPACES.
015760*
015770 01  HEAD-LINE-4.
015780       05  HLB-4-CC                  PIC X          VALUE '0'.
015790       05  FILLER                    PIC X(15)      VALUE SPACE.
015800       05  FILLER                    PIC X(5)       VALUE 'BATCH'.
015810       05  FILLER                    PIC X(29)      VALUE SPACE.
015820       05  FILLER                    PIC X(4)       VALUE 'ITEM'.
015830       05  FILLER                    PIC X(10)      VALUE SPACE.
015840       05  FILLER                    PIC X(14)      VALUE
015850                                     'ORIGINAL BATCH'.
015860       05  FILLER                    PIC X(13)      VALUE SPACE.
015870       05  FILLER                    PIC X(09)      VALUE
015880                                     'BATCH NET'.
015890       05  FILLER                    PIC X(16)      VALUE SPACE.
015900       05  FILLER                    PIC X(10)      VALUE
015910                                     'SETTLE NET'.
015920       05  FILLER                    PIC X(07)      VALUE SPACE.
015930*
015940 01  HEAD-LINE-5.
015950       05  HLB-5-CC                  PIC X        VALUE ' '.
015960       05  FILLER                    PIC X(15)    VALUE SPACE.
015970       05  FILLER                    PIC X(6)     VALUE 'NUMBER'.
015980       05  FILLER                    PIC X(03)    VALUE SPACE.
015990       05  FILLER                    PIC X(16)    VALUE
016000                                     'REFERENCE NUMBER'.
016010       05  FILLER                    PIC X(09)    VALUE SPACE.
016020       05  FILLER                    PIC X(05)    VALUE
016030                                     'COUNT'.
016040       05  FILLER                    PIC X(13)    VALUE SPACE.
016050       05  FILLER                    PIC X(06)    VALUE
016060                                     'AMOUNT'.
016070       05  FILLER                    PIC X(19)    VALUE SPACE.
016080       05  FILLER                    PIC X(06)    VALUE
016090                                     'AMOUNT'.
016100       05  FILLER                    PIC X(19)    VALUE SPACE.
016110       05  FILLER                    PIC X(06)    VALUE
016120                                     'AMOUNT'.
016130       05  FILLER                    PIC X(09)    VALUE SPACE.
016140*
016150 01  HEAD-LINE-6.
016160       05  HLB-6-CC                  PIC X       VALUE '0'.
016170       05  FILLER                    PIC X(11)   VALUE SPACE.
016180       05  HL6-BANK                  PIC 9(6).
016190       05  FILLER              PIC X(09)   VALUE ' SUMMARY '.
016200       05  HL6-LIT                   PIC X(6).
016210       05  FILLER                    PIC X(100)  VALUE SPACE.
016220 01  HEAD-LINE-CURR.
016230       05  HLB-CURR-CC               PIC X     VALUE '0'.
016240       05  FILLER                    PIC X(17) VALUE SPACE.
016250       05  FILLER                    PIC X(14) VALUE
016260       'CURRENCY CODE '.
016270       05  HLC-CURR-CODE-1           PIC X(03).
016280       05  FILLER                    PIC X(03) VALUE ' - '.
016290       05  HLC-CODE-NAME-1           PIC X(30).
016300       05  FILLER                    PIC X(04) VALUE SPACE.
016310       05  HLC-CURR-BANK             PIC 9(06).
016320       05  HLC-CURR-BANK-X REDEFINES HLC-CURR-BANK PIC X(06).
016330       05  HLC-CURR-CODE-LIT         PIC X(15) VALUE
016340       ' CURRENCY CODE '.
016350       05  HLC-CURR-CODE-2           PIC X(03).
016360       05  HLC-DASH                  PIC X(03) VALUE ' - '.
016370       05  HLC-CODE-NAME-2           PIC X(30).
016380       05  FILLER                    PIC X(04) VALUE SPACE.
016390 01  HEAD-LINE-SUM-TTL.
016400       05  HLST-CC                   PIC X        VALUE '0'.
016410       05  FILLER                    PIC X(35)    VALUE SPACE.
016420       05  FILLER                    PIC X(05)    VALUE 'BATCH'.
016430       05  FILLER                    PIC X(09)    VALUE SPACE.
016440       05  FILLER                    PIC X(05)    VALUE 'ITEM'.
016450       05  FILLER                    PIC X(37)    VALUE SPACE.
016460       05  FILLER                    PIC X(09)    VALUE
016470                                     'NET BATCH'.
016480       05  FILLER                    PIC X(15)    VALUE SPACE.
016490       05  FILLER                    PIC X(10)    VALUE
016500                                     'SETTLE NET'.
016510       05  FILLER                    PIC X(09)    VALUE SPACE.
016520 01  HEAD-LINE-SUM-TTL-B.
016530       05  HLST-B-CC                 PIC X        VALUE SPACE.
016540       05  FILLER                    PIC X(35)    VALUE SPACE.
016550       05  FILLER                    PIC X(05)    VALUE 'COUNT'.
016560       05  FILLER                    PIC X(09)    VALUE SPACE.
016570       05  FILLER                    PIC X(06)    VALUE 'COUNT'.
016580       05  FILLER                    PIC X(38)    VALUE SPACE.
016590       05  FILLER                    PIC X(06)    VALUE
016600                                     'AMOUNT'.
016610       05  FILLER                    PIC X(18)    VALUE SPACE.
016620       05  FILLER                    PIC X(06)    VALUE
016630                                     'AMOUNT'.
016640       05  FILLER                    PIC X(09)    VALUE SPACE.
016650 01  SYSTEM-CENTER-TOTALS.
016660    03 SCD1-DETAIL.
016670       05  SCD1-CC                   PIC X     VALUE SPACE.
016680       05  FILLER                    PIC X(13) VALUE SPACE.
016690       05  SCD1-REJ                  PIC X(02).
016700       05  SCD1-BATCH-FRST-2         PIC 9(2).
016710       05  FILLER                    PIC X(01) VALUE '-'.
016720       05  SCD1-BATCH-LAST-4         PIC 9(4).
016730       05  FILLER                    PIC X(01) VALUE SPACE.
016740       05  SCD1-REF                  PIC X(18).
016750       05  FILLER                    PIC X(07) VALUE SPACE.
016760       05  SCD1-ITEM-CNT             PIC ZZZ,ZZ9.
016770       05  FILLER                    PIC X(01) VALUE SPACE.
016780       05  SCD1-ORIG-AMT             PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
016790       05  FILLER                    PIC X(01) VALUE SPACE.
016800       05  SCD1-BATCH-AMT            PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
016810       05  FILLER                    PIC X(01) VALUE SPACE.
016820       05  SCD1-SETTLE-AMT           PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
016830       05  SCD1-SETTLE-AMT-X REDEFINES SCD1-SETTLE-AMT PIC X(24).
016840   03 SCD1-CURR-TTL.
016850       05  SCD1-CT-CC                PIC X     VALUE '0'.
016860       05  FILLER                    PIC X(13) VALUE SPACE.
016870       05  FILLER                    PIC X(15) VALUE
016880                                     'CURRENCY TOTALS'.
016890       05  FILLER                    PIC X(06) VALUE SPACE.
016900       05  SCD1-LIT                  PIC X(07) VALUE SPACE.
016910       05  FILLER                    PIC X(91) VALUE SPACE.
016920    03 SCD2-DETAIL.
016930       05  SCD2-CC                   PIC X     VALUE SPACE.
016940       05  FILLER                    PIC X(16) VALUE SPACE.
016950       05  FILLER                    PIC X(08) VALUE 'BATCHES '.
016960       05  SCD2-LIT                  PIC X(08).
016970       05  FILLER                    PIC X(02) VALUE SPACE.
016980       05  SCD2-BATCH-CNT            PIC ZZZ,ZZ9.
016990       05  FILLER                    PIC X(01) VALUE SPACE.
017000       05  SCD2-ITEM-CNT             PIC Z,ZZZ,ZZZ,ZZ9.
017010       05  FILLER                    PIC X(01) VALUE SPACE.
017020       05  SCD2-ORIG-AMT             PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
017030       05  FILLER                    PIC X(01) VALUE SPACE.
017040       05  SCD2-BATCH-AMT            PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
017050       05  FILLER                    PIC X(01) VALUE SPACE.
017060       05  SCD2-SETTLE-AMT           PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
017070    03 SCD3-DETAIL.
017080       05  SCD3-CC                   PIC X     VALUE '0'.
017090       05  FILLER                    PIC X(14) VALUE SPACE.
017100       05  SCD3-LIT.
017110           07 SCD3-LIT-1             PIC X(6).
017120           07 FILLER                 PIC X(1)  VALUE SPACE.
017130           07 SCD3-LIT-2             PIC X(6).
017140       05  FILLER                    PIC X(06) VALUE SPACES.
017150       05  SCD3-BATCH-CNT            PIC ZZZ,ZZ9.
017160       05  FILLER                    PIC X(02) VALUE SPACES.
017170       05  SCD3-ITEM-CNT             PIC Z,ZZZ,ZZZ,ZZ9.
017180       05  FILLER                    PIC X(26) VALUE SPACES.
017190       05  SCD3-BATCH-AMT            PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
017200       05  SCD3-BATCH-AMT-X REDEFINES SCD3-BATCH-AMT
017210                                     PIC X(24).
017220       05  FILLER                    PIC X(01) VALUE SPACE.
017230       05  SCD3-SETTLE-AMT           PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
017240       05  FILLER                    PIC X(02) VALUE SPACE.
017250 01  TOTAL-BATCH-HEAD-2.
017260     03  TBH2-CC         PIC X      VALUE '0'.
017270     03  FILLER          PIC XX     VALUE SPACES.
017280     03  FILLER          PIC X(5)   VALUE 'BATCH'.
017290     03  FILLER          PIC X(4)   VALUE SPACES.
017300     03  FILLER          PIC X(4)   VALUE 'BANK'.
017310     03  FILLER          PIC X(22)  VALUE SPACES.
017320     03  FILLER          PIC X(4)   VALUE 'ITEM'.
017330     03  FILLER          PIC X(9)   VALUE SPACES.
017340     03  FILLER          PIC X(14)  VALUE 'ORIGINAL BATCH'.
017350     03  FILLER          PIC X(13)  VALUE SPACES.
017360     03  FILLER          PIC X(9)   VALUE 'BATCH NET'.
017370     03  FILLER          PIC X(7)   VALUE SPACES.
017380     03  FILLER          PIC X(5)   VALUE 'BATCH'.
017390     03  FILLER          PIC X(13)  VALUE SPACES.
017400     03  FILLER          PIC X(10)  VALUE 'SETTLE NET'.
017410     03  FILLER          PIC X(6)   VALUE SPACES.
017420     03  FILLER          PIC X(4)   VALUE 'SETL'.
017410     03  FILLER          PIC X      VALUE SPACE.
017430 01  TOTAL-BATCH-HEAD-3.
017440     03  TBH3-CC         PIC X      VALUE SPACE.
017450     03  FILLER          PIC XX     VALUE SPACES.
017460     03  FILLER          PIC X(6)   VALUE 'NUMBER'.
017470     03  FILLER          PIC XXX    VALUE SPACES.
017480     03  FILLER          PIC XXX    VALUE 'KEY'.
017490     03  FILLER          PIC X(4)   VALUE SPACES.
017500     03  FILLER          PIC X(9)   VALUE 'REFERENCE'.
017510     03  FILLER          PIC X(10)  VALUE SPACES.
017520     03  FILLER          PIC X(5)   VALUE 'COUNT'.
017530     03  FILLER          PIC X(12)  VALUE SPACES.
017540     03  FILLER          PIC X(6)   VALUE 'AMOUNT'.
017550     03  FILLER          PIC X(19)  VALUE SPACES.
017560     03  FILLER          PIC X(6)   VALUE 'AMOUNT'.
017570     03  FILLER          PIC X(8)   VALUE SPACES.
017580     03  FILLER          PIC X(4)   VALUE 'CURR'.
017590     03  FILLER          PIC X(16)  VALUE SPACES.
017600     03  FILLER          PIC X(6)   VALUE 'AMOUNT'.
017610     03  FILLER          PIC X(8)   VALUE SPACES.
017620     03  FILLER          PIC X(4)   VALUE 'CURR'.
017410     03  FILLER          PIC X      VALUE SPACE.
017630 01  TOTAL-BATCH-LINE.
017640     03  TBL-CC          PIC X      VALUE '0'.
017650     03  TBL-REJ         PIC XX.
017660     03  TBL-BTCH.
017670         05  TBL-PRE     PIC 99.
017680         05  TBL-DASH    PIC X      VALUE '-'.
017690         05  TBL-MAIN    PIC 9999.
017700     03  FILLER          PIC X    VALUE SPACE.
017710     03  TBL-BANK-KEY    PIC 999999.
017720     03  FILLER          PIC X    VALUE SPACE.
017730     03  TBL-REF         PIC X(17).
017740     03  FILLER          PIC XX   VALUE SPACES.
017750     03  TBL-ITMS-X.
               05  TBL-ITMS    PIC ZZZ,ZZ9.
017760     03  FILLER          PIC X    VALUE SPACE.
           03  TBL-ORIG-AMT-X.
               05  TBL-ORIG-AMT
                               PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
017780     03  FILLER          PIC X    VALUE SPACE.
           03  TBL-NET-AMT-X.
               05  TBL-NET-AMT PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
017800     03  FILLER          PIC X    VALUE SPACE.
017810     03  TBL-NET-CURR    PIC XXX.
017820     03  FILLER          PIC X(6) VALUE SPACES.
           03  TBL-SETTLE-AMT-X.
               05  TBL-SETTLE-AMT
                               PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
017840     03  FILLER          PIC X    VALUE SPACE.
017850     03  TBL-SETL-CURR   PIC XXX.
017410     03  FILLER          PIC X      VALUE SPACE.
017860 01  TRAILER-BATCH-HEAD.
017870     03  TBH-CC          PIC X      VALUE '0'.
017880     03  FILLER          PIC X(22)  VALUE SPACES.
017890     03  FILLER          PIC X(07)  VALUE 'BATCHES'.
017900     03  FILLER          PIC X(103) VALUE SPACES.
017910 01  TRAILER-BATCH-TOTAL.
017920     03  TBT-CC          PIC X      VALUE '0'.
017930     03  FILLER          PIC X(4)   VALUE SPACES.
017940     03  TBT-DISC        PIC X(17).
017950     03  FILLER          PIC X      VALUE SPACE.
           03  TBT-NUM-BTCHS-X.
             05  TBT-NUM-BTCHS PIC ZZZ,ZZ9.
017970     03  FILLER          PIC X      VALUE SPACE.
           03  TBT-ITEMS-X.
             05  TBT-ITEMS     PIC Z,ZZZ,ZZZ,ZZ9.
017990     03  FILLER          PIC X(60)  VALUE SPACES.
           03  TBT-SETTLE-AMT-X.
             05  TBT-SETTLE-AMT
                               PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
018010     03  FILLER          PIC X(5) VALUE SPACES.
      *****************************************************************
      *
       01  REPORT-LINES.
      *
         02  REPORT-BATCH-LINES.
      *
           03  RPT-BATCH-LINE-1.
             05  RBL-1-CC                  PIC X(01) VALUE '0'.
             05  RBL-1-SUS-FLAG            PIC X(01) VALUE SPACE.
             05  RBL-1-TRANSCODE           PIC X(04) VALUE SPACES.
             05  FILLER                    PIC X(10)
                 VALUE ' (BATCH - '.
             05  RBL-1-HDR-WAO             PIC 9(05).
             05  FILLER                    PIC X(01)
                 VALUE '-'.
             05  RBL-1-HDR-TIME            PIC 9(07).
             05  FILLER                    PIC X(01)
                 VALUE '-'.
             05  RBL-1-HDR-SEQ             PIC 9(05).
             05  FILLER                    PIC X(02)
                 VALUE ') '.
             05  FILLER                    PIC X(14)
                 VALUE 'CURRENCY CODE '.
             05  RBL-1-CURR-CODE           PIC X(03) VALUE SPACES.
             05  FILLER                    PIC X(03) VALUE ' - '.
             05  RBL-1-CURR-NAME           PIC X(30) VALUE SPACES.
             05  RBL-1-CURR-CODE-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(05) VALUE SPACES.
             05  RBL-1-AMT-X VALUE SPACES.
               07  RBL-1-AMT               PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
             05  RBL-1-AMT-ERR-IND         PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RBL-1-ERROR-DATA VALUE SPACES.
               07  RBL-1-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RBL-1-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RBL-1-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RBL-1-FATAL-FLAG        PIC X(01).
      *
           03  RPT-BATCH-LINE-2.
             05  RBL-2-CC                  PIC X(01) VALUE SPACE.
             05  RBL-2-SUS-FLAG            PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(18)
                 VALUE '      OPERATOR ID '.
             05  RBL-2-OPER-NMBR           PIC XXX VALUE SPACES.
             05  FILLER                    PIC X(25)
                 VALUE '              REF NUMBER '.
             05  RBL-2-REF-NO              PIC X(18) VALUE SPACES.
             05  RBL-2-REF-NO-ERR-IND      PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(26)
                 VALUE '         ORIGINAL AMOUNT  '.
             05  RBL-2-AMT-X VALUE SPACES.
               07  RBL-2-AMT               PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
             05  RBL-2-AMT-ERR-IND         PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RBL-2-ERROR-DATA VALUE SPACES.
               07  RBL-2-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RBL-2-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RBL-2-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RBL-2-FATAL-FLAG        PIC X(01).
      *
         02  REPORT-GROUP-LINES.
      *
           03  RPT-GROUP-LINE-1.
             05  RGL-1-CC                  PIC X(01) VALUE '0'.
             05  RGL-1-SUS-FLAG            PIC X(01) VALUE SPACE.
             05  RGL-1-TRANSCODE           PIC X(04) VALUE SPACES.
             05  FILLER                    PIC X(10)
                 VALUE ' (GROUP - '.
             05  RGL-1-REF-WAO             PIC 9(05).
             05  FILLER                    PIC X(01)
                 VALUE '-'.
             05  RGL-1-REF-TIME            PIC 9(07).
             05  FILLER                    PIC X(01)
                 VALUE '-'.
             05  RGL-1-REF-SEQ             PIC 9(05).
             05  FILLER                    PIC X(02)
                 VALUE ') '.
             05  FILLER                    PIC X(16)
                 VALUE 'MERCHANT NUMBER '.
             05  RGL-1-MERCH-NMBR          PIC X(16) VALUE SPACES.
             05  RGL-1-MERCH-NMBR-ERR-IND  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(23) VALUE SPACES.
             05  RGL-1-AMT-X VALUE SPACES.
               07  RGL-1-AMT               PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
             05  RGL-1-AMT-ERR-IND         PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RGL-1-ERROR-DATA VALUE SPACES.
               07  RGL-1-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RGL-1-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RGL-1-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RGL-1-FATAL-FLAG        PIC X(01).
      *
           03  RPT-GROUP-LINE-2.
             05  RGL-2-CC                  PIC X(01) VALUE SPACE.
             05  RGL-2-SUS-FLAG            PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(18)
                 VALUE '      OPERATOR ID '.
             05  RGL-2-OPER-NMBR           PIC XXX VALUE SPACES.
             05  FILLER                    PIC X(25)
                 VALUE '              REF NUMBER '.
             05  RGL-2-REF-NO              PIC X(18) VALUE SPACES.
             05  RGL-2-REF-NO-ERR-IND      PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(53) VALUE SPACES.
             05  RGL-2-ERROR-DATA VALUE SPACES.
               07  RGL-2-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RGL-2-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RGL-2-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RGL-2-FATAL-FLAG        PIC X(01).
      *
         02  REPORT-RANDC-LINES.
      *
           03  RPT-RANDC-LINE-1.
             05  RRL-1-CC                  PIC X(01) VALUE '0'.
             05  RRL-1-SUS-FLAG            PIC X(01) VALUE SPACE.
             05  RRL-1-TRANSCODE           PIC X(04) VALUE SPACES.
             05  FILLER                    PIC X(31) VALUE SPACES.
             05  FILLER                    PIC X(16)
                 VALUE 'MERCHANT NUMBER '.
             05  RRL-1-MERCH-NMBR          PIC X(16) VALUE SPACES.
             05  RRL-1-MERCH-NMBR-ERR-IND  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(27) VALUE SPACES.
             05  RRL-1-AMT-X VALUE SPACES.
               07  RRL-1-AMT               PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
             05  RRL-1-AMT-ERR-IND         PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RRL-1-ERROR-DATA VALUE SPACES.
               07  RRL-1-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RRL-1-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RRL-1-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RRL-1-FATAL-FLAG        PIC X(01).
      *
           03  RPT-RANDC-LINE-2.
             05  RRL-2-CC                  PIC X(01) VALUE SPACE.
             05  RRL-2-SUS-FLAG            PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(07)
                 VALUE 'REASON '.
             05  RRL-2-CORR-REASON         PIC X(30) VALUE SPACES.
             05  RRL-2-CORR-REASON-ERR-IND PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(13)
                 VALUE '  REF NUMBER '.
             05  RRL-2-REF-NO              PIC X(18) VALUE SPACES.
             05  RRL-2-REF-NO-ERR-IND      PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(48) VALUE SPACES.
             05  RRL-2-ERROR-DATA VALUE SPACES.
               07  RRL-2-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RRL-2-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RRL-2-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RRL-2-FATAL-FLAG        PIC X(01).
      *
         02  REPORT-FORMAT-1-LINES.
      *
           03  RPT-FORMAT-1-LINE-1.
             05  RF1-1-CC                  PIC X(01) VALUE '0'.
             05  FILLER                    PIC X(12)
                 VALUE 'TRAN CODE   '.
             05  RF1-1-TRANSCODE           PIC X(04) VALUE SPACES.
             05  RF1-1-SUS-FLAG            PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(12)
                 VALUE '  TRAN DATE '.
             05  RF1-1-TRAN-DATE           PIC X(04) VALUE SPACES.
             05  RF1-1-TRAN-DATE-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE '  CARD TYPE    '.
             05  RF1-1-CARD-TYPE           PIC X(02) VALUE SPACES.
             05  RF1-1-CARD-TYPE-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(07)
                 VALUE '  ACCT '.
             05  RF1-1-ACCT-NO             PIC X(16) VALUE SPACES.
             05  RF1-1-ACCT-NO-REM VALUE SPACES.
               07  RF1-1-DASH              PIC X.
               07  RF1-1-ACCT-NO-EXT       PIC X(7).
             05  RF1-1-ACCT-NO-ERR-IND     PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(12)
                 VALUE '  TRAN AMT  '.
             05  RF1-1-TRAN-AMT-X VALUE SPACES.
               07  RF1-1-TRAN-AMT          PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
             05  RF1-1-TRAN-AMT-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RF1-1-ERROR-DATA VALUE SPACES.
               07  RF1-1-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RF1-1-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RF1-1-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RF1-1-FATAL-FLAG        PIC X(01).
      *
           03  RPT-FORMAT-1-LINE-2.
             05  RF1-2-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(10)
                 VALUE 'AUTH CODE '.
             05  RF1-2-AUTH-CODE           PIC X(06) VALUE SPACES.
             05  RF1-2-AUTH-CODE-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(12)
                 VALUE '  MOTO/ECOM '.
             05  RF1-2-MOTO-ECOM           PIC X(01) VALUE SPACE.
             05  RF1-2-MOTO-ECOM-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RF1-2-MOTO-ECOM-OUT       PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE '   NUM INSTALL '.
             05  RF1-2-NO-INST             PIC X(03) VALUE SPACES.
             05  RF1-2-NO-INST-ERR-IND     PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(20)
                 VALUE '  REF NUMBER        '.
             05  RF1-2-REF-NO-X VALUE SPACES.
               07  RF1-2-REF-NO            PIC 9(11).
             05  RF1-2-REF-NO-ERR-IND      PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(12)
                 VALUE '  CAT CODE  '.
             05  RF1-2-CAT-CODE-X VALUE SPACES.
               07  RF1-2-CAT-CODE          PIC 9(04).
             05  RF1-2-CAT-CODE-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(18) VALUE SPACES.
             05  RF1-2-ERROR-DATA VALUE SPACES.
               07  RF1-2-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RF1-2-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RF1-2-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RF1-2-FATAL-FLAG        PIC X(01).
      *
           03  RPT-FORMAT-1-LINE-7.
             05  RF1-7-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(19)
                 VALUE 'DESCRIPTION IN     '.
             05  RF1-7-MRCH-NAME           PIC X(25) VALUE SPACES.
             05  RF1-7-MRCH-NAME-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RF1-7-MRCH-CITY           PIC X(13) VALUE SPACES.
             05  RF1-7-MRCH-CITY-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RF1-7-MRCH-STATE          PIC X(02) VALUE SPACES.
             05  RF1-7-MRCH-STATE-ER-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RF1-7-MRCH-COUNTRY        PIC X(02) VALUE SPACES.
             05  RF1-7-MRCH-COUNTRY-ERR-IND
                                           PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(27) VALUE SPACES.
             05  FILLER                    PIC X(06)
                 VALUE ' MRCH '.
             05  RF1-7-MRCH-ID             PIC X(16) VALUE SPACES.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RF1-7-ERROR-DATA VALUE SPACES.
               07  RF1-7-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RF1-7-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RF1-7-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RF1-7-FATAL-FLAG        PIC X(01).
      *
         02  FILLER REDEFINES REPORT-FORMAT-1-LINES.
           03  RPT-FORMAT-1-LINE OCCURS 3.
             05  FILLER                    PIC X(120).
             05  RF1-ERROR-DATA OCCURS 3.
               07  RF1-ERROR-CD            PIC Z99.
               07  FILLER                  PIC X(01).
             05  RF1-FATAL-FLAG            PIC X(01).
      *
         02  REPORT-COMMON-LINES.
      *
           03  RPT-COMMON-LINE-1.
             05  RCL-1-CC                  PIC X(01) VALUE '0'.
             05  FILLER                    PIC X(12)
                 VALUE 'TRAN CODE   '.
             05  RCL-1-TRANSCODE           PIC X(04) VALUE SPACES.
             05  RCL-1-SUS-FLAG            PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(12)
                 VALUE '  TRAN DATE '.
             05  RCL-1-TRAN-DATE           PIC X(04) VALUE SPACES.
             05  RCL-1-TRAN-DATE-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE '  CARD TYPE    '.
             05  RCL-1-CARD-TYPE           PIC X(02) VALUE SPACES.
             05  RCL-1-CARD-TYPE-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(07)
                 VALUE '  ACCT '.
             05  RCL-1-ACCT-NO             PIC X(16) VALUE SPACES.
             05  RCL-1-ACCT-NO-REM VALUE SPACES.
               07  RCL-1-DASH              PIC X.
               07  RCL-1-ACCT-NO-EXT       PIC X(7).
             05  RCL-1-ACCT-NO-ERR-IND     PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(12)
                 VALUE '  TRAN AMT  '.
             05  RCL-1-TRAN-AMT-X VALUE SPACES.
               07  RCL-1-TRAN-AMT          PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
             05  RCL-1-TRAN-AMT-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RCL-1-ERROR-DATA VALUE SPACES.
               07  RCL-1-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-1-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-1-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-1-FATAL-FLAG        PIC X(01).
      *
           03  RPT-COMMON-LINE-2.
             05  RCL-2-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(10)
                 VALUE 'AUTH CODE '.
             05  RCL-2-AUTH-CODE           PIC X(06) VALUE SPACES.
             05  RCL-2-AUTH-CODE-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(12)
                 VALUE '  MOTO/ECOM '.
             05  RCL-2-MOTO-ECOM           PIC X(01) VALUE SPACE.
             05  RCL-2-MOTO-ECOM-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RCL-2-MOTO-ECOM-OUT       PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(14)
                 VALUE '   EXP DATE   '.
             05  RCL-2-EXP-DATE            PIC X(04) VALUE SPACES.
             05  RCL-2-EXP-DATE-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(20)
                 VALUE '  REF NUMBER        '.
             05  RCL-2-REF-NO-X VALUE SPACES.
               07  RCL-2-REF-NO            PIC 9(11).
             05  RCL-2-REF-NO-ERR-IND      PIC X(01) VALUE SPACE.
             05  RCL-2-OPTIONAL-DATA       PIC X(33) VALUE SPACES.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RCL-2-ERROR-DATA VALUE SPACES.
               07  RCL-2-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-2-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-2-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-2-FATAL-FLAG        PIC X(01).
      *
           03  RPT-COMMON-LINE-3.
             05  RCL-3-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE 'AUTH SRC       '.
             05  RCL-3-AUTH-SRC            PIC X(01) VALUE SPACE.
             05  RCL-3-AUTH-SRC-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(14)
                 VALUE '  POS E MOD   '.
             05  RCL-3-POS-E-MOD           PIC X(02) VALUE SPACES.
             05  RCL-3-POS-E-MOD-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(16)
                 VALUE '  POS TERM CAP  '.
             05  RCL-3-POS-TRM-CAP         PIC X(01) VALUE SPACE.
             05  RCL-3-POS-TRM-CAP-ERR-IND PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(23)
                 VALUE '  TIME STAMP           '.
             05  RCL-3-TIME-STAMP          PIC X(08) VALUE SPACES.
             05  RCL-3-TIME-STAMP-ERR-IND  PIC X(01) VALUE SPACE.
             05  RCL-3-OPTIONAL-DATA       PIC X(33) VALUE SPACES.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RCL-3-ERROR-DATA VALUE SPACES.
               07  RCL-3-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-3-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-3-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-3-FATAL-FLAG        PIC X(01).
      *
           03  RPT-COMMON-LINE-4.
             05  RCL-4-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(12)
                 VALUE 'AUTH CHAR   '.
             05  RCL-4-AUTH-CHAR           PIC X(01) VALUE SPACE.
             05  RCL-4-AUTH-CHAR-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RCL-4-AUTH-CHAR-OUT       PIC X(01) VALUE SPACE.
             05  RCL-4-VISA-MVV-DATA VALUE SPACES.                      02.39
               07  RCL-4-MVV-TIER-TITLE    PIC X(07).                   02.39
               07  RCL-4-MVV-TIER          PIC X(10).                   02.39
             05  RCL-4-MC-ASSIGN-ID-DATA REDEFINES RCL-4-VISA-MVV-DATA. 02.39
               07  RCL-4-MC-ASSIGN-ID-TITLE                             02.39
                                           PIC X(11).                   02.39
               07  RCL-4-MC-ASSIGN-ID      PIC X(06).                   02.39
             05  RCL-4-MVV-TIER-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(16)
                 VALUE '  CRD ID MTHD   '.
             05  RCL-4-CRD-ID-MTHD         PIC X(01) VALUE SPACE.
             05  RCL-4-CRD-ID-MTHD-ERR-IND PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(23)
                 VALUE '  TERM ID              '.
             05  RCL-4-TERM-ID             PIC X(08) VALUE SPACES.
             05  RCL-4-TERM-ID-ERR-IND     PIC X(01) VALUE SPACE.
             05  RCL-4-OPTIONAL-DATA       PIC X(33) VALUE SPACES.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RCL-4-ERROR-DATA VALUE SPACES.
               07  RCL-4-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-4-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-4-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-4-FATAL-FLAG        PIC X(01).
      *
           03  RPT-COMMON-LINE-5.
             05  RCL-5-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(14)
                 VALUE 'AUTH RESP     '.
             05  RCL-5-AUTH-RESP           PIC X(02) VALUE SPACES.
             05  RCL-5-AUTH-RESP-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE '  CAT TRM      '.
             05  RCL-5-CAT-TRM             PIC X(01) VALUE SPACE.
             05  RCL-5-CAT-TRM-ERR-IND     PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE '  SPC COND     '.
             05  RCL-5-SPC-COND            PIC X(02) VALUE SPACES.
             05  RCL-5-SPC-COND-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(25)
                 VALUE '  PROCESS CODE           '.
             05  RCL-5-PROC-CD             PIC X(06) VALUE SPACES.
             05  RCL-5-PROC-CD-ERR-IND     PIC X(01) VALUE SPACE.
             05  RCL-5-OPTIONAL-DATA       PIC X(33) VALUE SPACES.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RCL-5-ERROR-DATA VALUE SPACES.
               07  RCL-5-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-5-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-5-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-5-FATAL-FLAG        PIC X(01).
      *
           03  RPT-COMMON-LINE-6.
             05  RCL-6-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE 'AVS RESP       '.
             05  RCL-6-AVS-RESP            PIC X(01) VALUE SPACE.
             05  RCL-6-AVS-RESP-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(12)
                 VALUE '  CAT CODE  '.
             05  RCL-6-CAT-CODE-X VALUE SPACES.
               07  RCL-6-CAT-CODE          PIC 9(04).
             05  RCL-6-CAT-CODE-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(16)
                 VALUE '  ATM STL IND   '.
             05  RCL-6-ATM-STL-IND         PIC X(01) VALUE SPACE.
             05  RCL-6-ATM-STL-IND-ERR-IND PIC X(01) VALUE SPACE.
             05  RCL-6-PURCHASE-IDENT.
               07  FILLER                  PIC X(21)
                   VALUE '  PURCHASE IDENT FMT '.
               07  RCL-6-PRCH-ID-FMT       PIC X(01) VALUE SPACE.
               07  RCL-6-PRCH-ID-FMT-ERR-IND
                                           PIC X(01) VALUE SPACE.
               07  FILLER                  PIC X(16)
                   VALUE '   IDENT NUMBER '.
               07  RCL-6-PRCH-ID-NO        PIC X(25) VALUE SPACES.      02.55
               07  RCL-6-PRCH-ID-NO-ERR-IND
                                           PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RCL-6-ERROR-DATA VALUE SPACES.
               07  RCL-6-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-6-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-6-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-6-FATAL-FLAG        PIC X(01).
      *
           03  RPT-COMMON-LINE-7.
             05  RCL-7-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(19)
                 VALUE 'DESCRIPTION IN     '.
             05  RCL-7-MRCH-NAME           PIC X(25) VALUE SPACES.
             05  RCL-7-MRCH-NAME-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RCL-7-MRCH-CITY           PIC X(13) VALUE SPACES.
             05  RCL-7-MRCH-CITY-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(06)
                 VALUE ' UQID '.
             05  RCL-7-UNIQUE-TRAN-ID      PIC X(30) VALUE SPACES.
             05  FILLER                    PIC X(06)
                 VALUE ' MRCH '.
             05  RCL-7-MRCH-ID             PIC X(16) VALUE SPACES.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RCL-7-ERROR-DATA VALUE SPACES.
               07  RCL-7-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-7-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-7-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RCL-7-FATAL-FLAG        PIC X(01).
      *
           03  RPT-COMMON-LINE-8.
             05  RCL-8-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(19)
                 VALUE 'DESCRIPTION OUT    '.
             05  RCL-8-MRCH-NAME           PIC X(25) VALUE SPACES.
             05  RCL-8-MRCH-NAME-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RCL-8-MRCH-CITY           PIC X(13) VALUE SPACES.
             05  RCL-8-MRCH-CITY-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RCL-8-MRCH-STATE          PIC X(02) VALUE SPACES.
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RCL-8-MRCH-COUNTRY        PIC X(03) VALUE SPACES.
             05  RCL-8-MRCH-CNTRY-ERR-IND  PIC X(01) VALUE SPACE.       02.41
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RCL-8-MRCH-ZIP            PIC X(09) VALUE SPACES.
             05  RCL-8-MRCH-ZIP-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(09)
                 VALUE '  REF NO '.
             05  RCL-8-REF-NO              PIC X(23) VALUE SPACES.
             05  FILLER                    PIC X(19) VALUE SPACES.      02.41
      *
           03  RPT-COMMON-LINE-9.                                       02.95
             05  RCL-9-CC                  PIC X(01) VALUE SPACE.       02.95
             05  FILLER                    PIC X(19)                    02.95
                 VALUE 'SURCHARGE AMT      '.                           02.95
             05  RCL-9-SUR-AMT-X VALUE SPACES.                          02.95
               07  RCL-9-SUR-AMT           PIC ZZZ,ZZ9.999.             02.95
             05  RCL-9-SUR-AMT-ERR-IND     PIC X(01) VALUE SPACE.       02.95
             05  FILLER                    PIC X(05)  VALUE SPACES.     02.95
             05  FILLER                    PIC X(15)                    02.95
                 VALUE 'SURCHARGE IND  '.                               02.95
             05  RCL-9-SUR-IND             PIC X     VALUE SPACES.      02.95
             05  RCL-9-SUR-IND-ERR-IND     PIC X(01) VALUE SPACE.       02.95
             05  FILLER                    PIC X(79) VALUE SPACES.      02.95
      *                                                                 02.95
           03  RPT-COMMON-LINE-10.                                      02.95
             05  RCL-10-CC                 PIC X(01) VALUE SPACE.       02.95
             05  RCL-10-ALTERNATE-DATA.                                 02.95
               07  FILLER                  PIC X(12)                    02.95
                   VALUE 'POST PLAN   '.                                02.95
               07  RCL-10-POST-PLAN        PIC X(04) VALUE SPACES.      02.95
               07  RCL-10-POST-PLAN-ADD-IND PIC X(01) VALUE SPACE.      02.95
               07  FILLER                  PIC X(11)                    02.95
                   VALUE '  INT PLAN '.                                 02.95
               07  RCL-10-INT-PLAN         PIC X(04) VALUE SPACES.      02.95
               07  FILLER                  PIC X(03) VALUE SPACES.      02.95
             05  RCL-10-OPTIONAL-DATA      PIC X(84) VALUE SPACES.      02.95
             05  FILLER                    PIC X(02) VALUE SPACES.      03.51
             05  RVL-BAC00110-VERSION      PIC X(03) VALUE SPACES.      03.51
             05  RVL-BAS110AR-VERSION      PIC X(03) VALUE SPACES.      03.51
             05  RVL-QUAL-PGM-VERSION      PIC X(03) VALUE SPACES.      03.51
             05  RVL-QUAL-PGM              PIC X(02) VALUE SPACES.      03.51
      *
         02  FILLER REDEFINES REPORT-COMMON-LINES.
           03  RPT-COMMON-LINE OCCURS 10.                               02.95
             05  FILLER                    PIC X(120).
             05  RCL-ERROR-DATA OCCURS 3.
               07  RCL-ERROR-CD            PIC Z99.
               07  FILLER                  PIC X(01).
             05  RCL-FATAL-FLAG            PIC X(01).
      *
         02  REPORT-OTHER-LINES.
      *
           03  RPT-INTCHG-LINE-1.
             05  RIL-1-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(11)
                 VALUE 'REIMB CURR '.
             05  RIL-1-REIMB-CURR-X VALUE SPACES.
               05  RIL-1-REIMB-CURR        PIC 9(03).
             05  FILLER                    PIC X(05)
                 VALUE ' AMT '.
             05  RIL-1-REIMB-AMT-X VALUE SPACES.
               07  RIL-1-REIMB-AMT         PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
             05  FILLER                    PIC X(05)
                 VALUE ' FEE '.
             05  RIL-1-REIMB-FEE-X VALUE SPACES.
               07  RIL-1-REIMB-FEE         PIC ZZZ,ZZZ,ZZ9.999-.
             05  FILLER                    PIC X(10)
                 VALUE ' STL CURR '.
             05  RIL-1-SETTLE-CURR-X VALUE SPACES.
               07  RIL-1-SETTLE-CURR       PIC 9(03).
             05  FILLER                    PIC X(05)
                 VALUE ' AMT '.
             05  RIL-1-SETTLE-AMT-X VALUE SPACES.
               07  RIL-1-SETTLE-AMT        PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
             05  FILLER                    PIC X(05)
                 VALUE ' FEE '.
             05  RIL-1-INTCHG-FEE-X VALUE SPACES.
               07  RIL-1-INTCHG-FEE        PIC ZZZ,ZZZ,ZZ9.999-.
             05  RIL-1-ERROR-DATA VALUE SPACES.
               07  RIL-1-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RIL-1-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RIL-1-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RIL-1-FATAL-FLAG        PIC X(01).
      *
           03  RPT-VISA-LINE-1.
             05  RVS-1-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(08)                    03.42V
                 VALUE 'PROD ID '.                                      03.42V
             05  RVS-1-PROD-ID             PIC X(02) VALUE SPACES.
             05  RVS-1-PROD-ID-ERR-IND     PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.       03.04A
             05  RVS-1-PROD-ID-OUT         PIC X(02) VALUE SPACE.       03.04A
             05  FILLER                    PIC X(14)                    03.42V
                 VALUE ' MKT SPC DATA '.                                03.42V
             05  RVS-1-MKT-SPC-DAT         PIC X(01) VALUE SPACE.
             05  RVS-1-MKT-SPC-DAT-ERR-IND PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(12)                    03.42V
                 VALUE ' VALID CODE '.                                  03.42V
             05  RVS-1-VALID-CODE          PIC X(04) VALUE SPACES.
             05  RVS-1-VALID-CODE-ERR-IND  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(10)                    03.42V
                 VALUE ' TRANS ID '.                                    03.42V
             05  RVS-1-TRANS-IDENT-X VALUE SPACES.
               07  RVS-1-TRANS-IDENT       PIC 9(15).
             05  RVS-1-TRANS-IDENT-ERR-IND PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(09)                    03.42V
                 VALUE ' INF IND '.                                     03.42V
             05  RVS-1-INFO-IND            PIC X(01) VALUE SPACE.
             05  RVS-1-INFO-IND-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(06)
                 VALUE ' TELE '.
             05  RVS-1-TELE-NO             PIC X(14) VALUE SPACES.
             05  RVS-1-TELE-NO-ERR-IND     PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(05)                    03.42V
                 VALUE ' MCS '.                                         03.42V
             05  RVS-1-MCS-NO              PIC X(02) VALUE SPACES.      03.42V
             05  RVS-1-SLASH               PIC X(01) VALUE '/'.         03.42V
             05  RVS-1-MCS-CNT             PIC X(02) VALUE SPACES.      03.42V
             05  RVS-1-MCS-ERR-IND         PIC X(01) VALUE SPACES.      03.42V
             05  FILLER                    PIC X(03) VALUE SPACES.      03.42V
             05  RVS-1-ERROR-DATA VALUE SPACES.
               07  RVS-1-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RVS-1-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RVS-1-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RVS-1-FATAL-FLAG        PIC X(01).
      *
           03  RPT-VISA-LINE-2.
             05  RVS-2-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE 'TRAN QUAL      '.
             05  RVS-2-TRAN-QUAL           PIC X(01) VALUE SPACE.
             05  RVS-2-TRAN-QUAL-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE '  CRD VER RES  '.
             05  RVS-2-CRD-VER-RES         PIC X(01) VALUE SPACE.
             05  RVS-2-CRD-VER-RES-ERR-IND PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE '  SVC DEVELOP  '.
             05  RVS-2-SVC-DEVEL           PIC X(02) VALUE SPACES.
             05  RVS-2-SVC-DEVEL-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(13)
                 VALUE '  CHIP COND  '.
             05  RVS-2-CHIP-COND           PIC X(01) VALUE SPACE.
             05  RVS-2-CHIP-COND-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE '  POS ENVIRON  '.
             05  RVS-2-POS-ENV             PIC X(01) VALUE SPACE.
             05  RVS-2-POS-ENV-ERR-IND     PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(09)
                 VALUE '  ECGI   '.
             05  RVS-2-ECGI                PIC X(02) VALUE SPACES.
             05  RVS-2-ECGI-ERR-IND        PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(10)                    02.81
                 VALUE '  FND SRC '.                                    02.81
             05  RVS-2-ACCT-FUND-SRC       PIC X(01) VALUE SPACE.       02.81
             05  FILLER                    PIC X(12) VALUE SPACE.       03.46
             05  RVS-2-ERROR-DATA VALUE SPACES.
               07  RVS-2-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RVS-2-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RVS-2-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RVS-2-FATAL-FLAG        PIC X(01).
      *                                                                 02.23
           03  RPT-VISA-LINE-3.                                         02.23
             05  RVS-3-CC                  PIC X(01) VALUE SPACE.       02.23
             05  FILLER                    PIC X(18)                    02.23
                 VALUE 'INSTALL TOTAL AMT '.                            02.23
             05  RVS-3-INSTL-TOTAL-AMT-X             VALUE SPACES.      02.23
               07  RVS-3-INSTL-TOTAL-AMT   PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.    02.23
             05  RVS-3-INSTL-TOT-AMT-ERR-IND                            02.23
                                           PIC X(01) VALUE SPACE.       02.23
             05  FILLER                    PIC X(18)                    02.23
                 VALUE ' INSTALL TOTAL NO '.                            02.23
             05  RVS-3-INSTL-TOTAL-NO-X              VALUE SPACES.      02.23
               07  RVS-3-INSTL-TOTAL-NO    PIC 9(03).                   02.23
             05  RVS-3-INSTL-TOT-NO-ERR-IND                             02.23
                                           PIC X(01) VALUE SPACE.       02.23
             05  FILLER                    PIC X(12)                    02.23
                 VALUE ' INSTALL NO '.                                  02.23
             05  RVS-3-INSTL-NO-X                    VALUE SPACES.      03.42
               07  RVS-3-INSTL-NO          PIC 9(03).                   03.42
             05  RVS-3-INSTL-NO-ERR-IND    PIC X(01) VALUE SPACE.       03.42
             05  FILLER                    PIC X(14)                    02.23
                 VALUE ' INSTALL FREQ '.                                02.23
             05  RVS-3-INSTL-FREQUENCY     PIC X(01) VALUE SPACES.      02.23
             05  RVS-3-INSTL-FREQ-ERR-IND  PIC X(01) VALUE SPACE.       02.23
             05  FILLER                    PIC X(26) VALUE SPACES.      02.23
             05  RVS-3-ERROR-DATA VALUE SPACES.                         02.23
               07  RVS-3-ERROR-CD-1        PIC Z99.                     02.23
               07  FILLER                  PIC X(01).                   02.23
               07  RVS-3-ERROR-CD-2        PIC Z99.                     02.23
               07  FILLER                  PIC X(01).                   02.23
               07  RVS-3-ERROR-CD-3        PIC Z99.                     02.23
               07  FILLER                  PIC X(01).                   02.23
               07  RVS-3-FATAL-FLAG        PIC X(01).                   02.23
      *
           03  RPT-VISA-LINE-4.                                         03.42V
             05  RVS-4-CC                  PIC X(01) VALUE SPACE.       03.42V
             05  FILLER                    PIC X(04)                    03.42V
                 VALUE 'SQI '.                                          03.42V
             05  RVS-4-SPEND-QUAL-IND      PIC X(01) VALUE SPACES.      03.42V
             05  RVS-4-SPEND-QUAL-ERR-IND  PIC X(01) VALUE SPACE.       03.42V
             05  FILLER                    PIC X(09)                    03.46
                 VALUE ' TKN IND '.                                     03.46
             05  RVS-4-TOKEN-IND           PIC X(01) VALUE SPACES.      03.46
             05  RVS-4-TOKEN-IND-ERR-IND   PIC X(01) VALUE SPACE.       03.46
             05  FILLER                    PIC X(14)                    03.46
                 VALUE ' TKN ASSR LVL '.                                03.46
             05  RVS-4-TOKEN-ASSURE-LVL    PIC X(02) VALUE SPACES.      03.46
             05  RVS-4-TOKEN-ASSURE-LVL-ERR-IND                         03.46
                                           PIC X(01) VALUE SPACE.       03.46
             05  FILLER                    PIC X(10)                    03.62V
                 VALUE ' ACCT TYP '.                                    03.62V
             05  RVS-4-ACCT-TYPE           PIC X(01) VALUE SPACES.      03.62V
             05  RVS-4-ACCT-TYPE-ERR-IND                                03.62V
                                           PIC X(01) VALUE SPACE.       03.62V
             05  FILLER                    PIC X(5)                     03.63
                 VALUE ' VPP '.                                         03.63
             05  RVS-4-VISA-VPP            PIC X(01) VALUE SPACE.       03.63
             05  RVS-4-VISA-VPP-ERR-IND    PIC X(01) VALUE SPACE.       03.63
             05  FILLER                    PIC X(66) VALUE SPACES.      03.63
             05  RVS-4-ERROR-DATA VALUE SPACES.                         03.42V
               07  RVS-4-ERROR-CD-1        PIC Z99.                     03.42V
               07  FILLER                  PIC X(01).                   03.42V
               07  RVS-4-ERROR-CD-2        PIC Z99.                     03.42V
               07  FILLER                  PIC X(01).                   03.42V
               07  RVS-4-ERROR-CD-3        PIC Z99.                     03.42V
               07  FILLER                  PIC X(01).                   03.42V
               07  RVS-4-FATAL-FLAG        PIC X(01).                   03.42V
      *                                                                 03.42V
           03  RPT-MC-LINE-1.
             05  RMC-1-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(13)
                 VALUE 'UCAF COLL CD '.
             05  RMC-1-UCAF-COL-CD         PIC X(01) VALUE SPACE.
             05  RMC-1-UCAF-COL-CD-ERR-IND PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RMC-1-UCAF-COL-CD-OUT     PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(13)
                 VALUE '  SEC PROT   '.
             05  RMC-1-SEC-PROT            PIC X(01) VALUE SPACE.
             05  RMC-1-SEC-PROT-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RMC-1-SEC-PROT-OUT        PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(14)
                 VALUE '  CHD AUTHEN  '.
             05  RMC-1-CHD-AUTHEN          PIC X(01) VALUE SPACE.
             05  RMC-1-CHD-AUTHEN-ERR-IND  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RMC-1-CHD-AUTHEN-OUT      PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(13)
                 VALUE '  BNKNET REF '.
             05  RMC-1-BANKNET-REF-IN      PIC X(09) VALUE SPACES.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RMC-1-BANKNET-REF-OUT     PIC X(09) VALUE SPACES.
             05  RMC-1-BANKNET-REF-ERR-IND PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(14)
                 VALUE '  BNKNET DATE '.
             05  RMC-1-BANKNET-DT          PIC X(04) VALUE SPACES.
             05  RMC-1-BANKNET-DT-ERR-IND  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(08)                    02.33
                 VALUE '  T-CAT '.                                      02.33
             05  RMC-1-TRN-CAT-IND-IN      PIC X(02) VALUE SPACES.      02.33
             05  FILLER                    PIC X(01) VALUE SPACE.       02.33
             05  RMC-1-TRN-CAT-IND-OUT     PIC X(02) VALUE SPACES.      02.33
             05  RMC-1-TRN-CAT-IND-ERR-IND PIC X(01) VALUE SPACE.       02.33
             05  FILLER                    PIC X(01) VALUE SPACE.       02.33
             05  RMC-1-ERROR-DATA VALUE SPACES.
               07  RMC-1-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RMC-1-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RMC-1-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RMC-1-FATAL-FLAG        PIC X(01).
      *
           03  RPT-MC-LINE-2.
             05  RMC-2-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(13)
                 VALUE 'ACCEPT BRAND '.
             05  RMC-2-ACCEPT-BRND         PIC X(01) VALUE SPACE.       03.42M
             05  RMC-2-ACCEPT-BRND-ERR-IND PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(07)
                 VALUE '  INST '.
             05  RMC-2-INSTALL-NO          PIC X(03) VALUE SPACES.
             05  RMC-2-INSTALL-NO-ERR-IND  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(02) VALUE '- '.
             05  RMC-2-NO-INSTALL          PIC X(03) VALUE SPACES.
             05  RMC-2-NO-INSTALL-ERR-IND  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(11)
                 VALUE '  PROM CD  '.
             05  RMC-2-PROM-CD             PIC X(06) VALUE SPACES.
             05  RMC-2-PROM-CD-ERR-IND     PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(19)
                 VALUE '  POS DATA CODES   '.
             05  RMC-2-POS-DATA-CODES VALUE SPACES.
               07  RMC-2-POS-DATA-CD-ENTRY OCCURS 12.
                 09  RMC-2-POS-DATA-CD     PIC X(01).
                 09  RMC-2-POS-DATA-CD-ERR-IND
                                           PIC X(01).
             05  FILLER                    PIC X(09)
                 VALUE '  SVC CD '.
             05  RMC-2-SVC-CODE            PIC X(03) VALUE SPACES.
             05  RMC-2-SVC-CODE-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(09)                    02.68
                 VALUE '  RT IND '.                                     02.68
             05  RMC-2-RATE-IND            PIC X(01) VALUE SPACES.      02.68
             05  FILLER                    PIC X(03) VALUE SPACE.       03.42M
             05  RMC-2-ERROR-DATA VALUE SPACES.
               07  RMC-2-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RMC-2-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RMC-2-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RMC-2-FATAL-FLAG        PIC X(01).
      *
           03  RPT-MC-LINE-3.                                           03.16M
             05  RMC-3-CC                  PIC X(01) VALUE SPACE.       03.16M
             05  FILLER                    PIC X(08)                    03.16M
                 VALUE 'DEV TYP '.                                      03.16M
             05  RMC-3-DEV-TYP             PIC X(02) VALUE SPACE.       03.16M
             05  RMC-3-DEV-TYP-ERR-IND     PIC X(01) VALUE SPACE.       03.16M
             05  FILLER                    PIC X(13)                    03.16M
                 VALUE ' TRANSIT PGM '.                                 03.16M
             05  RMC-3-TRANSIT-PGM         PIC X(04) VALUE SPACES.      03.16M
             05  RMC-3-TRANSIT-PGM-ERR-IND PIC X(01) VALUE SPACE.       03.16M
             05  FILLER                    PIC X(09)                    03.16M
                 VALUE ' MAP SVC '.                                     03.42M
             05  RMC-3-MAP-SVC-IND         PIC X(01) VALUE SPACES.      03.42M
             05  FILLER                    PIC X(14)                    03.53
                 VALUE ' RISK MGMT CD '.                                03.53
             05  RMC-3-RISK-MGMT-APPRV-CD  PIC X(11) VALUE SPACES.      03.53
             05  RMC-3-RISK-MGMT-ERR-IND   PIC X(01) VALUE SPACES.      03.53
             05  FILLER                    PIC X(13)                    03.62M
                 VALUE ' TKN ASR LVL '.                                 03.62M
             05  RMC-3-TOKEN-ASSURE-LEVEL  PIC X(02) VALUE SPACES.      03.62M
             05  RMC-3-TOKEN-ASR-L-ERR-IND PIC X(01) VALUE SPACES.      03.62M
             05  FILLER                    PIC X(12)                    03.62M
                 VALUE ' TKN REQ ID '.                                  03.62M
             05  RMC-3-TOKEN-REQSTR-ID     PIC X(11) VALUE SPACES.      03.62M
             05  RMC-3-TOKEN-RQSTR-ERR-IND PIC X(01) VALUE SPACES.      03.62M
             05  FILLER                    PIC X(14) VALUE SPACES.      03.62M
             05  RMC-3-ERROR-DATA VALUE SPACES.                         03.16M
               07  RMC-3-ERROR-CD-1        PIC Z99.                     03.16M
               07  FILLER                  PIC X(01).                   03.16M
               07  RMC-3-ERROR-CD-2        PIC Z99.                     03.16M
               07  FILLER                  PIC X(01).                   03.16M
               07  RMC-3-ERROR-CD-3        PIC Z99.                     03.16M
               07  FILLER                  PIC X(01).                   03.16M
               07  RMC-3-FATAL-FLAG        PIC X(01).                   03.16M
      *                                                                 03.16M
           03  RPT-AMEX-LINE-1.
             05  RAX-1-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE 'SRVC ESTAB NO  '.
             05  RAX-1-SE-X.
               07  RAX-1-SE                PIC 9(15) VALUE ZEROS.
             05  RAX-1-SE-ERR-IND          PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(10)                    02.68
                 VALUE '  FRMT CD '.                                    02.68
             05  RAX-1-SE-FC               PIC 9(02) VALUE ZEROS.
             05  RAX-1-SE-FC-ERR-IND       PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(11)
                 VALUE '  MRCH LOC '.
             05  RAX-1-MRCH-LOC-ID         PIC X(15) VALUE SPACE.
             05  RAX-1-MRCH-LOC-ID-ERR-IND PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(10)                    02.68
                 VALUE '  VOL DSC '.                                    02.68
             05  RAX-1-VOL-DISC-CODE       PIC X(01) VALUE SPACE.       02.68
             05  FILLER                    PIC X(11)
                 VALUE '  DATA CDS '.
             05  RAX-1-POS-DATA-CODES VALUE SPACES.
               07  RAX-1-POS-DATA-CD-ENTRY OCCURS 12.
                 09  RAX-1-POS-DATA-CD     PIC X(01).
                 09  RAX-1-POS-DATA-CD-ERR-IND
                                           PIC X(01).
             05  FILLER                    PIC X(02) VALUE SPACES.
             05  RAX-1-ERROR-DATA VALUE SPACES.
               07  RAX-1-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RAX-1-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RAX-1-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RAX-1-FATAL-FLAG        PIC X(01).
      *
           03  RPT-AMEX-LINE-2.
             05  RAX-2-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(14)
                 VALUE 'EXTEND PAY    '.
             05  RAX-2-EXTEND-PAY          PIC X(02) VALUE SPACE.
             05  RAX-2-EXTEND-PAY-ERR-IND  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(14)
                 VALUE '  SUB MTHD    '.
             05  RAX-2-SUB-MTHD            PIC X(02) VALUE SPACE.
             05  RAX-2-SUB-MTHD-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(15)
                 VALUE '  MEDIA CODE   '.
             05  RAX-2-MEDIA-CD            PIC X(02) VALUE SPACE.
             05  RAX-2-MEDIA-CD-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(11)
                 VALUE '  CONTACT  '.
             05  RAX-2-CONTACT             PIC X(40) VALUE SPACE.
             05  RAX-2-CONTACT-ERR-IND     PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(07)                    03.56
                 VALUE '  ECI  '.                                       03.56
             05  RAX-2-ECI                 PIC X(02) VALUE SPACE.       03.56
             05  RAX-2-ECI-ERR-IND         PIC X(01) VALUE SPACE.       03.56
             05  FILLER                    PIC X(05) VALUE SPACES.      03.56
             05  RAX-2-ERROR-DATA VALUE SPACES.
               07  RAX-2-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RAX-2-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RAX-2-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RAX-2-FATAL-FLAG        PIC X(01).
      *
           03  RPT-AMEX-LINE-3.                                         03.29
             05  RAX-3-CC                  PIC X(01) VALUE SPACE.       03.29
             05  FILLER                    PIC X(14)                    03.29
                 VALUE 'INV REF NBR   '.                                03.29
             05  RAX-3-INV-REF-NBR         PIC X(25) VALUE SPACE.       03.29
             05  RAX-3-INV-REF-NBR-IND     PIC X(01) VALUE SPACE.       03.29
             05  FILLER                    PIC X(11)                    03.47
                 VALUE ' SUBMIT ID '.                                   03.47
             05  RAX-3-SUBMIT-ID           PIC X(11) VALUE SPACE.       03.47
             05  RAX-3-SUBMIT-ID-ERR-IND   PIC X(01) VALUE SPACE.       03.47
             05  FILLER                    PIC X(12)                    03.47
                 VALUE ' SETTLE FLG '.                                  03.47
             05  RAX-3-SETTLE-FLG          PIC X(01) VALUE SPACE.       03.47
             05  RAX-3-SETTLE-FLG-ERR-IND  PIC X(01) VALUE SPACE.       03.47
             05  FILLER                    PIC X(01) VALUE SPACE.       03.47
             05  RAX-3-SETTLE-FLG-OUT      PIC X(01) VALUE SPACE.       03.47
             05  FILLER                    PIC X(40) VALUE SPACES.      03.47
             05  RAX-3-ERROR-DATA VALUE SPACES.                         03.29
               07  RAX-3-ERROR-CD-1        PIC Z99.                     03.29
               07  FILLER                  PIC X(01).                   03.29
               07  RAX-3-ERROR-CD-2        PIC Z99.                     03.29
               07  FILLER                  PIC X(01).                   03.29
               07  RAX-3-ERROR-CD-3        PIC Z99.                     03.29
               07  FILLER                  PIC X(01).                   03.29
               07  RAX-3-FATAL-FLAG        PIC X(01).                   03.29
      *                                                                 03.29
           03  RPT-DS-LINE-1.
             05  RDS-1-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(13)                    02.68
                 VALUE 'DISC MRCH NO '.                                 02.68
             05  RDS-1-NO-X.
               07  RDS-1-NO                PIC 9(15) VALUE ZEROS.
             05  RDS-1-NO-ERR-IND          PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(13)                    02.68
                 VALUE '  MRCH CNTRY '.                                 02.68
             05  RDS-1-MRCH-COUNTRY-A      PIC X(03) VALUE SPACE.
             05  FILLER                    PIC X(03)
                 VALUE ' / '.
             05  RDS-1-MRCH-COUNTRY-N      PIC 9(03) VALUE ZEROS.
             05  RDS-1-MRCH-COUNTRY-ERR-IND
                                           PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(11)
                 VALUE '  TRAN TYP '.
             05  RDS-1-TRAN-TYP            PIC X(02) VALUE SPACE.
             05  RDS-1-TRAN-TYP-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(10)                    02.68
                 VALUE '  REG IND '.                                    02.68
             05  RDS-1-REG-IND             PIC X(01) VALUE SPACE.       02.68
             05  FILLER                    PIC X(12)                    02.68
                 VALUE '  LCL DATE '.                                   02.68
             05  RDS-1-LOCAL-DATE          PIC X(08) VALUE SPACE.
             05  RDS-1-LOCAL-DATE-ERR-IND  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(11)                    02.68
                 VALUE '  LCL TIME '.                                   02.68
             05  RDS-1-LOCAL-TIME          PIC X(08) VALUE SPACE.
             05  RDS-1-LOCAL-TIME-ERR-IND  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(02) VALUE SPACES.      02.68
             05  RDS-1-ERROR-DATA VALUE SPACES.
               07  RDS-1-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RDS-1-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RDS-1-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RDS-1-FATAL-FLAG        PIC X(01).
      *
           03  RPT-DS-LINE-2.
             05  RDS-2-CC                  PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(09)
                 VALUE 'AUTH STN '.
             05  RDS-2-AUTH-STAN           PIC X(06).
             05  RDS-2-AUTH-STAN-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(11)
                 VALUE '  PIN ECAP '.
             05  RDS-2-PIN-E-CAP           PIC X(01) VALUE SPACE.
             05  RDS-2-PIN-E-CAP-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(10)
                 VALUE '  TRK CND '.
             05  RDS-2-TRK-COND-CD-1       PIC X(01) VALUE SPACE.
             05  RDS-2-TRK-COND-CD-1-ERR-IND
                                           PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RDS-2-TRK-COND-CD-2       PIC X(01) VALUE SPACE.
             05  RDS-2-TRK-COND-CD-2-ERR-IND
                                           PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(10)
                 VALUE '  PRT SHP '.
             05  RDS-2-PART-SHIP-IND       PIC X(01).
             05  RDS-2-PART-SHIP-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(09)
                 VALUE '  NET ID '.
             05  RDS-2-NETWORK-REF-ID      PIC X(15).
             05  RDS-2-NETWORK-REF-ERR-IND PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(11)
                 VALUE '  DATA CDS '.
             05  RDS-2-POS-DATA-CODES VALUE SPACES.
               07  RDS-2-POS-DATA-CD-ENTRY OCCURS 13.
                 09  RDS-2-POS-DATA-CD     PIC X(01).
                 09  RDS-2-POS-DATA-CD-ERR-IND
                                           PIC X(01).
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  RDS-2-ERROR-DATA VALUE SPACES.
               07  RDS-2-ERROR-CD-1        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RDS-2-ERROR-CD-2        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RDS-2-ERROR-CD-3        PIC Z99.
               07  FILLER                  PIC X(01).
               07  RDS-2-FATAL-FLAG        PIC X(01).
      *                                                                 03.47
           03  RPT-DS-LINE-3.                                           03.47
             05  RDS-3-CC                  PIC X(01) VALUE SPACE.       03.47
             05  FILLER                    PIC X(07)                    03.47
                 VALUE 'ACQ ID '.                                       03.47
             05  RDS-3-ACQ-ID              PIC X(11).                   03.47
             05  RDS-3-ACQ-ID-ERR-IND      PIC X(01) VALUE SPACE.       03.47
             05  FILLER                    PIC X(11)                    03.47
                 VALUE ' CLIENT ID '.                                   03.47
             05  RDS-3-CLIENT-ID           PIC X(03).                   03.47
             05  RDS-3-CLIENT-ID-ERR-IND   PIC X(01) VALUE SPACE.       03.47
             05  FILLER                    PIC X(08)                    03.47
                 VALUE ' PREFIX '.                                      03.47
             05  RDS-3-PREFIX              PIC X(02).                   03.47
             05  RDS-3-PREFIX-ERR-IND      PIC X(01) VALUE SPACE.       03.47
             05  FILLER                    PIC X(12)                    03.47
                 VALUE ' SETTLE FLG '.                                  03.47
             05  RDS-3-SETTLE-FLG          PIC X(01).                   03.47
             05  RDS-3-SETTLE-FLG-ERR-IND  PIC X(01) VALUE SPACE.       03.47
             05  FILLER                    PIC X(01) VALUE SPACE.       03.47
             05  RDS-3-SETTLE-FLG-OUT      PIC X(01) VALUE SPACE.       03.47
             05  FILLER                    PIC X(58) VALUE SPACES.      03.47
             05  RDS-3-ERROR-DATA VALUE SPACES.                         03.47
               07  RDS-3-ERROR-CD-1        PIC Z99.                     03.47
               07  FILLER                  PIC X(01).                   03.47
               07  RDS-3-ERROR-CD-2        PIC Z99.                     03.47
               07  FILLER                  PIC X(01).                   03.47
               07  RDS-3-ERROR-CD-3        PIC Z99.                     03.47
               07  FILLER                  PIC X(01).                   03.47
               07  RDS-3-FATAL-FLAG        PIC X(01).                   03.47
      *                                                                 03.47
           03  RPT-DOWNGRADE-LINE.
             05  RDL-CC                    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(10)
                 VALUE 'RECLASSES:'.
             05  RDL-PLAN-ERROR-DATA VALUE SPACES.
               07  RDL-PED-ENTRY OCCURS 10.
                 09  FILLER                PIC X(01).
                 09  RDL-PED-PLAN          PIC X(04).
                 09  RDL-PED-DASH          PIC X(01).
                 09  RDL-PED-ERROR         PIC X(04).
             05  FILLER                    PIC X(22) VALUE SPACES.
      *
       01  RPT-REDEFINED-DATA.
      *
           03  RRD-AMT-DATA VALUE SPACES.
             05  RRD-AMT-ID                PIC X(12).
             05  RRD-AMT-X.
               07  RRD-AMT                 PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
             05  RRD-AMT-ERR-IND           PIC X(01).
      *
           03  RRD-CSP-DATA.
             05  FILLER                    PIC X(17)
                 VALUE '  CUST SVC PHONE '.
             05  RRD-CSP-PHONE             PIC X(14) VALUE SPACES.      02.55
             05  RRD-CSP-PHONE-ERR-IND     PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACES.
      *
           03  RRD-AMX-DATA.
             05  FILLER                    PIC X(11)
                 VALUE '  TRANS ID '.
             05  RRD-AMX-TRANS-IDENT-X               VALUE SPACES.
               07  RRD-AMX-TRANS-IDENT     PIC 9(15).
             05  RRD-AMX-TRANS-IDENT-ERR-IND
                                           PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(06) VALUE SPACES.
      *
           03  RRD-DS-DATA.
             05  FILLER                    PIC X(15)
                 VALUE '  TRANS ID     '.
             05  RRD-DS-TRANS-ID           PIC X(16) VALUE SPACES.
             05  RRD-DS-TRANS-ID-ERR-IND   PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(12)
                 VALUE '  SPEC USE  '.
             05  RRD-DS-AMT-X VALUE SPACES.
               07  RRD-DS-AMT              PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
             05  RRD-DS-AMT-ERR-IND        PIC X(01) VALUE SPACE.
      *
           03  RCL-OPTIONAL-DATA-10-MC.                                 02.95
             05  FILLER                    PIC X(08)
                 VALUE 'PRG REG '.
             05  ROD-MC-PROG-REGIST-ID     PIC X(03) VALUE SPACES.
             05  FILLER                    PIC X(06)                    02.81
                 VALUE '  BSA '.                                        02.81
             05  FILLER                    PIC X(01) VALUE SPACE.       02.81
             05  ROD-MC-SRV-LVL-CODE       PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.       02.81
             05  ROD-MC-SRV-ID-CODE        PIC X(06) VALUE SPACES.
             05  FILLER                    PIC X(01) VALUE SPACE.       02.81
             05  ROD-MC-SRV-IRD            PIC X(02) VALUE SPACES.
             05  ROD-MC-SRV-IRD-ERR-IND    PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(09)
                 VALUE ' PROD ID '.
             05  ROD-MC-PRODUCT-ID-IN      PIC X(03) VALUE SPACES.
             05  FILLER                    PIC X(01) VALUE SPACE.
             05  ROD-MC-PRODUCT-ID-OUT     PIC X(03) VALUE SPACES.
             05  ROD-MC-PRODUCT-ID-ERR-IND PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(08)                    02.81
                 VALUE ' PRE PD '.                                      02.81
             05  ROD-MC-PREPAID-IND        PIC X(01) VALUE SPACE.       02.81
             05  FILLER                    PIC X(05)
                 VALUE ' ALM '.
             05  ROD-MC-ALM-IND            PIC X(01) VALUE SPACES.
             05  FILLER                    PIC X(08)
                 VALUE '  BRAND '.
             05  ROD-MC-ACCEPT-BRAND-CD    PIC X(03) VALUE SPACES.
             05  FILLER                    PIC X(11) VALUE SPACES.      03.39
      *
           03  RCL-OPTIONAL-DATA-10-VS.                                 02.95
             05  FILLER                    PIC X(08)                    02.68
                 VALUE 'RMB IND '.
             05  ROD-VS-REIMB-IND          PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(10)
                 VALUE '  FEE PGM '.
             05  ROD-VS-FEE-PGM-IND        PIC X(03) VALUE SPACES.
             05  FILLER                    PIC X(09)                    02.68
                 VALUE '  PY SVC '.                                     02.68
             05  ROD-VS-PAY-SVC-IND        PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(10)                    02.68
                 VALUE '  TCH IND '.                                    02.41
             05  ROD-VS-TECH-IND           PIC X(01) VALUE SPACE.       02.41
             05  FILLER                    PIC X(10)                    02.68
                 VALUE '  REG IND '.                                    02.68
             05  ROD-VS-REG-IND            PIC X(01) VALUE SPACE.       02.68
             05  FILLER                    PIC X(10)                    02.41
                 VALUE '  LRG TKT '.                                    02.81
             05  ROD-VS-LRG-TKT            PIC X(01) VALUE SPACE.       02.81
             05  FILLER                    PIC X(10)                    02.68
                 VALUE '  ACT LVL '.                                    02.81
             05  ROD-VS-ACCT-LVL-IND       PIC X(01) VALUE SPACE.       02.81
             05  FILLER                    PIC X(06)                    02.68
                 VALUE '  USE '.
             05  ROD-VS-CARD-USAGE         PIC X(01) VALUE SPACE.
             05  FILLER                    PIC X(01) VALUE SPACE.
      *
           03  RCL-OPTIONAL-DATA-10-DS.                                 02.95
             05  FILLER                    PIC X(11)
                 VALUE 'INTCHG PGM '.
             05  ROD-DS-INTCHG-PGM-ID      PIC X(04) VALUE SPACES.
             05  FILLER                    PIC X(10)                    02.48
                 VALUE ' PROD TYP '.                                    02.48
             05  ROD-DS-PRODUCT-TYP-IN     PIC X(03) VALUE SPACES.      02.48
             05  FILLER                    PIC X(01) VALUE SPACE.       02.48
             05  ROD-DS-PRODUCT-TYP-OUT    PIC X(03) VALUE SPACES.      02.48
             05  FILLER                    PIC X(05)                    02.48
                 VALUE ' ALP '.                                         02.48
             05  ROD-DS-ALP-IND            PIC X(01) VALUE SPACES.      02.48
             05  FILLER                    PIC X(46) VALUE SPACES.      02.48
      *
         01  RPT-ALTERNATE-LINE-10.                                     02.95
           03  RPT-ALT-CUSTOM-LINE-10.                                  02.95
             05  FILLER                    PIC X(09)                    02.84
                 VALUE 'POST PLN '.                                     02.84
             05  RCL-10CU-POST-PLAN        PIC X(04) VALUE SPACES.      02.95
             05  RCL-10CU-POST-PLAN-ADD-IND PIC X(01) VALUE SPACE.      02.95
             05  FILLER                    PIC X(01) VALUE SPACE.       02.84
             05  FILLER                    PIC X(01) VALUE '('.         02.84
             05  RCL-10CU-CUSTOM-PLAN      PIC X(04) VALUES SPACES.     02.95
             05  FILLER                    PIC X(01) VALUE ')'.         02.84
             05  FILLER                    PIC X(09)                    02.84
                 VALUE ' INT PLN '.                                     02.84
             05  RCL-10CU-INT-PLAN         PIC X(04) VALUE SPACES.      02.95
             05  FILLER                    PIC X(01) VALUE SPACE.       02.84
      *                                                                 02.84
       01  RESET-LINES.
           03  RESET-RPT-BATCH-LINE-1      PIC X(133).
           03  RESET-RPT-BATCH-LINE-2      PIC X(133).
           03  RESET-RPT-GROUP-LINE-1      PIC X(133).
           03  RESET-RPT-GROUP-LINE-2      PIC X(133).
           03  RESET-RPT-RANDC-LINE-1      PIC X(133).
           03  RESET-RPT-RANDC-LINE-2      PIC X(133).
           03  RESET-RPT-FORMAT-1-LINE-1   PIC X(133).
           03  RESET-RPT-FORMAT-1-LINE-2   PIC X(133).
           03  RESET-RPT-FORMAT-1-LINE-7   PIC X(133).
           03  RESET-RPT-COMMON-LINE-1     PIC X(133).
           03  RESET-RPT-COMMON-LINE-2     PIC X(133).
           03  RESET-RPT-COMMON-LINE-3     PIC X(133).
           03  RESET-RPT-COMMON-LINE-4     PIC X(133).
           03  RESET-RPT-COMMON-LINE-5     PIC X(133).
           03  RESET-RPT-COMMON-LINE-6     PIC X(133).
           03  RESET-RPT-COMMON-LINE-7     PIC X(133).
           03  RESET-RPT-COMMON-LINE-8     PIC X(133).
           03  RESET-RPT-COMMON-LINE-9     PIC X(133).
           03  RESET-RPT-COMMON-LINE-10    PIC X(133).                  02.95
           03  RESET-RPT-INTCHG-LINE-1     PIC X(133).
           03  RESET-RPT-VISA-LINE-1       PIC X(133).
           03  RESET-RPT-VISA-LINE-2       PIC X(133).
           03  RESET-RPT-VISA-LINE-3       PIC X(133).
           03  RESET-RPT-VISA-LINE-4       PIC X(133).                  03.42V
           03  RESET-RPT-MC-LINE-1         PIC X(133).
           03  RESET-RPT-MC-LINE-2         PIC X(133).
           03  RESET-RPT-MC-LINE-3         PIC X(133).                  03.16M
           03  RESET-RPT-AMEX-LINE-1       PIC X(133).
           03  RESET-RPT-AMEX-LINE-2       PIC X(133).
           03  RESET-RPT-AMEX-LINE-3       PIC X(133).                  03.29
           03  RESET-RPT-DS-LINE-1         PIC X(133).
           03  RESET-RPT-DS-LINE-2         PIC X(133).
           03  RESET-RPT-DS-LINE-3         PIC X(133).                  03.47
           03  RESET-RPT-DOWNGRADE-LINE    PIC X(133).
           03  RESET-RRD-AMT-DATA          PIC X(33).
           03  RESET-RRD-CSP-DATA          PIC X(33).
           03  RESET-RRD-AMX-DATA          PIC X(33).
           03  RESET-RRD-DS-DATA           PIC X(65).
           03  RESET-RCL-OPTIONAL-DATA-10-MC                            02.95
                                           PIC X(84).
           03  RESET-RCL-OPTIONAL-DATA-10-VS                            02.95
                                           PIC X(84).
           03  RESET-RCL-OPTIONAL-DATA-10-DS                            02.95
                                           PIC X(84).
      *
018040 01  REPORT-SALES-RETURNS.
      *
018890     03  RPT-REPORT-ADDENDUM VALUE SPACES.
018900       05  RRA-CC                 PIC X(01).
018900       05  RRA-SUS-FLAG           PIC X(01).
018900       05  RRA-DETAIL             PIC X(111).
018900       05  RRA-ERRORS.
019030           10  FILLER             PIC X(01).
019040           10  RRA-ERROR-CD-1-X.
019040               15  RRA-ERROR-CD-1 PIC ZZ9.
019050           10  FILLER             PIC X(01).
019040           10  RRA-ERROR-CD-2-X.
019040               15  RRA-ERROR-CD-2 PIC ZZ9.
019070           10  FILLER             PIC X(01).
019040           10  RRA-ERROR-CD-3-X.
019040               15  RRA-ERROR-CD-3 PIC ZZ9.
019090           10  FILLER             PIC X(01).
019040           10  RRA-ERROR-CD-4-X.
019040               15  RRA-ERROR-CD-4 PIC ZZ9.
019110           10  FILLER             PIC X(01).
019040           10  RRA-ERROR-CD-5-X.
019040               15  RRA-ERROR-CD-5 PIC ZZ9.
018900       05  FILLER REDEFINES RRA-ERRORS.
019030           10  RRA-ERROR-ENTRY OCCURS 5.
019030               15  FILLER         PIC X(01).
019040               15  RRA-ERROR-CD-X.
019040                   20  RRA-ERROR-CD
019040                                  PIC ZZ9.
018880*
018890     03  RPT-REJECT-ADDENDUM.
018900       05  RJA-CC                 PIC X(01) VALUE SPACE.
018900       05  RJA-SUS-FLAG           PIC X(01) VALUE '*'.
018900       05  FILLER                 PIC X(38) VALUE
018900           ' ADDENDUM REJECTED. TOTAL RECEIVED OF '.
018900       05  RJA-TOT-RECEIVED       PIC ZZZ9.
018900       05  FILLER                 PIC X(35) VALUE
018900           ' IS NOT EQUAL TO TOTAL EXPECTED OF '.
018900       05  RJA-TOT-EXPECTED       PIC ZZZ9.
018900       05  FILLER                 PIC X(01) VALUE '.'.
018900       05  FILLER                 PIC X(49) VALUE SPACES.
019660*
018890     03  RPT-INVALID-ADDENDUM.
018900       05  RIA-CC                 PIC X(01) VALUE SPACE.
018900       05  RIA-SUS-FLAG           PIC X(01) VALUE '*'.
018900       05  FILLER                 PIC X(19) VALUE
018900           ' INVALID ADDENDUM: '.
018900       05  RIA-DATA               PIC X(100).
018900       05  FILLER                 PIC X(12) VALUE SPACES.
019660*
018890     03  RPT-REJECT-ALL-ADDENDUM.
018900       05  RAA-CC                 PIC X(01) VALUE SPACE.
018900       05  RAA-SUS-FLAG           PIC X(01) VALUE '*'.
018900       05  FILLER                 PIC X(32) VALUE
018900           ' ALL ADDENDUM RECORDS REJECTED. '.
018900       05  FILLER                 PIC X(30) VALUE
018900           ' SEQUENCE ERRORS ENCOUNTERED. '.
018900       05  FILLER                 PIC X(69) VALUE SPACES.
020540*
019670     03  RPT-SLS-ADDENDUM-9A                VALUE SPACES.
019680       05  RSA9A-CC               PIC X(1).
018160       05  RSA9A-SUS-FLAG         PIC X.
019690       05  RSA9A-TITLE1           PIC X(20).
019700       05  RSA9A-MESSAGE-ID       PIC X(15).
019790       05  RSA9A-DASH-1           PIC X(1).
019700       05  RSA9A-ITEM-SEQ         PIC X(3).
019710       05  RSA9A-TITLE2           PIC X(10).
019720       05  RSA9A-DISCOUNT-AMT-X.
019700           10  RSA9A-DISCOUNT-AMT PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
019730       05  RSA9A-TITLE3           PIC X(9).
019720       05  RSA9A-FREIGHT-AMT-X.
019700           10  RSA9A-FREIGHT-AMT  PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
019730       05  RSA9A-TITLE4           PIC X(6).
019730       05  RSA9A-ORDER-DATE       PIC X(6).
019750       05  FILLER                 PIC X(2).
019760       05  RSA9A-ERROR-CD-1       PIC ZZ9.
019770       05  FILLER                 PIC X(1).
019780       05  RSA9A-ERROR-CD-2       PIC ZZ9.
019790       05  FILLER                 PIC X(1).
019800       05  RSA9A-ERROR-CD-3       PIC ZZ9.
019810       05  FILLER                 PIC X(1).
019820       05  RSA9A-ERROR-CD-4       PIC ZZ9.
019830       05  FILLER                 PIC X(1).
019840       05  RSA9A-ERROR-CD-5       PIC ZZ9.
019660*
019670     03  RPT-SLS-ADDENDUM-9B                VALUE SPACES.
019680       05  RSA9B-CC               PIC X(1).
018160       05  RSA9B-SUS-FLAG         PIC X.
019730       05  RSA9B-TITLE1           PIC X(6).
019720       05  RSA9B-DUTY-AMT-X.
019700           10  RSA9B-DUTY-AMT     PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
019730       05  RSA9B-TITLE2           PIC X(9).
019720       05  RSA9B-VAT-TAX-AMT-X.
019700           10  RSA9B-VAT-TAX-AMT  PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
019710       05  RSA9B-TITLE3           PIC X(10).
019720       05  RSA9B-VAT-TAX-RATE-X.
019700           10  RSA9B-VAT-TAX-RATE PIC 99.99.
019710       05  RSA9B-TITLE4           PIC X(9).
019710       05  RSA9B-VAT-INVOICE-REF  PIC X(15).
019750       05  FILLER                 PIC X(18).
019760       05  RSA9B-ERROR-CD-1       PIC ZZ9.
019770       05  FILLER                 PIC X(1).
019780       05  RSA9B-ERROR-CD-2       PIC ZZ9.
019790       05  FILLER                 PIC X(1).
019800       05  RSA9B-ERROR-CD-3       PIC ZZ9.
019810       05  FILLER                 PIC X(1).
019820       05  RSA9B-ERROR-CD-4       PIC ZZ9.
019830       05  FILLER                 PIC X(1).
019840       05  RSA9B-ERROR-CD-5       PIC ZZ9.
019660*
019670     03  RPT-SLS-ADDENDUM-9C                VALUE SPACES.
019680       05  RSA9C-CC               PIC X(1).
018160       05  RSA9C-SUS-FLAG         PIC X.
019730       05  RSA9C-TITLE1           PIC X(11).
019710       05  RSA9C-SHIP-POSTAL-CD   PIC X(10).
019730       05  RSA9C-TITLE2           PIC X(11).
019710       05  RSA9C-DEST-POSTAL-CD   PIC X(10).
019710       05  RSA9C-TITLE3           PIC X(14).
019710       05  RSA9C-DEST-CNTRY-CD    PIC X(3).
019710       05  RSA9C-TITLE4           PIC X(9).
019710       05  RSA9C-ACCOUNT          PIC X(16).
019770       05  RSA9C-DASH-1           PIC X(1).
019710       05  RSA9C-ACCOUNT-EXT      PIC X(3).
019710       05  RSA9C-TITLE5           PIC X(9).                       03.42V
019710       05  RSA9C-AUTH-CD          PIC X(06).                      03.42V
019750       05  FILLER                 PIC X(09).                      03.42V
019760       05  RSA9C-ERROR-CD-1       PIC ZZ9.
019770       05  FILLER                 PIC X(1).
019780       05  RSA9C-ERROR-CD-2       PIC ZZ9.
019790       05  FILLER                 PIC X(1).
019800       05  RSA9C-ERROR-CD-3       PIC ZZ9.
019810       05  FILLER                 PIC X(1).
019820       05  RSA9C-ERROR-CD-4       PIC ZZ9.
019830       05  FILLER                 PIC X(1).
019840       05  RSA9C-ERROR-CD-5       PIC ZZ9.
019660*
019670     03  RPT-SLS-ADDENDUM-9D                VALUE SPACES.         03.42V
019680       05  RSA9D-CC               PIC X(1).                       03.42V
018160       05  RSA9D-SUS-FLAG         PIC X.                          03.42V
019730       05  RSA9D-TITLE1           PIC X(16).                      03.42V
019710       05  RSA9D-INV-LVL-DISC-TR  PIC X(01).                      03.42V
019730       05  RSA9D-TITLE2           PIC X(08).                      03.42V
019710       05  RSA9D-TAX-TR           PIC X(1).                       03.42V
019710       05  RSA9D-TITLE3           PIC X(11).                      03.42V
019710       05  RSA9D-DISC-AMT-SIGN    PIC X(01).                      03.42V
019710       05  RSA9D-TITLE4           PIC X(10).                      03.42V
019710       05  RSA9D-FRT-AMT-SIGN     PIC X(01).                      03.42V
019710       05  RSA9D-TITLE5           PIC X(11).                      03.42V
019710       05  RSA9D-DUTY-AMT-SIGN    PIC X(01).                      03.42V
019710       05  RSA9D-TITLE6           PIC X(10).                      03.42V
019710       05  RSA9D-VAT-TAX-SIGN     PIC X(01).                      03.42V
019710       05  RSA9D-TITLE7           PIC X(12).                      03.42V
019710       05  RSA9D-SERVICE-ID       PIC X(06).                      03.42V
019750       05  FILLER                 PIC X(22).                      03.42V
019760       05  RSA9D-ERROR-CD-1       PIC ZZ9.                        03.42V
019770       05  FILLER                 PIC X(1).                       03.42V
019780       05  RSA9D-ERROR-CD-2       PIC ZZ9.                        03.42V
019790       05  FILLER                 PIC X(1).                       03.42V
019800       05  RSA9D-ERROR-CD-3       PIC ZZ9.                        03.42V
019810       05  FILLER                 PIC X(1).                       03.42V
019820       05  RSA9D-ERROR-CD-4       PIC ZZ9.                        03.42V
019830       05  FILLER                 PIC X(1).                       03.42V
019840       05  RSA9D-ERROR-CD-5       PIC ZZ9.                        03.42V
018880*                                                                 03.42V
019670     03  RPT-SLS-ADDENDUM-10A               VALUE SPACES.
019680       05  RSA10A-CC              PIC X(1).
018160       05  RSA10A-SUS-FLAG        PIC X.
019690       05  RSA10A-TITLE1          PIC X(20).
019700       05  RSA10A-MESSAGE-ID      PIC X(15).
019790       05  RSA10A-DASH-1          PIC X(1).
019700       05  RSA10A-ITEM-SEQ        PIC X(3).
019790       05  RSA10A-DASH-2          PIC X(1).
019700       05  RSA10A-LINE-ITEM-IND   PIC X(1).
019710       05  RSA10A-TITLE2          PIC X(9).
019700       05  RSA10A-ITEM-COMM-CD    PIC X(12).
019710       05  RSA10A-TITLE3          PIC X(12).
019700       05  RSA10A-ITEM-DESCRIPTOR PIC X(12).
019710       05  RSA10A-TITLE4          PIC X(12).
019730       05  RSA10A-PRODUCT-CD      PIC X(12).
019750       05  FILLER                 PIC X(2).
019760       05  RSA10A-ERROR-CD-1      PIC ZZ9.
019770       05  FILLER                 PIC X(1).
019780       05  RSA10A-ERROR-CD-2      PIC ZZ9.
019790       05  FILLER                 PIC X(1).
019800       05  RSA10A-ERROR-CD-3      PIC ZZ9.
019810       05  FILLER                 PIC X(1).
019820       05  RSA10A-ERROR-CD-4      PIC ZZ9.
019830       05  FILLER                 PIC X(1).
019840       05  RSA10A-ERROR-CD-5      PIC ZZ9.
019660*
019670     03  RPT-SLS-ADDENDUM-10B               VALUE SPACES.
019680       05  RSA10B-CC              PIC X(1).
018160       05  RSA10B-SUS-FLAG        PIC X.
019730       05  RSA10B-TITLE1          PIC X(10).
018160       05  RSA10B-QUANTITY-X.
019700           10  RSA10B-QUANTITY    PIC ZZZ,ZZZ,ZZZ,ZZ9.
019730       05  RSA10B-TITLE2          PIC X(17).
019710       05  RSA10B-UNIT-MEASURE-CD PIC X(12).
019730       05  RSA10B-TITLE3          PIC X(11).
019720       05  RSA10B-UNIT-COST-X.
019700           10  RSA10B-UNIT-COST   PIC ZZ,ZZZ,ZZZ,ZZ9.9999-.
019730       05  RSA10B-TITLE4          PIC X(16).                      03.42V
019710       05  RSA10B-LINE-ITEM-TRMT  PIC X(1).                       03.42V
019750       05  FILLER                 PIC X(02).                      03.42V
019760       05  RSA10B-ERROR-CD-1      PIC ZZ9.
019770       05  FILLER                 PIC X(1).
019780       05  RSA10B-ERROR-CD-2      PIC ZZ9.
019790       05  FILLER                 PIC X(1).
019800       05  RSA10B-ERROR-CD-3      PIC ZZ9.
019810       05  FILLER                 PIC X(1).
019820       05  RSA10B-ERROR-CD-4      PIC ZZ9.
019830       05  FILLER                 PIC X(1).
019840       05  RSA10B-ERROR-CD-5      PIC ZZ9.
019660*
019670     03  RPT-SLS-ADDENDUM-10C               VALUE SPACES.
019680       05  RSA10C-CC              PIC X(1).
018160       05  RSA10C-SUS-FLAG        PIC X.
019730       05  RSA10C-TITLE1          PIC X(9).
019720       05  RSA10C-VAT-TAX-AMT-X.
019700           10  RSA10C-VAT-TAX-AMT PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
019730       05  RSA10C-TITLE2          PIC X(10).
019720       05  RSA10C-VAT-TAX-RATE-X.
019700           10  RSA10C-VAT-TAX-RATE
019700                                  PIC 99.99.
019710       05  RSA10C-TITLE3          PIC X(11).
019720       05  RSA10C-LINE-ITEM-DISC-X.
019700           10  RSA10C-LINE-ITEM-DISC
019700                                  PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
019710       05  RSA10C-TITLE4          PIC X(12).
019720       05  RSA10C-LINE-ITEM-TOTAL-X.
019700           10  RSA10C-LINE-ITEM-TOTAL
019700                                  PIC ZZZ,ZZZ,ZZZ,ZZ9.999-.
019750       05  FILLER                 PIC X(5).
019760       05  RSA10C-ERROR-CD-1      PIC ZZ9.
019770       05  FILLER                 PIC X(1).
019780       05  RSA10C-ERROR-CD-2      PIC ZZ9.
019790       05  FILLER                 PIC X(1).
019800       05  RSA10C-ERROR-CD-3      PIC ZZ9.
019810       05  FILLER                 PIC X(1).
019820       05  RSA10C-ERROR-CD-4      PIC ZZ9.
019830       05  FILLER                 PIC X(1).
019840       05  RSA10C-ERROR-CD-5      PIC ZZ9.
019660*
019670     03  RPT-SLS-ADDENDUM-10D               VALUE SPACES.         03.42V
019680       05  RSA10D-CC              PIC X(1).                       03.42V
018160       05  RSA10D-SUS-FLAG        PIC X.                          03.42V
019730       05  RSA10D-TITLE1          PIC X(12).                      03.42V
019720       05  RSA10D-SERVICE-ID      PIC X(6).                       03.42V
019750       05  FILLER                 PIC X(94).                      03.42V
019760       05  RSA10D-ERROR-CD-1      PIC ZZ9.                        03.42V
019770       05  FILLER                 PIC X(1).                       03.42V
019780       05  RSA10D-ERROR-CD-2      PIC ZZ9.                        03.42V
019790       05  FILLER                 PIC X(1).                       03.42V
019800       05  RSA10D-ERROR-CD-3      PIC ZZ9.                        03.42V
019810       05  FILLER                 PIC X(1).                       03.42V
019820       05  RSA10D-ERROR-CD-4      PIC ZZ9.                        03.42V
019830       05  FILLER                 PIC X(1).                       03.42V
019840       05  RSA10D-ERROR-CD-5      PIC ZZ9.                        03.42V
021500*                                                                 03.42V
018890     03  REPORT-ERROR-HILITE-ADD9A          VALUE SPACES.
019680       05  REHA9A-CC              PIC X(1).
019690       05  FILLER                 PIC X(1).
019690       05  REHA9A-TITLE1          PIC X(20).
019700       05  REHA9A-MESSAGE-ID      PIC X(15).
019790       05  FILLER                 PIC X(1).
019700       05  REHA9A-ITEM-SEQ        PIC X(3).
019710       05  FILLER                 PIC X(10).
019720       05  REHA9A-DISCOUNT-AMT    PIC X(20).
019730       05  FILLER                 PIC X(9).
019720       05  REHA9A-FREIGHT-AMT     PIC X(20).
019730       05  FILLER                 PIC X(6).
019730       05  REHA9A-ORDER-DATE      PIC X(6).
019750       05  FILLER                 PIC X(2).
019760       05  REHA9A-ERROR-CD-1      PIC ZZ9.
019770       05  FILLER                 PIC X(1).
019780       05  REHA9A-ERROR-CD-2      PIC ZZ9.
019790       05  FILLER                 PIC X(1).
019800       05  REHA9A-ERROR-CD-3      PIC ZZ9.
019810       05  FILLER                 PIC X(1).
019820       05  REHA9A-ERROR-CD-4      PIC ZZ9.
019830       05  FILLER                 PIC X(1).
019840       05  REHA9A-ERROR-CD-5      PIC ZZ9.
019660*
018890     03  REPORT-ERROR-HILITE-ADD9B          VALUE SPACES.
019680       05  REHA9B-CC              PIC X(1).
019730       05  FILLER                 PIC X(7).
019720       05  REHA9B-DUTY-AMT        PIC X(20).
019730       05  FILLER                 PIC X(9).
019720       05  REHA9B-VAT-TAX-AMT     PIC X(20).
019710       05  FILLER                 PIC X(10).
019720       05  REHA9B-VAT-TAX-RATE    PIC X(5).
019710       05  FILLER                 PIC X(9).
019710       05  REHA9B-VAT-INVOICE-REF PIC X(15).
019750       05  FILLER                 PIC X(18).
019760       05  REHA9B-ERROR-CD-1      PIC ZZ9.
019770       05  FILLER                 PIC X(1).
019780       05  REHA9B-ERROR-CD-2      PIC ZZ9.
019790       05  FILLER                 PIC X(1).
019800       05  REHA9B-ERROR-CD-3      PIC ZZ9.
019810       05  FILLER                 PIC X(1).
019820       05  REHA9B-ERROR-CD-4      PIC ZZ9.
019830       05  FILLER                 PIC X(1).
019840       05  REHA9B-ERROR-CD-5      PIC ZZ9.
019660*
018890     03  REPORT-ERROR-HILITE-ADD9C          VALUE SPACES.
019680       05  REHA9C-CC              PIC X(1).
019730       05  FILLER                 PIC X(11).
019710       05  REHA9C-SHIP-POSTAL-CD  PIC X(10).
019730       05  FILLER                 PIC X(11).
019710       05  REHA9C-DEST-POSTAL-CD  PIC X(10).
019710       05  FILLER                 PIC X(14).
019710       05  REHA9C-DEST-CNTRY-CD   PIC X(3).
019710       05  FILLER                 PIC X(9).
019710       05  REHA9C-ACCOUNT         PIC X(16).
019770       05  FILLER                 PIC X(1).
019710       05  REHA9C-ACCOUNT-EXT     PIC X(3).
019710       05  FILLER                 PIC X(9).                       03.42V
019710       05  REHA9C-AUTH-CD         PIC X(06).                      03.42V
019750       05  FILLER                 PIC X(09).                      03.42V
019760       05  REHA9C-ERROR-CD-1      PIC ZZ9.
019770       05  FILLER                 PIC X(1).
019780       05  REHA9C-ERROR-CD-2      PIC ZZ9.
019790       05  FILLER                 PIC X(1).
019800       05  REHA9C-ERROR-CD-3      PIC ZZ9.
019810       05  FILLER                 PIC X(1).
019820       05  REHA9C-ERROR-CD-4      PIC ZZ9.
019830       05  FILLER                 PIC X(1).
019840       05  REHA9C-ERROR-CD-5      PIC ZZ9.
019660*
019670     03  REPORT-ERROR-HILITE-ADD9D          VALUE SPACES.         03.42V
019680       05  REHA9D-CC              PIC X(1).                       03.42V
019730       05  FILLER                 PIC X(17).                      03.42V
019710       05  REHA9D-INV-LVL-DISC-TR PIC X(01).                      03.42V
019730       05  FILLER                 PIC X(08).                      03.42V
019710       05  REHA9D-TAX-TR          PIC X(1).                       03.42V
019710       05  FILLER                 PIC X(11).                      03.42V
019710       05  REHA9D-DISC-AMT-SIGN   PIC X(01).                      03.42V
019710       05  FILLER                 PIC X(10).                      03.42V
019710       05  REHA9D-FRT-AMT-SIGN    PIC X(01).                      03.42V
019710       05  FILLER                 PIC X(11).                      03.42V
019710       05  REHA9D-DUTY-AMT-SIGN   PIC X(01).                      03.42V
019710       05  FILLER                 PIC X(10).                      03.42V
019710       05  REHA9D-VAT-TAX-SIGN    PIC X(01).                      03.42V
019710       05  FILLER                 PIC X(12).                      03.42V
019710       05  REHA9D-SERVICE-ID      PIC X(06).                      03.42V
019750       05  FILLER                 PIC X(22).                      03.42V
019760       05  REHA9D-ERROR-CD-1      PIC ZZ9.                        03.42V
019770       05  FILLER                 PIC X(1).                       03.42V
019780       05  REHA9D-ERROR-CD-2      PIC ZZ9.                        03.42V
019790       05  FILLER                 PIC X(1).                       03.42V
019800       05  REHA9D-ERROR-CD-3      PIC ZZ9.                        03.42V
019810       05  FILLER                 PIC X(1).                       03.42V
019820       05  REHA9D-ERROR-CD-4      PIC ZZ9.                        03.42V
019830       05  FILLER                 PIC X(1).                       03.42V
019840       05  REHA9D-ERROR-CD-5      PIC ZZ9.                        03.42V
018880*                                                                 03.42V
018890     03  REPORT-ERROR-HILITE-ADD10A         VALUE SPACES.
019680       05  REHA10A-CC             PIC X(1).
019690       05  FILLER                 PIC X(1).
019690       05  REHA10A-TITLE1         PIC X(20).
019700       05  REHA10A-MESSAGE-ID     PIC X(15).
019790       05  FILLER                 PIC X(1).
019700       05  REHA10A-ITEM-SEQ       PIC X(3).
019790       05  FILLER                 PIC X(1).
019700       05  REHA10A-LINE-ITEM-IND  PIC X(1).
019710       05  FILLER                 PIC X(9).
019700       05  REHA10A-ITEM-COMM-CD   PIC X(12).
019710       05  FILLER                 PIC X(12).
019700       05  REHA10A-ITEM-DESCRIPTOR
                                        PIC X(12).
019710       05  FILLER                 PIC X(12).
019730       05  REHA10A-PRODUCT-CD     PIC X(12).
019750       05  FILLER                 PIC X(2).
019760       05  REHA10A-ERROR-CD-1     PIC ZZ9.
019770       05  FILLER                 PIC X(1).
019780       05  REHA10A-ERROR-CD-2     PIC ZZ9.
019790       05  FILLER                 PIC X(1).
019800       05  REHA10A-ERROR-CD-3     PIC ZZ9.
019810       05  FILLER                 PIC X(1).
019820       05  REHA10A-ERROR-CD-4     PIC ZZ9.
019830       05  FILLER                 PIC X(1).
019840       05  REHA10A-ERROR-CD-5     PIC ZZ9.
019660*
018890     03  REPORT-ERROR-HILITE-ADD10B         VALUE SPACES.
019680       05  REHA10B-CC             PIC X(1).
019730       05  REHA10B-TITLE1         PIC X(11).
018160       05  REHA10B-QUANTITY       PIC X(15).
019730       05  FILLER                 PIC X(17).
019710       05  REHA10B-UNIT-MEASURE-CD
                                        PIC X(12).
019730       05  FILLER                 PIC X(11).
019720       05  REHA10B-UNIT-COST      PIC X(20).
019730       05  FILLER                 PIC X(16).                      03.42V
019710       05  REHA10B-LINE-ITEM-TRMT PIC X(1).                       03.42V
019750       05  FILLER                 PIC X(02).                      03.42V
019760       05  REHA10B-ERROR-CD-1     PIC ZZ9.
019770       05  FILLER                 PIC X(1).
019780       05  REHA10B-ERROR-CD-2     PIC ZZ9.
019790       05  FILLER                 PIC X(1).
019800       05  REHA10B-ERROR-CD-3     PIC ZZ9.
019810       05  FILLER                 PIC X(1).
019820       05  REHA10B-ERROR-CD-4     PIC ZZ9.
019830       05  FILLER                 PIC X(1).
019840       05  REHA10B-ERROR-CD-5     PIC ZZ9.
019660*
018890     03  REPORT-ERROR-HILITE-ADD10C         VALUE SPACES.
019680       05  REHA10C-CC             PIC X(1).
019730       05  FILLER                 PIC X(10).
019720       05  REHA10C-VAT-TAX-AMT    PIC X(20).
019730       05  FILLER                 PIC X(10).
019720       05  REHA10C-VAT-TAX-RATE   PIC X(5).
019710       05  FILLER                 PIC X(11).
019720       05  REHA10C-LINE-ITEM-DISC PIC X(20).
019710       05  FILLER                 PIC X(12).
019720       05  REHA10C-LINE-ITEM-TOTAL
019700                                  PIC X(20).
019750       05  FILLER                 PIC X(5).
019760       05  REHA10C-ERROR-CD-1     PIC ZZ9.
019770       05  FILLER                 PIC X(1).
019780       05  REHA10C-ERROR-CD-2     PIC ZZ9.
019790       05  FILLER                 PIC X(1).
019800       05  REHA10C-ERROR-CD-3     PIC ZZ9.
019810       05  FILLER                 PIC X(1).
019820       05  REHA10C-ERROR-CD-4     PIC ZZ9.
019830       05  FILLER                 PIC X(1).
019840       05  REHA10C-ERROR-CD-5     PIC ZZ9.
021500*                                                                 03.42V
019670     03  REPORT-ERROR-HILITE-ADD10D         VALUE SPACES.         03.42V
019680       05  REHA10D-CC             PIC X(1).                       03.42V
018160       05  REHA10D-SUS-FLAG       PIC X.                          03.42V
019730       05  FILLER                 PIC X(12).                      03.42V
019720       05  REHA10D-SERVICE-ID     PIC X(6).                       03.42V
019750       05  FILLER                 PIC X(94).                      03.42V
019760       05  REHA10D-ERROR-CD-1     PIC ZZ9.                        03.42V
019770       05  FILLER                 PIC X(1).                       03.42V
019780       05  REHA10D-ERROR-CD-2     PIC ZZ9.                        03.42V
019790       05  FILLER                 PIC X(1).                       03.42V
019800       05  REHA10D-ERROR-CD-3     PIC ZZ9.                        03.42V
019810       05  FILLER                 PIC X(1).                       03.42V
019820       05  REHA10D-ERROR-CD-4     PIC ZZ9.                        03.42V
019830       05  FILLER                 PIC X(1).                       03.42V
019840       05  REHA10D-ERROR-CD-5     PIC ZZ9.                        03.42V
      *
023110 01  REPORT-NON-MONETARY.
023120*
023130     03  RPT-NON-MON-HDR-1.
023140       05  RNH1-CC                   PIC X        VALUE '0'.
023150       05  RNH1-DROP                 PIC X(4)     VALUE 'DROP'.
023160       05  FILLER                    PIC X(36)    VALUE SPACE.
023170       05  FILLER                    PIC X(11)    VALUE
023180             'TRANSACTION'.
023190       05  FILLER                    PIC X(59)    VALUE SPACE.
023200       05  FILLER                    PIC X(11)    VALUE
023210             'ERROR CODES'.
023220       05  FILLER                    PIC X(10)    VALUE SPACE.
023230       05  FILLER                    PIC X        VALUE 'F'.
023240*
023250     03   RPT-NON-MON-DETAIL-1                    VALUE SPACES.
023260       05  RND1-CC                   PIC X.
022170       05  RND1-SUS-FLAG             PIC X.
023270       05  FILLER                    PIC X(4).
023280       05  RND1-DATA                 PIC X(80).
023290       05  FILLER REDEFINES RND1-DATA.
023300           07  FILLER                PIC X(29).
023310           07  RND1-MESG             PIC X(22).
023320           07  FILLER                PIC X(29).
023330       05  FILLER                    PIC X(25).
023340       05  RND1-ERROR-CD-1           PIC XXX.
023350       05  FILLER                    PIC X.
023360       05  RND1-ERROR-CD-2           PIC XXX.
023370       05  FILLER                    PIC X.
023380       05  RND1-ERROR-CD-3           PIC XXX.
023390       05  FILLER                    PIC X.
023400       05  RND1-ERROR-CD-4           PIC XXX.
023410       05  FILLER                    PIC X.
023420       05  RND1-ERROR-CD-5           PIC XXX.
023430       05  FILLER                    PIC X(2).
023440       05  RND1-FATAL-FLAG           PIC X.
      *
024800 01  RPT-SUM-LINE.
024810   05  RSUM-CC         PIC X       VALUE '0'.
024820   05  FILLER          PIC X(04)   VALUE SPACES.
024830   05  FILLER          PIC X(21)   VALUE 'NUMBER OF ITEMS THIS '.
024840   05  RSUM-GRP-LIT    PIC X(8)    VALUE 'GROUP   '.
024850   05  FILLER          PIC X       VALUE SPACES.
024860   05  RSUM-CNT        PIC ZZZZ99-.
024870   05  FILLER          PIC X(5)    VALUE ' CALC'.
024880   05  RSUM-CALC       PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
024890   05  FILLER          PIC X(5)    VALUE '  SUM'.
024900   05  RSUM-AMT        PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
024910   05  FILLER          PIC X(9)    VALUE '  DIFF   '.
024920   05  RSUM-DIFF       PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
024940*
024950 01  RPT-BATCH-TOT-LINE.
024960     05  RBT-CC           PIC X       VALUE '0'.
024970     05  RBT-TITLE        PIC X(14)   VALUE ' BATCH TOTALS '.
024980     05  RBT-BATCH-NMBR.
024990       10  RBT-BATCH-FRST-2   PIC XX.
025000       10  FILLER             PIC X       VALUE '-'.
025010       10  RBT-BATCH-LAST-4   PIC X(4).
025020     05  FILLER          PIC X(2)    VALUE SPACES.
025030     05  FILLER          PIC X(10)   VALUE 'BATCH AMT '.
025040     05  RBT-BATCH-AMT   PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
025050     05  FILLER          PIC X(13)   VALUE ' CALC AMOUNT '.
025060     05  RBT-CALC-AMT    PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
025070     05  FILLER          PIC X(12)   VALUE ' DIFFERENCE '.
025080     05  RBT-DIFF        PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
025090*
025100 01  RPT-BATCH-CURR-LINE.
025110     05  RBC-CC           PIC X       VALUE '0'.
025120     05  FILLER           PIC X(11)   VALUE SPACES.
025130     05  RBC-BANK         PIC 9(6).
025140     05  FILLER           PIC X(15)   VALUE
025150     ' CURRENCY CODE '.
025160     05  RBC-CURR-CODE    PIC XXX.
025170     05  FILLER           PIC X(03)   VALUE ' - '.
025180     05  RBC-CURR-NAME    PIC X(30).
025190     05  FILLER           PIC X(64)   VALUE SPACES.               02.93
025200*
025210 01  RPT-TRANS-TOT-HDR-1.
025220     05  RTH1-CC         PIC X       VALUE '0'.
025230     05  FILLER          PIC X(05)   VALUE SPACES.
025230     05  FILLER          PIC X(27)
025240                             VALUE '** C A R D   T O T A L S **'. 03.47
025230     05  FILLER          PIC X(17)   VALUE SPACES.
025230     05  FILLER          PIC X(27)
025240                             VALUE '** C A R D   T O T A L S **'. 03.47
025230     05  FILLER          PIC X(17)   VALUE SPACES.
025230     05  FILLER          PIC X(27)
025240                             VALUE '** C A R D   T O T A L S **'. 03.47
025230     05  FILLER          PIC X(12)   VALUE SPACES.
025270 01  RPT-TRANS-TOT-HDR-2.
025280     05  RTH2-CC         PIC X       VALUE '0'.
025290     05  FILLER    PIC X(57)    VALUE '                 V I S A'.
025300     05  FILLER    PIC X(11)    VALUE 'MASTERCARD'.
025310     05  FILLER          PIC X(29)   VALUE SPACES.
025320     05  FILLER    PIC X(10)    VALUE 'AMERICAN'.
025330     05  FILLER    PIC X(25)    VALUE ' EXPRESS'.
025270 01  RPT-TRANS-TOT-HDR-2B.
025280     05  RTH2B-CC        PIC X       VALUE '0'.
025290     05  FILLER    PIC X(57)    VALUE '                DISCOVER'.
025300     05  FILLER    PIC X(11)    VALUE '     PAYPAL'.              03.47
025310     05  FILLER          PIC X(29)   VALUE SPACES.
025320     05  FILLER    PIC X(18)    VALUE '     PRIVATE LABEL'.       03.47
025330     05  PL-LNGB-B PIC X(17)    VALUE SPACES.                     03.47
025340 01  RPT-TRANS-TOT-HDR-3.
025350     05  RTH3-CC         PIC X       VALUE '0'.
025360     05  FILLER          PIC X(71)   VALUE ' TC       NUMBER
025370-        '        AMOUNT         TC       NUMBER           '.
025380     05  FILLER          PIC X(61)   VALUE '   AMOUNT         TC
025390-        '     NUMBER              AMOUNT        '.
025400*
025410 01  RPT-TRANS-TOTS                              VALUE SPACES.
025420     05  RTT-CC                  PIC X.
025430     05  RTT-DET.
025440         10  RTT-DET-ENTRY OCCURS 3 TIMES.
025450             15  FILLER          PIC X.
025460             15  RTT-TC          PIC X(5).
025470             15  FILLER          PIC X(3).
025480             15  RTT-ITMS        PIC ZZZZZZ9.
025490             15  FILLER          PIC X(1).
025500             15  RTT-AMOUNT      PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
025510             15  FILLER          PIC X(3).
025520     05  FILLER REDEFINES RTT-DET.
025530         10  RTT-TITLE-LN OCCURS 3 TIMES.
025540             15  FILLER          PIC X(7).
025550             15  RTT-TITLE       PIC X(23).
025560             15  FILLER          PIC X(14).
025570*
025580 01  RPT-BATCH-CH-TOTS.
025590     05  RCT-CC              PIC X           VALUE SPACES.
025600     05  FILLER              PIC X(6)        VALUE SPACES.
025610     05  RCT-DESCR           PIC X(24).
025620     05  FILLER              PIC X(10)       VALUE SPACES.
025630     05  RCT-TOT.
025640         10  RCT-AMT         PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999.
025650         10  RCT-ITEM REDEFINES RCT-AMT.
025660             15  FILLER      PIC X(14).
025670             15  RCT-ITMS    PIC ZZZZZZZZ9.
025680     05  FILLER              PIC X(69)       VALUE SPACES.
082500*
082600* RECONCILIATION FILE
082700 01  RECN-RECORD-AREA.
082900   05  RECN-HEADER.
083000     10  FILLER                      PIC X(01) VALUE '1'.
083000     10  FILLER                      PIC X(23) VALUE SPACES.
           10  RECN-FILE-TITLE             PIC X(30) VALUE              03.31
               ' BAC00110 2-SIDED RECON       '.                        03.31
083300     10  FILLER                      PIC X(27) VALUE SPACES.
083400   05  RECN-FL-1.
083000     10  FILLER                      PIC X(01) VALUE '0'.
083500     10  FILLER                      PIC X(20) VALUE
083600         '         FILE NAME: '.
083700     10  RCN-FL-NAME                 PIC X(50).
083800     10  FILLER                      PIC X(10) VALUE SPACES.
084300   05  RECN-FL-2.
083000     10  FILLER                      PIC X(01) VALUE SPACE.
083900     10  FILLER                      PIC X(20) VALUE
084000         '         SOURCE ID: '.
084100     10  RCN-FL-TYPE                 PIC X.
084200     10  FILLER                      PIC X(59) VALUE SPACES.
084300   05  RECN-FL-3.
083000     10  FILLER                      PIC X(01) VALUE SPACE.
084400     10  FILLER                      PIC X(20) VALUE
084500         '     CREATION DATE: '.
084600     10  RCN-FL-DT                   PIC 9(06).
084700     10  FILLER                      PIC X(54) VALUE SPACES.
089300   05  RECN-BATCH-HEADER.
083000     10  FILLER                      PIC X(01) VALUE '0'.
089400     10  FILLER                      PIC X(23) VALUE SPACES.
           10  RECN-BATCH-TITLE            PIC X(30) VALUE              03.31
               ' BAC00110 2-SIDED BATCH SUMM  '.                        03.31
089700     10  FILLER                      PIC X(27) VALUE SPACES.
017630   05  RECN-BATCH-TITLE-LINE-1.
083000     10  FILLER                      PIC X(01) VALUE '0'.
017660     10  FILLER                      PIC X(08)
017700         VALUE ' BATCH  '.
017660     10  FILLER                      PIC X(07)
017700         VALUE ' BANK  '.
017660     10  FILLER                      PIC X(29)
017700         VALUE '---------- BATCH ----------- '.
017660     10  FILLER                      PIC X(08)
017700         VALUE '  ITEM  '.
017660     10  FILLER                      PIC X(28)
017700         VALUE '------- SETTLEMENT ---------'.
017630   05  RECN-BATCH-TITLE-LINE-2.
083000     10  FILLER                      PIC X(01) VALUE SPACE.
017660     10  FILLER                      PIC X(08)
017700         VALUE ' NUMBER '.
017660     10  FILLER                      PIC X(07)
017700         VALUE ' KEY   '.
017660     10  FILLER                      PIC X(29)
017700         VALUE '           AMOUNT       CURR '.
017660     10  FILLER                      PIC X(08)
017700         VALUE '  COUNT '.
017660     10  FILLER                      PIC X(28)
017700         VALUE '            AMOUNT      CURR'.
017630   05  RECN-BATCH-DETAIL-LINE.
083000     10  RCN-BDL-CC                  PIC X(01) VALUE '0'.
017660     10  RCN-BDL-BTCH                PIC X(07).
017700     10  RCN-BDL-REJ                 PIC X.
017710     10  RCN-BDL-BANK-KEY            PIC 999999.
017780     10  FILLER                      PIC X    VALUE SPACE.
017790     10  RCN-BDL-NET-AMT             PIC X(24).
017800     10  FILLER                      PIC X    VALUE SPACE.
017810     10  RCN-BDL-NET-CURR            PIC XXX.
017720     10  FILLER                      PIC X    VALUE SPACE.
017750     10  RCN-BDL-ITMS                PIC X(07).
017820     10  FILLER                      PIC X    VALUE SPACE.
017830     10  RCN-BDL-SETTLE-AMT          PIC X(24).
017840     10  FILLER                      PIC X    VALUE SPACE.
017850     10  RCN-BDL-SETL-CURR           PIC XXX.
017630   05  RECN-BATCH-SUMMARY-LINE.
083000     10  RCN-BSL-CC                  PIC X(01) VALUE '0'.
017660     10  RCN-BSL-DESCR               PIC X(29).
017780     10  FILLER                      PIC X    VALUE SPACE.
017750     10  RCN-BSL-NUM-BTCHS           PIC X(07).
017720     10  FILLER                      PIC X    VALUE SPACE.
017750     10  RCN-BSL-ITMS                PIC X(13).
017720     10  FILLER                      PIC X    VALUE SPACE.
017830     10  RCN-BSL-SETTLE-AMT          PIC X(24).
017840     10  FILLER                      PIC X(04) VALUE SPACES.
089300   05  RECN-STL-HEADER.
083000     10  FILLER                      PIC X(01) VALUE '0'.
083000     10  FILLER                      PIC X(25) VALUE SPACES.
           10  RECN-SETL-TITLE             PIC X(25) VALUE              03.31
               'BAC00110 2-SIDED SETTLE  '.                             03.31
089700     10  FILLER                      PIC X(30) VALUE SPACES.
089300   05  RECN-STL-HEADER-1.
083000     10  FILLER                      PIC X(01) VALUE '0'.
084900     10  FILLER                      PIC X(25) VALUE
086400         '   CARD TYPE             '.
086400     10  FILLER                      PIC X(15) VALUE SPACES.
085100     10  FILLER                      PIC X(11) VALUE
086400         '      ITEMS'.
086300     10  FILLER                      PIC X(25) VALUE
086400         '              AMOUNT     '.
086400     10  FILLER                      PIC X(04) VALUE SPACES.
089300   05  RECN-STL-HEADER-2.
083000     10  FILLER                      PIC X(01) VALUE '0'.
089500     10  RCN-STL-H2-DESCR            PIC X(25).
089700     10  FILLER                      PIC X(55) VALUE SPACES.
084800   05  RECN-STL-DETAIL-LINE.
083000     10  RCN-STL-CC                  PIC X(01) VALUE '0'.
084900     10  RCN-STL-DL-HEADING          PIC X(25).
086400     10  FILLER                      PIC X(15) VALUE SPACES.
085100     10  RCN-STL-DL-ITMS             PIC ZZZ,ZZZ,ZZ9.
017720     10  FILLER                      PIC X    VALUE SPACE.
086300     10  RCN-STL-DL-AMT              PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.
086400     10  FILLER                      PIC X(04) VALUE SPACES.
025690*
025700 01  WK-TIMESTAMP-9               PIC 9(8).
025710 01  WK-TIMESTAMP  REDEFINES  WK-TIMESTAMP-9.
025720     05  WK-TIMESTAMP-HH          PIC 99.
025730     05  WK-TIMESTAMP-MM          PIC 99.
025740     05  WK-TIMESTAMP-SS          PIC 99.                         02.53
           05  FILLER                   PIC 99.                         02.53
       01  FILLER REDEFINES WK-TIMESTAMP-9.
           05  WK-TIMESTAMP-HHMMSS      PIC 9(06).
           05  FILLER                   PIC 9(02).
025750*
025760 01  END-WS-LIT         PIC X(10)    VALUE '**END WS**'.
      *
       LINKAGE SECTION.
      *
       01  LINKAGE-PARM.
           03  FILLER                          PIC XX.
           03  PARM-SOURCE-ID.
               05  PSI-RUN                     PIC X.
           03  PARM-TT-SETL-FLAG               PIC X.
               88  PARM-CREATE-TT-SETL         VALUE 'Y'.
           03  PARM-TEST-FLAG                  PIC X.
               88  PARM-IS-TEST                VALUE 'Y'.
           03  PARM-REJECT-REPAIR              PIC X.
               88  PARM-IS-REJECT-REPAIR       VALUE 'Y'.
           03  PARM-BALANCE-RECON              PIC X.
               88  PARM-IS-BALANCE-RECON       VALUE 'Y'.
           03  PARM-1-SIDED-FLAG               PIC X.                   03.31
               88  PARM-IS-1-SIDED             VALUE 'Y'.               03.31
           03  FILLER                          PIC X(72).
      *
       PROCEDURE DIVISION USING LINKAGE-PARM.
      *
025790 A-100-MAINLINE.
025800     ACCEPT WS-ACCEPT-TIME FROM TIME.
025810     MOVE WHEN-COMPILED            TO WS-DATE-COMPILED.
025820     MOVE WS-DATE-COMPILED         TO WS-DISP-COMPILED.
025830     DISPLAY 'START BAC00110 - COMPILED: ' WS-DISP-COMPILED
025840             '- INVENTORY LEVEL: ' INVENTORY-LEVEL.
      *
           MOVE INVENTORY-LEVEL(18:3)    TO RVL-BAC00110-VERSION.       03.51
      *                                                                 03.51
           OPEN INPUT REF-NO-ID.
           READ REF-NO-ID INTO WS-REF-NO-ID
             AT END
                MOVE SPACES              TO WS-REF-NO-ID
                MOVE ZEROS               TO WS-RNI-LAST
           END-READ.
           CLOSE REF-NO-ID.
           IF WS-RNI-LAST-X NOT NUMERIC
              MOVE 1                      TO WS-RNI-LAST
           ELSE
           IF WS-RNI-LAST = 99
              MOVE 1                      TO WS-RNI-LAST
           ELSE
              ADD 1                       TO WS-RNI-LAST
           END-IF.
           MOVE WS-RNI-LAST               TO WS-RNC-3-4-DIGITS.
           OPEN OUTPUT REF-NO-ID.
           WRITE REF-NO-ID-REC FROM WS-REF-NO-ID.
           CLOSE REF-NO-ID.
029730*
025850     MOVE ZEROS         TO  HLD-RETURN-CD.
           MOVE SPACES                   TO BAS10002-CALL-PARAMETERS    02.23
                                            POST-EDIT-HOLD-SUSPENSE.    02.23
           MOVE 'O'                      TO BAS10002-CALL-TYPE.         02.23
025890     PERFORM Z9998-CALL-BAS10002
025900        THRU Z9998-EXIT.
      *
           MOVE 'O'                      TO BAS10004-CALL-TYPE.
           PERFORM Z9996-CALL-BAS10004 THRU Z9996-EXIT.
      *
           SET BASDTDTA-CT-OPEN          TO TRUE.                       03.13
           PERFORM Z9TDAT-CALL-BASDTDTA                                 03.13
              THRU Z9TDAT-EXIT.                                         03.13
      *                                                                 03.13
           MOVE 'O'                      TO BASDTRAN-CALL-TYPE.         03.13
           PERFORM Z9TRN-CALL-BASDTRAN                                  02.88
              THRU Z9TRN-EXIT.                                          03.13
      *                                                                 02.88
           MOVE 'O'                      TO BASDADDM-CALL-TYPE.         03.13
           PERFORM Z9ADM-CALL-BASDADDM                                  02.88
              THRU Z9ADM-EXIT.                                          02.88
      *                                                                 02.88
025880     MOVE 'O'           TO BASCRATE-SD-CALL-TYPE.
112050     PERFORM Z9997-CALL-BASCRATE
025900        THRU Z9997-EXIT.
025910
025920     OPEN INPUT  DAILY-TRANS
                       AUTO-PLAN-FILE                                   02.38
                       INTCHG-RATES                                     02.51
025940                 FEICF-FILE
025940                 FEPKG-FILE.
025970*
025980     IF FEICF-BYTES = '00' OR '97'
025990        NEXT SENTENCE
026000     ELSE
026010        DISPLAY 'BAD OPEN ON FEICF FILE'
026020        DISPLAY 'FILE STATUS ====> ' FEICF-BYTES
026030        MOVE 25 TO HLD-RETURN-CD.
025970*
025980     IF FEPKG-BYTES = '00' OR '97'
025990        NEXT SENTENCE
026000     ELSE
026010        DISPLAY 'BAD OPEN ON FEPKG FILE'
026020        DISPLAY 'FILE STATUS ====> ' FEPKG-BYTES
026030        MOVE 35 TO HLD-RETURN-CD.
           MOVE ZEROS                    TO PPA-KEY-INST-ASSN.          02.23
           MOVE +0                       TO PPA-PKG-CNT.                02.23
           MOVE SPACES                   TO PPA-PLAN-PKG-TABLE.         02.23
026110*
026120 A-100-CHECK-FOR-FILES.
026130*
026140     MOVE ZEROS                    TO FEICF-KEY.
           PERFORM Z-800-READ-FEICF
              THRU Z-800-EXIT.
           IF FEICF-BYTES = '00'
              MOVE FE-WORK-AS-OF-DATE    TO HLD-WAO-DATE-7
              MOVE FE-JULIAN-DATE        TO HLD-JULIAN-DATE
                                            WS-ARI-WAO
                                            WS-HRI-WAO
                                            WS-GRI-WAO
                                            RBL-1-HDR-WAO
                                            RGL-1-REF-WAO
                                            WS-LVL3-WORK
              MOVE FE-DAY-OF-WEEK        TO HLD-DAY-OF-WEEK
              MOVE 'CAD'                 TO DC-OPERATION
              MOVE HLD-WORK-AS-OF-DATE   TO DC-SEND-DATE
              PERFORM D-100-CALL-DATECONV
                 THRU D-100-EXIT
              IF DC-SUCCESSFUL
                 MOVE DC-RETURN-DATE     TO HLD-WAO-DATE-CCYYMMDD
                                            PL-REF-DATE
              ELSE
                 DISPLAY 'BAD WORK AS OF DATE'
                 DISPLAY 'DATECONV-PASSAREA -->' DATECONV-PASSAREA
                 MOVE 62                 TO HLD-RETURN-CD
              END-IF
026200     ELSE
026210        DISPLAY 'NO ZEROS RECORD ON FEICF'
026220        MOVE 40 TO HLD-RETURN-CD.
           MOVE HLD-WAO-DATE-CCYYMMDD-X(1:4)                            02.88
                                         TO WS-DW-CCYY.                 02.88
           MOVE HLD-WAO-DATE-CCYYMMDD-X(5:2)                            02.88
                                         TO WS-DW-MM.                   02.88
           MOVE HLD-WAO-DATE-CCYYMMDD-X(7:2)                            02.88
                                         TO WS-DW-DD.                   02.88
           MOVE WS-DATE-WORK             TO BASDTRAN-WAO-DATE           03.13
                                            BASDTDTA-WAO-DATE.          03.13
           MOVE WSA-RT-HH-MM-S           TO WS-UN-TIME-HHMMS.           03.24
           MOVE WSA-RT-HH-MM             TO WS-OTR-TIME-HH-MM.
           MOVE WS-OTR-TIME              TO WS-OTR-SEQ-NO.
      *
           PERFORM T-760-BANK-999999-INFO
              THRU T-760-EXIT.
      *
       A-100-OPEN-MEDNME.
           MOVE 'O'                      TO MESNMERD-CALL-TYPE.         02.77
           MOVE 'V'                      TO MESNMERD-FILE-TYPE.         02.77
           PERFORM Z-910-CALL-MESNMERD                                  02.77
              THRU Z-910-EXIT.                                          02.77
           IF NOT MESNMERD-RC-NORMAL                                    02.77
              DISPLAY '** BAC00110: BAD OPEN FOR INPUT MEDNME'          02.77
              MOVE 20                    TO HLD-RETURN-CD               02.77
           END-IF.                                                      02.77
           MOVE 'R'                      TO MESNMERD-CALL-TYPE.         02.77
      *                                                                 02.77
026680 A-100-OPEN-OTHER-FILES.
026690*
026700     OPEN OUTPUT WORK-FILE
026710                 OUT-TRANS
026710                 RECN-FILE
026710                 REJECT-TRAN-FILE
026720                 RPT-FILE
                       REJECT-RPT-FILE
                       BALANCE-FILE                                     02.64
026730                 TTL-PAGE
026740                 ADDENDUM-FILE-OUT
026750                 SYSTEM-ASSN-WORK
026760                 SYSTEM-TTL-WORK.
      *                                                                 02.87
           IF PARM-IS-1-SIDED                                           03.31
              DISPLAY '1-SIDED TRANSACTIONS BEING PROCESSED.'           03.31
           ELSE                                                         03.31
              DISPLAY '2-SIDED TRANSACTIONS BEING PROCESSED.'           03.31
              OPEN OUTPUT DOWN-FILE                                     03.31
                          PASSTHRU-RPT-FILE                             03.31
                          DOWNGRADE-RPT-FILE                            03.31
                          PBD-EBT-RPT-FILE                              03.31
                          DEFAULT-RPT-FILE                              03.31
                          GEN-PLAN-FILE                                 03.31
           END-IF.                                                      03.31
      *                                                                 03.31
           IF NOT PARM-IS-REJECT-REPAIR                                 02.87
              DISPLAY 'NO REJECT/REPAIR FILES TODAY'                    02.87
              PERFORM Z9TRNR-CALL-BASDTRAN-NO-REJ                       03.54
                 THRU Z9TRNR-EXIT                                       03.54
      *                                                                 03.54
              MOVE 'C'                      TO BASDTRAN-CALL-TYPE       03.54
              PERFORM Z9TRNR-CALL-BASDTRAN-NO-REJ                       03.54
              THRU Z9TRNR-EXIT                                          03.54
      *                                                                 03.54
           END-IF.                                                      02.87
      *                                                                 02.87
           IF PARM-IS-BALANCE-RECON                                     02.87
              OPEN OUTPUT BATCH-FILE                                    02.87
                          RECON-DATA-FILE                               02.87
           ELSE                                                         02.87
              DISPLAY 'NO BALANCE/RECON FILES TODAY'                    02.87
           END-IF.                                                      02.87
      *                                                                 02.87
026780     IF  HLD-RETURN-CD    >  0
026790         COMPUTE ABEND-CODE  = HLD-RETURN-CD + 900
026800         PERFORM  Z9999-ABEND-PGM
026810            THRU  Z9999-EXIT.
026820     PERFORM T-990-READ-BIN-DATE
026830        THRU T-990-EXIT.
026840     PERFORM T-995-READ-ARD-DATE
026850        THRU T-995-EXIT.
026860     PERFORM B-100-INITIALIZE
026870        THRU B-100-EXIT.
026880     PERFORM C-100-PROCESS
026890        THRU C-100-EXIT
026900         UNTIL END-OF-INPUT.
           IF NOT WS-PASS-THRU-RPT-CREATED
              DISPLAY 'NO PASS THROUGH REPORT TODAY'
              MOVE 1                     TO RAD-ED-REPORT-TYPE
              PERFORM R-795-NULL-REPORT
                 THRU R-795-EXIT.
           IF NOT WS-QUALIFICATION-RPT-CREATED
              DISPLAY 'NO QUALIFICATION REPORT TODAY'
              MOVE 2                     TO RAD-ED-REPORT-TYPE
              PERFORM R-795-NULL-REPORT
                 THRU R-795-EXIT.
           IF NOT WS-PBD-EBT-RPT-CREATED
              DISPLAY 'NO PBD / EBT REPORT TODAY'
              MOVE 4                     TO RAD-ED-REPORT-TYPE
              PERFORM R-795-NULL-REPORT
                 THRU R-795-EXIT.
           IF NOT WS-DEFAULT-RPT-CREATED
              DISPLAY 'NO DEFAULT REPORT TODAY'
              MOVE 8                     TO RAD-ED-REPORT-TYPE
              PERFORM R-795-NULL-REPORT
                 THRU R-795-EXIT.
           IF NOT WS-REJECT-RPT-CREATED
              DISPLAY 'NO REJECT REPORT TODAY'
              MOVE 9                     TO RAD-ED-REPORT-TYPE
              PERFORM R-795-NULL-REPORT
                 THRU R-795-EXIT.
026910     IF SUB-BTCH EQUAL ZERO
026920        DISPLAY 'BANKCARD EDIT EMPTY INPUT DATASET'
              PERFORM R-790-ZERO-REPORT
                 THRU R-790-EXIT
              PERFORM S-452-WRITE-RECN-FILE-SUMM
                 THRU S-452-EXIT
              MOVE BASCRATE-SD-CENTER-CURR-CD                           02.98
                                       TO BAL-REC-CURR-CODE             02.98
              PERFORM C-780-WRITE-BAL-REC-OUTPUT                        02.98
                 THRU C-780-EXIT                                        02.98
026930        GO TO A-100-CLOSE-FILES.
           MOVE LIT-SALES              TO HLB-LIT.
026940     PERFORM R-500-BATCH-BREAK
026950        THRU R-500-EXIT.
026960     PERFORM R-700-RUN-TOTALS
026970        THRU R-700-EXIT.
           PERFORM S-452-WRITE-RECN-FILE-SUMM
              THRU S-452-EXIT.
           PERFORM C-780-WRITE-BAL-REC-OUTPUT                           02.64
              THRU C-780-EXIT.                                          02.64
026980 A-100-CLOSE-FILES.
026990*
           MOVE SPACES                   TO BAS10002-CALL-PARAMETERS.   02.23
           MOVE 'C'                      TO BAS10002-CALL-TYPE.         02.23
027030     PERFORM Z9998-CALL-BAS10002
027040        THRU Z9998-EXIT.
      *
           MOVE 'C'                      TO BAS10004-CALL-TYPE.
           PERFORM Z9996-CALL-BAS10004 THRU Z9996-EXIT.
      *
           SET BASDTDTA-CT-CLOSE         TO TRUE.                       03.13
           PERFORM Z9TDAT-CALL-BASDTDTA                                 03.13
              THRU Z9TDAT-EXIT.                                         03.13
      *                                                                 03.13
           MOVE 'C'                      TO BASDTRAN-CALL-TYPE.         03.13
           PERFORM Z9TRN-CALL-BASDTRAN                                  02.88
              THRU Z9TRN-EXIT.                                          03.13
      *                                                                 02.88
           MOVE 'C'                      TO BASDADDM-CALL-TYPE.         03.13
           PERFORM Z9ADM-CALL-BASDADDM                                  02.88
              THRU Z9ADM-EXIT.                                          02.88
      *                                                                 02.88
025880     MOVE 'C'           TO BASCRATE-SD-CALL-TYPE.
112050     PERFORM Z9997-CALL-BASCRATE
025900        THRU Z9997-EXIT.
      *
           DISPLAY 'MAX NUMBER OF CAB PROGRAMS IN KMCMCCPW '
                    WS-MC-MAX-CAB-CNT.
           DISPLAY 'MAX NUMBER OF CAB BSA PROGRAMS IN KMCMCCPW '        02.29
                    WS-MC-MAX-CAB-BSA-CNT.                              02.29
      *
           DISPLAY ' '.                                                 02.64
           DISPLAY 'BALANCE RECORDS WRITTEN ' BALANCE-RECS-CNT.         02.64
           DISPLAY ' '.                                                 02.64
           DISPLAY 'BATCH RECORDS WRITTEN   ' BATCH-RECS-CNT.           02.87
           DISPLAY ' '.                                                 02.87
           DISPLAY 'RECON DATA RECS WRITTEN ' RECON-DATA-RECS-CNT.      02.87
           DISPLAY ' '.                                                 02.87
      *                                                                 02.64
           DISPLAY ' '.                                                 02.51
           DISPLAY 'RATE RECORDS READ IS    ' INTCHG-RATES-CNT.         02.51
           DISPLAY ' '.                                                 02.51
           DISPLAY 'AU RECORDS PROCESSED IS ' AU-CTR.                   02.51
           MOVE AU-RT-MAX                TO AU-CTR.                     02.51
           DISPLAY 'AU RECORDS IN TABLE IS  ' AU-CTR.                   02.51
           DISPLAY ' '.                                                 03.16A
           DISPLAY 'AE RECORDS PROCESSED IS ' AE-CTR.                   03.16A
           MOVE AE-RT-MAX                TO AE-CTR.                     03.16A
           DISPLAY 'AE RECORDS IN TABLE IS  ' AE-CTR.                   03.16A
           DISPLAY ' '.                                                 02.51
           DISPLAY 'DU RECORDS PROCESSED IS ' DU-CTR.                   02.51
           MOVE DU-RT-MAX                TO DU-CTR.                     02.51
           DISPLAY 'DU RECORDS IN TABLE IS  ' DU-CTR.                   02.51
           DISPLAY ' '.                                                 02.51
           DISPLAY 'MI RECORDS PROCESSED IS ' MI-CTR.                   02.51
           MOVE MI-RT-MAX                TO MI-CTR.                     02.51
           DISPLAY 'MI RECORDS IN TABLE IS  ' MI-CTR.                   02.51
           DISPLAY ' '.                                                 02.51
           DISPLAY 'MU RECORDS PROCESSED IS ' MU-CTR.                   02.51
           MOVE MU-RT-MAX                TO MU-CTR.                     02.51
           DISPLAY 'MU RECORDS IN TABLE IS  ' MU-CTR.                   02.51
           DISPLAY ' '.                                                 02.51
           DISPLAY 'PU RECORDS PROCESSED IS ' PU-CTR.                   02.51
           MOVE PDN-RT-MAX               TO PU-CTR.                     02.51
           DISPLAY 'PU RECORDS IN TABLE IS  ' PU-CTR.                   02.51
           DISPLAY ' '.                                                 02.51
           DISPLAY 'VI RECORDS PROCESSED IS ' VI-CTR.                   02.51
           MOVE VI-RT-MAX                TO VI-CTR.                     02.51
           DISPLAY 'VI RECORDS IN TABLE IS  ' VI-CTR.                   02.51
           DISPLAY ' '.                                                 02.51
           DISPLAY 'VU RECORDS PROCESSED IS ' VU-CTR.                   02.51
           MOVE VU-RT-MAX                TO VU-CTR.                     02.51
           DISPLAY 'VU RECORDS IN TABLE IS  ' VU-CTR.                   02.51
           DISPLAY ' '.                                                 02.51
           DISPLAY 'RATES BYPASSED IS       ' BYPASS-CTR.               02.51
           DISPLAY ' '.                                                 02.51
           DISPLAY 'RATES NOT FOUND IS      ' NOT-FND-CTR.              02.51
           DISPLAY ' '.                                                 02.51
      *                                                                 02.51
           MOVE 'C'                      TO MESNMERD-CALL-TYPE.         02.77
           PERFORM Z-910-CALL-MESNMERD                                  02.77
              THRU Z-910-EXIT.                                          02.77
      *                                                                 02.77
           CLOSE DAILY-TRANS
                 AUTO-PLAN-FILE
                 INTCHG-RATES                                           02.51
                 BALANCE-FILE                                           02.64
                 FEICF-FILE
                 FEPKG-FILE
                 WORK-FILE
                 OUT-TRANS
                 RECN-FILE
                 REJECT-TRAN-FILE
                 RPT-FILE
                 REJECT-RPT-FILE
                 TTL-PAGE
                 ADDENDUM-FILE-OUT
                 SYSTEM-ASSN-WORK.
      *                                                                 02.87
           IF NOT PARM-IS-1-SIDED                                       03.31
              CLOSE DOWN-FILE                                           03.31
                    PASSTHRU-RPT-FILE                                   03.31
                    DOWNGRADE-RPT-FILE                                  03.31
                    PBD-EBT-RPT-FILE                                    03.31
                    DEFAULT-RPT-FILE                                    03.31
                    GEN-PLAN-FILE                                       03.31
           END-IF.                                                      03.31
      *                                                                 03.31
           IF PARM-IS-BALANCE-RECON                                     02.87
              CLOSE BATCH-FILE                                          02.87
                    RECON-DATA-FILE                                     02.87
           END-IF.                                                      02.87
      *                                                                 02.87
027280 A-100-FINISHUP.
027290     MOVE HLD-RETURN-CD TO RETURN-CODE
027300                           ABEND-CODE.
027310     IF ABORT-RUN-SW EQUAL 'Y'
027320         DISPLAY '***** ABORT BANKCARD EDIT *****'
027330         DISPLAY '  '
027340         PERFORM  Z9999-ABEND-PGM
027350            THRU  Z9999-EXIT.
027360     GOBACK.
027370*
027380 B-100-INITIALIZE.
027390     DISPLAY '  '.
027400     DISPLAY '  BAC00110 BANKCARD EDIT MESSAGES'.
027410*
           INITIALIZE ADDENDUM-WORK-RECORD.
           INITIALIZE KIT-MOTOR-FUEL-PROD-CODES.
           INITIALIZE KIT-OIL-COMPANY-CODES.
           INITIALIZE KIT-PRODUCT-CODES.
           INITIALIZE KMCINTEP-DATA-AREA.
           MOVE SPACES                   TO SNF-RECORD.                 02.77
           INITIALIZE SNF-RECORD.                                       02.77
           MOVE +0                       TO SNF-INST-CODE
                                            SNF-MERCH-NBR.
           MOVE LOW-VALUES               TO SNF-PLAN-CODE-TABLE.
           MOVE 'NO MEDNAME MERCHANT DATA'
                                         TO SNF-FIRST-NAME(1).
           MOVE PSI-RUN                  TO HLB-SOURCE-ID
                                            RAD-ED-SOURCE-ID
                                            WS-OTR-SOURCE-ID.
      *
           SET SID-INDX TO +1.
           SEARCH WS-SID-ENTRY
              AT END
                 MOVE 99                 TO WS-RNC-1-2-DIGITS
              WHEN HLB-SOURCE-ID = WS-SID-SOURCE-X(SID-INDX)
                 MOVE WS-SID-SOURCE(SID-INDX)
                                         TO WS-RNC-1-2-DIGITS.
      *                                                                 03.24
           MOVE WS-RNC-1-2-DIGITS        TO WS-UN-SRC-ID.               03.24
           MOVE WS-UNIQUE-NO             TO WS-ARI-TIME                 03.24
                                            WS-HRI-TIME                 03.24
                                            WS-GRI-TIME                 03.62M
                                            RBL-1-HDR-TIME              03.62M
                                            RGL-1-REF-TIME.             03.62M
      *
           MOVE SPACES                   TO BALANCING-RECORD.           02.64
           MOVE HLD-WAO-DATE-CCYYMMDD-X(3:6)                            02.64
                                         TO BAL-REC-WAO-DATE.           02.64
           MOVE '01'                     TO BAL-REC-CLEAR-CYCLE         02.64
                                            BAL-REC-POST-CYCLE.         02.64
           IF PSI-RUN = 'U'                                             03.31
              MOVE '002021'              TO BAL-REC-TYPE                03.31
              MOVE ' BAC00111 1-SIDED RJT RECON   '                     03.31
                                         TO RECN-FILE-TITLE             03.31
              MOVE 'BAC00111 1-SIDED RJT BTCH SUMM'                     03.31
                                         TO RECN-BATCH-TITLE            03.31
              MOVE 'BAC00111 1-SIDED RJT SETL'                          03.31
                                         TO RECN-SETL-TITLE             03.31
           ELSE                                                         03.31
           IF PSI-RUN = 'D'                                             03.31
              MOVE '002022'              TO BAL-REC-TYPE                03.31
              MOVE ' BAC00110 2-SIDED RJT RECON   '                     03.31
                                         TO RECN-FILE-TITLE             03.31
              MOVE 'BAC00110 2-SIDED RJT BTCH SUMM'                     03.31
                                         TO RECN-BATCH-TITLE            03.31
              MOVE 'BAC00110 2-SIDED RJT SETL'                          03.31
                                         TO RECN-SETL-TITLE             03.31
           ELSE                                                         03.31
           IF PSI-RUN = 'Q'                                             03.31
              MOVE '003000'              TO BAL-REC-TYPE                03.31
              MOVE ' BAC00111 1-SIDED RECON       '                     03.31
                                         TO RECN-FILE-TITLE             03.31
              MOVE ' BAC00111 1-SIDED BATCH SUMM  '                     03.31
                                         TO RECN-BATCH-TITLE            03.31
              MOVE ' BAC00111 1-SIDED SETTLE '                          03.31
                                         TO RECN-SETL-TITLE             03.31
           ELSE                                                         03.31
           IF PSI-RUN = 'O'                                             02.64
              MOVE '002000'              TO BAL-REC-TYPE                02.64
           ELSE                                                         02.64
              MOVE '00201'               TO BAL-REC-TYPE(1:5)           02.64
              MOVE PSI-RUN               TO BAL-REC-TYPE(6:1)           02.64
           END-IF.                                                      02.64
           MOVE LOW-VALUES               TO BAL-REC-CURR-CODE.          02.64
           INITIALIZE PRESENTMENT-TRANS(1)                              02.64
                      PRESENTMENT-TRANS(2).                             02.64
      *                                                                 02.64
003140     MOVE ZEROS                    TO ERR-LVL3-MESSAGE-ID-WORK.
003140     MOVE 'AA'                 TO ERR-LVL3-MESSAGE-ID-WORK-X(1:2).
003140     COMPUTE WS-LVL3-WORK = (WSA-RT-HH * 3600)
003140                          + (WSA-RT-MM * 60)
003140                          + WSA-RT-SS.
003140     MOVE WS-LVL3-WORK-X       TO ERR-LVL3-MESSAGE-ID-WORK-X(7:5).
027430     MOVE LOW-VALUES               TO FEICF-KEY-X.
027440     START FEICF-FILE KEY IS NOT LESS THAN FEICF-KEY-X.
027460     MOVE 0                        TO WS-ASSN-RECS
027470     SET ER-INDX TO 1.
           MOVE WS-LVL3-WORK-X(2:4)  TO ERR-LVL3-MESSAGE-ID-WORK-X(3:4).
           PERFORM B-110-LOAD-MC-LIC-TABLE                              02.23
              THRU B-110-EXIT.                                          02.23
           PERFORM B-140-LOAD-MC-PROD-GRAD-TABLE                        02.39
              THRU B-140-EXIT.                                          02.39
           PERFORM B-150-LOAD-STALE-DATES
              THRU B-150-EXIT.
           PERFORM B-170-LOAD-PRODUCT-ID
              THRU B-170-EXIT.
           PERFORM B-180-LOAD-VALUE-TABLES
              THRU B-180-EXIT.
           PERFORM B-190-LOAD-AUTO-PLAN-TABLE                           02.38
              THRU B-190-EXIT.                                          02.38
           PERFORM B-200-LOAD-INTCHG-TABLES                             02.51
              THRU B-200-EXIT                                           02.51
                   UNTIL INTCHG-RATES-EOF.                              02.51
027550     PERFORM B-300-ZERO-TABLES
027560        THRU B-300-EXIT.
027570     PERFORM B-400-LOAD-TC-TABLES
027580        THRU B-400-EXIT.
           MOVE ZEROS                    TO ERROR-CODE-HOLD-TABLE.
027630*
           PERFORM S-450-WRITE-RECN-FH
              THRU S-450-EXIT.
027630*
027640     MOVE FRONT-END-SYSTEM-NAME    TO HL1-SYSTEM-NAME.
           IF PARM-IS-1-SIDED                                           03.31
              MOVE 'BAC00111'            TO HL1-PROGRAM                 03.31
           ELSE                                                         03.31
              MOVE 'BAC00110'            TO HL1-PROGRAM                 03.31
           END-IF.                                                      03.31
027660     MOVE '001'                    TO HL1-REPORT.
      *
           MOVE RPT-BATCH-LINE-1         TO RESET-RPT-BATCH-LINE-1.
           MOVE RPT-BATCH-LINE-2         TO RESET-RPT-BATCH-LINE-2.
           MOVE RPT-GROUP-LINE-1         TO RESET-RPT-GROUP-LINE-1.
           MOVE RPT-GROUP-LINE-2         TO RESET-RPT-GROUP-LINE-2.
           MOVE RPT-RANDC-LINE-1         TO RESET-RPT-RANDC-LINE-1.
           MOVE RPT-RANDC-LINE-2         TO RESET-RPT-RANDC-LINE-2.
           MOVE RPT-FORMAT-1-LINE-1      TO RESET-RPT-FORMAT-1-LINE-1.
           MOVE RPT-FORMAT-1-LINE-2      TO RESET-RPT-FORMAT-1-LINE-2.
           MOVE RPT-FORMAT-1-LINE-7      TO RESET-RPT-FORMAT-1-LINE-7.
           MOVE RPT-COMMON-LINE-1        TO RESET-RPT-COMMON-LINE-1.
           MOVE RPT-COMMON-LINE-2        TO RESET-RPT-COMMON-LINE-2.
           MOVE RPT-COMMON-LINE-3        TO RESET-RPT-COMMON-LINE-3.
           MOVE RPT-COMMON-LINE-4        TO RESET-RPT-COMMON-LINE-4.
           MOVE RPT-COMMON-LINE-5        TO RESET-RPT-COMMON-LINE-5.
           MOVE RPT-COMMON-LINE-6        TO RESET-RPT-COMMON-LINE-6.
           MOVE RPT-COMMON-LINE-7        TO RESET-RPT-COMMON-LINE-7.
           MOVE RPT-COMMON-LINE-8        TO RESET-RPT-COMMON-LINE-8.
           MOVE RPT-COMMON-LINE-9        TO RESET-RPT-COMMON-LINE-9.
           MOVE RPT-COMMON-LINE-10       TO RESET-RPT-COMMON-LINE-10.   02.95
           MOVE RPT-INTCHG-LINE-1        TO RESET-RPT-INTCHG-LINE-1.
           MOVE RPT-VISA-LINE-1          TO RESET-RPT-VISA-LINE-1.
           MOVE RPT-VISA-LINE-2          TO RESET-RPT-VISA-LINE-2.
           MOVE RPT-VISA-LINE-3          TO RESET-RPT-VISA-LINE-3.
           MOVE RPT-VISA-LINE-4          TO RESET-RPT-VISA-LINE-4.      03.42V
           MOVE RPT-MC-LINE-1            TO RESET-RPT-MC-LINE-1.
           MOVE RPT-MC-LINE-2            TO RESET-RPT-MC-LINE-2.
           MOVE RPT-MC-LINE-3            TO RESET-RPT-MC-LINE-3.        03.16M
           MOVE RPT-AMEX-LINE-1          TO RESET-RPT-AMEX-LINE-1.
           MOVE RPT-AMEX-LINE-2          TO RESET-RPT-AMEX-LINE-2.
           MOVE RPT-AMEX-LINE-3          TO RESET-RPT-AMEX-LINE-3.      03.29
           MOVE RPT-DS-LINE-1            TO RESET-RPT-DS-LINE-1.
           MOVE RPT-DS-LINE-2            TO RESET-RPT-DS-LINE-2.
           MOVE RPT-DS-LINE-3            TO RESET-RPT-DS-LINE-3.        03.47
           MOVE RPT-DOWNGRADE-LINE       TO RESET-RPT-DOWNGRADE-LINE.
           MOVE RRD-AMT-DATA             TO RESET-RRD-AMT-DATA.
           MOVE RRD-AMX-DATA             TO RESET-RRD-AMX-DATA.
           MOVE RRD-CSP-DATA             TO RESET-RRD-CSP-DATA.
           MOVE RRD-DS-DATA              TO RESET-RRD-DS-DATA.
           MOVE RCL-OPTIONAL-DATA-10-MC TO                              02.95
                                          RESET-RCL-OPTIONAL-DATA-10-MC.02.95
           MOVE RCL-OPTIONAL-DATA-10-VS TO                              02.95
                                          RESET-RCL-OPTIONAL-DATA-10-VS.02.95
           MOVE RCL-OPTIONAL-DATA-10-DS TO                              02.95
                                          RESET-RCL-OPTIONAL-DATA-10-DS.02.95
      *
027670 B-100-EXIT.
027680     EXIT.
027690*
       B-110-LOAD-MC-LIC-TABLE.                                         02.23
      *                                                                 02.23
           MOVE SPACES                   TO BAS10002-CALL-PARAMETERS    02.23
                                            EDIT-FILE-REC.              02.23
           MOVE LOW-VALUES               TO EFR-KEY-REMAIN.             02.23
           MOVE 'H'                      TO EFR-REC-KEY-ID.             02.23
           MOVE '3'                      TO EFR-MCT16-REC-TYPE.         02.23
           MOVE 'X'                      TO BAS10002-EFR-PROB.          02.23
           MOVE EFR-REC-KEY              TO BAS10002-PASSED-KEY.        02.23
           MOVE 'S'                      TO BAS10002-CALL-TYPE.         02.23
           PERFORM Z9998-CALL-BAS10002                                  02.23
              THRU Z9998-EXIT.                                          02.23
           IF NOT BAS10002-EFR-GOOD                                     02.23
              GO TO B-110-EXIT                                          02.23
           END-IF.                                                      02.23
           MOVE BAS10002-EDDATA-AREA     TO EDIT-FILE-REC.              02.23
           IF EFR-REC-KEY-ID = 'H' AND                                  02.23
              EFR-MCT16-REC-TYPE = '3'                                  02.23
                 NEXT SENTENCE                                          02.23
           ELSE                                                         02.23
              GO TO B-110-EXIT                                          02.23
           END-IF.                                                      02.23
      *                                                                 02.23
           MOVE 'N'                      TO BAS10002-CALL-TYPE.         02.23
           PERFORM                                                      02.23
             VARYING LP2P-INDX FROM +1 BY +1                            02.23
             UNTIL   LP2P-INDX > WS-MC-LP2P-MAX                         02.23
               COMPUTE WS-MC-LP2P-CNT = WS-MC-LP2P-CNT + 1              02.23
               MOVE EFR-MCT16-LIC-PROD-ID                               02.23
                                         TO WS-MC-LP2P-LIC(LP2P-INDX)   02.23
               MOVE EFR-MCT16-PRODUCT-ID TO WS-MC-LP2P-PROD(LP2P-INDX)  02.23
               MOVE EFR-MCT16-ACCEPT-BRAND                              02.23
                                         TO WS-MC-LP2P-ACCEPT(LP2P-INDX)02.23
               MOVE EFR-MCT16-PRODUCT-CLASS                             02.23
                                         TO WS-MC-LP2P-CLASS(LP2P-INDX) 02.23
               MOVE EFR-MCT16-PRODUCT-TYPE                              02.23
                                         TO WS-MC-LP2P-TYPE(LP2P-INDX)  02.23
               MOVE EFR-MCT16-PRODUCT-CAT                               03.42M
                                         TO WS-MC-LP2P-CAT(LP2P-INDX)   03.42M
               MOVE 'X'                  TO BAS10002-EFR-PROB           02.23
               MOVE EFR-REC-KEY          TO BAS10002-PASSED-KEY         02.23
               PERFORM Z9998-CALL-BAS10002                              02.23
                  THRU Z9998-EXIT                                       02.23
               IF BAS10002-EFR-GOOD                                     02.23
                  MOVE BAS10002-EDDATA-AREA                             02.23
                                         TO EDIT-FILE-REC               02.23
                  IF EFR-REC-KEY-ID = 'H' AND                           02.23
                     EFR-MCT16-REC-TYPE = '3'                           02.23
                     IF WS-MC-LP2P-CNT = WS-MC-LP2P-MAX                 02.23
                        DISPLAY '*** MC LICENSE ID TABLE FULL ***'      02.23
                        DISPLAY '***  TABLE EXPANSION NEEDED  ***'      02.23
                        MOVE 53          TO HLD-RETURN-CD               02.23
                        COMPUTE ABEND-CODE = HLD-RETURN-CD + 900        02.23
                        PERFORM Z9999-ABEND-PGM                         02.23
                           THRU Z9999-EXIT                              02.23
                     END-IF                                             02.23
                  ELSE                                                  02.23
                     SET LP2P-INDX       TO WS-MC-LP2P-MAX              02.23
                  END-IF                                                02.23
               ELSE                                                     02.23
                  SET LP2P-INDX          TO WS-MC-LP2P-MAX              02.23
               END-IF                                                   02.23
           END-PERFORM.                                                 02.23
      *                                                                 02.23
       B-110-EXIT.                                                      02.23
           EXIT.                                                        02.23
      *                                                                 02.23
       B-140-LOAD-MC-PROD-GRAD-TABLE.                                   02.39
      *                                                                 02.39
           MOVE SPACE                    TO INVALID-MCEDFILE-SW.        02.39
           MOVE SPACES                   TO MC-EDIT-REC.                02.39
           MOVE 'R'                      TO BAS10004-CALL-TYPE.         02.39
           MOVE 'G'                      TO MC-REC-KEY-ID.              02.39
           MOVE MC-ALMPG-KEY             TO BAS10004-MCEDFILE-READ-KEY. 02.39
           PERFORM Z9996-CALL-BAS10004                                  02.39
              THRU Z9996-EXIT.                                          02.39
           IF BAS10004-RC-NORMAL                                        02.39
              MOVE MC-ALMPG-DATA         TO WS-MC-ALMPG-DATA            02.39
           ELSE                                                         02.39
              DISPLAY 'NO ALM RECORD RECORD ON MCEDFILE.'               02.39
              DISPLAY 'USING DEFAULT.'                                  02.39
              MOVE WS-MC-TEMP-PROD-GRAD-TABLE                           02.39
                                         TO WS-MC-PGT-ENTRIES           02.39
              MOVE +37                   TO WS-MC-PGT-CNT               02.39
           END-IF.                                                      02.39
      *                                                                 02.39
       B-140-EXIT.                                                      02.39
           EXIT.                                                        02.39
      *                                                                 02.39
027700 B-150-LOAD-STALE-DATES.
027710     MOVE SPACES         TO  EDIT-FILE-REC.
027720     MOVE 'Y'            TO  EFR-REC-KEY-ID.
027730     MOVE +1             TO  EFR-STLDT-RECID.
027740     PERFORM Z-900-READ-EFR
027750        THRU Z-900-EXIT.
           IF BAS10002-EFR-GOOD                                         02.23
027770         MOVE EDIT-FILE-REC TO VISA-STALE-DATE-RECORD
027780     ELSE
027790         MOVE 51 TO HLD-RETURN-CD
027800         COMPUTE ABEND-CODE  = HLD-RETURN-CD + 900
027810         PERFORM  Z9999-ABEND-PGM
027820            THRU  Z9999-EXIT.
027710     MOVE SPACES         TO  EDIT-FILE-REC.
027720     MOVE 'Y'            TO  EFR-REC-KEY-ID.
027730     MOVE +5             TO  EFR-STLDT-RECID.
027740     PERFORM Z-900-READ-EFR
027750        THRU Z-900-EXIT.
           IF BAS10002-EFR-GOOD                                         02.23
027770         MOVE EDIT-FILE-REC TO DISCOVER-STALE-DATE-RECORD
027780     ELSE
027770         INITIALIZE DISCOVER-STALE-DATE-RECORD
027780     END-IF.
027770     PERFORM
027770       VARYING SUB1 FROM +1 BY +1
027770       UNTIL   SUB1 > +21
027770         MOVE HLD-JULIAN-DATE      TO ESD-DAYS-CUTOFF(SUB1)
027770     END-PERFORM.
027860     PERFORM B-160-LOAD-MC-STALE-DATE-TABLE
027870        THRU B-160-EXIT.
028010 B-150-EXIT.
028020     EXIT.
029160*
028030 B-160-LOAD-MC-STALE-DATE-TABLE.
      *
           PERFORM
              VARYING WS-SUB1 FROM +1 BY +1
              UNTIL   WS-SUB1 > +6                                      02.23
                 EVALUATE WS-SUB1
                    WHEN +1
                       MOVE 00           TO WS-WRK-SD-TYP(WS-SUB1)
                    WHEN +2
                       MOVE 10           TO WS-WRK-SD-TYP(WS-SUB1)
                    WHEN +3
                       MOVE 20           TO WS-WRK-SD-TYP(WS-SUB1)
                    WHEN +4
                       MOVE 30           TO WS-WRK-SD-TYP(WS-SUB1)
                    WHEN +5                                             02.23
                       MOVE 39           TO WS-WRK-SD-TYP(WS-SUB1)      02.23
                    WHEN +6                                             02.23
                       MOVE 60           TO WS-WRK-SD-TYP(WS-SUB1)
                 END-EVALUATE
                 MOVE +0                 TO WS-WRK-SD-TYP-CNT(WS-SUB1)
           END-PERFORM
      *
           MOVE WS-WRK-STALE-DATE-WORK   TO WS-MCC-00-STALE-DATE-WORK
                                            WS-MCC-01-STALE-DATE-WORK
                                            WS-MCC-12-STALE-DATE-WORK
                                            WS-MCC-18-STALE-DATE-WORK
                                            WS-MCC-20-STALE-DATE-WORK
                                            WS-MCC-28-STALE-DATE-WORK
                                            WS-DMC-00-STALE-DATE-WORK
                                            WS-DMC-01-STALE-DATE-WORK
                                            WS-DMC-09-STALE-DATE-WORK
                                            WS-DMC-12-STALE-DATE-WORK
                                            WS-DMC-18-STALE-DATE-WORK
                                            WS-DMC-20-STALE-DATE-WORK
                                            WS-DMC-28-STALE-DATE-WORK.
      *
           MOVE SPACE                    TO INVALID-MCEDFILE-SW.
           MOVE 'S'                      TO BAS10004-CALL-TYPE.
           MOVE LOW-VALUES               TO MC-SD-KEY.
           MOVE 'Z'                      TO MC-REC-KEY-ID.
           MOVE MC-SD-KEY                TO BAS10004-MCEDFILE-READ-KEY.
           PERFORM Z9996-CALL-BAS10004 THRU Z9996-EXIT.
           IF NOT BAS10004-RC-NORMAL
              MOVE 'Y'                   TO INVALID-MCEDFILE-SW
              DISPLAY 'BAD START DATE START ON MCEDFILE.'
              GO TO B-160-LOAD-STALE-ERROR.
      *
           MOVE 'N'                      TO KSD-STALE-DATE-SW.
           MOVE 'N'                      TO BAS10004-CALL-TYPE.
           PERFORM B-161-PROCESS-STALE-REC
              THRU B-161-EXIT
                   UNTIL   KSD-STALE-DATE-SW = 'Y' OR
                           INVALID-MCEDFILE-SW = 'Y'.
      *
       B-160-LOAD-STALE-ERROR.
      *
           IF INVALID-MCEDFILE-SW = 'Y'
              MOVE 52                    TO HLD-RETURN-CD
              COMPUTE ABEND-CODE = HLD-RETURN-CD + 900
              PERFORM Z9999-ABEND-PGM
                 THRU Z9999-EXIT
           END-IF.
      *
       B-160-EXIT.
           EXIT.
      *
       B-161-PROCESS-STALE-REC.
      *
           IF MC-SD-KEY = WS-MC-LAST-STALE-KEY
              GO TO B-161-SAME-TRAN.
      *
           MOVE MC-SD-KEY                TO WS-MC-LAST-STALE-KEY.
      *
           IF MC-SD-ACCEPT-BRAND = 'C'
              EVALUATE MC-SD-TRAN-TYPE
                 WHEN '00'
                    MOVE WS-MCC-00-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN '01'
                    MOVE WS-MCC-01-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN '12'
                    MOVE WS-MCC-12-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN '18'
                    MOVE WS-MCC-18-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN '20'
                    MOVE WS-MCC-20-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN '28'
                    MOVE WS-MCC-28-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN OTHER
                    MOVE 'Y'             TO INVALID-MCEDFILE-SW
                    DISPLAY 'INVALID MCC STALE DATE ID OF .'
                             MC-SD-KEY
              END-EVALUATE
           ELSE
              EVALUATE MC-SD-TRAN-TYPE
                 WHEN '00'
                    MOVE WS-DMC-00-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN '01'
                    MOVE WS-DMC-01-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN '09'
                    MOVE WS-DMC-09-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN '12'
                    MOVE WS-DMC-12-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN '18'
                    MOVE WS-DMC-18-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN '20'
                    MOVE WS-DMC-20-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN '28'
                    MOVE WS-DMC-28-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN OTHER
                    MOVE 'Y'             TO INVALID-MCEDFILE-SW
                    DISPLAY 'INVALID DMC STALE DATE ID OF .'
                             MC-SD-KEY
              END-EVALUATE
           END-IF.
      *
           IF INVALID-MCEDFILE-SW = 'Y'
              GO TO B-161-EXIT.
      *
       B-161-SAME-TRAN.
      *
           EVALUATE MC-SD-FROM-TYPE
              WHEN '00'
                 COMPUTE WS-SUB1 = +1
              WHEN '10'
                 COMPUTE WS-SUB1 = +2
              WHEN '20'
                 COMPUTE WS-SUB1 = +3
              WHEN '30'
                 COMPUTE WS-SUB1 = +4
              WHEN '39'                                                 02.23
                 COMPUTE WS-SUB1 = +5                                   02.23
              WHEN '60'
                 COMPUTE WS-SUB1 = +6                                   02.23
              WHEN OTHER
                 MOVE 'Y'                TO INVALID-MCEDFILE-SW
                 DISPLAY 'INVALID STALE DATE FROM TYPE OF .'
                          MC-SD-KEY
           END-EVALUATE.
      *
           IF INVALID-MCEDFILE-SW = 'Y'
              GO TO B-161-EXIT.
      *
           MOVE MC-SD-DATA               TO WS-WRK-SD-DATA(WS-SUB1).
      *
           MOVE MC-SD-KEY                TO BAS10004-MCEDFILE-READ-KEY.
           PERFORM Z9996-CALL-BAS10004 THRU Z9996-EXIT.
           IF BAS10004-RC-NOT-FOUND
              MOVE 'Y'                   TO KSD-STALE-DATE-SW
              GO TO B-161-SET-TABLE.
           IF NOT BAS10004-RC-NORMAL
              MOVE 'Y'                   TO INVALID-MCEDFILE-SW
              DISPLAY 'BAD STALE DATE READ ON MCEDFILE.'
              GO TO B-161-EXIT.
      *
           IF MC-REC-KEY-ID NOT = 'Z'
              MOVE 'Y'                   TO KSD-STALE-DATE-SW
              GO TO B-161-SET-TABLE.
      *
           IF MC-SD-KEY = WS-MC-LAST-STALE-KEY
              GO TO B-161-EXIT.
      *
       B-161-SET-TABLE.
      *
           IF WS-MC-LSK-ACCEPT-BRAND = 'C'
              EVALUATE WS-MC-LSK-TRAN-TYPE
                 WHEN '00'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-MCC-00-STALE-DATE-WORK
                 WHEN '01'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-MCC-01-STALE-DATE-WORK
                 WHEN '12'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-MCC-12-STALE-DATE-WORK
                 WHEN '18'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-MCC-18-STALE-DATE-WORK
                 WHEN '20'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-MCC-20-STALE-DATE-WORK
                 WHEN '28'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-MCC-28-STALE-DATE-WORK
              END-EVALUATE
           ELSE
              EVALUATE WS-MC-LSK-TRAN-TYPE
                 WHEN '00'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-DMC-00-STALE-DATE-WORK
                 WHEN '01'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-DMC-01-STALE-DATE-WORK
                 WHEN '09'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-DMC-09-STALE-DATE-WORK
                 WHEN '12'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-DMC-12-STALE-DATE-WORK
                 WHEN '18'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-DMC-18-STALE-DATE-WORK
                 WHEN '20'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-DMC-20-STALE-DATE-WORK
                 WHEN '28'
                    MOVE WS-WRK-STALE-DATE-WORK
                      TO WS-DMC-28-STALE-DATE-WORK
              END-EVALUATE
           END-IF.
      *
       B-161-EXIT.
           EXIT.
      *
       B-170-LOAD-PRODUCT-ID.
      *
           MOVE SPACE                    TO INVALID-MCEDFILE-SW.
           MOVE 'S'                      TO BAS10004-CALL-TYPE.
           MOVE LOW-VALUES               TO MC-BR-KEY.
           MOVE 'B'                      TO MC-REC-KEY-ID.
           MOVE MC-BR-KEY                TO BAS10004-MCEDFILE-READ-KEY.
           PERFORM Z9996-CALL-BAS10004 THRU Z9996-EXIT.
           IF NOT BAS10004-RC-NORMAL
              MOVE 'Y'                   TO INVALID-MCEDFILE-SW
              DISPLAY 'BAD PRODUCT ID START ON MCEDFILE.'
              GO TO B-170-EXIT.
      *
           MOVE +0                       TO WS-SUB1.
           MOVE +1                       TO WS-SUB2
                                            WS-SUB3.
           MOVE 'N'                      TO BAS10004-CALL-TYPE.
           PERFORM
              UNTIL   WS-SUB1 > WS-PIH-MAX-PROD-ENTRIES OR
                      MC-REC-KEY-ID NOT = 'B'
                 EVALUATE MC-BR-ACCEPT-BRAND
                    WHEN 'C'
                       IF WS-SUB2 > WS-PIH-MAX-PROD-ENTRIES
                          COMPUTE WS-SUB1 = WS-SUB2                     02.68
                          MOVE 'Y'       TO INVALID-MCEDFILE-SW
                          DISPLAY 'MAX MCC PRODUCT IDS EXCEEDED.'
                                   MC-BR-PRODUCT-ID
                       ELSE
                          MOVE MC-BR-PRODUCT-ID
                                         TO WS-MCC-PRODUCT-ID(WS-SUB2)
                          MOVE MC-BR-DATA
                                         TO WS-MCC-PROD-DATA(WS-SUB2)
                          COMPUTE WS-MCC-PROD-NO-ENTRIES = WS-SUB2
                          COMPUTE WS-SUB2 = WS-SUB2 + 1
                       END-IF
                    WHEN 'D'
                       IF WS-SUB3 > WS-PIH-MAX-PROD-ENTRIES
                          COMPUTE WS-SUB1 = WS-SUB3                     02.68
                          MOVE 'Y'       TO INVALID-MCEDFILE-SW
                          DISPLAY 'MAX DMC PRODUCT IDS EXCEEDED.'
                                   MC-BR-PRODUCT-ID
                       ELSE
                          MOVE MC-BR-PRODUCT-ID
                                         TO WS-DMC-PRODUCT-ID(WS-SUB3)
                          MOVE MC-BR-DATA
                                         TO WS-DMC-PROD-DATA(WS-SUB3)
                          COMPUTE WS-DMC-PROD-NO-ENTRIES = WS-SUB3
                          COMPUTE WS-SUB3 = WS-SUB3 + 1
                       END-IF
                    WHEN OTHER
                       COMPUTE WS-SUB1 = WS-PIH-MAX-PROD-ENTRIES + 1    02.68
                       MOVE 'Y'          TO INVALID-MCEDFILE-SW
                       DISPLAY 'PRODUCT ID/ACCEPT BRAND ERROR.'
                                MC-BR-PRODUCT-ID
                               '/'
                                MC-BR-ACCEPT-BRAND
                 END-EVALUATE
                 IF WS-SUB1 NOT > +0
                    MOVE MC-BR-KEY       TO BAS10004-MCEDFILE-READ-KEY
                    PERFORM Z9996-CALL-BAS10004 THRU Z9996-EXIT
                    IF NOT BAS10004-RC-NORMAL
                       MOVE 'Y'          TO INVALID-MCEDFILE-SW
                       DISPLAY 'BAD PRODUCT ID READ ON MCEDFILE.'
                       COMPUTE WS-SUB1 = WS-PIH-MAX-PROD-ENTRIES + 1    02.68
                    END-IF
                 END-IF
           END-PERFORM.
      *
           IF INVALID-MCEDFILE-SW = 'Y'
              MOVE 53                    TO HLD-RETURN-CD
              COMPUTE ABEND-CODE = HLD-RETURN-CD + 900
              PERFORM Z9999-ABEND-PGM
                 THRU Z9999-EXIT
           END-IF.
      *
       B-170-EXIT.
           EXIT.
      *
       B-180-LOAD-VALUE-TABLES.
      *
           MOVE SPACE                    TO INVALID-MCEDFILE-SW.
           MOVE 'R'                      TO BAS10004-CALL-TYPE.
           MOVE SPACES                   TO MC-VV-KEY.
           MOVE 'V'                      TO MC-REC-KEY-ID.
           MOVE 'MFP'                    TO MC-VV-TYPE.
           MOVE MC-VV-KEY                TO BAS10004-MCEDFILE-READ-KEY.
           PERFORM Z9996-CALL-BAS10004
              THRU Z9996-EXIT.
           IF NOT BAS10004-RC-NORMAL
              MOVE 'Y'                   TO INVALID-MCEDFILE-SW
              DISPLAY 'NO MOTOR FUEL PRODUCT RECORD ON MCEDFILE.'
           ELSE
              MOVE MC-VV-MFP-DATA        TO KIT-MOTOR-FUEL-PROD-CODES
           END-IF.
      *
           MOVE SPACE                    TO INVALID-MCEDFILE-SW.
           MOVE 'R'                      TO BAS10004-CALL-TYPE.
           MOVE SPACES                   TO MC-VV-KEY.
           MOVE 'V'                      TO MC-REC-KEY-ID.
           MOVE 'OIL'                    TO MC-VV-TYPE.
           MOVE MC-VV-KEY                TO BAS10004-MCEDFILE-READ-KEY.
           PERFORM Z9996-CALL-BAS10004
              THRU Z9996-EXIT.
           IF NOT BAS10004-RC-NORMAL
              MOVE 'Y'                   TO INVALID-MCEDFILE-SW
              DISPLAY 'NO OIL COMPANY CODES RECORD ON MCEDFILE.'
           ELSE
              MOVE MC-VV-OIL-DATA        TO KIT-OIL-COMPANY-CODES
           END-IF.
      *
           MOVE SPACE                    TO INVALID-MCEDFILE-SW.
           MOVE 'R'                      TO BAS10004-CALL-TYPE.
           MOVE SPACES                   TO MC-VV-KEY.
           MOVE 'V'                      TO MC-REC-KEY-ID.
           MOVE 'PRD'                    TO MC-VV-TYPE.
           MOVE MC-VV-KEY                TO BAS10004-MCEDFILE-READ-KEY.
           PERFORM Z9996-CALL-BAS10004
              THRU Z9996-EXIT.
           IF NOT BAS10004-RC-NORMAL
              MOVE 'Y'                   TO INVALID-MCEDFILE-SW
              DISPLAY 'NO PRODUCT CODES RECORD ON MCEDFILE.'
           ELSE
              MOVE MC-VV-PRD-DATA        TO KIT-PRODUCT-CODES
           END-IF.
      *
           MOVE SPACE                    TO INVALID-MCEDFILE-SW.        02.95
           MOVE 'S'                      TO BAS10004-CALL-TYPE.         02.95
           MOVE LOW-VALUES               TO MC-VV-KEY.                  02.95
           MOVE 'V'                      TO MC-REC-KEY-ID.              02.95
           MOVE 'LTA'                    TO MC-VV-TYPE.                 02.95
           MOVE MC-VV-KEY                TO BAS10004-MCEDFILE-READ-KEY. 02.95
           PERFORM Z9996-CALL-BAS10004                                  02.95
              THRU Z9996-EXIT.                                          02.95
           IF BAS10004-RC-ERROR                                         02.95
              MOVE 'Y'                   TO INVALID-MCEDFILE-SW         02.95
              DISPLAY 'BAD LARGE TICKET START ON MCEDFILE.'             02.95
              GO TO B-180-LOAD-LTA-ERROR                                02.95
           END-IF.                                                      02.95
      *                                                                 02.95
           MOVE +0                       TO KIT-LTA-CNT.                02.95
           MOVE 'N'                      TO BAS10004-CALL-TYPE.         02.95
      *                                                                 02.95
           PERFORM                                                      02.95
              VARYING WS-SUB1 FROM +1 BY +1                             02.95
              UNTIL   WS-SUB1 > KIT-LTA-MAX OR                          02.95
                     (NOT BAS10004-RC-NORMAL)                           02.95
                IF MC-REC-KEY-ID = 'V' AND                              02.95
                   MC-VV-TYPE = 'LTA'                                   02.95
                      COMPUTE KIT-LTA-CNT = KIT-LTA-CNT + 1             02.95
                      MOVE MC-VV-LK-ACCEPT-BRAND                        02.95
                                         TO KIT-LE-ACCEPT-BRAND(WS-SUB1)02.95
                      MOVE MC-VV-LK-BSA  TO KIT-LE-BSA(WS-SUB1)         02.95
                      MOVE MC-VV-LK-IRD  TO KIT-LE-IRD(WS-SUB1)         02.95
                      MOVE MC-VV-LTA-AMOUNT                             02.95
                                         TO KIT-LE-AMT(WS-SUB1)         02.95
                      PERFORM Z9996-CALL-BAS10004                       02.95
                         THRU Z9996-EXIT                                02.95
                      IF BAS10004-RC-ERROR                              02.95
                         DISPLAY 'READ ERROR LARGE TICKET ON MCEDFILE.' 02.95
                         MOVE 'Y'        TO INVALID-MCEDFILE-SW         02.95
                         GO TO B-180-LOAD-LTA-ERROR                     02.95
                      END-IF                                            02.95
                      IF NOT BAS10004-RC-NORMAL                         02.95
                         DISPLAY 'LARGE TICKET NOT FOUND ON MCEDFILE.'  02.95
                         MOVE 'Y'           TO INVALID-MCEDFILE-SW      02.95
                         GO TO B-180-LOAD-LTA-ERROR                     02.95
                      END-IF                                            02.95
                ELSE                                                    02.95
                   COMPUTE WS-SUB1 = KIT-LTA-MAX                        02.95
                END-IF                                                  02.95
           END-PERFORM.                                                 02.95
      *                                                                 02.95
           IF KIT-LTA-CNT = +0                                          02.95
              DISPLAY 'NO LARGE TICKET AMOUNT RECORDS ON MCEDFILE.'.    02.95
      *                                                                 02.95
       B-180-LOAD-LTA-ERROR.                                            02.95
      *                                                                 02.95
           IF INVALID-MCEDFILE-SW = 'Y'                                 02.95
              DISPLAY '    MCEDFILE KEY ' MC-VV-KEY                     02.95
              MOVE 54                    TO HLD-RETURN-CD               02.95
              COMPUTE ABEND-CODE = HLD-RETURN-CD + 900                  02.95
              PERFORM Z9999-ABEND-PGM                                   02.95
                 THRU Z9999-EXIT                                        02.95
           END-IF.                                                      02.95
      *                                                                 02.95
       B-180-EXIT.
           EXIT.
      *
       B-190-LOAD-AUTO-PLAN-TABLE.
      *
           MOVE HIGH-VALUES              TO WS-AUTO-PLAN-TABLE.         02.38
           PERFORM                                                      02.38
             VARYING WS-APW-SUB FROM +1 BY +1                           02.38
             UNTIL   WS-APW-SUB > WS-APW-MAX-FEPLN-RECS OR              02.38
                     FEPLN-EOF                                          02.38
               READ AUTO-PLAN-FILE INTO FPG-PLAN-RECORD                 02.38
                 AT END                                                 02.38
                    MOVE 'Y'             TO FEPLN-EOF-SW                02.38
                 NOT AT END                                             02.38
                    MOVE FPG-PLAN-TABLE  TO WS-APT-RECORD(WS-APW-SUB)   02.38
                    COMPUTE WS-APW-NO-ENTRIES = WS-APW-NO-ENTRIES       02.38
                                              + FPG-NO-ENTRIES          02.38
               END-READ                                                 02.38
           END-PERFORM.                                                 02.38
           IF NOT FEPLN-EOF                                             02.38
              IF WS-APW-SUB > WS-APW-MAX-FEPLN-RECS                     02.38
                 DISPLAY '*** MAX FEPLN RECORDS EXCEDED ***'            02.38
              END-IF                                                    02.38
           END-IF.                                                      02.38
           MOVE WS-APW-NO-ENTRIES        TO DISPLAY-COUNT.              02.38
           DISPLAY 'FEPLN PLAN ENTRIES = ' DISPLAY-COUNT.               02.38
      *
       B-190-EXIT.
           EXIT.
      *
       B-200-LOAD-INTCHG-TABLES.                                        02.51
      *                                                                 02.51
           MOVE 'N'                      TO WS-FOUND-SW.                02.51
      *                                                                 02.51
           READ INTCHG-RATES INTO IRR-INTERCHANGE-RATES-RECORD          02.51
             AT END                                                     02.51
                MOVE 'Y'                 TO INTCHG-RATES-EOF-SW         02.51
             NOT AT END                                                 02.51
                ADD +1                   TO INTCHG-RATES-CNT            02.51
           END-READ.                                                    02.51
      *                                                                 02.51
           IF INTCHG-RATES-EOF                                          02.51
              GO TO B-200-EXIT.                                         02.51
      *                                                                 02.51
           MOVE IRR-PLAN-X               TO MPM-PLAN-CODE.              02.77
           IF MPM-PACKAGE-PLAN OR                                       02.77
              MPM-NON-SETL OR                                           02.77
              MPM-PIN-DBT OR                                            02.77
              MPM-EBT                                                   02.77
                 GO TO B-200-EXIT                                       02.51
           END-IF.                                                      02.51
      *                                                                 02.51
           IF MPM-PIN-DBT-PLAN                                          02.92
              PERFORM                                                   02.51
                VARYING SUB1 FROM +1 BY +1                              02.51
                UNTIL   SUB1 > PDN-RT-MAX                               02.51
                  IF PDN-RTE-PLN-X(SUB1) = MPM-PLAN-CODE                02.77
                     MOVE IRR-PERCENT-PCT                               02.51
                                         TO PDN-RTE-PCT(SUB1)           02.51
                     MOVE IRR-PER-ITEM   TO PDN-RTE-ITM(SUB1)           02.51
                     MOVE IRR-MIN        TO PDN-RTE-MIN(SUB1)           02.51
                     MOVE IRR-MAX        TO PDN-RTE-MAX(SUB1)           02.51
                     MOVE 'Y'            TO WS-FOUND-SW                 02.51
                     COMPUTE SUB1 = PDN-RT-MAX                          02.51
                     ADD +1              TO PU-CTR                      02.51
                  END-IF                                                02.51
              END-PERFORM                                               02.51
           END-IF.                                                      02.51
      *                                                                 02.51
           IF WS-FOUND                                                  02.51
              GO TO B-200-EXIT                                          02.51
           END-IF.                                                      02.51
      *                                                                 02.51
           IF MPM-VISA-ANY                                              02.77
              PERFORM                                                   02.51
                VARYING SUB1 FROM +1 BY +1                              02.51
                UNTIL   SUB1 > VU-RT-MAX                                02.51
                  IF VU-RTE-PLN-X(SUB1) = MPM-PLAN-CODE                 02.77
                     MOVE IRR-PERCENT-PCT                               02.51
                                         TO VU-RTE-PCT(SUB1)            02.51
                     MOVE IRR-PER-ITEM   TO VU-RTE-ITM(SUB1)            02.51
                     MOVE IRR-MAX        TO VU-RTE-MAX(SUB1)            02.51
                     MOVE 'Y'            TO WS-FOUND-SW                 02.51
                     COMPUTE SUB1 = VU-RT-MAX                           02.51
                     ADD +1              TO VU-CTR                      02.51
                  END-IF                                                02.51
              END-PERFORM                                               02.51
              IF MPM-DEFAULT-PLAN OR                                    02.77
                (NOT WS-FOUND)                                          02.51
                 PERFORM                                                02.51
                   VARYING SUB1 FROM +1 BY +1                           02.51
                   UNTIL   SUB1 > VI-RT-MAX                             02.51
                     IF VI-RTE-PLN-X(SUB1) = MPM-PLAN-CODE              02.77
                        MOVE IRR-PERCENT-PCT                            02.51
                                         TO VI-RTE-PCT(SUB1)            02.51
                        MOVE IRR-PER-ITEM                               02.51
                                         TO VI-RTE-ITM(SUB1)            02.51
                        MOVE IRR-MAX     TO VI-RTE-MAX(SUB1)            02.51
                        MOVE 'Y'         TO WS-FOUND-SW                 02.51
                        COMPUTE SUB1 = VI-RT-MAX                        02.51
                        ADD +1              TO VI-CTR                   02.51
                     END-IF                                             02.51
                 END-PERFORM                                            02.51
              END-IF                                                    02.51
           END-IF.                                                      02.51
      *                                                                 02.51
           IF WS-FOUND                                                  02.51
              GO TO B-200-EXIT                                          02.51
           END-IF.                                                      02.51
      *                                                                 02.51
           IF MPM-MASTERCARD-ANY                                        02.77
              PERFORM                                                   02.51
                VARYING SUB1 FROM +1 BY +1                              02.51
                UNTIL   SUB1 > MU-RT-MAX                                02.51
                  IF MU-RTE-PLN-X(SUB1) = MPM-PLAN-CODE                 02.77
                     MOVE IRR-PERCENT-PCT                               02.51
                                         TO MU-RTE-PCT(SUB1)            02.51
                     MOVE IRR-PER-ITEM   TO MU-RTE-ITM(SUB1)            02.51
                     MOVE IRR-MAX        TO MU-RTE-MAX(SUB1)            02.51
                     MOVE 'Y'            TO WS-FOUND-SW                 02.51
                     COMPUTE SUB1 = MU-RT-MAX                           02.51
                     ADD +1              TO MU-CTR                      02.51
                  END-IF                                                02.51
              END-PERFORM                                               02.51
              IF MPM-DEFAULT-PLAN OR                                    02.77
                (NOT WS-FOUND)                                          02.51
                 PERFORM                                                02.51
                   VARYING SUB1 FROM +1 BY +1                           02.51
                   UNTIL   SUB1 > MI-RT-MAX                             02.51
                     IF MI-RTE-PLN-X(SUB1) = MPM-PLAN-CODE              02.77
                        MOVE IRR-PERCENT-PCT                            02.51
                                         TO MI-RTE-PCT(SUB1)            02.51
                        MOVE IRR-PER-ITEM                               02.51
                                         TO MI-RTE-ITM(SUB1)            02.51
                        MOVE IRR-MAX     TO MI-RTE-MAX(SUB1)            02.51
                        MOVE 'Y'         TO WS-FOUND-SW                 02.51
                        COMPUTE SUB1 = MI-RT-MAX                        02.51
                        ADD +1              TO MI-CTR                   02.51
                     END-IF                                             02.51
                 END-PERFORM                                            02.51
              END-IF                                                    02.51
           END-IF.                                                      02.51
      *                                                                 02.51
           IF WS-FOUND                                                  02.51
              GO TO B-200-EXIT                                          02.51
           END-IF.                                                      02.51
      *                                                                 02.51
           IF MPM-DISCOVER OR MPM-PAYPAL                                03.47
              PERFORM                                                   02.51
                VARYING SUB1 FROM +1 BY +1                              02.51
                UNTIL   SUB1 > DU-RT-MAX                                02.51
                  IF DU-RTE-PLN-X(SUB1) = MPM-PLAN-CODE                 02.77
                     MOVE IRR-PERCENT-PCT                               02.51
                                         TO DU-RTE-PCT(SUB1)            02.51
                     MOVE IRR-PER-ITEM   TO DU-RTE-ITM(SUB1)            02.51
                     MOVE IRR-MAX        TO DU-RTE-MAX(SUB1)            02.51
                     MOVE 'Y'            TO WS-FOUND-SW                 02.51
                     COMPUTE SUB1 = DU-RT-MAX                           02.51
                     ADD +1              TO DU-CTR                      02.51
                  END-IF                                                02.51
              END-PERFORM                                               02.51
           END-IF.                                                      02.51
      *                                                                 02.51
           IF WS-FOUND                                                  02.51
              GO TO B-200-EXIT                                          02.51
           END-IF.                                                      02.51
      *                                                                 02.51
           IF MPM-AMEX AND NOT MPM-AMEX-EAP                             03.16A
              PERFORM                                                   02.51
                VARYING SUB1 FROM +1 BY +1                              02.51
                UNTIL   SUB1 > AU-RT-MAX                                02.51
                  IF AU-RTE-PLN-X(SUB1) = MPM-PLAN-CODE                 02.77
                     MOVE IRR-PERCENT-PCT                               02.51
                                         TO AU-RTE-PCT(SUB1)            02.51
                     MOVE IRR-PER-ITEM   TO AU-RTE-ITM(SUB1)            02.51
                     MOVE IRR-MAX        TO AU-RTE-MAX(SUB1)            02.51
                     MOVE 'Y'            TO WS-FOUND-SW                 02.51
                     COMPUTE SUB1 = AU-RT-MAX                           02.51
                     ADD +1              TO AU-CTR                      02.51
                  END-IF                                                02.51
              END-PERFORM                                               02.51
           END-IF.                                                      02.51
      *                                                                 03.16A
           IF MPM-AMEX-EAP                                              03.16A
              PERFORM                                                   03.16A
                VARYING SUB1 FROM +1 BY +1                              03.16A
                UNTIL   SUB1 > AE-RT-MAX                                03.16A
                  IF AE-RTE-PLN-X(SUB1) = MPM-PLAN-CODE                 03.16A
                     MOVE IRR-PERCENT-PCT                               03.16A
                                         TO AE-RTE-PCT(SUB1)            03.16A
                     MOVE IRR-PER-ITEM   TO AE-RTE-ITM(SUB1)            03.16A
                     MOVE IRR-MAX        TO AE-RTE-MAX(SUB1)            03.16A
                     MOVE 'Y'            TO WS-FOUND-SW                 03.16A
                     COMPUTE SUB1 = AE-RT-MAX                           03.16A
                     ADD +1              TO AE-CTR                      03.16A
                  END-IF                                                03.16A
              END-PERFORM                                               03.16A
           END-IF.                                                      03.16A
      *                                                                 02.51
           IF NOT WS-FOUND                                              02.51
              ADD +1                     TO NOT-FND-CTR                 02.51
              DISPLAY ' BAC00110 - MPMS PLAN CODE '                     02.77
                        MPM-PLAN-CODE                                   02.77
                      ' NOT FOUND.'                                     02.51
           END-IF.                                                      02.51
      *                                                                 02.51
       B-200-EXIT.                                                      02.51
           EXIT.                                                        02.51
      *                                                                 02.51
029820 B-300-ZERO-TABLES.
029830     PERFORM S-860-ZERO-TC-TABLES
029840        THRU S-860-EXIT.
029850*
029860 B-300-EXIT.
029870     EXIT.
029880*
029890 B-400-LOAD-TC-TABLES.
029900     MOVE SPACES                 TO VISA-NOTONUS-TOTS             03.47
029930                                    MC-NOTONUS-TOTS
029930                                    AMEX-NOTONUS-TOTS
029930                                    DISC-NOTONUS-TOTS
029930                                    PP-NOTONUS-TOTS               03.47
029950                                    TRANSCODE-MERCHANT-TOTS.
029960*
           IF PARM-IS-1-SIDED                                           03.31
              MOVE '12  '              TO VISA-NOU-TC(1)                03.47
              MOVE '14  '              TO VISA-NOU-TC (2)               03.47
              MOVE '13  '              TO VISA-NOU-TC (3)               03.47
              MOVE '28  '              TO TC-MRCH-TRANS (1)             03.31
              MOVE '    '              TO TC-MRCH-TRANS (2)             03.31
              MOVE '    '              TO TC-MRCH-TRANS (3)             03.31
              MOVE '    '              TO TC-MRCH-TRANS (4)             03.31
           ELSE                                                         03.31
              MOVE '0O  '              TO VISA-NOU-TC (1)               03.47
              MOVE '06  '              TO VISA-NOU-TC (2)               03.47
              MOVE '07  '              TO VISA-NOU-TC (3)               03.47
              MOVE '30  '              TO TC-MRCH-TRANS (1)             03.31
              MOVE '31  '              TO TC-MRCH-TRANS (2)             03.31
              MOVE '32  '              TO TC-MRCH-TRANS (3)             03.31
              MOVE '58  '              TO TC-MRCH-TRANS (4)             03.31
           END-IF.                                                      03.31
           MOVE VISA-NOU-TC (1)        TO                               03.34
030000                                    MC-NOU-TC (1)
030000                                    AMEX-NOU-TC (1)
030000                                    DISC-NOU-TC (1)
030000                                    PP-NOU-TC (1)                 03.47
030000                                    PL-NOU-TC (1).                03.47
           MOVE VISA-NOU-TC (2)        TO                               03.34
030050                                    MC-NOU-TC (2)
030050                                    AMEX-NOU-TC (2)
030050                                    DISC-NOU-TC (2)
030000                                    PP-NOU-TC (2)                 03.47
030050                                    PL-NOU-TC (2).                03.47
           MOVE VISA-NOU-TC (3)        TO                               03.34
030100                                    MC-NOU-TC (3)
030100                                    AMEX-NOU-TC (3)
030100                                    DISC-NOU-TC (3)
030000                                    PP-NOU-TC (3)                 03.47
030100                                    PL-NOU-TC (3).                03.47
030120*
030180 B-400-EXIT.
030190     EXIT.
030910*
030920 C-100-PROCESS.
030930     IF ER-INDX IS GREATER THAN MAX-ERR-CNT
030940         DISPLAY '***** ABORT BANKCARD EDIT *****'
030950         DISPLAY 'C-100-PROCESS'
030960         DISPLAY 'ERROR CODE TABLE EXCEEDS MAX-ERR-CNT'
030970         SET UNPACK-CTR TO ER-INDX
030980         DISPLAY  UNPACK-CTR '  ERRORS FOR TRANS ' MR1-TRANSCODE
030990         MOVE 25 TO HLD-RETURN-CD
031000         COMPUTE ABEND-CODE  = HLD-RETURN-CD + 900
031010         PERFORM  Z9999-ABEND-PGM
031020            THRU  Z9999-EXIT.
031030     SET ER-INDX TO 1.
031040     MOVE ZEROS TO ERROR-CODE-HOLD-TABLE.
031050     MOVE ZEROS TO ADD-ERR-CODE-TABLE.
031060     IF BATCH-BYPASSED
031070         GO TO C-100-VALIDATE-TRANSCODE.
031100     PERFORM S-010-READ-TRANS-IN
031110        THRU S-010-EXIT.
031160     IF END-OF-INPUT
031170         GO TO C-100-EXIT.
031180*
031190 C-100-VALIDATE-TRANSCODE.
031200     SET VAL-INDX       TO 1.
031210     SEARCH     VAL-TRANSCODE
031220         VARYING VAL-INDX
031230         AT END
031240            GO TO C-100-TRAN-NOT-VALID
031250         WHEN VAL-TC-TC (VAL-INDX) = MR1-TRANSCODE
031260             NEXT SENTENCE.
031270     GO TO C-100-HDR-CHECK.
031280 C-100-TRAN-NOT-VALID.
031290     MOVE 70                       TO ER-CD (ER-INDX).
031300     ADD 1                         TO INVALID-TRANS-CTR.
031310     MOVE 'Y'                      TO BATCH-REJ-SW.
031320     PERFORM S-990-PRINT-INVALID-TRANS
031330        THRU S-990-EXIT.
031340     GO TO C-100-EXIT.
031350 C-100-HDR-CHECK.
031360     IF FIRST-REC-SW EQUAL 'Y'
031370         NEXT SENTENCE
031380     ELSE
031390         GO TO C-100-TC-CHECK.
031400*
031410     MOVE 'N' TO FIRST-REC-SW.
           MOVE MIBH-CURR-CODE           TO BAL-REC-CURR-CODE.          02.88
           IF MR1-VALID-BATCH                                           03.31
031430         PERFORM C-200-EDIT-BATCH-HDR
031440            THRU C-200-EXIT
031450         GO TO C-100-EXIT.
031460*
031470*   IF TRANS CODE FAILS ABOVE TESTS, FIRST RECORD IN
031480*     TRANSMISSION IS NOT A VALID BATCH HEADER
031490*
           ADD 1                         TO WS-HRI-SEQ-NUM.             02.88
031500     MOVE 91 TO ER-CD (ER-INDX).
031510     MOVE SPACE TO  HL1-INST-NAME
031520                    HL2-INST-NAME.
031530     MOVE ZEROS TO  HL1-INST-NBR.
031540     PERFORM S-900-BYPASS-BATCH
031550        THRU S-900-EXIT.
031560     GO TO C-100-EXIT.
031570*
031580 C-100-TC-CHECK.
031590*
031600*   CHECK FOR BATCH HEADERS
031610*
           IF MR1-VALID-BATCH                                           03.31
              IF MIBH-CURR-CODE NOT = BAL-REC-CURR-CODE                 02.64
                 PERFORM C-780-WRITE-BAL-REC-OUTPUT                     02.64
                    THRU C-780-EXIT                                     02.64
                 MOVE MIBH-CURR-CODE     TO BAL-REC-CURR-CODE           02.64
              END-IF                                                    02.64
031630         PERFORM R-500-BATCH-BREAK
031640            THRU R-500-EXIT
               MOVE ZEROS                TO ERROR-CODE-HOLD-TABLE       03.11F
031650         PERFORM C-200-EDIT-BATCH-HDR
031660            THRU C-200-EXIT
031670         GO TO C-100-EXIT.
031680*
031690*   CHECK FOR GROUP HEADERS
031700*
           IF MR1-VALID-GROUP                                           03.31
031720         PERFORM C-300-EDIT-GR-SUM
031730            THRU C-300-EXIT
031740         GO TO C-100-EXIT.
031750*
031760 C-100-TC-MON-CHECK.
031770*
031780*   CHECK FOR MONETARY TRANS
031790*
           IF MR1-TC-PREF = '32' OR '58'
              PERFORM C-700-EDIT-MISC
                 THRU C-700-EXIT
              GO TO C-100-EXIT.
      *
031800     MOVE 'D'                      TO WS-CREDIT-OR-DEBIT.
           IF MR1-VALID-MONETARY
              PERFORM C-350-EDIT-MONETARY                               03.31
                 THRU C-350-EXIT                                        03.31
              PERFORM C-150-WRITE-DB-TRANS                              03.31
                 THRU C-150-EXIT                                        03.31
              GO TO C-100-EXIT                                          03.31
           END-IF.                                                      03.31
031860*
031870     DISPLAY '***** ABORT BANKCARD EDIT *****'.
031880     DISPLAY 'INVALID TRANSCODE ' MR1-TRANSCODE
031890         ' IN C-100-TC-MON-CHECK'.
031900     DISPLAY 'PROGRAM PROBLEM'.
031910     MOVE 35 TO HLD-RETURN-CD.
031920     COMPUTE ABEND-CODE  = HLD-RETURN-CD + 900
031930     PERFORM  Z9999-ABEND-PGM
031940        THRU  Z9999-EXIT.
031950 C-100-EXIT.
031960     EXIT.
      *
       C-150-WRITE-DB-TRANS.                                            02.88
           SET BASDTRAN-CT-INPUT         TO TRUE.                       02.88
           MOVE WORK-DATA                TO BASDTRAN-TD-PET.            02.88
           MOVE WORK-ERROR-CODES         TO ERROR-CODE-HOLD-TABLE.      02.88
           PERFORM S-090-LOAD-REJECT-ERRORS                             02.88
              THRU S-090-EXIT.                                          02.88
           MOVE ZEROS                    TO ERROR-CODE-HOLD-TABLE.      02.88
           MOVE WS-WORK-EXTRA-DATA       TO BASDTRAN-TD-EXTRA-DATA.     02.88
           IF MR1-VALID-MIS3-TRAN                                       03.31
              SET BASDTRAN-TD-400        TO TRUE                        02.88
              IF MIS3-CARD-TYPE = SPACES                                02.88
                 MOVE WS-MIS3-CARD-TYPE  TO MIS3-CARD-TYPE              02.88
              END-IF                                                    02.88
           ELSE                                                         02.88
              SET BASDTRAN-TD-100        TO TRUE                        02.88
              IF MIS1-CARD-TYPE = SPACES                                02.88
                 MOVE WS-MIS3-CARD-TYPE  TO MIS1-CARD-TYPE              02.88
              END-IF                                                    02.88
           END-IF.                                                      02.88
           MOVE SPACES                   TO BASDTRAN-CARD-TYPE.         03.09
           MOVE WS-MIS3-CARD-TYPE(1:1)   TO BASDTRAN-CARD-TYPE.         02.88
           IF WS-MIS3-CARD-TYPE (1:1) = 'A' OR 'D' OR 'Y'               03.47
               IF WS-MIS3-CARD-TYPE (1:1) = 'A' AND                     03.16A
                  WS-PLAN-CODE (3:2) = '54'                             03.16A
                   MOVE '3'              TO BASDTRAN-CARD-TYPE (2:1)    03.16A
               ELSE                                                     03.16A
               IF WS-MIS3-CARD-TYPE (1:1) = 'A'                         03.09
                   MOVE 'X'              TO BASDTRAN-CARD-TYPE (2:1)    03.09
               ELSE                                                     03.09
               IF WS-MIS3-CARD-TYPE (1:1) = 'D'                         03.47
                   MOVE 'S'              TO BASDTRAN-CARD-TYPE (2:1)    03.09
               ELSE                                                     03.47
               IF WS-MIS3-CARD-TYPE (1:1) = 'P'                         03.47
                   MOVE 'P'              TO BASDTRAN-CARD-TYPE (2:1)    03.47
               END-IF                                                   03.09
               END-IF                                                   03.16A
               END-IF                                                   03.47
               END-IF                                                   03.47
               EVALUATE WS-PLAN-CODE                                    03.08
                   WHEN 0104                                            03.08
                   WHEN 0105                                            03.47
                   WHEN 0106                                            03.47F
                       MOVE '1'       TO BASDTRAN-CARD-TYPE (2:1)       03.08
                   WHEN 0204                                            03.47
                   WHEN 0205                                            03.08
                       MOVE '2'       TO BASDTRAN-CARD-TYPE (2:1)       03.08
               END-EVALUATE                                             03.08
           END-IF.                                                      03.08
           IF VALID-MIS3-VISA-CARD-TYPE                                 02.88
              MOVE 'V '                   TO BASDTRAN-CARD-TYPE         03.09
           ELSE                                                         02.88
              IF VALID-MIS3-DB-CARD-TYPE                                02.88
                 MOVE 'P'                TO BASDTRAN-CARD-TYPE          02.88
              ELSE                                                      02.88
                 IF VALID-MIS3-PD-NET                                   02.88
                    MOVE 'N'             TO BASDTRAN-CARD-TYPE          02.88
                 END-IF                                                 02.88
              END-IF                                                    02.88
           END-IF.                                                      02.88
           PERFORM Z9TRN-CALL-BASDTRAN                                  02.88
              THRU Z9TRN-EXIT.                                          02.88
           IF ((GROUP-SUS-SW = 'Y') OR                                  03.08
                (GRP-REJ-SW = 'Y')) AND                                 03.08
                 BASDTRAN-RC-REJECT-CODES = SPACES                      03.08
               SET BASDTRAN-CT-REJECT    TO TRUE                        03.08
               SET BASDTRAN-TD-INDIVIDUAL                               03.08
                                         TO TRUE                        03.08
               PERFORM Z9TRN-CALL-BASDTRAN                              03.08
                  THRU Z9TRN-EXIT                                       03.08
           END-IF.                                                      03.08
       C-150-EXIT.                                                      02.88
           EXIT.                                                        02.88
      *                                                                 02.88
031970*
031980*   THIS MODULE EDITS THE BATCH HEADER, WRITES THE OUTPUT
031990*     BATCH HEADER RECORD, SETS UP NEW PAGE HEADINGS FOR
032000*     THE NEW BATCH, AND PRINTS A BATCH HEADER DETAIL LINE
032010*
032020 C-200-EDIT-BATCH-HDR.
032030     PERFORM S-860-ZERO-TC-TABLES
032040        THRU S-860-EXIT.
           MOVE ZERO                     TO WS-SAVE-BATCH-TYPE.
           MOVE ZERO                     TO RAD-ED-LINE-TYPE
                                            RAD-ED-REPORT-TYPE.
           MOVE SPACES                   TO WS-RWA-BATCH-SWITCHES
                                            WS-RWA-GROUP-SWITCHES
                                            WS-RWA-TRAN-SWITCHES.
032050     MOVE SPACE TO MON-BATCH-SW
032060                   HLD-SUM-TC.
032070     MOVE ZERO TO HLD-BANK-KEY.
           MOVE ZERO                     TO HLD-INT-SETL-GRP.           02.87
032080     MOVE ZERO TO INVALID-TRANS-CTR.
032090     MOVE ZEROS                    TO WS-BATCH-BIN.
032100     MOVE 'US'                     TO WS-BATCH-BIN-COUNTRY.
032110     MOVE '0'                      TO KDA-BATCH-BIN-REGION.
032110     MOVE 'V'                      TO WS-BATCH-BIN-TYPE.
032110     MOVE 'M'                      TO WS-BATCH-ICA-TYPE.
032120     MOVE ZEROS                    TO WS-BATCH-ICA.
032200     ADD 1 TO SUB-BTCH.
           MOVE MIBH-NON-SETTLE-CLEAR    TO WS-NON-SETTLE-CLEAR.        02.91
           MOVE MIBH-BATCH-NMBR          TO SB-BATCH-NMBR.
           MOVE MIBH-AMOUNT              TO SB-BATCH-AMT.               02.73
032210     MOVE ZEROS                    TO HLD-BTCH-NMBR.
032220     MOVE 'Y' TO MON-BATCH-SW.
032230*
032240     MOVE MR1-TRANSCODE TO HLD-HDR-TC.
032250*
032260 C-200-EDIT-BANK-NMBR.
           IF MIBH-BANK-KEY  NUMERIC AND MIBH-BANK-KEY NOT = ZERO       02.73
              MOVE MIBH-BANK-KEY-NUM     TO HLD-BANK-KEY                02.73
                                            BASCRATE-SD-BANK-KEY        02.73
                                            MIBH-BN-FIRST-6             02.73
              MOVE '00'                  TO MIBH-BANK-NMBR (7:2)        02.73
              MOVE MIBH-BANK-NMBR        TO HLD-BANK-NMBR               02.73
           ELSE                                                         02.73
              IF MIBH-BANK-NMBR NUMERIC                                 02.73
                 MOVE MIBH-BN-FIRST-6    TO HLD-BANK-KEY                02.73
                                            BASCRATE-SD-BANK-KEY        02.73
                                            MIBH-BANK-KEY-NUM           02.73
                 MOVE MIBH-BANK-NMBR     TO HLD-BANK-NMBR               02.73
              ELSE                                                      02.73
                 MOVE 92                 TO ER-CD(ER-INDX)              02.73
                 SET ER-INDX UP BY 1                                    02.73
                 MOVE MIBH-BANK-KEY-NUM  TO HLD-BANK-KEY                02.73
                                            BASCRATE-SD-BANK-KEY        02.73
                                            MIBH-BN-FIRST-6             02.73
                 MOVE '00'               TO MIBH-BANK-NMBR (7:2)        02.73
                 MOVE +2                 TO BASCRATE-SD-BATCH-CURR-DEC  02.73
                 MOVE 'Y'                TO CRITICAL-BATCH-REJ-SW       02.73
                 GO TO C-200-REF-PREFIX-SET                             02.73
              END-IF                                                    02.73
           END-IF.                                                      02.73
      *

           IF HLD-BANK-KEY = BE-BCTRL-KEY
              GO TO C-200-SET-VISA-PREFIX.
      *
           MOVE HLD-BANK-KEY             TO FEICF-KEY.
           INITIALIZE BANKCTRL-EDIT-INFO.                               02.73
           PERFORM Z-800-READ-FEICF
              THRU Z-800-EXIT.
           IF FEICF-BYTES NOT = '00'
              MOVE 93 TO ER-CD(ER-INDX)
              SET ER-INDX UP BY 1                                       02.73
              MOVE HLD-BANK-KEY          TO HL1-INST-NBR
              MOVE 'Y'                   TO CRITICAL-BATCH-REJ-SW       02.73
              GO TO C-200-REF-PREFIX-SET.                               02.73
      *
           PERFORM S-600-LOAD-BANK-TABLE
              THRU S-600-EXIT.
      *                                                                 02.23
           IF HLD-BANK-KEY-X NOT = PPA-KEY-INST-ASSN-X                  02.23
              MOVE HLD-BANK-KEY-X        TO PPA-KEY-INST-ASSN-X         02.23
              COMPUTE PPA-PKG-CNT = +0                                  02.23
              MOVE HIGH-VALUES           TO PPA-PLAN-PKG-TABLE          02.23
              PERFORM                                                   02.23
                VARYING WS-SUB1 FROM +1 BY +1                           02.23
                UNTIL   WS-SUB1 > +8                                    02.23
                  MOVE PPA-KEY-INST-ASSN-X                              02.23
                                         TO FEPKG-KEY-INST-ASSN-X       02.23
                  COMPUTE FEPKG-KEY-SEQ = WS-SUB1 - 1                   02.23
                  READ FEPKG-FILE                                       02.23
                  IF FEPKG-BYTES = '00'                                 02.23
                     MOVE FEPKG-REC-MAX  TO FRONT-END-PACKAGE-RECORD    02.23
                     COMPUTE PPA-PKG-CNT = PPA-PKG-CNT + FEP-PKG-CNT    02.23
                     IF FEP-PKG-CNT = +4000                             02.23
                        MOVE FEP-PLAN-PKG-TABLE                         02.23
                                         TO PPA-PPT-PT-DATA(WS-SUB1)    02.23
                     ELSE                                               02.23
                        COMPUTE WS-LGTH = FEP-PKG-CNT * +4              02.23
                        MOVE FEP-PLAN-PKG-TABLE(1:WS-LGTH)              02.23
                                TO PPA-PPT-PT-DATA(WS-SUB1)(1:WS-LGTH)  02.23
                        COMPUTE WS-SUB1 = +8                            02.23
                  ELSE                                                  02.23
                     COMPUTE WS-SUB1 = +8                               02.23
                  END-IF                                                02.23
              END-PERFORM                                               02.23
           END-IF.                                                      02.23
      *
           MOVE SPACES                   TO WS-PEM-NOTONUS-FLAGS.
           IF BE-CF-VS-SETL = 'Y'
              MOVE 'S'                   TO WS-PEM-NF-VISA.             03.27
           IF BE-CF-MC-SETL = 'Y'
              MOVE 'S'                   TO WS-PEM-NF-MC.               02.41
           IF BE-CF-AX-SETL = 'Y'
              MOVE 'S'                   TO WS-PEM-NF-AMEX.
           IF BE-CF-DS-SETL = 'Y'
              MOVE 'S'                   TO WS-PEM-NF-DISC              03.47
                                            WS-PEM-NF-PP.               03.47
           MOVE WS-PEM-NOTONUS-FLAGS     TO WS-SAVE-PEM-NOTONUS-FLAGS.
032600     MOVE BE-ICA-NMBR              TO HLD-ICA-NMBR.
           PERFORM S-870-VALID-ICA                                      02.41
              THRU S-870-EXIT.                                          02.41
           IF EFR-ICA-CD NOT = HLD-ICA-NMBR                             02.41
              MOVE 'Y'                   TO BAS10002-INVALID-ICA-SW.    02.41
           IF BAS10002-INVALID-ICA-SW = 'Y'                             02.23
032660        MOVE 'Y'                   TO  VALID-BATCH-ICA-SW
032670     ELSE
032680        MOVE 'N'                   TO  VALID-BATCH-ICA-SW.
           MOVE BE-INT-SETL-GRP          TO HOLD-MRCH-INT-SETL-GRP
                                            HOLD-VISA-INT-SETL-GRP
                                            HLD-INT-SETL-GRP            02.87
                                            HOLD-AX-INT-SETL-GRP        02.29
                                            HOLD-AX-INT-SETL-GRP-NS     03.61
                                            HOLD-DS-INT-SETL-GRP        02.29
                                            HOLD-MC-INT-SETL-GRP.
      *
       C-200-SET-VISA-PREFIX.
      *
032750     MOVE BE-REF-NMBR-PREFIX       TO WSBK-BIN.
032760     IF WSBK-BIN = 400000
032770        GO TO C-200-SET-MC-PREFIX.
032780     IF WSBK-BIN-X(1:1) = '4'
032790        PERFORM S-620-READ-BIN
032800           THRU S-620-EXIT
              IF BAS10002-EFR-GOOD                                      02.23
                 MOVE SPACES             TO EDIT-FILE-REC               02.23
                 MOVE 'O'                TO EFR-REC-KEY-ID              02.23
                 MOVE 'VR'               TO EFR-OWNER-TYPE              02.23
                 MOVE BE-REF-NMBR-PREFIX TO EFR-OWNER-VISA-BIN          02.23
                 PERFORM Z-900-READ-EFR                                 02.23
                    THRU Z-900-EXIT                                     02.23
                 IF BAS10002-EFR-GOOD                                   02.23
                    MOVE EFR-OWNER-INST  TO HOLD-VISA-INT-SETL-GRP      02.23
                 END-IF                                                 02.23
              ELSE                                                      02.23
                 MOVE 74                 TO ER-CD(ER-INDX)              02.23
                 SET ER-INDX UP BY 1                                    02.23
                 MOVE 'Y'                TO BATCH-REJ-SW                02.23
                                            INVALID-REF-SW              02.23
              END-IF                                                    02.23
           END-IF.                                                      02.23
032890*
032950 C-200-SET-MC-PREFIX.
032960     IF BE-MC-REF-PREFIX = ZEROS
032970        GO TO C-200-SET-AMEX-PREFIX.                              03.00
032980     MOVE BE-MC-REF-PREFIX         TO WSBK-MC-REF.
032760     IF WSBK-BIN = 500000
032970        GO TO C-200-SET-AMEX-PREFIX.                              03.00
           MOVE WSBK-BIN-X               TO WS-MC-REF-NO-PREFIX         02.41
                                            WS-MC-LAST-BIN-ID.
           PERFORM S-880-VALID-MC-REF-PREFIX                            02.41
              THRU S-880-EXIT.                                          02.41
           IF BAS10002-INVALID-PRE-SW = 'Y'                             02.23
033040        GO TO C-200-SET-AMEX-PREFIX.                              03.00
           IF EFR-MCB-ACQ-SW = 'I' OR 'P'                               02.41
033040        GO TO C-200-SET-AMEX-PREFIX.                              03.00
           PERFORM S-540-LOAD-MC-ACQ-TABLE
              THRU S-540-EXIT.
005880     MOVE 'M'                       TO WS-BATCH-ICA-TYPE.
           MOVE EFR-MCB-ICA              TO WS-BATCH-ICA.               02.41
           MOVE EFR-MCB-IEI-QUAL         TO KDA-MC-INT-IEI-ACQ-SW.      02.41
           MOVE EFR-MCB-ELEC-CARD-IND    TO KDA-MC-ELEC-CARD-IND.       02.41
           MOVE EFR-MCB-ATM-SW           TO KDA-MC-ATM-ACQ-SW.          02.41
           MOVE EFR-MCB-COUNTRIES        TO WS-BATCH-ICA-COUNTRIES.     02.41
           MOVE EFR-MCB-REGIONS          TO WS-BATCH-ICA-REGIONS.       02.41
           MOVE SPACES                   TO EDIT-FILE-REC.
           MOVE 'O'                      TO EFR-REC-KEY-ID.
           MOVE 'MR'                     TO EFR-OWNER-TYPE.
           MOVE BE-MC-REF-PREFIX         TO EFR-OWNER-MC-BIN.
           PERFORM Z-900-READ-EFR THRU Z-900-EXIT.
           IF BAS10002-EFR-GOOD                                         02.23
              MOVE EFR-OWNER-INST        TO HOLD-MC-INT-SETL-GRP.       02.41
      *
       C-200-SET-AMEX-PREFIX.                                           CPS
           IF BE-AMEX-ESA-SUBMITTER-ID = SPACES AND                     03.16A
              BE-AMEX-1PT-SUBMITTER-ID = SPACES AND                     03.16A
              BE-AMEX-EAP-SUBMITTER-ID = SPACES                         03.16A
                 MOVE 'R'                TO WS-BATCH-AMX-TYPE           02.29
           ELSE                                                         02.29
              IF BE-CF-AX-SETL = 'Y'                                    02.29
                 IF BE-AMEX-1PT-SUBMITTER-ID = SPACES AND               03.16A
                    BE-AMEX-EAP-SUBMITTER-ID = SPACES                   03.16A
                    MOVE 'N'             TO WS-BATCH-AMX-TYPE           02.29
                 ELSE                                                   02.29
                    IF BE-AMEX-ESA-SUBMITTER-ID = SPACES                03.16A
                       MOVE 'S'          TO WS-BATCH-AMX-TYPE           02.29
                    ELSE                                                02.29
                       MOVE 'B'          TO WS-BATCH-AMX-TYPE           02.29
                    END-IF                                              02.29
                 END-IF                                                 02.29
              ELSE                                                      02.29
                 IF BE-AMEX-ESA-SUBMITTER-ID = SPACES                   03.16A
                    MOVE 'R'             TO WS-BATCH-AMX-TYPE           02.29
                 ELSE                                                   02.29
                    MOVE 'N'             TO WS-BATCH-AMX-TYPE           02.29
                 END-IF                                                 02.29
              END-IF                                                    02.29
           END-IF.                                                      02.29
      *                                                                 02.29
           IF WS-BATCH-IS-AMX-REJECT                                    02.29
              GO TO C-200-SET-DISCOVER-PREFIX.                          02.29
           IF WS-BATCH-IS-AMX-SETL OR                                   02.29
              WS-BATCH-IS-AMX-BOTH                                      02.29
                 MOVE SPACES             TO EDIT-FILE-REC               02.29
                 MOVE 'O'                TO EFR-REC-KEY-ID              02.29
                 MOVE 'AX'               TO EFR-OWNER-TYPE              02.29
                 IF BE-AMEX-1PT-SUBMITTER-ID = SPACES                   03.16A
                    MOVE BE-AMEX-EAP-SUBMITTER-ID                       03.16A
                                         TO EFR-OWNER-AX-SUBMITTER      03.16A
                 ELSE                                                   03.16A
                    MOVE BE-AMEX-1PT-SUBMITTER-ID                       03.16A
                                         TO EFR-OWNER-AX-SUBMITTER      03.16A
                 END-IF                                                 03.16A
                 PERFORM Z-900-READ-EFR                                 02.29
                    THRU Z-900-EXIT                                     02.29
                 IF BAS10002-EFR-GOOD                                   02.29
                    MOVE EFR-OWNER-INST  TO HOLD-AX-INT-SETL-GRP        02.29
                 ELSE                                                   02.29
                    MOVE 'R'             TO WS-BATCH-AMX-TYPE           02.44
                 END-IF                                                 02.29
           END-IF.                                                      02.29
           IF WS-BATCH-IS-AMX-NON-SETL OR                               02.29
              WS-BATCH-IS-AMX-BOTH                                      02.29
                 MOVE SPACES             TO EDIT-FILE-REC               02.29
                 MOVE 'O'                TO EFR-REC-KEY-ID              02.29
                 MOVE 'AX'               TO EFR-OWNER-TYPE              02.29
                 MOVE BE-AMEX-ESA-SUBMITTER-ID                          03.16A
                                         TO EFR-OWNER-AX-SUBMITTER      02.29
                 PERFORM Z-900-READ-EFR                                 02.29
                    THRU Z-900-EXIT                                     02.29
                 IF BAS10002-EFR-GOOD                                   02.29
                    MOVE EFR-OWNER-INST  TO HOLD-AX-INT-SETL-GRP-NS     03.61
                 ELSE                                                   02.29
                    MOVE 'R'             TO WS-BATCH-AMX-TYPE           02.44
                 END-IF                                                 02.29
           END-IF.                                                      02.29
      *                                                                 02.29
       C-200-SET-DISCOVER-PREFIX.
           IF BE-DISCOVER-ACQUIRER-ID = ZEROS AND
              BE-DISCOVER-CLIENT-ID = ZEROS
                 MOVE 'R'                TO WS-BATCH-DIS-TYPE
           ELSE
              IF BE-CF-DS-SETL = 'Y'
                 IF BE-DISCOVER-ACQUIRER-ID = ZEROS
                    MOVE 'N'             TO WS-BATCH-DIS-TYPE
                 ELSE
                    IF BE-DISCOVER-CLIENT-ID = ZEROS
                       MOVE 'S'          TO WS-BATCH-DIS-TYPE
                    ELSE
                       MOVE 'B'          TO WS-BATCH-DIS-TYPE
                    END-IF
                 END-IF
              ELSE
                 MOVE 'N'                TO WS-BATCH-DIS-TYPE
              END-IF
           END-IF.
      *                                                                 03.38
           IF WS-BATCH-IS-DIS-REJECT
              GO TO C-200-REF-PREFIX-SET.
           IF WS-BATCH-IS-DIS-SETL OR
              WS-BATCH-IS-DIS-BOTH
                 IF BE-DISCOVER-ACQUIRER-ID = ZEROS
                    MOVE 'R'             TO WS-BATCH-DIS-TYPE
                 ELSE
                    MOVE SPACES          TO EDIT-FILE-REC
                    MOVE 'O'             TO EFR-REC-KEY-ID
                    MOVE 'DA'            TO EFR-OWNER-TYPE
                    MOVE BE-DISCOVER-ACQUIRER-ID
                                         TO EFR-OWNER-DS-ACQUIRER
                    PERFORM Z-900-READ-EFR
                       THRU Z-900-EXIT
                    IF BAS10002-EFR-GOOD                                02.23
                       MOVE EFR-OWNER-INST
                                         TO HOLD-DS-INT-SETL-GRP        02.29
                    ELSE
                       MOVE 'R'          TO WS-BATCH-DIS-TYPE
                    END-IF
                 END-IF
           END-IF.
           IF WS-BATCH-IS-DIS-NON-SETL OR
              WS-BATCH-IS-DIS-BOTH
                 IF BE-DISCOVER-CLIENT-ID = ZEROS
                    MOVE 'R'             TO WS-BATCH-DIS-TYPE
                 ELSE
                    MOVE SPACES          TO EDIT-FILE-REC
                    MOVE 'O'             TO EFR-REC-KEY-ID
                    MOVE 'DI'            TO EFR-OWNER-TYPE
                    MOVE BE-DISCOVER-CLIENT-ID
                                         TO EFR-OWNER-DS-ID
                    PERFORM Z-900-READ-EFR
                       THRU Z-900-EXIT
                    IF BAS10002-EFR-GOOD                                02.23
                       MOVE EFR-OWNER-INST
                                         TO HOLD-DS-INT-SETL-GRP        02.29
                    ELSE
                       MOVE 'R'          TO WS-BATCH-DIS-TYPE
                    END-IF
                 END-IF
           END-IF.
033200*
033210 C-200-REF-PREFIX-SET.
033220     PERFORM T-765-BANK-III999-INFO
033230        THRU T-765-EXIT.
033240*
033250     MOVE HLD-BANK-KEY TO SB-BANK-KEY.
           MOVE HLD-INT-SETL-GRP           TO SB-INT-SETL-GRP.          02.87
033260*
033270     MOVE 'CAK'                      TO DC-OPERATION.
033280     MOVE HLD-WORK-AS-OF-DATE        TO DC-SEND-DATE.
033290     PERFORM D-100-CALL-DATECONV
033300        THRU D-100-EXIT.
033310     IF DC-SUCCESSFUL
033320         COMPUTE HLD-REF-DATE = DC-RETURN-DATE
033330     ELSE
033340        DISPLAY 'BAD WORK AS OF DATE'
033350        DISPLAY 'DATECONV-PASSAREA -->' DATECONV-PASSAREA
033360        MOVE 60 TO HLD-RETURN-CD
033370        COMPUTE ABEND-CODE  = HLD-RETURN-CD + 900
033380        PERFORM Z9999-ABEND-PGM
033390           THRU Z9999-EXIT.
033400*
033410 C-200-SETUP-RPT-HDR.
           MOVE MIBH-BANK-KEY-NUM          TO HL1-INST-NBR.             02.73
           MOVE MIBH-BATCH-NMBR          TO WS-BATCH-NMBR.
033440     MOVE WS-REPORT-LIT              TO HL2-TITLE.
033450     MOVE WS-BN-FIRST-TWO            TO HLB-BN-FIRST-TWO.
033460     MOVE WS-BN-LAST-FOUR            TO HLB-BN-LAST-FOUR.
033470*
033480 C-200-EDIT-BATCH-NMBR.
033490     IF MIBH-BATCH-NMBR NOT NUMERIC
033500         MOVE 71 TO ER-CD (ER-INDX)
033510         SET ER-INDX UP BY 1
033520         MOVE 'Y' TO BATCH-REJ-SW
033530         GO TO C-200-MON-HDR.
033540     MOVE MIBH-OPER-NMBR  TO HLD-OPER-NMBR.
033550     MOVE MIBH-BATCH-NMBR TO HLD-BTCH-NMBR
033560                             SB-BATCH-NMBR.
033570     IF MIBH-BATCH-FRST-2 IS GREATER THAN ZERO
033580         AND MIBH-BATCH-FRST-2 IS LESS THAN 32
033590             NEXT SENTENCE
033600     ELSE
033610         MOVE 72 TO ER-CD (ER-INDX)
033620         SET ER-INDX UP BY 1
033630         MOVE 'Y' TO BATCH-REJ-SW.
033670*
033680 C-200-MON-HDR.
033690*
033700     MOVE ZEROS               TO PEN-BANK-KEY
033710                                 PEN-VISA-ITMS
033720                                 PEN-VISA-AMOUNT
033730                                 PEN-MC-ITMS
033740                                 PEN-MC-AMOUNT
033730                                 PEN-DISC-ITMS                    03.47
033740                                 PEN-DISC-AMOUNT                  03.47
033730                                 PEN-PAYPAL-ITMS                  03.47
033740                                 PEN-PAYPAL-AMOUNT                03.47
033730                                 PEN-PL-ITMS
033740                                 PEN-PL-AMOUNT
033750                                 PEN-TOTAL-ITMS
033760                                 PEN-TOTAL-AMOUNT.
033770     MOVE ZEROS               TO CALC-CH-DEBIT-ITMS
033780                                 CALC-CH-CREDIT-ITMS
033790                                 CALC-CH-DEBIT-AMT
033800                                 CALC-CH-CREDIT-AMT
033810                                 GROUP-CTR
033820                                 GROUP-SUS-CTR
033830                                 GR-SUM-ITEMS-CTR
033840                                 CALC-GRP-AMOUNT
033850                                 INV-DATE-CTR
060980                                 BASCRATE-SD-ADD-DAYS.
           MOVE PSI-RUN                  TO PEN-SOURCE-ID
           MOVE FE-JULIAN-DATE           TO PEN-WAO.
           MOVE WSA-RUN-TIME             TO PEN-TIME.
033860     MOVE 'Y' TO FIRST-GROUP-SW.
033870*
033880     MOVE SPACE TO INVALID-REF-SW.
033890     IF MIBH-REF-NMBR NOT NUMERIC
033900         MOVE ZEROS TO HLD-HDR-REF-NMBR
033910         MOVE 73 TO ER-CD (ER-INDX)
033920         SET ER-INDX UP BY 1
033930         MOVE 'Y' TO BATCH-REJ-SW
033940         GO TO C-200-HILITE-REF-ERR.
033950*
046890     MOVE MIBH-REF-MM              TO VD-MM.
046890     MOVE MIBH-REF-DD              TO VD-DD.
046900     PERFORM S-800-VALID-DATE
046910        THRU S-800-EXIT.
046920     IF INVALID-DATE-SW = 'Y'
034010        MOVE 'Y'                   TO BATCH-REJ-SW
033940        GO TO C-200-HILITE-REF-ERR.
046550     MOVE 'DAA'                    TO DC-OPERATION.
046560     MOVE VALID-DATE               TO DC-SEND-DATE.
046590     MOVE HLD-WORK-AS-OF-DATE      TO DC-SEND-NUM.
046600     PERFORM D-100-CALL-DATECONV
046610        THRU D-100-EXIT.
046620     IF DC-RESULT = 02
046620        IF DC-RETURN-NUM < 100
046630           MOVE DC-RETURN-LAST-DAY TO BASCRATE-SD-ADD-DAYS.
033950*
033960     IF MIBH-REF-NMBR-PREF = BE-REF-NMBR-PREFIX
033970         NEXT SENTENCE
033980     ELSE
033990         MOVE 74 TO ER-CD (ER-INDX)
034000         SET ER-INDX UP BY 1
034010         MOVE 'Y' TO BATCH-REJ-SW
034020         MOVE 'Y' TO INVALID-REF-SW.
034030*
034040     IF MIBH-REF-LAST-8 IS GREATER THAN ZERO
034050         NEXT SENTENCE
034060     ELSE
034070         MOVE 76 TO ER-CD (ER-INDX)
034080         SET ER-INDX UP BY 1
034090         MOVE 'Y' TO BATCH-REJ-SW
034100         MOVE 'Y' TO INVALID-REF-SW.
034110*
034120     MOVE HLD-WAO-MM TO MIBH-REF-MM.
034130     MOVE HLD-WAO-DD TO MIBH-REF-DD.
034140*
034150     MOVE MIBH-REF-NMBR TO SB-REF
034160                           HLD-HDR-REF-NMBR.
034170     IF INVALID-REF-SW NOT EQUAL 'Y'
034180         GO TO C-200-EDIT-HDR-AMOUNT.
034190*
034200 C-200-HILITE-REF-ERR.
           MOVE ONE-AST                  TO RBL-2-REF-NO-ERR-IND.
034220*
034230 C-200-EDIT-HDR-AMOUNT.
034240*
034250     IF MIBH-AMOUNT NUMERIC
034260         MOVE MIBH-AMOUNT TO HLD-BTCH-AMOUNT
034270                             SB-BATCH-AMT
034280     ELSE
034290         MOVE ZERO TO HLD-BTCH-AMOUNT
                            SB-BATCH-AMT                                02.73
034300         MOVE 78 TO ER-CD (ER-INDX)
034310         SET ER-INDX UP BY 1
034320         MOVE 'Y' TO BATCH-REJ-SW
034330         GO TO C-200-OUTPUT-BATCH-HDR.
034340*
034350     IF MIBH-ORIG-AMOUNT NUMERIC
034360        MOVE MIBH-ORIG-AMOUNT      TO SB-BATCH-ORIG-AMT
034370        IF SB-BATCH-ORIG-AMT = +0
034380           MOVE MIBH-AMOUNT        TO SB-BATCH-ORIG-AMT.
034390*
034400 C-200-EDIT-CURR-CODE.
034410*
034420     IF MIBH-CURR-CODE NOT NUMERIC
034430        GO TO C-200-BATCH-HDR-ERROR.
034440     MOVE MIBH-CURR-CODE           TO SRCH-CURR-CODE.
034450     PERFORM S-610-SRCH-CURR-CD
034460        THRU S-610-EXIT.
034470     IF INVAL-CURR-SW = 'Y' OR 'N'
034480        GO TO C-200-BATCH-HDR-ERROR.
           MOVE CRE-CURRENCY-CODE-NUM(CRE-IDX)                          02.39
                                         TO BASCRATE-SD-BATCH-CURR-CD.  02.39
           MOVE CRE-NUM-DECINALS(CRE-IDX)                               02.39
                                         TO BASCRATE-SD-BATCH-CURR-DEC. 02.39
           MOVE CRE-CURRENCY-NAME(CRE-IDX)                              02.39
                                         TO WS-BATCH-CURRENCY-NAME.     02.39
033690*
034440     MOVE BE-BILL-CURR-CODE-NUM    TO SRCH-CURR-CODE.
034450     PERFORM S-610-SRCH-CURR-CD
034460        THRU S-610-EXIT.
034470     IF INVAL-CURR-SW = 'Y' OR 'N'
034480        GO TO C-200-BATCH-HDR-ERROR.
           MOVE CRE-CURRENCY-CODE-NUM(CRE-IDX)                          02.39
                                         TO BASCRATE-SD-REIMB-CURR-CD.  02.39
           MOVE CRE-NUM-DECINALS(CRE-IDX)                               02.39
                                         TO BASCRATE-SD-REIMB-CURR-DEC. 02.39
           MOVE CRE-CURRENCY-NAME(CRE-IDX)                              02.39
                                         TO WS-REIMB-CURRENCY-NAME.     02.39
033690*
032730     MOVE BE-SETTLEMENT-CURR-CODE-NUM
032740                                   TO SRCH-CURR-CODE.
034450     PERFORM S-610-SRCH-CURR-CD
034460        THRU S-610-EXIT.
034470     IF INVAL-CURR-SW = 'Y' OR 'N'
034480        GO TO C-200-BATCH-HDR-ERROR.
           MOVE CRE-CURRENCY-CODE-NUM(CRE-IDX)                          02.39
                                         TO BASCRATE-SD-IIIAAA-CURR-CD. 02.39
           MOVE CRE-NUM-DECINALS(CRE-IDX)                               02.39
                                         TO BASCRATE-SD-IIIAAA-CURR-DEC.02.39
           MOVE CRE-CURRENCY-NAME(CRE-IDX)                              02.39
                                         TO WS-IIIAAA-CURRENCY-NAME.    02.39
033690*
025880     MOVE '0'                      TO BASCRATE-SD-BASE-TYPE-ID.
025880     MOVE 'P'                      TO BASCRATE-SD-CALL-TYPE.
060980     MOVE HLD-WORK-AS-OF-DATE      TO BASCRATE-SD-WAO-DT.
112050     PERFORM Z9997-CALL-BASCRATE
025900        THRU Z9997-EXIT.
034630     IF BASCRATE-SD-RETURN-CD = 'E'
034670        GO TO C-200-BATCH-HDR-ERROR-2.
034630     IF BE-MULTI-CURRENCY-FLAG = '0'
034630        IF MIBH-CURR-CODE = BE-BILL-CURR-CODE-NUM OR
034640           MIBH-CURR-CODE = BE-ALT-CURR-CODE-NUM
034650              NEXT SENTENCE
034660        ELSE
034670           GO TO C-200-BATCH-HDR-ERROR-2.
034740*
034750     IF BASCRATE-SD-BATCH-CURR-DEC = 2
034760        MOVE AMOUNT-MAX-07-2       TO MC-AMOUNT-MAX
034770     ELSE
034780     IF BASCRATE-SD-BATCH-CURR-DEC = 0
034790        MOVE AMOUNT-MAX-09-0       TO MC-AMOUNT-MAX
034800     ELSE
034810     IF BASCRATE-SD-BATCH-CURR-DEC = 3
034820        MOVE AMOUNT-MAX-06-3       TO MC-AMOUNT-MAX
034830     ELSE
034840        MOVE AMOUNT-MAX-08-1       TO MC-AMOUNT-MAX.
034850     GO TO C-200-OUTPUT-BATCH-HDR.
034860 C-200-BATCH-HDR-ERROR.
034870     MOVE WS-UNKNOWN-CURRENCY      TO WS-BATCH-CURRENCY-NAME.
034880     DISPLAY 'BATCH HEADER CURR CODE NOT FOUND ' MIBH-CURR-CODE.
034890     MOVE +2                       TO BASCRATE-SD-BATCH-CURR-DEC.
034900     MOVE ZERO                     TO HLD-BTCH-AMOUNT
034910                                      BASCRATE-SD-BATCH-CURR-CD
034920                                      HLD-ITEM-CNT.
034950 C-200-BATCH-HDR-ERROR-2.
           MOVE ONE-AST                  TO RBL-1-CURR-CODE-ERR-IND.
034960     MOVE 69                       TO ER-CD (ER-INDX).
034970     SET ER-INDX UP BY 1.
034980     MOVE 'Y'                      TO BATCH-REJ-SW.
035000 C-200-OUTPUT-BATCH-HDR.
035020     PERFORM T-950-INIT-PET-RECORD
035030        THRU T-950-EXIT.
035040     PERFORM T-960-INIT-PET-HDR-REC
035050        THRU T-960-EXIT.
035060     IF MIBH-BATCH-NMBR IS NUMERIC
035070         MOVE MIBH-BATCH-NMBR        TO PET-HDR-BATCH-NMBR.
035080     MOVE BASCRATE-SD-BANK-KEY       TO PET-HDR-BANK-KEY.
035090     MOVE HLD-BANK-NMBR              TO PET-HDR-BANK-NMBR.
           MOVE PSI-RUN                  TO PET-HDR-SOURCE-ID.
           ADD 1                         TO WS-HRI-SEQ-NUM.
           MOVE WS-HEADER-REF-ID         TO PET-HDR-REF-ID
           MOVE WS-HRI-SEQ-NUM           TO RBL-1-HDR-SEQ.
035100     MOVE BASCRATE-SD-BATCH-CURR-CD-X
035100                                     TO PET-HDR-CURR-CODE.
035110     PERFORM C-210-WRITE-SALES-HDR
035120        THRU C-210-EXIT.
035130*
035140 C-200-EXIT.
035150     EXIT.
035160*
035170 C-210-WRITE-SALES-HDR.
035180     MOVE LIT-SALES              TO HLB-LIT.
           MOVE MR1-TRANSCODE            TO PET-TRANS
                                            RBL-1-TRANSCODE.
           MOVE BASCRATE-SD-BATCH-CURR-CD-X
                                         TO RBL-1-CURR-CODE.
           MOVE WS-BATCH-CURRENCY-NAME   TO RBL-1-CURR-NAME.
035230     IF MIBH-REF-NMBR IS NUMERIC
035240         MOVE MIBH-REF-NMBR      TO PET-HDR-REF-NMBR.
           MOVE MIBH-REF-NMBR            TO RBL-2-REF-NO.
      *
           IF MIBH-AMOUNT NUMERIC
              MOVE MIBH-AMOUNT           TO PET-HDR-AMOUNT
                                            RBL-1-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RBL-1-AMT  C-LGTH24
                   C-TYPEEND
           ELSE
              MOVE ZERO                  TO PET-HDR-AMOUNT
              MOVE MIBH-AMOUNT-X         TO RBL-1-AMT-X
              MOVE ONE-AST               TO RBL-1-AMT-ERR-IND.
      *
           IF MIBH-ORIG-AMOUNT NUMERIC
              MOVE MIBH-ORIG-AMOUNT      TO PET-HDR-ORIG-AMOUNT
                                            RAD-ED-TRAN-AMT
                                            RBL-2-AMT
           ELSE
              MOVE ZERO                  TO PET-HDR-ORIG-AMOUNT
                                            RAD-ED-TRAN-AMT
                                            RBL-2-AMT.
           MOVE BASCRATE-SD-BATCH-CURR-DEC
                                         TO RAD-ED-TRAN-DEC.
           CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                C-TYPEA  RBL-2-AMT  C-LGTH24
                C-TYPEEND.
      *
           IF CRITICAL-BATCH-REJ-SW = 'Y'                               02.73
              MOVE 'Y'                   TO BATCH-REJ-SW                02.73
              PERFORM S-900-BYPASS-BATCH THRU S-900-EXIT.               02.73
                                                                        02.73
           MOVE MIBH-OPER-NMBR           TO RBL-2-OPER-NMBR.
           MOVE POST-EDIT-TRANS          TO WORK-DATA.
035560     PERFORM S-300-WRITE-PET-WORK-REC
035570        THRU S-300-EXIT.
           IF BATCH-REJ-SW = 'Y'
              MOVE '*'                   TO RBL-1-SUS-FLAG.
           IF ER-CD-3-DIG (1) > ZERO
              MOVE ER-CD-3-DIG (1)       TO RBL-1-ERROR-CD-1.
           IF ER-CD-3-DIG (2) > ZERO
              MOVE ER-CD-3-DIG (2)       TO RBL-1-ERROR-CD-2.
           IF ER-CD-3-DIG (3) > ZERO
              MOVE ER-CD-3-DIG (3)       TO RBL-1-ERROR-CD-3.
           IF ER-CD-3-DIG (4) > ZERO
              MOVE ER-CD-3-DIG (4)       TO RBL-2-ERROR-CD-1.
           IF ER-CD-3-DIG (5) > ZERO
              MOVE ER-CD-3-DIG (5)       TO RBL-2-ERROR-CD-2.
           IF ER-CD-3-DIG (6) > ZERO
              MOVE ER-CD-3-DIG (6)       TO RBL-2-ERROR-CD-3.
      *
           MOVE MIBH-BATCH-NMBR          TO RAD-ED-BATCH-ID.
           MOVE ZERO                     TO RAD-ED-LINE-TYPE
                                            RAD-ED-REPORT-TYPE.
           MOVE +0                       TO RAD-ED-TRAN-AMT.
      *
           MOVE RPT-BATCH-LINE-1         TO RLW-DETAIL-LINE.
           PERFORM R-920-WRITE-REPORT-RECORD
              THRU R-920-EXIT.
           MOVE RESET-RPT-BATCH-LINE-1   TO RPT-BATCH-LINE-1.
      *
           MOVE RPT-BATCH-LINE-2         TO RLW-DETAIL-LINE.
           PERFORM R-920-WRITE-REPORT-RECORD
              THRU R-920-EXIT.
           MOVE RESET-RPT-BATCH-LINE-2   TO RPT-BATCH-LINE-2.
      *
035600 C-210-EXIT.
035610     EXIT.
035620*
035630 C-300-EDIT-GR-SUM.
035640     IF FIRST-GROUP-SW EQUAL 'N'
035650         PERFORM R-600-GROUP-SUM-BREAK
035660            THRU R-600-EXIT
035670     ELSE
035680         MOVE 'N' TO FIRST-GROUP-SW.
035690*
035700*   THIS MODULE EDITS THE GROUP SUMMARY TRANSACTION,
035710*     WRITES THE OUTPUT GROUP SUMMARY RECORD, AND
035720*     PRINTS A GROUP SUMMARY DETAIL LINE
035730*
           MOVE ZERO                     TO RAD-ED-LINE-TYPE
                                            RAD-ED-REPORT-TYPE.
           MOVE SPACES                   TO WS-RWA-GROUP-SWITCHES
                                            WS-RWA-TRAN-SWITCHES.
           MOVE ZERO                     TO WS-SAVE-GROUP-TYPE.
035740     ADD 1                    TO GROUP-CTR.
035750     MOVE ZERO                TO INV-DET-CTR
035760                                 GR-SUM-ITEMS-CTR
035770                                 HLD-MRCH-ER-CD
035780                                 HLD-GRP-AMOUNT
035790                                 CALC-GRP-AMOUNT.
035800     MOVE SPACES              TO HLD-SUM-TC
032060                                 HLD-SUM-GROUP-TYPE
035810                                 GROUP-SUS-SW
035820                                 GRP-REJ-SW.
035830     MOVE SPACES              TO POST-EDIT-MERCH-TOTALS.
           MOVE +0                  TO PEM-BANK-KEY
                                       PEM-MERCH-NMBR
                                       PEM-BANK-NMBR
                                       PEM-BATCH-DATE
                                       PEM-BATCH-CURR-CODE
                                       PEM-BATCH-DR-ITEMS
                                       PEM-BATCH-DR-AMT
                                       PEM-BATCH-CR-ITEMS
                                       PEM-BATCH-CR-AMT
                                       PEM-BATCH-DR-ITEMS-REJ           02.58
                                       PEM-BATCH-DR-AMT-REJ             02.58
                                       PEM-BATCH-CR-ITEMS-REJ           02.58
                                       PEM-BATCH-CR-AMT-REJ             02.58
                                       PEM-BATCH-DR-ITEMS-NS            03.00
                                       PEM-BATCH-DR-AMT-NS              03.00
                                       PEM-BATCH-CR-ITEMS-NS            03.00
                                       PEM-BATCH-CR-AMT-NS              03.00
                                       PEM-BATCH-DR-ITEMS-REJ-NS        03.10
                                       PEM-BATCH-DR-AMT-REJ-NS          03.10
                                       PEM-BATCH-CR-ITEMS-REJ-NS        03.10
                                       PEM-BATCH-CR-AMT-REJ-NS          03.10
                                       PEM-VISA-NOTONUS-ITMS
                                       PEM-MC-NOTONUS-ITMS
                                       PEM-AMEX-NOTONUS-ITMS
                                       PEM-DISC-NOTONUS-ITMS
                                       PEM-PP-NOTONUS-ITMS              03.47
                                       PEM-VISA-NOTONUS-AMT
                                       PEM-MC-NOTONUS-AMT
                                       PEM-AMEX-NOTONUS-AMT
                                       PEM-DISC-NOTONUS-AMT
                                       PEM-PP-NOTONUS-AMT               03.47
                                       WORK-NON-SETL-REIMB-AMT
                                       WORK-NON-SETL-CNT                02.86
035940                                 WORK-NON-SETL-AMT.
           IF PARM-IS-1-SIDED                                           03.31
              IF MR1-VALID-1-SIDED-GROUP AND                            03.31
                 HLD-VALID-1-SIDED-BATCH                                03.31
                    GO TO C-300-EDIT-SUSP-CR-FLAG                       03.31
              END-IF                                                    03.31
           ELSE                                                         03.31
              IF MR1-VALID-2-SIDED-GROUP AND                            03.31
                 HLD-VALID-2-SIDED-BATCH                                03.31
                    GO TO C-300-EDIT-SUSP-CR-FLAG                       03.31
              END-IF                                                    03.31
           END-IF.                                                      03.31
035980*
035990*   IF TRANSCODE DOES NOT PASS ABOVE TESTS, THE GROUP
036000*     SUMMARY TRANSACTION DOES NOT FOLLOW THE PROPER BATCH
036010*     HEADER
036020*
036030     MOVE 94 TO ER-CD (ER-INDX).
036040     PERFORM S-900-BYPASS-BATCH
036050        THRU S-900-EXIT.
036060     GO TO C-300-EXIT.
       C-300-EDIT-SUSP-CR-FLAG.                                         03.02
           MOVE MIGR-SUSP-NET-CR        TO WS-MIGR-PEF-SUSP-NET-CR.     03.02
           IF MIGR-SUSP-NET-CR = 'Y'                                    03.02
              ADD 1                     TO GROUP-SUS-CTR                03.02
              MOVE 'Y'                  TO GROUP-SUS-SW                 03.02
              MOVE 80                   TO ER-CD(ER-INDX)               03.02
              SET ER-INDX UP BY 1.                                      03.02
036070 C-300-EDIT-GR-REF-NMBR.
036080     MOVE SPACE TO INVALID-REF-SW.
036090     IF MIGR-REF-NMBR IS NUMERIC
036100         NEXT SENTENCE
036110     ELSE
036120         MOVE 73 TO ER-CD (ER-INDX)
036130         SET ER-INDX UP BY 1
036140         MOVE 'Y' TO BATCH-REJ-SW
036150         MOVE 'Y' TO GRP-REJ-SW
036160         GO TO C-300-HILITE-GR-REF-ERR.
036170     IF HLD-HDR-REF-NMBR EQUAL ZEROS
036180         NEXT SENTENCE
036190     ELSE
036200     IF MIGR-REF-NMBR-PREF EQUAL HLD-HDR-REF-NMBR-PREF
036210         NEXT SENTENCE
036220     ELSE
036230         MOVE 74 TO ER-CD (ER-INDX)
036240         SET ER-INDX UP BY 1
036250         MOVE 'Y' TO BATCH-REJ-SW
036260         MOVE 'Y' TO GRP-REJ-SW
036270         MOVE 'Y' TO INVALID-REF-SW.
036280     IF MIGR-REF-LAST-8 IS GREATER THAN ZERO
036290         NEXT SENTENCE
036300     ELSE
036310         MOVE 76 TO ER-CD (ER-INDX)
036320         SET ER-INDX UP BY 1
036330         MOVE 'Y' TO BATCH-REJ-SW
036340         MOVE 'Y' TO GRP-REJ-SW
036350         MOVE 'Y' TO INVALID-REF-SW.
035870     MOVE HLD-WORK-AS-OF-DATE      TO PEM-BATCH-DATE.
036360     MOVE HLD-WAO-MM TO MIGR-REF-MM.
036370     MOVE HLD-WAO-DD TO MIGR-REF-DD.
036380     IF INVALID-REF-SW NOT EQUAL 'Y'
036390         MOVE MIGR-REF-NMBR TO HLD-SUM-REF-NMBR
036410         GO TO C-300-EDIT-GR-AMOUNT.
036420 C-300-HILITE-GR-REF-ERR.
036430     MOVE ZEROS TO HLD-SUM-REF-NMBR.
           MOVE ONE-AST                  TO RGL-2-REF-NO-ERR-IND.
036460*
036470 C-300-EDIT-GR-AMOUNT.
           IF MIGR-AMOUNT NOT NUMERIC
              MOVE 78                    TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1
              MOVE 'Y'                   TO BATCH-REJ-SW
              MOVE 'Y'                   TO GRP-REJ-SW
              GO TO C-300-EDIT-GRP-SPEC-COND.
036540*
036550     MOVE MIGR-AMOUNT TO HLD-GRP-AMOUNT.
036560*
036570 C-300-EDIT-GRP-SPEC-COND.
036580     MOVE SPACES TO HOLD-GRP-SUM-SPEC-COND-IND
036590                    HOLD-GRP-SUM-MAIL-PHONE-IND.
036600     MOVE MIGR-SPEC-COND-IND TO CHK-SPEC-IND.
036610     IF  (CHK-SPEC-IND-1 = SPACE OR '1' OR '2' OR '3')
036620     AND (CHK-SPEC-IND-2 = SPACE OR 'L' OR 'F' OR 'B'
036630          OR  'D' OR 'S' OR '8')
036640         MOVE MIGR-SPEC-COND-IND TO HOLD-GRP-SUM-SPEC-COND-IND
036650     ELSE
036660         MOVE 75 TO ER-CD  (ER-INDX)
036670         SET ER-INDX UP BY 1
036680         MOVE 'Y' TO BATCH-REJ-SW
036690         MOVE 'Y' TO GRP-REJ-SW.
036700*
036710 C-300-EDIT-GRP-MAIL-PHONE.
036720     MOVE MIGR-MAIL-PHONE-IND      TO KDA-PHONE-ORD.
036730     IF KDA-VC-PHONE-ORD
036740         MOVE MIGR-MAIL-PHONE-IND TO HOLD-GRP-SUM-MAIL-PHONE-IND
036750     ELSE
036760         MOVE 77 TO ER-CD  (ER-INDX)
036770         SET ER-INDX UP BY 1
036780         MOVE 'Y' TO BATCH-REJ-SW
036790         MOVE 'Y' TO GRP-REJ-SW.
036800*
036810 C-300-CHECK-TC.
036820*
036830     MOVE SPACES                 TO PET-MERCHANT.
036840     MOVE ZEROES                 TO PET-MRCH-BANK-KEY
036850                                    PET-MRCH-MERCH-NMBR
036860                                    PET-MRCH-TIMESTAMP
036870                                    PET-MRCH-ITEMS
036880                                    PET-MRCH-AMOUNT
036890                                    PET-MRCH-DATE
036900                                    PET-MRCH-300-FLAG
036910                                    PET-MRCH-SUS-NMBR
036920                                    PET-MRCH-ER-CODE
036930                                    PET-MRCH-SUM-AMOUNT
113800                                    PET-MRCH-DR-ITEMS
113900                                    PET-MRCH-DR-AMT
114000                                    PET-MRCH-CR-ITEMS
                                          PET-MRCH-CR-AMT               02.58
                                          PET-MRCH-DR-ITEMS-REJ         02.58
                                          PET-MRCH-DR-AMT-REJ           02.58
                                          PET-MRCH-CR-ITEMS-REJ         02.58
                                          PET-MRCH-CR-AMT               03.00
                                          PET-MRCH-DR-ITEMS-NS          03.00
                                          PET-MRCH-DR-AMT-NS            03.00
                                          PET-MRCH-CR-ITEMS-NS          03.00
                                          PET-MRCH-CR-AMT-NS            03.10
                                          PET-MRCH-DR-ITEMS-REJ-NS      03.10
                                          PET-MRCH-DR-AMT-REJ-NS        03.10
                                          PET-MRCH-CR-ITEMS-REJ-NS      03.10
                                          PET-MRCH-CR-AMT-REJ-NS.       03.10
036930     MOVE +0                     TO PET-MRCH-REIMB-AMT
036930                                    PET-MRCH-NON-SETL-REIMB-AMT
036930                                    PET-MRCH-IIIAAA-AMT.
           MOVE HLD-BTCH-NMBR            TO PET-MRCH-BATCH-NMBR
                                            PEM-BATCH-NMBR.
           MOVE WS-SAVE-PEM-NOTONUS-FLAGS
                                         TO WS-PEM-NOTONUS-FLAGS.
036940*
036950 C-300-EDIT-GR-MERCH-NMBR.
036960*
036970*   EDIT THE MERCHANT NUMBER ON THE GROUP SUMMARY
036980*     TRANSACTION AND GET THE MERCHANT DESCRIPTION FROM
036990*     THE MERCHANT NAME AND ADDRESS FILE
037000*
037010     IF MIGR-MERCH-NMBR IS NUMERIC
037020         MOVE MIGR-MERCH-NMBR TO HLD-SUM-MERCH-NMBR
037030     ELSE
037040         MOVE ZERO TO HLD-SUM-MERCH-NMBR.
037050     MOVE SPACES TO HLD-DESCR-COUNTRY
037060                    HOLD-DISCOVER-COUNTRY-A
037060                    HLD-MRCH-VE-COUNTRY
037060                    HLD-INET-COUNTRY.
           MOVE ZEROS                    TO HLD-INET-COUNTRY-NUM
                                            HOLD-DISCOVER-COUNTRY-N.
           IF MIGR-MERCH-NMBR NOT NUMERIC                               02.44
              ADD 1                     TO GROUP-SUS-CTR
              MOVE 'Y'                  TO GROUP-SUS-SW
                                           INVALID-MERCH-SW             02.44
              MOVE SNF-RECORD           TO NME-RECORD                   02.77
              MOVE ONE-AST              TO RGL-1-MERCH-NMBR-ERR-IND
              MOVE 44                   TO ER-CD (ER-INDX)
                                           HLD-MRCH-ER-CD
              SET ER-INDX UP BY 1
              MOVE SPACES               TO HLD-DESCR
              GO TO C-300-CHECK-GROUP-SUS.
037180*
037190     MOVE HLD-BANK-KEY TO MNK-BANK-KEY.
037200     MOVE MIGR-MERCH-NMBR-10 TO MNK-MERCH-NMBR.
037230     PERFORM S-050-READ-MERCH-NAME THRU S-050-EXIT.
      *                                                                 02.47
           IF NME-AMEX-SETL-PGM NOT = SPACE                             03.38
              GO TO C-300-EDIT-GR-SET-AMX-TYPE.                         03.38
      *                                                                 03.38
           MOVE 'N'                      TO WS-MRCH-AMX-TYPE.           03.38
           IF WS-BATCH-IS-AMX-SETL OR                                   03.38
              WS-BATCH-IS-AMX-BOTH                                      03.38
                 MOVE 'E'                TO WS-MRCH-AMX-TYPE            03.38
                 MOVE '0154'             TO WS-PLAN-CODE                03.47
                 PERFORM D-500-SEARCH-PLAN-PACKAGE                      03.38
                    THRU D-500-EXIT                                     03.38
                 IF WS-PLAN-CODE-FOUND-SW = 'N'                         03.38
                    MOVE 'S'             TO WS-MRCH-AMX-TYPE            03.38
                    MOVE '0114'          TO WS-PLAN-CODE                03.39
                    PERFORM D-500-SEARCH-PLAN-PACKAGE                   03.38
                       THRU D-500-EXIT                                  03.38
                    IF WS-PLAN-CODE-FOUND-SW = 'N'                      03.38
                       IF NOT WS-NSC-NON-CLEAR-AX                       03.39
                          MOVE '0104'    TO WS-PLAN-CODE                03.39
                       ELSE                                             03.39
                          MOVE '0204'    TO WS-PLAN-CODE                03.39
                       END-IF                                           03.39
                       PERFORM D-500-SEARCH-PLAN-PACKAGE                03.39
                          THRU D-500-EXIT                               03.39
                       IF WS-PLAN-CODE-FOUND-SW = 'N'                   03.39
                          IF NOT WS-NSC-NON-CLEAR-AX                    03.39
                             MOVE '0204' TO WS-PLAN-CODE                03.39
                             PERFORM D-500-SEARCH-PLAN-PACKAGE          03.39
                                THRU D-500-EXIT                         03.39
                          END-IF                                        03.39
                       END-IF                                           03.39
                       IF WS-PLAN-CODE-FOUND-SW = 'N'                   03.39
                          MOVE 'Y'       TO WS-PLAN-CODE-FOUND-SW       03.39
                          IF BE-AMEX-EAP-SUBMITTER-ID = SPACES OR ZEROS 03.39
                             MOVE 'S'    TO WS-MRCH-AMX-TYPE            03.39
                          ELSE                                          03.39
                             MOVE 'E'    TO WS-MRCH-AMX-TYPE            03.39
                          END-IF                                        03.39
                       ELSE                                             03.39
                          MOVE 'N'       TO WS-MRCH-AMX-TYPE            03.39
                       END-IF                                           03.39
                    END-IF                                              03.39
                 END-IF                                                 03.39
           END-IF.                                                      03.39
           IF (WS-MRCH-IS-AMX-SETL OR WS-MRCH-IS-AMX-EAP) AND           03.39
               WS-PLAN-CODE-FOUND                                       03.39
              MOVE 'S'                   TO WS-PEM-NF-AMEX              03.39
           ELSE                                                         03.38
              MOVE 'N'                   TO WS-PEM-NF-AMEX              03.38
           END-IF.                                                      03.38
      *                                                                 03.38
           GO TO C-300-EDIT-GR-AMX-TYPE-SET.                            03.38
      *                                                                 03.38
       C-300-EDIT-GR-SET-AMX-TYPE.                                      03.38
      *                                                                 03.38
           MOVE NME-AMEX-SETL-PGM            TO MIS3-AX-SETL-PGM-ID.    03.34F
           IF WS-NSC-NON-CLEAR-AX                                       03.39
               MOVE 'N'                      TO WS-MRCH-AMX-TYPE        03.34F
               MOVE '0204'                   TO WS-PLAN-CODE            03.34F
               PERFORM D-500-SEARCH-PLAN-PACKAGE                        03.34F
                  THRU D-500-EXIT                                       03.34F
           ELSE                                                         03.34F
               EVALUATE MIS3-AX-SETL-PGM-ID                             03.34F
                   WHEN 'E'                                             03.34F
                      MOVE 'E'                  TO WS-MRCH-AMX-TYPE     03.34F
                      MOVE '0154'               TO WS-PLAN-CODE         03.34F
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                      IF KDA-CAP-AMEX-X = SPACES OR '0000'              03.34G
                         CONTINUE                                       03.34G
                      ELSE                                              03.34G
                         MOVE 'Y'              TO WS-PLAN-CODE-FOUND-SW 03.34G
                      END-IF                                            03.34G
                   WHEN 'O'                                             03.34F
                      MOVE 'S'                  TO WS-MRCH-AMX-TYPE     03.34F
                      MOVE '0114'               TO WS-PLAN-CODE         03.34F
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                      IF KDA-CAP-AMEX-X = SPACES OR '0000'              03.34G
                         CONTINUE                                       03.34G
                      ELSE                                              03.34G
                         MOVE 'Y'              TO WS-PLAN-CODE-FOUND-SW 03.34G
                      END-IF                                            03.34G
                   WHEN 'A'                                             03.34F
                      MOVE 'N'                  TO WS-MRCH-AMX-TYPE     03.34F
                      MOVE '0104'               TO WS-PLAN-CODE         03.34F
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                   WHEN 'X'                                             03.34F
                      MOVE 'N'                  TO WS-MRCH-AMX-TYPE     03.34F
                      MOVE '0204'               TO WS-PLAN-CODE         03.34F
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                   WHEN OTHER                                           03.34F
                      MOVE 'N'                 TO WS-PLAN-CODE-FOUND-SW 03.34F
               END-EVALUATE                                             03.34F
           END-IF.                                                      03.34F
           IF WS-PLAN-CODE-FOUND-SW = 'N'                               03.30
              MOVE 'Z'                      TO WS-MRCH-AMX-TYPE         03.34F
                                               WS-SAVE-MRCH-AMX-TYPE    03.47
              MOVE '0000'                   TO WS-SAVE-AMX-PLAN-CODE-X  03.34F
           ELSE                                                         03.34F
              MOVE WS-MRCH-AMX-TYPE         TO WS-SAVE-MRCH-AMX-TYPE    03.34F
              MOVE KDA-PLAN-QUAL-CODE       TO WS-SAVE-AMX-PLAN-CODE-X  03.34F
           END-IF.                                                      03.34F
           IF (WS-MRCH-IS-AMX-SETL OR WS-MRCH-IS-AMX-EAP) AND           03.30
               WS-PLAN-CODE-FOUND                                       03.30
              MOVE 'S'                   TO WS-PEM-NF-AMEX              03.16A
           ELSE                                                         03.16A
              MOVE 'N'                   TO WS-PEM-NF-AMEX              03.16A
           END-IF.                                                      03.34F
      *                                                                 02.47
       C-300-EDIT-GR-AMX-TYPE-SET.                                      03.38
      *                                                                 03.38
           IF NME-DISCOVER-SETL-PGM NOT = SPACE                         03.38
              GO TO C-300-EDIT-GR-SET-DS-TYPE.                          03.38
      *                                                                 03.38
           MOVE 'N'                      TO WS-MRCH-DIS-TYPE.           03.38
           IF WS-BATCH-IS-DIS-SETL OR                                   03.38
              WS-BATCH-IS-DIS-BOTH                                      03.38
                 MOVE 'S'                TO WS-MRCH-DIS-TYPE            03.38
                 MOVE '0115'             TO WS-PLAN-CODE                03.47
                 PERFORM D-500-SEARCH-PLAN-PACKAGE                      03.38
                    THRU D-500-EXIT                                     03.38
                 IF WS-PLAN-CODE-FOUND-SW = 'N'                         03.38
                    IF NOT WS-NSC-NON-CLEAR-DS                          03.39
                       MOVE '0105'       TO WS-PLAN-CODE                03.39
                    ELSE                                                03.39
                       MOVE '0205'       TO WS-PLAN-CODE                03.39
                    END-IF                                              03.39
                    PERFORM D-500-SEARCH-PLAN-PACKAGE                   03.39
                       THRU D-500-EXIT                                  03.39
                    IF WS-PLAN-CODE-FOUND-SW = 'N'                      03.39
                       IF NOT WS-NSC-NON-CLEAR-DS                       03.39
                          MOVE '0205'    TO WS-PLAN-CODE                03.39
                          PERFORM D-500-SEARCH-PLAN-PACKAGE             03.39
                             THRU D-500-EXIT                            03.39
                       END-IF                                           03.39
                    END-IF                                              03.39
                    IF WS-PLAN-CODE-FOUND-SW = 'N'                      03.39
                       MOVE 'Y'          TO WS-PLAN-CODE-FOUND-SW       03.39
                       MOVE 'S'          TO WS-MRCH-DIS-TYPE            03.39
                    ELSE                                                03.39
                       MOVE 'N'          TO WS-MRCH-DIS-TYPE            03.39
                    END-IF                                              03.39
                 END-IF                                                 03.39
           END-IF.                                                      03.39
           IF WS-MRCH-IS-DIS-SETL AND                                   03.39
              WS-PLAN-CODE-FOUND                                        03.39
                 MOVE 'S'                TO WS-PEM-NF-DISC              03.39
                                            WS-PEM-NF-PP                03.47
           ELSE                                                         03.38
              MOVE 'N'                   TO WS-PEM-NF-DISC              03.38
                                            WS-PEM-NF-PP                03.47
           END-IF.                                                      03.38
      *                                                                 03.38
           GO TO C-300-EDIT-GR-DS-TYPE-SET.                             03.38
      *                                                                 03.38
       C-300-EDIT-GR-SET-DS-TYPE.                                       03.38
      *                                                                 03.38
           MOVE NME-DISCOVER-SETL-PGM TO MIS3-DS-SETL-PGM-ID.           03.34F
           IF WS-NSC-NON-CLEAR-DS                                       03.39
               MOVE 'N'                      TO WS-MRCH-DIS-TYPE        03.34F
               MOVE '0205'                   TO WS-PLAN-CODE            03.34F
               PERFORM D-500-SEARCH-PLAN-PACKAGE                        03.34F
                  THRU D-500-EXIT                                       03.34F
           ELSE                                                         03.34F
               EVALUATE MIS3-DS-SETL-PGM-ID                             03.34F
                   WHEN 'M'                                             03.34F
                      MOVE 'S'                  TO WS-MRCH-DIS-TYPE     03.34F
                      MOVE '0115'               TO WS-PLAN-CODE         03.34F
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                      IF KDA-CAP-DISC-X = SPACES OR '0000'              03.34G
                         CONTINUE                                       03.34G
                      ELSE                                              03.34G
                         MOVE 'Y'              TO WS-PLAN-CODE-FOUND-SW 03.34G
                      END-IF                                            03.34G
                   WHEN 'N'                                             03.34F
                      MOVE 'N'                  TO WS-MRCH-DIS-TYPE     03.34F
                      MOVE '0105'               TO WS-PLAN-CODE         03.34F
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                   WHEN 'X'                                             03.34F
                      MOVE 'N'                  TO WS-MRCH-DIS-TYPE     03.34F
                      MOVE '0205'               TO WS-PLAN-CODE         03.34F
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                   WHEN OTHER                                           03.34F
                      MOVE 'N'                 TO WS-PLAN-CODE-FOUND-SW 03.34F
               END-EVALUATE                                             03.34F
           END-IF.                                                      03.34F
           IF WS-PLAN-CODE-FOUND-SW = 'N'                               03.30
              MOVE 'Z'                      TO WS-MRCH-DIS-TYPE         03.34F
                                               WS-SAVE-MRCH-DIS-TYPE    03.47
              MOVE '0000'                   TO WS-SAVE-DIS-PLAN-CODE-X  03.34F
           ELSE                                                         03.34F
              MOVE WS-MRCH-DIS-TYPE         TO WS-SAVE-MRCH-DIS-TYPE    03.34F
              MOVE KDA-PLAN-QUAL-CODE       TO WS-SAVE-DIS-PLAN-CODE-X  03.34F
           END-IF.                                                      03.34F
           IF WS-MRCH-IS-DIS-SETL AND WS-PLAN-CODE-FOUND                03.30
              MOVE 'S'                   TO WS-PEM-NF-DISC              03.16A
                                            WS-PEM-NF-PP                03.47
           ELSE                                                         03.16A
              MOVE 'N'                   TO WS-PEM-NF-DISC              03.16A
                                            WS-PEM-NF-PP                03.47
           END-IF.                                                      03.34F
      *                                                                 02.47
       C-300-EDIT-GR-DS-TYPE-SET.                                       03.38
      *                                                                 03.38
           MOVE WS-PEM-NOTONUS-FLAGS     TO PEM-NOTONUS-FLAGS
                                            PET-MRCH-NOTONUS-FLAGS.
           IF (INVALID-MERCH-SW = 'Y' OR 'Z') OR
               INVALID-NAME-ADDR-SW NOT = SPACES
                 MOVE MNK-BANK-KEY      TO NME-INST-CODE                02.77
                 MOVE MNK-MERCH-NMBR    TO NME-MERCH-NBR                02.77
                 ADD 1                  TO GROUP-SUS-CTR
                 MOVE 'Y'               TO GROUP-SUS-SW
                 MOVE ONE-AST           TO RGL-1-MERCH-NMBR-ERR-IND
                 MOVE SPACES            TO HLD-DESCR.
037320******************************************************************
037330*    SET DEFAULT MAIL PHONE INDICATOR TO A PROPER VALUE BASED ON *
037340*    THE MERCHANT CATEGORY CODE.                                 *
037350******************************************************************
037360     MOVE MIGR-MAIL-PHONE-IND      TO KDA-PHONE-ORD.
037370     IF KDA-MERCAT-DIRECT-MKT OR
037370        KDA-MERCAT-HEALTH-CARE
037380        IF KDA-VC-PHONE-ORD-MERCH
037390           NEXT SENTENCE
037400        ELSE
037410           MOVE '4'               TO HOLD-GRP-SUM-MAIL-PHONE-IND
037420     ELSE
037430        MOVE SPACE                TO HOLD-GRP-SUM-MAIL-PHONE-IND.
037440*
           IF (INVALID-MERCH-SW = 'Y' OR 'Z') OR
               INVALID-NAME-ADDR-SW NOT = SPACES
                 GO TO C-300-CHECK-GROUP-SUS.
037440*
034630     IF BASCRATE-SD-RETURN-CD = 'E'
037470        MOVE 98                    TO ER-CD (ER-INDX)
037480        SET ER-INDX UP BY 1
037490        MOVE 'Y'                   TO BATCH-REJ-SW
037500        MOVE 'Y'                   TO GRP-REJ-SW
037520        GO TO C-300-CHECK-GROUP-SUS.
037440*
034630     IF BE-MULTI-CURRENCY-FLAG = '0'
037460        IF NME-BILL-CURR-CODE NOT = BASCRATE-SD-BATCH-CURR-CD-X   02.77
037470           MOVE 98                 TO ER-CD (ER-INDX)
037480           SET ER-INDX UP BY 1
037490           MOVE 'Y'                TO BATCH-REJ-SW
037500           MOVE 'Y'                TO GRP-REJ-SW
037520           GO TO C-300-CHECK-GROUP-SUS.
037440*
112050     PERFORM Z9997-CALL-BASCRATE
025900        THRU Z9997-EXIT.
037440*
037520 C-300-CHECK-GROUP-SUS.
037530     IF GROUP-SUS-SW EQUAL SPACE
037540         MOVE ZERO TO GROUP-SUS-CTR.
037610*
037620 C-300-OUTPUT-GROUP-TRANS.
037630     IF  MIGR-BAL-DATE IS EQUAL TO SPACES
037640       THEN
037650         MOVE ZEROS TO MIGR-BAL-DATE.
037660     MOVE MIGR-BAL-DATE   TO WS-BALANCE-DATE-X.
037670     MOVE WS-BALANCE-DATE TO PET-MRCH-DATE.
037680     MOVE MR1-TRANSCODE TO HLD-SUM-TC.
           MOVE MIGR-OPER-NMBR           TO HLD-OPER-NMBR.
           MOVE NME-CUST-ID-2            TO PET-MRCH-CUST-ID-2.         02.88
037690     IF MIGR-GROUP-TYPE = 'C' OR 'D'
049900        MOVE MIGR-GROUP-TYPE       TO HLD-SUM-GROUP-TYPE
049900                                      PET-MRCH-GROUP-TYPE
037690     ELSE
049900        MOVE 'C'                   TO HLD-SUM-GROUP-TYPE
049900                                      PET-MRCH-GROUP-TYPE.
037460     MOVE BASCRATE-SD-BATCH-CURR-CD-X
037700                                   TO PET-MRCH-CURR-CODE
035870                                      PEM-BATCH-CURR-CODE-X.
      *
           MOVE MR1-TRANSCODE            TO PET-MRCH-TRANSCODE
                                            RGL-1-TRANSCODE.
037830     MOVE +0                     TO PET-MRCH-TIMESTAMP.
037840     MOVE HLD-BANK-KEY           TO PET-MRCH-BANK-KEY.
037850     MOVE HLD-SUM-MERCH-NMBR     TO PET-MRCH-MERCH-NMBR.
           MOVE MIGR-MERCH-NMBR-R        TO RGL-1-MERCH-NMBR.
           MOVE HL1-INST-NBR-X           TO RGL-1-MERCH-NMBR(1:6).
           MOVE RGL-1-MERCH-NMBR         TO HLD-TRAN-MERCH-NMBR-X.
037870     IF MIGR-REF-NMBR IS NUMERIC
037880         MOVE MIGR-REF-NMBR      TO PET-MRCH-REF-NMBR
037890                                    PET-MRCH-ITEM-REF.
           MOVE MIGR-REF-NMBR            TO RGL-2-REF-NO.
037460     MOVE BASCRATE-SD-REIMB-CURR-CD-X
035870                                 TO PET-MRCH-REIMB-CURR-CODE.
           MOVE PSI-RUN                TO PET-MRCH-SOURCE-ID
                                          PEM-SOURCE-ID.
           MOVE HOLD-VISA-INT-SETL-GRP TO PET-MRCH-OWNER-INST.
           ADD 1                         TO WS-GRI-SEQ-NUM.
           MOVE WS-GROUP-REF-ID          TO PET-MRCH-GROUP-REF-ID
                                            PEM-GROUP-REF-ID.
           MOVE WS-HRI-SEQ-NUM           TO PET-MRCH-BATCH-SEQ
                                            PEM-BATCH-SEQ.
           MOVE WS-GRI-SEQ-NUM           TO RGL-1-REF-SEQ.
      *
           IF MIGR-AMOUNT NOT NUMERIC
              MOVE ZERO                  TO PET-MRCH-AMOUNT
                                            RAD-ED-TRAN-AMT
              MOVE MIGR-AMOUNT-X         TO RGL-1-AMT-X
              MOVE ONE-AST               TO RGL-1-AMT-ERR-IND
           ELSE
              MOVE MIGR-AMOUNT           TO PET-MRCH-AMOUNT
                                            RAD-ED-TRAN-AMT
                                            PET-MRCH-REIMB-AMT
                                            RGL-1-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RGL-1-AMT  C-LGTH24
                   C-TYPEEND.
      *
038010     IF  MIGR-BAL-DATE IS EQUAL TO SPACES
038020       THEN
038030         MOVE ZEROS TO MIGR-BAL-DATE.
           IF  MR1-VALID-GROUP
038050         MOVE MIGR-BAL-DATE   TO WS-BALANCE-DATE-X                03.31
038060         MOVE WS-BALANCE-DATE TO PET-MRCH-DATE
038070       ELSE
038080         MOVE HLD-WORK-AS-OF-DATE TO PET-MRCH-DATE.
           MOVE MIGR-OPER-NMBR           TO RGL-2-OPER-NMBR.
      *
           IF GRP-REJ-SW = 'Y'
              MOVE 'G'                   TO PET-MRCH-SELECT             02.88
              MOVE '*'                   TO RGL-1-SUS-FLAG
                                            RGL-1-FATAL-FLAG.
           IF GROUP-SUS-SW EQUAL 'Y'
              MOVE 'G'                   TO PET-MRCH-SELECT             02.88
              MOVE 'Y'                   TO PET-MRCH-SUS-FLAG
              MOVE '*'                   TO RGL-1-SUS-FLAG.
           MOVE ERROR-CODE-HOLD-TABLE    TO PET-MRCH-ERROR-CODES.       02.88
           MOVE PET-MRCH-ERROR-CODES     TO WORK-ERROR-CODES.           02.88
           IF ER-CD-3-DIG (1) > ZERO
              MOVE ER-CD-3-DIG (1)       TO RGL-1-ERROR-CD-1.
           IF ER-CD-3-DIG (2) > ZERO
              MOVE ER-CD-3-DIG (2)       TO RGL-1-ERROR-CD-2.
           IF ER-CD-3-DIG (3) > ZERO
              MOVE ER-CD-3-DIG (3)       TO RGL-1-ERROR-CD-3.
           IF ER-CD-3-DIG (4) > ZERO
              MOVE ER-CD-3-DIG (4)       TO RGL-2-ERROR-CD-1.
           IF ER-CD-3-DIG (5) > ZERO
              MOVE ER-CD-3-DIG (5)       TO RGL-2-ERROR-CD-2.
           IF ER-CD-3-DIG (6) > ZERO
              MOVE ER-CD-3-DIG (6)       TO RGL-2-ERROR-CD-3.
      *
           MOVE MIGR-MERCH-NMBR-R(7:10)  TO RAD-ED-MRCH-NMBR.
           MOVE MIGR-REF-NMBR            TO RAD-ED-GROUP-REF-NO.
           MOVE +0                       TO RAD-ED-TRAN-AMT.
      *
           MOVE RPT-GROUP-LINE-1         TO RLW-DETAIL-LINE.
           PERFORM R-920-WRITE-REPORT-RECORD
              THRU R-920-EXIT.
           MOVE RESET-RPT-GROUP-LINE-1   TO RPT-GROUP-LINE-1.
      *
           MOVE RPT-GROUP-LINE-2         TO RLW-DETAIL-LINE.
           PERFORM R-920-WRITE-REPORT-RECORD
              THRU R-920-EXIT.
           MOVE RESET-RPT-GROUP-LINE-2   TO RPT-GROUP-LINE-2.
      *
038240     MOVE PET-MERCHANT TO POST-EDIT-HOLD-MERCH.
           IF MR1-TC-PREF = '28' OR                                     03.31
              MR1-TC-PREF = '30'                                        03.31
                 ADD 1 TO TC-MRCH-ITMS (1)                              03.31
                 ADD PET-MRCH-AMOUNT     TO TC-MRCH-AMOUNT (1).         03.31
038280     IF MR1-TC-PREF EQUAL '31'
038290         ADD 1 TO TC-MRCH-ITMS (2)
038300         ADD PET-MRCH-AMOUNT TO TC-MRCH-AMOUNT (2).
038310 C-300-EXIT.
038320     EXIT.
038330*
038340 C-350-EDIT-MONETARY.
061290     MOVE HLD-RESET-DESCR          TO HLD-DESCR.
           MOVE HLD-RESET-CUST-SVC-PHONE TO KDA-CUST-SVC-PHONE.
           MOVE HLD-RESET-US-CAN-CS-PHONE                               02.37
                                         TO WS-US-CAN-CS-PHONE.         02.37
           MOVE HLD-RESET-URL            TO WS-URL.                     02.37
           MOVE HLD-RESET-EMAIL          TO WS-EMAIL.                   02.37
           MOVE HOLD-MC-ASSIGN-MRCH-ID   TO KDA-MC-ASSIGN-MRCH-ID.      02.39
           MOVE HOLD-MC-PROG-REGIST-ID   TO KDA-MC-PROG-REGIST-ID.
           MOVE SPACES                   TO KDA-ADDENDUM-SWITCHES
                                            KDA-PROGRAM-QUAL-SWITCHES
                                            KDA-CONTACT-EMAIL
                                            WS-RWA-TRAN-SWITCHES
                                            WS-USER-ADJ-REASON-CODES.
           MOVE SPACE                    TO RAD-ED-REJECT-IND.
038380     ADD 1 TO GR-SUM-ITEMS-CTR.
038390     MOVE SPACE TO INV-GRP-TC-SW.
           IF HLD-VALID-SUM-GROUP                                       03.31
              IF PARM-IS-1-SIDED                                        03.31
                 IF NOT MR1-VALID-1-SIDED                               03.31
                    MOVE 'Y'             TO INV-GRP-TC-SW               03.31
                 END-IF                                                 03.31
              ELSE                                                      03.31
                 IF NOT MR1-VALID-2-SIDED                               03.31
                    MOVE 'Y'             TO INV-GRP-TC-SW               03.31
                 END-IF                                                 03.31
              END-IF                                                    03.31
038420     ELSE
              PERFORM S-850-VALID-GRP-TC
                 THRU S-850-EXIT
           END-IF.                                                      03.31
           IF INV-GRP-TC-SW = 'Y'                                       03.31
              IF MR1-VALID-MIS3-TRAN                                    03.31
                 MOVE ONE-AST            TO RCL-1-TRANSCODE             03.31
              ELSE                                                      03.31
                 MOVE ONE-AST            TO RF1-1-TRANSCODE             03.31
              END-IF                                                    03.31
              MOVE 84                    TO ER-CD(ER-INDX)              03.31
              SET ER-INDX UP BY 1                                       03.31
              ADD 1                      TO INV-DET-CTR                 03.31
              MOVE 'Y'                   TO BATCH-REJ-SW                03.31
           END-IF.                                                      03.31
038450     IF INV-DET-CTR EQUAL 3
038460         MOVE ZERO TO INV-DET-CTR
038470         MOVE 96 TO ER-CD (ER-INDX)
038480         PERFORM S-900-BYPASS-BATCH
038490            THRU S-900-EXIT
038510         GO TO C-350-EXIT.
038520     PERFORM T-950-INIT-PET-RECORD
038530        THRU T-950-EXIT.
           IF GRP-REJ-SW = 'Y' OR
              GROUP-SUS-SW = 'Y'
              IF NOT PET-VALID-1-SIDED                                  03.31
                 MOVE 'G'                TO PET-MERCH-SEL-TRANS         03.31
              END-IF                                                    03.31
           END-IF.                                                      03.31
      *
           IF MR1-VALID-MIS3-TRAN                                       03.31
              MOVE MIS3-PRE-EDIT-ERROR-CODE                             02.78
                                         TO WS-MIS3-PRE-EDIT-ERROR-CODE 02.78
              MOVE MIS3-PEF-INVALID-MID                                 03.02
                                         TO WS-MIS3-PEF-MID             03.02
              MOVE MIS3-PEF-DUP-TRAN                                    03.02
                                         TO WS-MIS3-PEF-DUPE            03.02
              MOVE MIS3-PEF-BLOCK-PAN                                   03.02
                                         TO WS-MIS3-PEF-PAN             03.02
              MOVE MIS3-PEF-EXCESS-TRN-AMT                              03.02
                                         TO WS-MIS3-PEF-TRAN-AMT        03.02
              MOVE MIS3-PEF-EXCESS-RET-TOT                              03.02
                                         TO WS-MIS3-PEF-CR-BATCH        03.02
              IF WS-MIS3-PRE-EDIT-FLAGS NOT = SPACES                    03.02
                 IF WS-MIS3-PEF-DUPE = 'Y'                              03.02
                    MOVE 81              TO ER-CD(ER-INDX)              03.02
                    SET ER-INDX UP BY 1                                 03.02
                    MOVE 'Y'             TO PET-SUS-FLAG                03.02
                 END-IF                                                 03.02
                 IF WS-MIS3-PEF-MID = 'Y'                               03.02
                    MOVE 82              TO ER-CD(ER-INDX)              03.02
                    SET ER-INDX UP BY 1                                 03.02
                    MOVE 'Y'             TO PET-SUS-FLAG                03.02
                 END-IF                                                 03.02
                 IF WS-MIS3-PEF-PAN = 'Y'                               03.02
                    MOVE 83              TO ER-CD(ER-INDX)              03.02
                    SET ER-INDX UP BY 1                                 03.02
                    MOVE 'Y'             TO PET-SUS-FLAG                03.02
                 END-IF                                                 03.02
                 IF WS-MIS3-PEF-TRAN-AMT = 'Y'                          03.02
                    MOVE 88              TO ER-CD(ER-INDX)              03.02
                    SET ER-INDX UP BY 1                                 03.02
                    MOVE 'Y'             TO PET-SUS-FLAG                03.02
                 END-IF                                                 03.02
                 IF WS-MIS3-PEF-CR-BATCH = 'Y'                          03.02
                    MOVE 87              TO ER-CD(ER-INDX)              03.02
                    SET ER-INDX UP BY 1                                 03.02
                    MOVE 'Y'             TO PET-SUS-FLAG                03.02
                 END-IF                                                 03.02
              ELSE                                                      03.02
              IF VALID-MIS3-PRE-EDIT-ERROR                              02.78
                 IF WS-MIS3-PRE-EDIT-ERROR-IS-DUP                       02.78
                    MOVE 81              TO ER-CD(ER-INDX)              02.78
                 END-IF                                                 02.78
                 IF WS-MIS3-PRE-EDIT-ERROR-IS-MID                       02.78
                    MOVE 82              TO ER-CD(ER-INDX)              02.78
                 END-IF                                                 02.78
                 IF WS-MIS3-PRE-EDIT-ERROR-IS-PAN                       02.78
                    MOVE 83              TO ER-CD(ER-INDX)              02.78
                 END-IF                                                 02.78
                 IF WS-MIS3-PRE-EDIT-ERROR-IS-RET                       02.78
                    MOVE 87              TO ER-CD(ER-INDX)              02.78
                 END-IF                                                 02.78
                 IF WS-MIS3-PRE-EDIT-ERROR-IS-AMT                       02.78
                    MOVE 88              TO ER-CD(ER-INDX)              02.78
                 END-IF                                                 02.78
                 SET ER-INDX UP BY 1                                    02.78
                 MOVE 'Y'                TO PET-SUS-FLAG                02.78
              END-IF                                                    02.78
              END-IF                                                    03.02
           END-IF.                                                      02.78
      *                                                                 02.78
           IF INVALID-MERCH-SW = 'Y'
              MOVE 47                    TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1
              MOVE 'Y'                   TO PET-SUS-FLAG.
           IF INVALID-MERCH-SW = 'Z'
              MOVE 45                    TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1
              MOVE 'Y'                   TO PET-SUS-FLAG.
           IF INVALID-NAME-ADDR-SW NOT = SPACES
              MOVE 43                    TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1
              MOVE 'Y'                   TO PET-SUS-FLAG.
      *
           IF MR1-VALID-MIS3-TRAN                                       03.31
              MOVE MIS3-AUTHORIZE(6:1)   TO WS-CHD-ICA-ACCT-CAT-TYP-VAL
                                            WS-CHD-DS-ACCT-PROD-TYP-VAL 02.48
              MOVE MIS3-AUTHORIZE        TO RCL-2-AUTH-CODE             02.81
                                            AUTH-SPACE-WORK             02.39
              MOVE MIS3-CARD-TYPE        TO WS-MIS3-CARD-TYPE
                                            PET-MIS3-CARD-TYPE          02.75
              MOVE MIS3-VS-PRODUCT-ID    TO KDA-VS-PRODUCT-ID
              MOVE MIS3-PD-PIN-IND       TO KDA-CHD-PD-PIN-IND          02.29
              MOVE MIS3-PD-REG-IND       TO KDA-CHD-PD-REG-IND          02.81
           ELSE
              MOVE MIS1-AUTH-NO(6:1)     TO WS-CHD-ICA-ACCT-CAT-TYP-VAL
                                            WS-CHD-DS-ACCT-PROD-TYP-VAL 02.48
              MOVE MIS1-AUTH-NO          TO RF1-2-AUTH-CODE             02.81
                                            AUTH-SPACE-WORK             02.39
              MOVE 'N'                   TO KDA-AUTH-CHAR-IND
              MOVE MIS1-PD-PIN-IND       TO KDA-CHD-PD-PIN-IND          02.29
              MOVE SPACE                 TO KDA-CHD-PD-REG-IND          02.81
              IF MIS1-CARD-TYPE = SPACES OR ZEROS                       02.29
                 MOVE SPACES             TO WS-MIS3-CARD-TYPE           02.29
              ELSE                                                      02.29
                 MOVE MIS1-CARD-TYPE     TO WS-MIS3-CARD-TYPE           02.29
              END-IF                                                    02.29
              MOVE WS-MIS3-CARD-TYPE     TO PET-MIS3-CARD-TYPE          02.75
              MOVE SPACES                TO KDA-VS-PRODUCT-ID           02.29
                                            KDA-MC-E-COMM-SEC-LVL-IND
                                            KDA-AUTH-RESP-CD
                                            KDA-POS-ENTRY-MODE
                                            KDA-ELEC-COMM-GOODS-IND
              MOVE ZERO                  TO KDA-VISA-ACCOUNT-SELECT     03.62V
              MOVE +0                    TO KDA-AUTH-MC-USD-AMT
                                            KDA-TRAN-MC-CSH-BK-USD-AMT
              MOVE SPACE                 TO KDA-VALID-SERVICE-CD-X
                                            KDA-CVV2-RESULT
                                            KDA-AUTH-SRCE
                                            KDA-AVS-RESPONSE-CODE
                                            KDA-CAT-TERM-LVL
                                            KDA-CARDHLDR-ID
                                            KDA-POS-ENV
                                            KDA-PHONE-ORD
                                            KDA-MARKET-SPC-AUTH-DATA-IND
                                            KDA-POS-PIN-ENTRY-CAP
                                            KDA-POS-TERM
                                            KDA-PURCHASE-IDENT-FORMAT
                                            KDA-PAY-SVC-IND
                                            KDA-SPEC-COND-IND
                                            KDA-SERV-DEVELOP
                                            KDA-CHIP-COND-CODE
           END-IF.
           IF VALID-MIS3-VISA-CARD-TYPE                                 02.57
              MOVE MIS3-VS-ATM-SETTLE-NET-ID                            02.57
                                         TO KDA-BATCH-ATM-SETTLE-NET    02.57
           ELSE                                                         02.57
              MOVE SPACE                 TO KDA-BATCH-ATM-SETTLE-NET    02.57
           END-IF.                                                      02.57
           IF MR1-VALID-RETURN                                          03.31
              MOVE SPACES                TO AUTH-SPACE-WORK             02.39
              MOVE SPACE                 TO WS-CHD-ICA-ACCT-CAT-TYP-VAL 02.39
                                            WS-CHD-DS-ACCT-PROD-TYP-VAL 02.48
           END-IF.                                                      02.39
           MOVE WS-MIS3-CARD-TYPE        TO KDA-CHD-PD-NETWORK-TYPE.    02.29
      *
           IF NOT MR1-VALID-MIS3-TRAN                                   03.31
              MOVE HOLD-MC-CAT-CODE      TO KDA-MC-CAT-CODE
                                            KDA-PD-CAT-CODE             02.29
              MOVE HOLD-VS-CAT-CODE      TO KDA-SIC-CAT-CODE
              MOVE HOLD-AX-CAT-CODE      TO KDA-AX-CAT-CODE             02.29
              MOVE HOLD-DS-CAT-CODE      TO KDA-DS-CAT-CODE             02.39
           ELSE
              IF MIS3-MRCH-MCC NOT NUMERIC
                 MOVE HOLD-MC-CAT-CODE   TO KDA-MC-CAT-CODE
                                            KDA-PD-CAT-CODE             02.29
                 MOVE HOLD-VS-CAT-CODE   TO KDA-SIC-CAT-CODE
                 MOVE HOLD-AX-CAT-CODE   TO KDA-AX-CAT-CODE             02.29
                 MOVE HOLD-DS-CAT-CODE   TO KDA-DS-CAT-CODE             02.39
              ELSE
                 IF MIS3-MRCH-MCC = ZEROS
                    MOVE HOLD-MC-CAT-CODE   TO KDA-MC-CAT-CODE
                                               KDA-PD-CAT-CODE          02.29
                    MOVE HOLD-VS-CAT-CODE   TO KDA-SIC-CAT-CODE
                    MOVE HOLD-AX-CAT-CODE   TO KDA-AX-CAT-CODE          02.29
                    MOVE HOLD-DS-CAT-CODE   TO KDA-DS-CAT-CODE          02.39
                 ELSE
                    IF MIS3-MRCH-MCC NOT = KDA-MC-CAT-CODE
                       MOVE ZEROS           TO KDA-MC-CAT-CODE
                                               KDA-PD-CAT-CODE          02.29
                       MOVE MIS3-MRCH-MCC   TO KDA-MC-CAT-CODE-X(2:4)
                                               KDA-PD-CAT-CODE-X(2:4)   02.29
                    END-IF
                    IF MIS3-MRCH-MCC NOT = KDA-SIC-CAT-CODE
                       MOVE ZEROS           TO KDA-SIC-CAT-CODE
                       MOVE MIS3-MRCH-MCC   TO KDA-SIC-CAT-CODE-X(2:4)
                    END-IF                                              02.29
                    IF HOLD-AX-CAT-CODE NOT = ZEROES                    03.01
                       MOVE HOLD-AX-CAT-CODE TO KDA-AX-CAT-CODE         03.01
                       IF MIS3-MRCH-MCC NOT = HOLD-AX-CAT-CODE AND      03.01
                          VALID-MIS3-AX-CARD-TYPE                       03.01
                          MOVE '?'          TO RCL-6-CAT-CODE-ERR-IND   03.01
                       END-IF                                           03.01
                    ELSE                                                03.01
                       MOVE ZEROS           TO KDA-AX-CAT-CODE          03.01
                       MOVE MIS3-MRCH-MCC   TO KDA-AX-CAT-CODE-X(2:4)   03.01
                    END-IF                                              03.01
                    IF MIS3-MRCH-MCC NOT = KDA-DS-CAT-CODE              03.55
                       MOVE ZEROS           TO KDA-DS-CAT-CODE          03.55
                       MOVE MIS3-MRCH-MCC   TO KDA-DS-CAT-CODE-X(2:4)   03.55
                    END-IF                                              03.55
                 END-IF                                                 03.55
              END-IF                                                    03.55
           END-IF.                                                      03.55
      *
           IF VALID-MIS3-MC-CARD-TYPE AND KDA-MC-OTHER-AIR              03.12
              MOVE HLD-DESCR-NAME        TO WS-DESCR-NAME               03.12
              MOVE SPACES                TO HLD-DESCR-NAME              03.12
              MOVE WS-DESCR-NAME(1:9)    TO HLD-DESCR-NAME              03.12
           END-IF.                                                      03.12
           MOVE HLD-DESCR                TO PET-DESCR.                  03.12
      *
           IF KDA-SIC-MRCH-TYP = LAST-VS-CAT-CODE
              GO TO C-350-VS-CAT-CODE-DONE.
           MOVE 'N'                      TO CAT-CODE-VVAL.
           MOVE SPACES                   TO EDIT-FILE-REC.
           MOVE 'E'                      TO EFR-REC-KEY-ID.
           MOVE 'V'                      TO EFR-MERCAT-CDTYP.
           MOVE KDA-SIC-MRCH-TYP         TO EFR-MERCAT-CD
                                            LAST-VS-CAT-CODE.
           PERFORM Z-900-READ-EFR
              THRU Z-900-EXIT.
           IF NOT BAS10002-EFR-GOOD                                     02.23
              GO TO C-350-VS-CAT-CODE-DONE.
           MOVE EFR-MERCAT-FLOOR-LMT-CAT TO KDA-MERCAT-FLOOR-LMT-CAT.
           IF NOT EFR-VMERCAT-VS-REP-ONLY
              MOVE 'Y'                   TO CAT-CODE-VVAL.
           MOVE EFR-MERCAT-SVCLVL        TO KDA-VS-SVC-LVL.
           MOVE EFR-MERCAT-SVCCAT        TO KDA-VS-MERCAT-SVCCAT.
           MOVE EFR-MERCAT-TNEIND        TO KDA-MERCAT-TNEIND.
      *
       C-350-VS-CAT-CODE-DONE.
      *
           IF KDA-MC-MRCH-TYP = LAST-MC-CAT-CODE
              GO TO C-350-MC-CAT-CODE-DONE.
           MOVE 'N'                      TO CAT-CODE-MVAL
           MOVE 'R'                      TO BAS10004-CALL-TYPE.
           MOVE SPACES                   TO MC-MCC-KEY.
           MOVE 'E'                      TO MC-REC-KEY-ID.
           MOVE KDA-MC-MRCH-TYP          TO MC-MCC-MERCAT-CD
                                            LAST-MC-CAT-CODE.
           MOVE MC-MCC-KEY               TO BAS10004-MCEDFILE-READ-KEY.
           PERFORM Z9996-CALL-BAS10004
              THRU Z9996-EXIT.
           IF BAS10004-RC-NORMAL
              NEXT SENTENCE
           ELSE
           IF BAS10004-RC-ERROR
              MOVE 99                    TO HLD-RETURN-CD
              GO TO A-100-FINISHUP
           ELSE
              GO TO C-350-MC-CAT-CODE-DONE.
      *
           IF MC-MCC-OBSOLETE-CAT-CD
              MOVE 'N'                   TO CAT-CODE-MVAL
                                            KDA-MMERCAT-VALIND
           ELSE
              MOVE 'Y'                   TO CAT-CODE-MVAL
              MOVE MC-MCC-MERCAT-VALIND  TO KDA-MMERCAT-VALIND          02.41
           END-IF.                                                      02.41
      *
           MOVE MC-MCC-MERCAT-PROGRAM-COUNT
                                         TO KDA-MCC-CAB-PROG-CNT.
           MOVE SPACES                   TO KDA-MCC-CAB-PROGRAMS.
           PERFORM
             VARYING WS-SUB1 FROM +1 BY +1
             UNTIL   WS-SUB1 > MC-MCC-MERCAT-PROGRAM-COUNT
                MOVE MC-MCC-MERCAT-CAB-PROG(WS-SUB1)
                                         TO KDA-MCC-CAB-PROG(WS-SUB1)
           END-PERFORM.
      *
       C-350-MC-CAT-CODE-DONE.
      *
           IF NME-AMEX-SETL-PGM NOT = SPACE                             03.38
              GO TO C-350-AX-CHECK-CAT-CODE.                            03.38
      *                                                                 03.38
           IF KDA-AX-MRCH-TYP = LAST-AX-CAT-CODE                        03.38
              MOVE SPACE                     TO KDA-AMERCAT-VALIND      03.45
                                               KDA-AMERCAT-EAP-VALIND   03.45
              IF WS-MRCH-IS-AMX-EAP                                     03.45
                 MOVE WS-HLD-AMERCAT-EAP-VALIND TO                      03.45
                                            KDA-AMERCAT-EAP-VALIND      03.45
                 MOVE WS-HLD-AMERCAT-EAP-FLAG     TO                    03.45
                                            WS-AMERCAT-1PT-EAP-FLAG     03.45
              ELSE                                                      03.45
                 MOVE WS-HLD-AMERCAT-VALIND TO KDA-AMERCAT-VALIND       03.45
                 MOVE WS-HLD-AMERCAT-1PT-FLAG     TO                    03.45
                                            WS-AMERCAT-1PT-EAP-FLAG     03.45
              END-IF                                                    03.45
              GO TO C-350-AX-CAT-CODE-DONE.                             03.38
      *                                                                 03.38
           MOVE SPACE                    TO WS-HLD-AMERCAT-VALIND       03.45
                                            WS-HLD-AMERCAT-EAP-VALIND   03.45
                                            WS-HLD-AMERCAT-1PT-FLAG     03.45
                                            WS-HLD-AMERCAT-EAP-FLAG     03.45
                                            KDA-AMERCAT-VALIND          03.45
                                            KDA-AMERCAT-EAP-VALIND.     03.38
           MOVE 'N'                      TO CAT-CODE-AVAL               03.38
                                            WS-AMERCAT-1PT-EAP-FLAG.    03.38
           MOVE SPACES                   TO EDIT-FILE-REC.              03.38
           MOVE 'E'                      TO EFR-REC-KEY-ID.             03.38
           MOVE 'A'                      TO EFR-MERCAT-CDTYP.           03.38
           MOVE KDA-AX-MRCH-TYP          TO EFR-MERCAT-CD               03.38
                                            LAST-AX-CAT-CODE.           03.38
           PERFORM Z-900-READ-EFR                                       03.38
              THRU Z-900-EXIT.                                          03.38
           IF NOT BAS10002-EFR-GOOD                                     03.38
              GO TO C-350-AX-CAT-CODE-DONE.                             03.38
           MOVE 'Y'                      TO CAT-CODE-AVAL.              03.38
           MOVE EFR-AMERCAT-EAP-VALIND   TO WS-HLD-AMERCAT-EAP-VALIND.  03.45
           MOVE EFR-AMERCAT-VALIND       TO WS-HLD-AMERCAT-VALIND.      03.45
           MOVE EFR-AMERCAT-EAP-FLAG     TO WS-HLD-AMERCAT-EAP-FLAG.    03.45
           MOVE EFR-AMERCAT-1PT-FLAG     TO WS-HLD-AMERCAT-1PT-FLAG.    03.45
           IF WS-MRCH-IS-AMX-EAP                                        03.38
              MOVE EFR-AMERCAT-EAP-FLAG  TO WS-AMERCAT-1PT-EAP-FLAG     03.38
              MOVE EFR-AMERCAT-EAP-VALIND TO KDA-AMERCAT-EAP-VALIND     03.38
           ELSE                                                         03.38
              MOVE EFR-AMERCAT-1PT-FLAG  TO WS-AMERCAT-1PT-EAP-FLAG     03.38
              MOVE EFR-AMERCAT-VALIND    TO KDA-AMERCAT-VALIND          03.38
           END-IF.                                                      03.38
      *                                                                 03.38
           GO TO C-350-AX-CAT-CODE-DONE.                                03.38
      *                                                                 03.38
       C-350-AX-CHECK-CAT-CODE.                                         03.38
      *                                                                 03.38
           IF MR1-VALID-MIS3-TRAN                                       03.38
              IF VALID-MIS3-AX-CARD-TYPE                                03.38
                 PERFORM I-104B-AMEX-SETL-PGM-ID    THRU I-104B-EXIT    03.38
              END-IF                                                    03.38
           END-IF.                                                      03.38
      *                                                                 03.38
           IF KDA-AX-MRCH-TYP = LAST-AX-CAT-CODE                        02.29
               MOVE SPACE                    TO KDA-AMERCAT-VALIND      03.35
                                                KDA-AMERCAT-EAP-VALIND  03.34F
                IF WS-MRCH-IS-AMX-EAP                                   03.33
                   MOVE WS-HLD-AMERCAT-EAP-VALIND TO                    03.33
                                              KDA-AMERCAT-EAP-VALIND    03.33
                   MOVE WS-HLD-AMERCAT-EAP-FLAG   TO                    03.34F
                                              WS-AMERCAT-1PT-EAP-FLAG   03.34F
                ELSE                                                    03.33
                   MOVE WS-HLD-AMERCAT-VALIND TO KDA-AMERCAT-VALIND     03.34F
                   MOVE WS-HLD-AMERCAT-1PT-FLAG   TO                    03.34F
                                              WS-AMERCAT-1PT-EAP-FLAG   03.34F
                END-IF                                                  03.33
                GO TO C-350-AX-CAT-CODE-DONE                            03.34F
           END-IF.                                                      03.33
      *                                                                 03.33
           MOVE SPACE                    TO WS-HLD-AMERCAT-VALIND       03.33
                                            WS-HLD-AMERCAT-EAP-VALIND   03.33
                                            WS-HLD-AMERCAT-1PT-FLAG     03.34F
                                            WS-HLD-AMERCAT-EAP-FLAG     03.34F
                                            KDA-AMERCAT-VALIND          03.35
                                            KDA-AMERCAT-EAP-VALIND.     03.35
      *                                                                 02.29
           MOVE 'N'                      TO CAT-CODE-AVAL               02.29
                                            WS-AMERCAT-1PT-EAP-FLAG.    03.16A
           MOVE SPACES                   TO EDIT-FILE-REC.              02.29
           MOVE 'E'                      TO EFR-REC-KEY-ID.             02.29
           MOVE 'A'                      TO EFR-MERCAT-CDTYP.           02.29
           MOVE KDA-AX-MRCH-TYP          TO EFR-MERCAT-CD               02.29
                                            LAST-AX-CAT-CODE.           02.29
           PERFORM Z-900-READ-EFR                                       02.29
              THRU Z-900-EXIT.                                          02.29
           IF NOT BAS10002-EFR-GOOD                                     02.29
              GO TO C-350-AX-CAT-CODE-DONE.                             02.29
           MOVE 'Y'                      TO CAT-CODE-AVAL.              02.29
           MOVE EFR-AMERCAT-EAP-VALIND   TO WS-HLD-AMERCAT-EAP-VALIND.  03.37
           MOVE EFR-AMERCAT-VALIND       TO WS-HLD-AMERCAT-VALIND.      03.37
           MOVE EFR-AMERCAT-EAP-FLAG     TO WS-HLD-AMERCAT-EAP-FLAG.    03.37
           MOVE EFR-AMERCAT-1PT-FLAG     TO WS-HLD-AMERCAT-1PT-FLAG.    03.37
           IF WS-MRCH-IS-AMX-EAP                                        03.37
              MOVE EFR-AMERCAT-EAP-FLAG  TO WS-AMERCAT-1PT-EAP-FLAG     03.37
              MOVE EFR-AMERCAT-EAP-VALIND TO KDA-AMERCAT-EAP-VALIND     03.37
           ELSE                                                         03.37
              MOVE EFR-AMERCAT-1PT-FLAG  TO WS-AMERCAT-1PT-EAP-FLAG     03.37
              MOVE EFR-AMERCAT-VALIND    TO KDA-AMERCAT-VALIND          03.37
           END-IF.
      *                                                                 02.29
       C-350-AX-CAT-CODE-DONE.                                          02.29
      *
           IF MR1-VALID-MIS3-TRAN                                       03.47
              IF VALID-MIS3-DS-CARD-TYPE OR                             03.47
                 VALID-MIS3-PP-CARD-TYPE                                03.47
                 PERFORM I-105B-DSC-SETL-PGM-ID                         03.47
                    THRU I-105B-EXIT                                    03.47
              END-IF                                                    03.47
           END-IF.                                                      03.47
      *                                                                 03.38
           IF KDA-DS-MRCH-TYP = LAST-DS-CAT-CODE                        02.39
              GO TO C-350-DS-CAT-CODE-DONE.                             02.39
           MOVE SPACE                    TO KDA-DMERCAT-VALIND          03.38
                                            KDA-DMERCAT-NO-SIG-REQ      03.38
                                            KDA-DMERCAT-CASH-BACK       03.38
                                            KDA-DMERCAT-RECUR-PAY.      03.38
           MOVE 'N'                      TO CAT-CODE-DVAL.              02.39
           MOVE SPACES                   TO EDIT-FILE-REC.              02.39
           MOVE 'E'                      TO EFR-REC-KEY-ID.             02.39
           MOVE 'D'                      TO EFR-MERCAT-CDTYP.           02.39
           MOVE KDA-DS-MRCH-TYP          TO EFR-MERCAT-CD               02.39
                                            LAST-DS-CAT-CODE.           02.39
           PERFORM Z-900-READ-EFR                                       02.39
              THRU Z-900-EXIT.                                          02.39
           IF NOT BAS10002-EFR-GOOD                                     02.39
              GO TO C-350-DS-CAT-CODE-DONE.                             03.01
           MOVE 'Y'                      TO CAT-CODE-DVAL.              02.39
           IF EFR-DISCCAT-VALIND NOT = SPACE                            02.39
              MOVE EFR-DISCCAT-NO-SIG-REQ-ELIG                          02.39
                                         TO KDA-DMERCAT-NO-SIG-REQ      02.39
              MOVE EFR-DISCCAT-CASH-BACK-ELIG                           02.39
                                         TO KDA-DMERCAT-CASH-BACK       02.39
              MOVE EFR-DISCCAT-RECUR-PYMNT-ELIG                         02.39
                                         TO KDA-DMERCAT-RECUR-PAY       02.39
              MOVE EFR-DISCCAT-VALIND    TO KDA-DMERCAT-VALIND.         02.39
      *                                                                 02.39
       C-350-DS-CAT-CODE-DONE.                                          02.39
      *                                                                 02.39
           MOVE BE-CUST-BANK-ID          TO PET-CUST-BANK-ID.
           MOVE HOLD-CUST-ID-1           TO PET-CUST-ID-1.
           MOVE HOLD-CUST-ID-2           TO PET-CUST-ID-2.
           MOVE HOLD-MRCH-TAX-ID-FED     TO PET-MRCH-TAX-ID-FED.
           MOVE HOLD-MRCH-TAX-ID-ST      TO PET-MRCH-TAX-ID-ST.
      *
044590     MOVE MR1-ACCOUNT              TO HLD-ACCOUNT-IN.
           IF MR1-VALID-MIS3-TRAN                                       03.31
              MOVE MIS3-DATE             TO WS-TRAN-DATE-X
              MOVE MIS3-ACCT-NO-EXT-3-X  TO HLD-ACCOUNT-IN-EXT          02.51
           ELSE
              MOVE MIS1-DATE-X           TO WS-TRAN-DATE-X
              MOVE SPACES                TO HLD-ACCOUNT-IN-EXT
           END-IF.
044700     PERFORM T-100-EDIT-ACCOUNT
044710        THRU T-100-EXIT.
           IF INVALID-ACCT-SW = 'Y' AND
              PET-ACCOUNT = ZEROS
                 MOVE 16                 TO PET-LENGTH-ORIG-ACCT
                 MOVE HLD-ACCOUNT-IN     TO PET-ACCOUNT
           END-IF.
      *
           IF MR1-VALID-MIS3-TRAN                                       03.31
              MOVE MIS3-DATE             TO VD-MM-DD
                                            RCL-1-TRAN-DATE
              PERFORM S-815-SET-DATES
                 THRU S-815-EXIT
              IF INVALID-DATE-SW = 'Y'
                 MOVE ONE-AST            TO RCL-1-TRAN-DATE-ERR-IND
                 MOVE 'Y'                TO PET-SUS-FLAG
              END-IF
           ELSE
              MOVE MIS1-DATE-X           TO VD-MM-DD                    02.61
                                            RF1-1-TRAN-DATE
              PERFORM S-815-SET-DATES
                 THRU S-815-EXIT
              IF INVALID-DATE-SW = 'Y'
                 MOVE ONE-AST            TO RF1-1-TRAN-DATE-ERR-IND
                 MOVE 'Y'                TO PET-SUS-FLAG
              END-IF
           END-IF.
      *
           MOVE SPACES                   TO WS-COUNTRY-WORK.
           IF WS-MIS3-CARD-TYPE = SPACES                                02.39
              IF MR1-VALID-MIS3-TRAN                                    03.31
                 MOVE ONE-AST            TO RCL-1-CARD-TYPE-ERR-IND     02.39
              ELSE                                                      02.39
                 MOVE ONE-AST            TO RF1-1-CARD-TYPE-ERR-IND     02.39
              END-IF                                                    02.39
           END-IF.                                                      02.39
           IF PET-CARD-TYPE-VISA                                        03.27
              MOVE KDA-CHD-AR-CARD-USAGE TO PET-VS-CARD-USAGE
              IF NOT KDA-CHD-AR-IS-FND-SRC-CREDIT                       02.81
                 MOVE 'D'                TO PET-DR-CR-CARD              02.77
              END-IF                                                    02.77
              MOVE KDA-CHD-AR-LRG-TKT-IND                               02.81
                                         TO PET-VS-LRG-TKT-IND          02.81
              MOVE KDA-CHD-AR-ACCT-LVL-PROC-IND                         02.81
                                         TO PET-VS-ACCT-LVL-PROC-IND    02.81
              MOVE KDA-CHD-AR-ACCT-FUND-SRC                             02.81
                                         TO PET-VS-ACCT-FUND-SRC        02.81
044760        MOVE BE-ACQ-MEMBER-ID      TO PET-ACQUIRER-ID
090440        MOVE WS-CHD-AR-BIN-COUNTRY TO PET-ISS-COUNTRY
                                            WS-COUNTRY-WORK
005880        MOVE KDA-CHD-AR-BIN-REGION TO PET-ISS-REGN-SUBR
044570        MOVE WS-BATCH-BIN-COUNTRY  TO PET-ACQ-COUNTRY
              MOVE KDA-BATCH-BIN-REGION  TO PET-ACQ-REGN-SUBR           02.81
           END-IF.                                                      02.81
           IF PET-CARD-TYPE-DISCOVER OR PET-CARD-TYPE-PAYPAL            03.47
              IF KDA-CHD-IS-DS-DR                                       02.77
                 MOVE 'D'                TO PET-DR-CR-CARD              02.77
              END-IF                                                    02.77
              MOVE SPACES                TO PET-ISS-COUNTRY             02.48
              MOVE WS-BATCH-DIS-COUNTRY  TO PET-ACQ-COUNTRY             02.39
           END-IF.                                                      02.39
           IF PET-CARD-TYPE-AMEX                                        02.77
              IF KDA-AX-CHD-DEBIT                                       02.77
                 MOVE 'D'                TO PET-DR-CR-CARD              02.77
              END-IF                                                    02.77
           END-IF.                                                      02.77
           IF PET-CARD-TYPE-MC
              MOVE KDA-CHD-ICA-RATE-IND  TO PET-MC-RATE-IND             02.68
              MOVE KDA-CHD-ICA-ACCEPT-BRAND
                                         TO PET-MC-ACCEPT-BRAND-CD
              IF KDA-CHD-ICA-IS-MC-DEBIT                                02.77
                 MOVE 'D'                TO PET-DR-CR-CARD              02.77
              END-IF                                                    02.77
              MOVE KDA-CHD-ICA-CARD-TYPE TO PET-MC-PRODUCT-ID
              MOVE KDA-CHD-ICA-PREPAID   TO PET-MC-PREPAID-IND          02.81
090440        MOVE KDA-CHD-ICA-COUNTRY   TO PET-ISS-COUNTRY
                                            WS-COUNTRY-WORK
044570        MOVE KDA-BATCH-ICA-COUNTRY TO PET-ACQ-COUNTRY
044780        MOVE WS-BATCH-ICA          TO PET-SENDING-ICA             02.61
           END-IF.                                                      02.61
           IF VALID-MIS3-CARD-TYPE-DEBIT                                02.77
              MOVE 'D'                   TO PET-DR-CR-CARD              02.77
              IF KDA-CHD-IS-VALID-PD                                    02.96
                 MOVE KDA-CHD-PD-NETWORK-TYPE                           02.96
                                         TO PET-DEBIT-NETWORK-ID        02.96
              END-IF                                                    02.96
           END-IF.                                                      02.77
           IF WS-COUNTRY-IS-US
              MOVE 'USA'                 TO WS-X-BORDER-COUNTRY
           ELSE
              MOVE WS-COUNTRY-WORK       TO WS-X-BORDER-COUNTRY.
           IF PET-CARD-TYPE-VISA                                        03.27
              IF WS-X-BORDER-COUNTRY-2 NOT = HLD-MRCH-VE-COUNTRY
                 MOVE 'Y'                TO PET-X-BORDER-IND.
           IF PET-CARD-TYPE-MC
              IF WS-X-BORDER-COUNTRY NOT = HLD-INET-COUNTRY
                 MOVE 'Y'                TO PET-X-BORDER-IND.
           IF PET-CARD-TYPE-DISCOVER OR PET-CARD-TYPE-PAYPAL            03.47
              IF HOLD-DISCOVER-COUNTRY-A = 'USA'                        02.39
                 IF KDA-CHD-IS-DS-NOT-ISS-US                            02.39
                    MOVE 'Y'             TO PET-X-BORDER-IND            02.39
                 END-IF                                                 02.39
              ELSE                                                      02.39
                 IF KDA-CHD-IS-DS-ISS-US                                02.39
                    MOVE 'Y'             TO PET-X-BORDER-IND            02.39
                 END-IF                                                 02.39
              END-IF                                                    02.39
           END-IF.                                                      02.39
           IF PET-CARD-TYPE-AMEX                                        03.16A
              IF KDA-AX-CHD-INTL                                        03.16A
                 MOVE 'Y'             TO PET-X-BORDER-IND               03.16A
              END-IF                                                    03.16A
           END-IF.                                                      03.16A
044840     IF INVALID-ACCT-SW = 'Y'
PROMST        SET WS-ARC-SET-E07 TO TRUE
044880        MOVE 'Y'                   TO PET-SUS-FLAG
              IF MR1-VALID-MIS3-TRAN                                    03.31
                 MOVE ONE-AST            TO RCL-1-ACCT-NO-ERR-IND       02.39
              ELSE                                                      02.39
                 MOVE ONE-AST            TO RF1-1-ACCT-NO-ERR-IND       02.39
              END-IF                                                    02.39
           END-IF.                                                      02.39
           IF WS-MIS3-CARD-TYPE = 'DB' OR                               02.29
              VALID-MIS3-PD-NET                                         02.29
                 MOVE 'B'                TO WS-ARI-CARD                 02.29
           ELSE
           IF WS-MIS3-CARD-TYPE = 'EB'
              MOVE 'T'                   TO WS-ARI-CARD
           ELSE
           IF PET-CARD-USED = 'P'
              MOVE 'P'                   TO WS-ARI-CARD
           ELSE
              MOVE WS-MIS3-CARD-TYPE(1:1)
                                         TO WS-ARI-CARD.
041230     ADD 1                         TO WS-ARI-SEQ-NUM.
003140     MOVE +0                       TO WS-ADD-REC-CNT.
           MOVE WS-GROUP-REF-ID          TO PET-GROUP-REF-ID.
           MOVE HLD-BTCH-NMBR            TO PET-BATCH-NMBR.
           MOVE WS-HRI-SEQ-NUM           TO PET-BATCH-SEQ.
041240     MOVE WS-ADDENDUM-REF-ID       TO PET-ADDENDUM-REF-ID
                                            WS-DFR-KEY.
048970     MOVE 'N'                      TO WS-ADD-SUS-FLAG.
064360     MOVE ZEROS                    TO WS-SAVE-SUB-SEQ
                                            WS-SAVE-SUB-SEQ-TOT
                                            WS-DFR-CNT.
           MOVE 1                        TO WS-NEXT-SUB-SEQ
                                            WS-LAST-98-SEQ-TOT.
039320     MOVE 'N'                      TO WS-SEQ-TOTAL-REACHED.
041400     MOVE SPACES                   TO HOLD-LU-ADDENDUM
                                            HOLD-M1-ADDENDUM
                                            WS-MIMFCC-DATA
                                            WS-CHECK-ADD-TRAN
                                            WS-LAST-ADD-TRAN
                                            WS-DFR-TABLE.
      *
           IF (WS-MIS3-CARD-TYPE = 'M ' AND                             03.47
               BE-CF-MC-SETL = 'N') OR
              (WS-MIS3-CARD-TYPE = 'V ' AND                             03.47
               BE-CF-VS-SETL = 'N') OR
              (WS-MIS3-CARD-TYPE = 'DS' AND
               BE-CF-DS-SETL = 'R') OR                                  02.29
              (WS-MIS3-CARD-TYPE = 'PP' AND                             03.47
               BE-CF-DS-SETL = 'R') OR                                  03.47
              (WS-MIS3-CARD-TYPE = 'AX' AND                             02.29
               BE-CF-AX-SETL = 'N')                                     02.29
              PERFORM C-410-NO-EDITS
                 THRU C-410-EXIT
              GO TO C-350-EXIT.
           IF WS-MIS3-CARD-TYPE = 'DB' OR 'EB'                          03.00
              PERFORM C-410-NO-EDITS
                 THRU C-410-EXIT
              GO TO C-350-EXIT.
      *
038540     PERFORM C-400-CARDHOLDER-TRANS
038550        THRU C-400-EXIT.
038560 C-350-EXIT.
038570     EXIT.
038580*
038590 C-360-GET-ADDENDUMS.
           MOVE ZERO                     TO ERR-LVL3-LAST-ITEM-IND.
           MOVE SPACES                   TO ERR-LVL3-MESSAGE-ID.
           MOVE BASCRATE-SD-BANK-KEY     TO ERR-TRAN-BATCH-KEY.
           MOVE BASCRATE-SD-BATCH-CURR-DEC
                                         TO ERR-TRAN-CURR-DEC.
           MOVE HLD-WORK-AS-OF-DATE      TO ERR-WAO-DATE-MMDDYY.
           MOVE 'N'                      TO END-OF-AM07-SW.
           MOVE 'Y'                      TO WS-2ND-RECEIVED-FLAG.
           MOVE HLD-DESCR-NAME           TO KDA-MM-DESCR-NAME.          03.20
           MOVE HLD-DESCR-ADDR           TO KDA-MM-DESCR-ADDR.          03.20
           MOVE HLD-DESCR-CITY           TO KDA-MM-DESCR-CITY.          03.20
           MOVE HLD-DESCR-STATE          TO KDA-MM-DESCR-STATE.         03.20
           MOVE HLD-DESCR-COUNTRY        TO KDA-MM-DESCR-CNTRY.         03.20
           MOVE HLD-ZIP-WORK             TO KDA-MM-DESCR-POSTAL.        03.20
           MOVE KDA-AX-MRCH-TYP          TO KDA-MM-DESCR-MCC.           03.20
           PERFORM
              UNTIL END-OF-INPUT OR
                    END-OF-AM07
                 PERFORM C-365-READ-TRANS-IN
                    THRU C-365-EXIT
                 IF NOT END-OF-INPUT
                    IF HT-TRANSCODE = 'AM07'
                       MOVE 'I'          TO BASDADDM-CALL-TYPE          02.88
                       MOVE MIAR-SUB-TRAN                               02.88
                                         TO AWR-TRAN                    02.88
                       MOVE WS-ADDENDUM-REF-ID                          02.88
                                         TO AWR-REF-NO                  02.88
                       MOVE MIAR-SUB-SEQ-X                              02.88
                                         TO AWR-SEQ-X                   02.88
                       COMPUTE AWR-REC-CNT = WS-ADD-REC-CNT             02.88
                       PERFORM Z9ADM-CALL-BASDADDM                      02.88
                          THRU Z9ADM-EXIT                               02.88
                       PERFORM C-370-EDIT-ADDENDUM
                          THRU C-370-EXIT
                    ELSE
                       MOVE 'Y'          TO END-OF-AM07-SW
                    END-IF
                 END-IF
           END-PERFORM.
      *
           IF NOT WS-2ND-RECEIVED OR
             (WS-SAVE-SUB-SEQ NOT = WS-SAVE-SUB-SEQ-TOT)
              MOVE 'Y'                   TO WS-ADD-SUS-FLAG
              IF WS-SAVE-SUB-SEQ NOT = WS-SAVE-SUB-SEQ-TOT
                 MOVE WS-SAVE-SUB-SEQ    TO RJA-TOT-RECEIVED
                 MOVE WS-SAVE-SUB-SEQ-TOT
                                         TO RJA-TOT-EXPECTED
                 MOVE RPT-REJECT-ADDENDUM
                                         TO RLW-DETAIL-LINE
              ELSE
                 MOVE RPT-REJECT-ALL-ADDENDUM
                                         TO RLW-DETAIL-LINE
              END-IF
              PERFORM R-920-WRITE-REPORT-RECORD
                 THRU R-920-EXIT
           END-IF.
           IF WS-ADD-SUS-FLAG = 'Y'
              MOVE 'Y'                   TO PET-ADD-SUS-FLAG.
      *
038700 C-360-EXIT.
038710     EXIT.
038720*
038730 C-365-READ-TRANS-IN.
038750     MOVE SPACES                   TO HOLD-TRANSACTION.
           MOVE +100                     TO END-SUB.                    02.49
038750     READ DAILY-TRANS INTO HT-FIRST-100
038760        AT END
038770           MOVE 'Y'                TO END-OF-INPUT-SW
038780           GO TO C-365-EXIT.
038790     IF HT-TRANSCODE = 'AM07'
018900        MOVE '0'                   TO RIA-CC
018900                                      RAA-CC
038800        MOVE 'N'                   TO WS-HELD-REC
038810     ELSE
038820        MOVE 'Y'                   TO WS-HELD-REC
038990        GO TO C-365-NOT-ADDENDUM.
038730 C-365-READ-TRANS-CONT.
039000     MOVE HT-FIRST-100             TO MERCHANT-INPUT-ADDENDUM.
           MOVE MIAR-SUB-TRAN            TO WS-CHECK-SUB-TRAN.
      *
           IF WCST-AMEX-TRANS
              MOVE MIAX-TYPE-DATA        TO WS-CHECK-SUB-CODE
           ELSE
           IF WCST-DIS-TRANS
              MOVE ZEROS                 TO WS-CHECK-SUB-CODE
              MOVE MIDS-TYPE-CD-X        TO WS-CHECK-SUB-CODE(1:2)
           ELSE
              MOVE ZEROS                 TO WS-CHECK-SUB-CODE
              IF WCST-MC-TRANS
                 MOVE MIMPCA-INDUSTRY-REC-NO-X
                                         TO WS-CHECK-SUB-CODE(2:3)
              END-IF
           END-IF.
           SET ATE-INDX                  TO 1.
           SEARCH WS-AT-ENTRY
              VARYING ATE-INDX
                 AT END
                    GO TO C-365-NOT-VALID-ADDENDUM
                 WHEN WS-ATE-TRAN(ATE-INDX) = WS-CHECK-ADD-TRAN
                    MOVE WS-ATE-LGTH(ATE-INDX)
                                         TO WS-ADD-REM-LGTH
                                            END-SUB                     02.49
                    MOVE WS-ATE-VALID-1ST(ATE-INDX)
                                         TO WS-ADD-VALID-1ST
                    MOVE WS-ATE-MAX-NO(ATE-INDX)
                                         TO WS-ADD-MAX-NO.
      *
           IF ADD-IS-VALID-2ND-REQ
              MOVE 'N'                   TO WS-2ND-RECEIVED-FLAG
           ELSE
              MOVE 'Y'                   TO WS-2ND-RECEIVED-FLAG.
      *
           PERFORM
              VARYING SUB1 FROM +2 BY +1
              UNTIL   SUB1 > +30 OR
                      END-OF-INPUT OR
                      WS-ADD-REM-LGTH < +101
                 READ DAILY-TRANS INTO MID-LAYOUT(SUB1)
                    AT END
                       MOVE 'Y'          TO END-OF-INPUT-SW
                 END-READ
                 COMPUTE WS-ADD-REM-LGTH = WS-ADD-REM-LGTH - 100
           END-PERFORM.
           COMPUTE WS-ADD-REC-CNT = SUB1 - 1.
           PERFORM S-515-CHECK-SPACE-FILL-ADDM                          02.49
              THRU S-515-EXIT.                                          02.49
      *
           GO TO C-365-EXIT.
038980*
038990 C-365-NOT-VALID-ADDENDUM.
018900     MOVE HT-FIRST-100             TO RIA-DATA.
042050     MOVE RPT-INVALID-ADDENDUM     TO RLW-DETAIL-LINE.
064380     PERFORM R-920-WRITE-REPORT-RECORD
064390        THRU R-920-EXIT.
           MOVE 'I'                      TO RAD-ED-LINE-TYPE.
           MOVE +0                       TO RAD-ED-TRAN-AMT.
038750     MOVE SPACES                   TO HOLD-TRANSACTION.
038750     READ DAILY-TRANS INTO HT-FIRST-100
038760        AT END
038770           MOVE 'Y'                TO END-OF-INPUT-SW
038780           GO TO C-365-EXIT.
031200     SET VAL-INDX                  TO 1.
031210     SEARCH VAL-TRANSCODE
031220            VARYING VAL-INDX
031230               AT END
018900                  MOVE SPACE       TO RIA-CC
018900                                      RAA-CC
038990                  GO TO C-365-NOT-VALID-ADDENDUM
031250               WHEN VAL-TC-TC(VAL-INDX) = HT-TRANSCODE
031260                  NEXT SENTENCE.
038790     IF HT-TRANSCODE = 'AM07'
018900        MOVE '0'                   TO RIA-CC
018900                                      RAA-CC
038800        MOVE 'N'                   TO WS-HELD-REC
038730        GO TO C-365-READ-TRANS-CONT.
038820     MOVE 'Y'                      TO WS-HELD-REC.
038980*
038990 C-365-NOT-ADDENDUM.
083310     MOVE 'Y'                      TO WS-FIRST-ADDENDUM-SW.
039270     MOVE 1                        TO WS-NEXT-SUB-SEQ.
039020     MOVE HT-TRANSCODE             TO WS-TRANSCODE.
      *                                                                 02.64
           IF WS-HELD-REC = 'Y' AND                                     02.64
             (HT-TRANSCODE(1:2) = '06' OR '07' OR '0O' OR '32' OR '58') 02.64
              MOVE MR5-FIRST-100         TO HOLD-TRANSACTION-1          02.64
              MOVE HT-FIRST-100          TO MR5-FIRST-100               02.64
              MOVE WS-MIS3-CARD-TYPE     TO WS-SAVE-MIS3-TYPE           02.66
              PERFORM C-750-TALLY-BAL-REC-INPUT                         02.64
                 THRU C-750-EXIT                                        02.64
              MOVE WS-SAVE-MIS3-TYPE     TO WS-MIS3-CARD-TYPE           02.66
              MOVE HOLD-TRANSACTION-1    TO MR5-FIRST-100               02.64
           END-IF.                                                      02.64
      *                                                                 02.64
039040     IF WS-QUAD-RECORD
              MOVE +400                  TO END-SUB                     02.49
              READ DAILY-TRANS INTO HT-SECOND-100                       02.49
                 AT END                                                 02.49
                    MOVE 'Y'             TO END-OF-INPUT-SW             02.49
                    GO TO C-365-EXIT.                                   02.49
039090     IF WS-QUAD-RECORD
039100        READ DAILY-TRANS INTO HT-THIRD-100
039110           AT END
039120              MOVE 'Y'             TO END-OF-INPUT-SW
039080              GO TO C-365-EXIT.
039090     IF WS-QUAD-RECORD
039100        READ DAILY-TRANS INTO HT-FOURTH-100
039110           AT END
039120              MOVE 'Y'             TO END-OF-INPUT-SW.
           PERFORM S-510-CHECK-SPACE-FILL-HOLD                          02.49
              THRU S-510-EXIT.                                          02.49
039130*
039140 C-365-EXIT.
039150     EXIT.
039160*
039170 C-370-EDIT-ADDENDUM.
           MOVE 'A'                      TO RAD-ED-LINE-TYPE.
           MOVE +0                       TO RAD-ED-TRAN-AMT.
           MOVE ZERO                     TO RAD-ED-REPORT-TYPE.
048980     SET ADD-ER-INDX               TO 1.
031050     MOVE ZEROS                    TO ADD-ERR-CODE-TABLE.
030220     MOVE ZEROS                    TO ERR-CD-TABLE.
030220     MOVE +0                       TO ERR-CD-SUB.
      *
      * EMV RETURNS WILL HAVE CHIP CARD DATA SO ALLOW THESE TYPES OF    02.95
      * RETURNS TO HAVE ADDENDA                                         02.95
           IF PET-CARD-TYPE-AMEX                                        CPS
             NEXT SENTENCE                                              CPS
           ELSE                                                         CPS
             IF PET-VALID-RETURN       AND                              03.31
             NOT WCST-VISA-EMV         AND                              02.95
             NOT WCST-MC-EMV           AND                              02.95
             NOT WCSC-DS-EMV                                            02.95
               MOVE 106                  TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
               PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
               SET ADD-ER-INDX UP BY 1
             END-IF                                                     CPS
           END-IF.                                                      CPS
      *
           IF WS-LAST-ADD-TRAN = WS-CHECK-ADD-TRAN
              ADD 1                      TO WS-ADD-MAX-CNT
              IF ADD-IS-VALID-MANY AND
                (NOT WS-2ND-RECEIVED)
                    MOVE 103             TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                    PERFORM S-095-MOVE-ERROR-CODES
                       THRU S-095-EXIT
                    SET ADD-ER-INDX UP BY 1
              END-IF
           ELSE
              MOVE 1                     TO WS-ADD-MAX-CNT
              IF MIAR-SUB-SEQ-X = '0001'
                 MOVE +1                 TO WS-NEXT-SUB-SEQ
                 IF ADD-IS-VALID-1ST
                    MOVE 'Y'             TO WS-FIRST-ADDENDUM-SW
                 ELSE
                    MOVE 199             TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                    PERFORM S-095-MOVE-ERROR-CODES
                       THRU S-095-EXIT
                    SET ADD-ER-INDX UP BY 1.
      *
           IF WS-ADD-MAX-CNT > WS-ADD-MAX-NO
              MOVE 103                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT
              SET ADD-ER-INDX UP BY 1.
      *
           IF MIAR-SUB-SEQ-X NUMERIC
              MOVE MIAR-SUB-SEQ-NUM      TO WS-SAVE-SUB-SEQ
              IF MIAR-SUB-SEQ-X = ZEROS
                 MOVE 199                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
           ELSE
              MOVE ZEROS                 TO WS-SAVE-SUB-SEQ
              MOVE 199                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT
              SET ADD-ER-INDX UP BY 1.
      *
           IF MIAR-SUB-SEQ-TOT-X NUMERIC
              IF MIAR-SUB-SEQ-X = '0001'
                 MOVE MIAR-SUB-SEQ-TOT-NUM
                                         TO WS-SAVE-SUB-SEQ-TOT
              END-IF
              IF MIAR-SUB-SEQ-TOT-X = ZEROS
                 MOVE 101                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
           ELSE
              MOVE ZEROS                 TO WS-SAVE-SUB-SEQ-TOT
              MOVE 101                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT
              SET ADD-ER-INDX UP BY 1.
      *
           IF MIAR-SUB-SEQ-X = '0001'
              IF WS-FIRST-ADDENDUM-SW = 'Y'
                 IF ADD-IS-VALID-2ND-REQ
                    MOVE 'N'             TO WS-2ND-RECEIVED-FLAG
                 ELSE
                    MOVE 'Y'             TO WS-2ND-RECEIVED-FLAG
                 END-IF
                 IF ADD-IS-VALID-1ST
                    MOVE 'N'             TO WS-FIRST-ADDENDUM-SW
                 ELSE
                    MOVE 101             TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                    PERFORM S-095-MOVE-ERROR-CODES
                       THRU S-095-EXIT
                    SET ADD-ER-INDX UP BY 1
              ELSE
                 MOVE 101                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
           ELSE
              IF ADD-IS-VALID-1ST
                 IF ADD-IS-VALID-2ND-REQ
                    MOVE 'N'             TO WS-2ND-RECEIVED-FLAG
                 ELSE
                    MOVE 'Y'             TO WS-2ND-RECEIVED-FLAG
                 END-IF
                 IF ADD-IS-VALID-2ND-REQ
                    IF NOT ADD-IS-VALID-MANY
                       MOVE 101          TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                       PERFORM S-095-MOVE-ERROR-CODES
                          THRU S-095-EXIT
                       SET ADD-ER-INDX UP BY 1.
      *
           IF WS-SAVE-SUB-SEQ = WS-NEXT-SUB-SEQ
              ADD +1                     TO WS-NEXT-SUB-SEQ
           ELSE
              MOVE 105                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT
              SET ADD-ER-INDX UP BY 1.
      *
           IF WS-SAVE-SUB-SEQ > WS-SAVE-SUB-SEQ-TOT
              MOVE 102                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT
              SET ADD-ER-INDX UP BY 1.
      *
       C-370-CHECK-DISCOVER-ADDENDUM.
           IF NOT WCST-DIS-TRANS
              GO TO C-370-CHECK-AMEX-ADDENDUM.
           IF NOT PET-CARD-TYPE-DISCOVER AND                            03.47
              NOT PET-CARD-TYPE-PAYPAL                                  03.47
              MOVE 104                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT
              SET ADD-ER-INDX UP BY 1
              GO TO C-370-CALL-BAS110AR.
           IF WCSC-DS-GEOGRAPHIC
              IF KDA-HAS-DS-04
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              GO TO C-370-CALL-BAS110AR
           END-IF.
           IF WCSC-DS-CAR-RENTAL
              IF KDA-MERCAT-CAR-RENT OR
                 KDA-MRCH-TYP-AGENTS
                    CONTINUE
              ELSE
                 MOVE 116                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              GO TO C-370-CALL-BAS110AR
           END-IF.
           IF WCSC-DS-TELECOM                                           03.36
              IF KDA-HAS-DS-12                                          03.36
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)03.36
                                            WS-ERR-CD                   03.36
                 PERFORM S-095-MOVE-ERROR-CODES                         03.36
                    THRU S-095-EXIT                                     03.36
                 SET ADD-ER-INDX UP BY 1                                03.36
              END-IF                                                    03.36
              IF KDA-DS-MRCH-TYP-TELE                                   03.36
                 NEXT SENTENCE                                          03.36
              ELSE                                                      03.36
                 MOVE 116                   TO WS-ERR-CD                03.36
                 PERFORM S-095-MOVE-ERROR-CODES                         03.36
                    THRU S-095-EXIT.                                    03.36
              GO TO C-370-CALL-BAS110AR.                                03.36
           IF WCSC-DS-FLEET
              GO TO C-370-CALL-BAS110AR
           END-IF.
           IF WCSC-DS-EMV                                               02.95
              MOVE 'N'                   TO WS-ERROR-SW                 02.95
              IF KDA-HAS-DS-13                                          02.95
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.95
                                            WS-ERR-CD                   02.95
                 PERFORM S-095-MOVE-ERROR-CODES                         02.95
                    THRU S-095-EXIT                                     02.95
                 SET ADD-ER-INDX UP BY 1                                02.95
              END-IF                                                    02.95
              IF KDA-VC-POS-ENTRY-DIS-CHIP                              02.95
                 CONTINUE                                               02.95
              ELSE                                                      02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RCL-3-POS-E-MOD-ERR-IND     02.95
              END-IF                                                    02.95
              IF KDA-DS-DEVICE-ATTEND-IND = '2'                         02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RDS-2-POS-DATA-CD-ERR-IND(1)02.95
              END-IF                                                    02.95
              IF NOT KDA-VC-DS-CRDHLDR-IS-PRSNT                         02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RDS-2-POS-DATA-CD-ERR-IND(4)02.95
              END-IF                                                    02.95
              IF KDA-DS-DEVICE-LOC = '2' OR '3'                         02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RDS-2-POS-DATA-CD-ERR-IND(3)02.95
              END-IF                                                    02.95
              IF NOT KDA-VC-DS-CRD-IS-PRSNT                             02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RDS-2-POS-DATA-CD-ERR-IND(5)02.95
              END-IF                                                    02.95
              IF KDA-DS-CRD-INP-CAP = '5' OR 'C' OR 'H' OR 'R'          02.95
                 CONTINUE                                               02.95
              ELSE                                                      02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST           TO RDS-2-POS-DATA-CD-ERR-IND(11)02.95
              END-IF                                                    02.95
              IF ERROR-FOUND                                            02.95
                 MOVE 'Y'                TO PET-SUS-FLAG                02.95
                 MOVE 116                TO ER-CD-3-DIG(ER-INDX)        02.95
                 SET ER-INDX UP BY 1                                    02.95
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.95
                                            WS-ERR-CD                   02.95
                 PERFORM S-095-MOVE-ERROR-CODES                         02.95
                    THRU S-095-EXIT                                     02.95
                 SET ADD-ER-INDX UP BY 1                                02.95
              END-IF                                                    02.95
              GO TO C-370-CALL-BAS110AR                                 02.95
           END-IF.                                                      02.95
           IF WCSC-DS-LODGING
              IF KDA-MERCAT-LODGING OR
                 KDA-MRCH-TYP-AGENTS
                    CONTINUE
              ELSE
                 MOVE 116                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              GO TO C-370-CALL-BAS110AR
           END-IF.
           IF WCSC-DS-AIRLINE                                           03.03
              IF KDA-DS-MRCH-TYP-PASS-TRAN OR                           03.03
                 KDA-PP-MRCH-TYP-PASS-TRAN                              03.03
                    CONTINUE                                            03.03
              ELSE                                                      03.03
                 MOVE 116                TO WS-ERR-CD                   03.03
                 PERFORM S-095-MOVE-ERROR-CODES                         03.03
                    THRU S-095-EXIT                                     03.03
                 SET ADD-ER-INDX UP BY 1                                03.03
              END-IF                                                    03.03
              GO TO C-370-CALL-BAS110AR                                 03.03
           END-IF.                                                      03.03
           IF WCSC-DS-AT-LEGS                                           03.03
              IF KDA-DS-MRCH-TYP-PASS-TRAN OR                           03.03
                 KDA-PP-MRCH-TYP-PASS-TRAN                              03.03
                    CONTINUE                                            03.03
              ELSE                                                      03.03
                 MOVE 116                TO WS-ERR-CD                   03.03
                 PERFORM S-095-MOVE-ERROR-CODES                         03.03
                    THRU S-095-EXIT                                     03.03
                 SET ADD-ER-INDX UP BY 1                                03.03
              END-IF                                                    03.03
              GO TO C-370-CALL-BAS110AR                                 03.03
           END-IF.                                                      03.03
           IF WCSC-DS-PROMO-PGM                                         03.16D
              IF KDA-HAS-DS-17                                          03.16D
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)03.16D
                                            WS-ERR-CD                   03.16D
                 PERFORM S-095-MOVE-ERROR-CODES                         03.16D
                    THRU S-095-EXIT                                     03.16D
                 SET ADD-ER-INDX UP BY 1                                03.16D
              END-IF                                                    03.16D
              GO TO C-370-CALL-BAS110AR                                 03.16D
           END-IF.                                                      03.16D
           IF WCSC-DS-REF-ID                                            03.16D
              IF KDA-HAS-DS-18                                          03.16D
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)03.16D
                                            WS-ERR-CD                   03.16D
                 PERFORM S-095-MOVE-ERROR-CODES                         03.16D
                    THRU S-095-EXIT                                     03.16D
                 SET ADD-ER-INDX UP BY 1                                03.16D
              END-IF                                                    03.16D
              IF KDA-CHD-IS-DS-NET-PAYPAL                               03.16D
                 CONTINUE                                               03.16D
              ELSE                                                      03.16D
                 MOVE 116                TO WS-ERR-CD                   03.16D
                 PERFORM S-095-MOVE-ERROR-CODES                         03.16D
                    THRU S-095-EXIT                                     03.16D
                 SET ADD-ER-INDX UP BY 1                                03.16D
              END-IF                                                    03.16D
              GO TO C-370-CALL-BAS110AR                                 03.16D
           END-IF.                                                      03.16D
           GO TO C-370-CALL-BAS110AR.
      *
039170 C-370-CHECK-AMEX-ADDENDUM.
039180     IF NOT WCST-AMEX-TRANS
039170        GO TO C-370-CHECK-LVL3-PURCHASE.                          03.00
           IF NOT PET-CARD-TYPE-AMEX
              MOVE 104                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
              SET ADD-ER-INDX UP BY 1
              GO TO C-370-CALL-BAS110AR.
      * ADVICE DETAIL VALID IN ALL COMBINATIONS
           IF MIAR-SUB-TRAN = 'AD'
              IF KDA-HAS-AD
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              GO TO C-370-CALL-BAS110AR
           END-IF.
      * LOCATION DETAIL VALID IN ALL COMBINATIONS
           IF WCSC-AMEX-LOCATION
              IF KDA-HAS-AX-LD
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              GO TO C-370-CALL-BAS110AR
           END-IF.
      * CPS DETAIL VALID IN ALL COMBINATIONS                            02.81
           IF WCSC-AMEX-CPS                                             02.81
              IF KDA-HAS-AX-CPS                                         CPS
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)CPS
                                            WS-ERR-CD                   CPS
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT         CPS
                 SET ADD-ER-INDX UP BY 1                                CPS
              END-IF                                                    CPS
              GO TO C-370-CALL-BAS110AR                                 CPS
           END-IF.                                                      CPS
      * NO COMBINATIONS OF DIFFERENT INDUSTRY-SPECIFIC RECORDS ARE VALID
           IF WCSC-AMEX-INSURE
              IF KDA-HAS-AX-II
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              IF NOT VALID-AMEX-II
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.60
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              GO TO C-370-CALL-BAS110AR
           END-IF.
           IF WCSC-AMEX-CAR-RENTAL
              IF KDA-HAS-AX-VR
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              IF NOT VALID-AMEX-VR
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.60
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              GO TO C-370-CALL-BAS110AR
           END-IF.
           IF WCSC-AMEX-LODGING
              IF KDA-HAS-AX-LG
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              IF NOT VALID-AMEX-LG
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.60
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              GO TO C-370-CALL-BAS110AR
           END-IF.
           IF WCSC-AMEX-COMMUNICATIONS                                  03.36
              IF KDA-HAS-AX-CM                                          03.36
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)03.36
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT         03.36
                 SET ADD-ER-INDX UP BY 1                                03.36
              END-IF                                                    03.36
              IF NOT VALID-AMEX-CM                                      03.36
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)03.36
                                            WS-ERR-CD                   03.36
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT         03.36
                 SET ADD-ER-INDX UP BY 1                                03.36
              END-IF                                                    03.36
              GO TO C-370-CALL-BAS110AR                                 03.36
           END-IF.                                                      03.36
           IF WCSC-AMEX-RETAIL
              IF KDA-HAS-AX-RI                                          02.81
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              IF NOT VALID-AMEX-RI
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.60
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              GO TO C-370-CALL-BAS110AR
           END-IF.
           IF WCSC-AMEX-ENT-TKT
              IF KDA-HAS-AX-ET
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              IF NOT VALID-AMEX-ET
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.60
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              END-IF
              GO TO C-370-CALL-BAS110AR
           END-IF.
           IF WCSC-AMEX-EMV                                             02.95
              PERFORM I-104A-AMEX-POS-DATA-CODES THRU I-104A-EXIT       02.95
              MOVE 'N'                   TO WS-ERROR-SW                 02.95
              IF KDA-HAS-AX-EMV                                         02.95
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.95
                                            WS-ERR-CD                   02.95
                 PERFORM S-095-MOVE-ERROR-CODES                         02.95
                    THRU S-095-EXIT                                     02.95
                 SET ADD-ER-INDX UP BY 1                                02.95
              END-IF                                                    02.95
              IF NOT KDA-VC-CRD-DTA-INP-CAP-5                           02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RAX-1-POS-DATA-CD-ERR-IND(1)02.95
              END-IF                                                    02.95
              IF KDA-OPER-ENV = '0' OR '9' OR 'S' OR 'T'                02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RAX-1-POS-DATA-CD-ERR-IND(4)02.95
              END-IF                                                    02.95
              IF KDA-CRDHLDR-PRSNT  NOT = '0'                           02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RAX-1-POS-DATA-CD-ERR-IND(5)02.95
              END-IF                                                    02.95
              IF KDA-CRD-PRSNT = '0'                                    02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RAX-1-POS-DATA-CD-ERR-IND(6)02.95
              END-IF                                                    02.95
              IF KDA-DTA-INP-MOD NOT = '5' AND                          02.95
                 KDA-DTA-INP-MOD NOT = '9'                              02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RAX-1-POS-DATA-CD-ERR-IND(7)02.95
              END-IF                                                    02.95
              IF ERROR-FOUND                                            02.95
                 MOVE 'Y'                TO PET-SUS-FLAG                02.95
                 MOVE 116                TO ER-CD-3-DIG(ER-INDX)        02.95
                 SET ER-INDX UP BY 1                                    02.95
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.95
                                            WS-ERR-CD                   02.95
                 PERFORM S-095-MOVE-ERROR-CODES                         02.95
                    THRU S-095-EXIT                                     02.95
                 SET ADD-ER-INDX UP BY 1                                02.95
              END-IF                                                    02.95
              GO TO C-370-CALL-BAS110AR                                 02.95
           END-IF.                                                      02.95
           IF WCSC-AMEX-AIRLINE                                         03.03
              IF KDA-HAS-AX-AI                                          03.03
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)03.03
                                            WS-ERR-CD                   03.03
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT         03.03
                 SET ADD-ER-INDX UP BY 1                                03.03
              END-IF                                                    03.03
              IF NOT VALID-AMEX-AI                                      03.03
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)03.03
                                            WS-ERR-CD                   03.03
                 PERFORM S-095-MOVE-ERROR-CODES THRU S-095-EXIT         03.03
                 SET ADD-ER-INDX UP BY 1                                03.03
              END-IF                                                    03.03
              GO TO C-370-CALL-BAS110AR                                 03.03
      *        IF KDA-AX-MRCH-TYPE-AIRLINE                               03.03
      *           CONTINUE                                               03.03
      *        ELSE                                                      03.03
      *           MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)03.03
      *           PERFORM S-095-MOVE-ERROR-CODES                         03.03
      *              THRU S-095-EXIT                                     03.03
      *           SET ADD-ER-INDX UP BY 1                                03.03
      *        END-IF                                                    03.03
      *        GO TO C-370-CALL-BAS110AR                                 03.03
           END-IF.                                                      03.03
           GO TO C-370-CALL-BAS110AR.
      *
039170 C-370-CHECK-LVL3-PURCHASE.                                       02.75
039180     IF NOT WCST-LVL3-TRANS
039170        GO TO C-370-EDIT-MC-ADDENDUM.
           IF NOT PET-CARD-TYPE-VISA                                    03.27
              MOVE 104                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT
              SET ADD-ER-INDX UP BY 1
              GO TO C-370-CALL-BAS110AR.
039180     IF NOT WCST-LVL3-PURCHASE
039170        GO TO C-370-CHECK-LVL3-CORPORATE.                         02.75
      *    ALL PURCHA AND PURCHL ADDENDA ARE EDITED IN BAS110AR BUT THE 02.75
      *    REPORT LINES ARE CREATED IN BAC00110.
           IF KDA-SVCCAT-AIRPASS OR
              KDA-SVCCAT-CARRENT OR
              KDA-SVCCAT-LODGING
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
039240           SET ADD-ER-INDX UP BY 1.
           IF NOT KDA-VS-PID-IS-COMMERCIAL                              02.81
              MOVE 116                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT
039240        SET ADD-ER-INDX UP BY 1.
           IF NOT KDA-HAS-LU
              MOVE 103                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT
039240        SET ADD-ER-INDX UP BY 1.
039180     IF MIAR-SUB-TRAN = 'PA'
              IF KDA-HAS-PA
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              ELSE
              IF PET-PURCHASE-IDENTIFIER NOT = '1'
                 MOVE 184                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1
              ELSE
              IF PET-PURCHASE-IDENT = SPACES
                 MOVE 185                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)
                                            WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX UP BY 1.
           IF MIAR-SUB-TRAN = 'PL'
              MOVE 'Y'                   TO WS-2ND-RECEIVED-FLAG.
           GO TO C-370-CALL-BAS110AR.
      *
039170 C-370-CHECK-LVL3-CORPORATE.                                      02.75
039180     IF NOT WCST-LVL3-CORPORATE                                   02.75
039170        GO TO C-370-EDIT-LVL3-AIRLINE.                            02.75
      *    ALL COMMXA AND COMMXL ADDENDA ARE EDITED IN BAS110AR BUT THE 02.75
      *    REPORT LINES ARE CREATED IN BAC00110.                        02.75
           IF KDA-SVCCAT-AIRPASS OR                                     02.75
              KDA-SVCCAT-CARRENT OR                                     02.75
              KDA-SVCCAT-LODGING                                        02.75
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.75
                                            WS-ERR-CD                   02.75
                 PERFORM S-095-MOVE-ERROR-CODES                         02.75
                    THRU S-095-EXIT                                     02.75
039240           SET ADD-ER-INDX UP BY 1.                               02.75
           IF NOT KDA-VS-PID-IS-COMMERCIAL                              02.81
              MOVE 116                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.75
                                            WS-ERR-CD                   02.75
              PERFORM S-095-MOVE-ERROR-CODES                            02.75
                 THRU S-095-EXIT                                        02.75
039240        SET ADD-ER-INDX UP BY 1.                                  02.75
           IF NOT KDA-HAS-LU                                            02.75
              MOVE 103                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.75
                                            WS-ERR-CD                   02.75
              PERFORM S-095-MOVE-ERROR-CODES                            02.75
                 THRU S-095-EXIT                                        02.75
039240        SET ADD-ER-INDX UP BY 1.                                  02.75
039180     IF MIAR-SUB-TRAN = 'XA'                                      02.75
              IF KDA-HAS-XA                                             02.75
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.75
                                            WS-ERR-CD                   02.75
                 PERFORM S-095-MOVE-ERROR-CODES                         02.75
                    THRU S-095-EXIT                                     02.75
                 SET ADD-ER-INDX UP BY 1                                02.75
              ELSE                                                      02.75
              IF PET-PURCHASE-IDENTIFIER NOT = '1'                      02.75
                 MOVE 184                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.75
                                            WS-ERR-CD                   02.75
                 PERFORM S-095-MOVE-ERROR-CODES                         02.75
                    THRU S-095-EXIT                                     02.75
                 SET ADD-ER-INDX UP BY 1                                02.75
              ELSE                                                      02.75
              IF PET-PURCHASE-IDENT = SPACES                            02.75
                 MOVE 185                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.75
                                            WS-ERR-CD                   02.75
                 PERFORM S-095-MOVE-ERROR-CODES                         02.75
                    THRU S-095-EXIT                                     02.75
                 SET ADD-ER-INDX UP BY 1.                               02.75
           IF MIAR-SUB-TRAN = 'XL'                                      02.75
              MOVE 'Y'                   TO WS-2ND-RECEIVED-FLAG.       02.75
           GO TO C-370-CALL-BAS110AR.                                   02.75
      *                                                                 02.75
       C-370-EDIT-LVL3-AIRLINE.
      *    ALL CORPAS AND CORPAI ADDENDA ARE EDITED AND REPORT LINES
      *    CREATED IN BAS110AR.
           IF NOT KDA-SVCCAT-AIRPASS
              MOVE 116                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           IF NOT KDA-VS-PID-IS-COMMERCIAL                              02.81
              MOVE 116                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           IF NOT KDA-HAS-LU
              MOVE 103                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           IF MIAR-SUB-TRAN = 'CI'
              IF MIAR-SUB-SEQ-X = '0001'
                 NEXT SENTENCE
              ELSE
              IF WS-LAST-SUB-TRAN NOT = 'CS'
                 MOVE 105                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT.
           IF MIAR-SUB-TRAN = 'CS'
              MOVE 'Y'                   TO WS-2ND-RECEIVED-FLAG.
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-ADDENDUM.
           IF NOT WCST-MC-TRANS
              GO TO C-370-EDIT-VISA-ADDENDUM.
           IF NOT PET-CARD-TYPE-MC
              MOVE 104                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT
              GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-PASSTRNS.
           IF NOT WCST-PASSENGER-TRANS
              GO TO C-370-EDIT-MC-CAR-RENTAL.
           IF WCSC-MC-RAIL
              IF KDA-MMERCAT-MC-RAIL OR
                 KDA-MC-MRCH-TYP-AGENTS
                    GO TO C-370-CALL-BAS110AR
              ELSE
                 MOVE 116                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 GO TO C-370-CALL-BAS110AR.
           IF WCSC-MC-BASE
              IF KDA-HAS-01-P1
                 MOVE 103                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT.
           IF KDA-MMERCAT-MC-AIR-RAIL OR
              KDA-MC-MRCH-TYP-AGENTS
                 NEXT SENTENCE
           ELSE
              MOVE 116                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-CAR-RENTAL.
           IF NOT WCST-CAR-RENTAL
              GO TO C-370-EDIT-MC-LODGING.
           IF WCSC-MC-BASE
              IF KDA-HAS-05
                 MOVE 103                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT.
           IF NOT KDA-MMERCAT-MC-CARRENT
              MOVE 116                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-LODGING.
           IF NOT WCST-LODGING
              GO TO C-370-EDIT-MC-TEMP-SVC.
           IF WCSC-MC-BASE
              IF KDA-HAS-07
                 MOVE 103                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT.
           IF NOT KDA-MMERCAT-MC-LODGE
              MOVE 116                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-TEMP-SVC.
           IF NOT WCST-TEMP-SVC
              GO TO C-370-EDIT-MC-SHIP-SVC.
           IF WCSC-MC-BASE
              IF KDA-HAS-07
                 MOVE 103                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT.
           IF NOT KDA-MC-MRCH-TYP-TEMP-SVC
              MOVE 116                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-SHIP-SVC.
           IF NOT WCST-SHIP-SVC
              GO TO C-370-EDIT-MC-ELEC-INV.
           IF WCSC-MC-BASE
              IF KDA-HAS-08
                 MOVE 103                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT.
           IF NOT KDA-MC-MRCH-TYP-SHIP-COUR
              MOVE 116                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-ELEC-INV.
           IF NOT WCST-ELEC-INV
              GO TO C-370-EDIT-MC-PAYMENT.
           IF WCSC-MC-BASE
              IF MIAR-SUB-SEQ-X = '0001' AND
                 KDA-HAS-09-P1
                    MOVE 105             TO WS-ERR-CD
                    PERFORM S-095-MOVE-ERROR-CODES
                       THRU S-095-EXIT
              ELSE
              IF WS-LAST-ADD-TRAN = SPACES OR
                (NOT WLSC-MC-BASE)
                    NEXT SENTENCE
              ELSE
                 MOVE 105                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT.
           IF WCSC-MC-DETAIL
              MOVE 'Y'                   TO WS-2ND-RECEIVED-FLAG.
           IF NOT KDA-CHD-ICA-IS-MC-BCFPCARD
              MOVE 116                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-PAYMENT.
           IF NOT WCST-PAYMENT
              GO TO C-370-EDIT-MC-TELEPHONY.
           IF WCSC-MC-BASE
              IF KDA-HAS-10
                 MOVE 103                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT.
           IF KDA-MMERCAT-MC-PAYMNT AND                                 02.23
              KDA-PC-TRAN-IS-PAY                                        02.23
                 NEXT SENTENCE                                          02.23
           ELSE                                                         02.23
              MOVE 116                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-TELEPHONY.
           IF NOT WCST-TELEPHONY
              GO TO C-370-EDIT-MC-TRAVEL-AGENCY.
           IF WCSC-MC-BASE
              IF KDA-HAS-11-P1
                 MOVE 103                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT.
           IF KDA-MC-MRCH-TYP-TELE                                      03.36
              NEXT SENTENCE                                             03.36
           ELSE                                                         03.36
              MOVE 116                   TO WS-ERR-CD                   03.36
              PERFORM S-095-MOVE-ERROR-CODES                            03.36
                 THRU S-095-EXIT.                                       03.36
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-TRAVEL-AGENCY.
           IF NOT WCST-TRAVEL-AGENCY
              GO TO C-370-EDIT-MC-HEALTH-CARE.
           IF NOT WCSC-MC-BASE
              MOVE 103                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           IF KDA-MMERCAT-MC-AIR-RAIL OR
              KDA-MC-MRCH-TYP-AGENTS
                 NEXT SENTENCE
           ELSE
              MOVE 116                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           GO TO C-370-CALL-BAS110AR.
      *                                                                 02.23
       C-370-EDIT-MC-HEALTH-CARE.                                       02.23
           IF NOT WCST-HEALTH-CARE                                      02.23
              GO TO C-370-EDIT-MC-PRIVATE-LABEL.                        02.23
           IF NOT WCSC-MC-BASE                                          02.23
              MOVE 103                   TO WS-ERR-CD                   02.23
              PERFORM S-095-MOVE-ERROR-CODES                            02.23
                 THRU S-095-EXIT.                                       02.23
           IF KDA-MC-NO-ASSIGN-MRCH-ID OR                               02.39
             (NOT KDA-MERCAT-HEALTH-CARE) OR                            02.39
             (NOT KDA-CHD-ICA-IS-HEALTH-CARE)                           02.39
                 MOVE 116                TO WS-ERR-CD                   02.39
                 PERFORM S-095-MOVE-ERROR-CODES                         02.39
                    THRU S-095-EXIT                                     02.39
           END-IF.                                                      02.39
           GO TO C-370-CALL-BAS110AR.                                   02.23
      *                                                                 02.48
       C-370-EDIT-MC-PRIVATE-LABEL.                                     02.48
           IF NOT WCST-PRIVATE-LABEL                                    02.48
              GO TO C-370-EDIT-MC-LODGED-ACCT.                          02.48
           IF WCSC-MC-BASE                                              02.48
              IF KDA-HAS-14-P1                                          02.48
                 MOVE 103                TO WS-ERR-CD                   02.48
                 PERFORM S-095-MOVE-ERROR-CODES                         02.48
                    THRU S-095-EXIT.                                    02.48
           IF NOT KDA-CHD-ICA-IS-MC-PLBL-ADDM                           02.48
              MOVE 116                   TO WS-ERR-CD                   02.48
              PERFORM S-095-MOVE-ERROR-CODES                            02.48
                 THRU S-095-EXIT                                        02.48
           END-IF.                                                      02.48
           GO TO C-370-CALL-BAS110AR.                                   02.48
      *                                                                 02.48
       C-370-EDIT-MC-LODGED-ACCT.
           IF NOT WCST-LODGED-ACCT
              GO TO C-370-EDIT-MC-PURCHASE.
           IF NOT WCSC-MC-BASE
              MOVE 103                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           IF KDA-MMERCAT-MC-AIR-RAIL OR
              KDA-MC-MRCH-TYP-AGENTS
                 NEXT SENTENCE
           ELSE
              MOVE 116                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-PURCHASE.
           IF NOT WCST-PURCHASE-CARD
              GO TO C-370-EDIT-MC-GENERIC.
           IF WCSC-MC-BASE
              IF KDA-HAS-98-P1
                 MOVE 103                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT.
           IF WCSC-MC-FLEET
              IF KDA-HAS-98-F1
                 MOVE 103                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT.
           IF NOT KDA-CHD-ICA-IS-MC-BCFPCARD
              MOVE 116                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           IF WCSC-MC-FLEET
              IF KDA-CHD-ICA-IS-MC-FCARD AND
                 KDA-MC-MRCH-TYP-FUEL
                    NEXT SENTENCE
              ELSE
                 MOVE 116                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
              END-IF
           END-IF.
           IF WCSC-MC-FLEET OR
              WCSC-MC-PURCHASE
              IF KDA-HAS-98-P1 OR                                       02.88
                 KDA-98-P1-HAD-ERRORS                                   02.88
                    NEXT SENTENCE                                       02.88
              ELSE
                 COMPUTE MIAR-SUB-SEQ-NUM = MIAR-SUB-SEQ-NUM + 1
                 COMPUTE MIAR-SUB-SEQ-TOT-NUM = MIAR-SUB-SEQ-TOT-NUM + 1
              END-IF
           END-IF.
           MOVE MIAR-SUB-SEQ-TOT-NUM     TO WS-LAST-98-SEQ-TOT.
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-GENERIC.
           IF NOT WCST-GENERIC
              GO TO C-370-EDIT-MC-EMV-DATA.                             02.95
           IF WCSC-MC-BASE
              IF KDA-HAS-99
                 MOVE 103                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT.
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-MC-EMV-DATA.                                          02.95
           IF WCST-MC-EMV                                               02.95
              MOVE 'N'                   TO WS-ERROR-SW                 02.95
              IF KDA-HAS-EM                                             02.95
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.95
                                            WS-ERR-CD                   02.95
                 PERFORM S-095-MOVE-ERROR-CODES                         02.95
                    THRU S-095-EXIT                                     02.95
                 SET ADD-ER-INDX UP BY 1                                02.95
              END-IF                                                    02.95
              IF KDA-CRD-DTA-INP-CAP = '5' OR 'C' OR 'D' OR 'E' OR 'M'  02.95
                 CONTINUE                                               02.95
              ELSE                                                      02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RMC-2-POS-DATA-CD-ERR-IND(1)02.95
              END-IF                                                    02.95
              IF KDA-OPER-ENV = '0' OR '5' OR '7'                       02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RMC-2-POS-DATA-CD-ERR-IND(4)02.95
              END-IF                                                    02.95
              IF KDA-CRDHLDR-PRSNT  NOT = '0'                           02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RMC-2-POS-DATA-CD-ERR-IND(5)02.95
              END-IF                                                    02.95
              IF KDA-CRD-PRSNT = '0'                                    02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RMC-2-POS-DATA-CD-ERR-IND(6)02.95
              END-IF                                                    02.95
              IF KDA-DTA-INP-MOD NOT = 'C' AND                          02.95
                 KDA-DTA-INP-MOD NOT = 'F' AND                          02.95
                 KDA-DTA-INP-MOD NOT = 'M'                              02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RMC-2-POS-DATA-CD-ERR-IND(7)02.95
              END-IF                                                    02.95
              IF (KDA-CRDHLDR-ATHN-MTHD = '1' AND                       02.95
                  KDA-CRDHLDR-ATHN-ENT  = '1') OR                       02.95
                 (KDA-CRDHLDR-ATHN-MTHD = '1' AND                       02.95
                  KDA-CRDHLDR-ATHN-ENT  = '3') OR                       02.95
                 (KDA-CRDHLDR-ATHN-MTHD = '5' AND                       02.95
                  KDA-CRDHLDR-ATHN-ENT  = '4') OR                       02.95
                 (KDA-CRDHLDR-ATHN-MTHD = '0' AND                       02.95
                  KDA-CRDHLDR-ATHN-ENT  = '0')                          02.95
                    CONTINUE                                            02.95
              ELSE                                                      02.95
                    MOVE 'Y'             TO WS-ERROR-SW                 02.95
                    MOVE ONE-AST         TO RMC-2-POS-DATA-CD-ERR-IND(8)02.95
                                            RMC-2-POS-DATA-CD-ERR-IND(9)02.95
              END-IF                                                    02.95
              IF KDA-CRD-DTA-OUT-CAP = '1'                              02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST           TO RMC-2-POS-DATA-CD-ERR-IND(10)02.95
              END-IF                                                    02.95
              IF ERROR-FOUND                                            02.95
                 MOVE 'Y'                TO PET-SUS-FLAG                02.95
                 MOVE 116                TO ER-CD-3-DIG(ER-INDX)        02.95
                 SET ER-INDX UP BY 1                                    02.95
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.95
                                            WS-ERR-CD                   02.95
                 PERFORM S-095-MOVE-ERROR-CODES                         02.95
                    THRU S-095-EXIT                                     02.95
                 SET ADD-ER-INDX UP BY 1                                02.95
              END-IF                                                    02.95
              GO TO C-370-CALL-BAS110AR                                 02.95
           END-IF.                                                      02.95
      *                                                                 02.95
       C-370-EDIT-MC-XTRA-TRAN-DATA.
           IF KDA-HAS-M1
              MOVE 103                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT.
           GO TO C-370-CALL-BAS110AR.
      *
       C-370-EDIT-VISA-ADDENDUM.
           IF NOT PET-CARD-TYPE-VISA                                    03.27
              MOVE 104                   TO WS-ERR-CD
              PERFORM S-095-MOVE-ERROR-CODES
                 THRU S-095-EXIT
              SET ADD-ER-INDX UP BY 1
              GO TO C-370-CALL-BAS110AR.
           IF MIAR-SUB-TRAN = 'LU'
              IF KDA-HAS-LU
                 MOVE 102                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX  UP BY 1                               02.95
              END-IF                                                    02.95
              GO TO C-370-CALL-BAS110AR                                 02.95
           END-IF.                                                      02.95
      *
           IF WCST-B2B
              IF KDA-MRCH-TYP-B2B AND
                 KDA-VS-PID-IS-COMMERCIAL                               02.81
                    CONTINUE                                            02.95
              ELSE
                 MOVE 116                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX  UP BY 1                               02.95
              END-IF                                                    02.95
              GO TO C-370-CALL-BAS110AR                                 02.95
           END-IF.                                                      02.95
           IF WCST-FLEET-CARD
              IF KDA-MRCH-TYP-FLEET AND
                 KDA-VS-PID-IS-FLT-ANY                                  02.81
                    CONTINUE                                            02.95
              ELSE
                 MOVE 116                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX  UP BY 1                               02.95
              END-IF                                                    02.95
              GO TO C-370-CALL-BAS110AR                                 02.95
           END-IF.                                                      02.95
           IF WCST-COMM-FLEET                                           03.25
              IF NOT KDA-HAS-LU                                         03.25
                 MOVE 103                TO WS-ERR-CD                   03.25
                 PERFORM S-095-MOVE-ERROR-CODES                         03.25
                    THRU S-095-EXIT                                     03.25
                 SET ADD-ER-INDX UP BY 1                                03.25
              END-IF                                                    03.25
              IF KDA-MRCH-TYP-FLEET AND                                 03.25
                 KDA-VS-PID-IS-FLT-ANY                                  03.25
                    CONTINUE                                            03.25
              ELSE                                                      03.25
                 MOVE 116                TO WS-ERR-CD                   03.25
                 PERFORM S-095-MOVE-ERROR-CODES                         03.25
                    THRU S-095-EXIT                                     03.25
                 SET ADD-ER-INDX  UP BY 1                               03.25
              END-IF                                                    03.25
              GO TO C-370-CALL-BAS110AR                                 03.25
           END-IF.                                                      03.25
039180     IF WCST-PASSENGER-TRANS
039180        IF KDA-MERCAT-AIR-TRAIN
039180        OR KDA-SVCCAT-AIRPASS
                 CONTINUE                                               02.95
039180        ELSE
                 MOVE 116                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX  UP BY 1                               02.95
              END-IF                                                    02.95
              IF (KDA-HAS-AI AND WCST-PASSENGER-TRANS-AN) OR            03.42V
                 (KDA-HAS-AN AND WCST-PASSENGER-TRANS-AI) OR            03.42V
                 (KDA-HAS-AN AND WCST-PASSENGER-TRANS-AN) OR            03.42V
                 (KDA-HAS-AI AND WCST-PASSENGER-TRANS-AI)               03.42V
                 MOVE 102                TO WS-ERR-CD                   03.42V
                 PERFORM S-095-MOVE-ERROR-CODES                         03.42V
                    THRU S-095-EXIT                                     03.42V
                 SET ADD-ER-INDX  UP BY 1                               03.42V
              END-IF                                                    03.42V
              GO TO C-370-CALL-BAS110AR                                 02.95
           END-IF.                                                      02.95
039180     IF WCST-LODGING
039180        IF KDA-MERCAT-LODGING
039180        OR KDA-SVCCAT-LODGING
                 CONTINUE                                               02.95
039180        ELSE
                 MOVE 116                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX  UP BY 1                               02.95
              END-IF                                                    02.95
              GO TO C-370-CALL-BAS110AR                                 02.95
           END-IF.                                                      02.95
039180     IF WCST-CAR-RENTAL
039180        IF KDA-MERCAT-CAR-RENT
039180        OR KDA-SVCCAT-CARRENT
                 CONTINUE                                               02.95
039180        ELSE
                 MOVE 116                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
                 SET ADD-ER-INDX  UP BY 1                               02.95
              END-IF                                                    02.95
              GO TO C-370-CALL-BAS110AR                                 02.95
           END-IF.                                                      02.95
039180     IF WCST-PURCHASE-CARD
              IF KDA-VS-PID-IS-COMMERCIAL                               02.81
                 CONTINUE                                               02.95
039180        ELSE
                 MOVE 116                TO WS-ERR-CD
                 PERFORM S-095-MOVE-ERROR-CODES
                    THRU S-095-EXIT
              END-IF                                                    02.95
              GO TO C-370-CALL-BAS110AR                                 02.95
           END-IF.                                                      02.95
           IF WCST-VISA-EMV                                             02.95
              MOVE 'N'                   TO WS-ERROR-SW                 02.95
              IF KDA-HAS-EV                                             02.95
                 MOVE 103                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.95
                                            WS-ERR-CD                   02.95
                 PERFORM S-095-MOVE-ERROR-CODES                         02.95
                    THRU S-095-EXIT                                     02.95
                 SET ADD-ER-INDX UP BY 1                                02.95
              END-IF                                                    02.95
              IF NOT KDA-VC-POS-TERM-5                                  02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RCL-3-POS-TRM-CAP-ERR-IND   02.95
              END-IF                                                    02.95
              IF KDA-VC-POS-ENTRY-MODE-CHIP                             02.95
                 CONTINUE                                               02.95
              ELSE                                                      02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RCL-3-POS-E-MOD-ERR-IND     02.95
              END-IF                                                    02.95
              IF KDA-CHIP-COND-CODE = '0' OR '1' OR '2'                 02.95
                 CONTINUE                                               02.95
              ELSE                                                      02.95
                 MOVE 'Y'                TO WS-ERROR-SW                 02.95
                 MOVE ONE-AST            TO RVS-2-CHIP-COND-ERR-IND     02.95
              END-IF                                                    02.95
              IF ERROR-FOUND                                            02.95
                 MOVE 'Y'                TO PET-SUS-FLAG                02.95
                 MOVE 116                TO ER-CD-3-DIG(ER-INDX)        02.95
                 SET ER-INDX UP BY 1                                    02.95
                 MOVE 116                TO ADD-ER-CD-3-DIG(ADD-ER-INDX)02.95
                                            WS-ERR-CD                   02.95
                 PERFORM S-095-MOVE-ERROR-CODES                         02.95
                    THRU S-095-EXIT                                     02.95
                 SET ADD-ER-INDX UP BY 1                                02.95
              END-IF                                                    02.95
              GO TO C-370-CALL-BAS110AR                                 02.95
           END-IF.                                                      02.95
039400 C-370-CALL-BAS110AR.
039360     PERFORM C-371-CALL-BAS110AR
039370        THRU C-371-EXIT.
039380     PERFORM C-372-CHECK-BAS110AR-RESULTS
039390        THRU C-372-EXIT.
           IF WCST-PURCHASE-CARD AND
              WCSC-MC-FLEET
                 MOVE MIMFCC-TOTAL-TAXES-X
                                         TO WS-MIMFCC-TOTAL-TAXES-X
                 MOVE MIMFCC-FUEL-INFO   TO WS-MIMFCC-FUEL-INFO
                 MOVE MIMFCC-ODOMETER-READING
                                         TO WS-MIMFCC-ODOMETER-READING
           END-IF.
           MOVE WS-CHECK-ADD-TRAN        TO WS-LAST-ADD-TRAN.
           IF MIAR-SUB-TRAN = 'LU' OR 'M1'
              NEXT SENTENCE
           ELSE
              PERFORM C-373-BUILD-ADDENDUM-RECORDS
                 THRU C-373-EXIT.
039400 C-370-EXIT.
039410     EXIT.
039420*
039430 C-371-CALL-BAS110AR.
039450     CALL BAS110AR USING         ADDENDUM-WORK-RECORD
                                       POST-EDIT-TRANS
039460                                 BAS110AR-ERROR-INDICATORS
                                       KMCINTBL-INTCHG-TABLES
039460                                 KMCINTEP-DATA-AREA.
039470 C-371-EXIT.
039480     EXIT.
      *
       C-372-CHECK-BAS110AR-RESULTS.
      *
           IF (WCST-VISA-EMV AND KDA-EV-HAD-ERRORS) OR                  02.95
              (WCST-MC-EMV   AND KDA-EM-HAD-ERRORS) OR                  02.95
              (WCSC-AMEX-EMV AND KDA-AX-EMV-HAD-ERRORS) OR              02.95
              (WCSC-DS-EMV   AND KDA-DS-13-HAD-ERRORS)                  02.95
                MOVE 'Y'                   TO PET-SUS-FLAG              02.95
                MOVE 117                   TO ER-CD-3-DIG(ER-INDX)      02.95
                SET ER-INDX UP BY 1                                     02.95
           END-IF.                                                      02.95
      *                                                                 02.95
           IF MIAR-SUB-TRAN = 'M1' AND
              KDA-HAS-M1
                 MOVE MID-LAYOUT(1)      TO HOLD-M11.
      *
           IF MIAR-SUB-TRAN = 'LU' AND
              KDA-HAS-LU
                 MOVE MID-LAYOUT(1)      TO HOLD-LU1
                 MOVE MID-LAYOUT(2)      TO HOLD-LU2.
      *
      *    PRINT LINES FORMATTED IN BAS110AR WILL HAVE ERR-LINE-SUB
      *    SET TO A VALUE GREATER THAN +0.
      *
           IF ERR-LINE-SUB > +0
              PERFORM C-374-PRINT-ADDENDUM-LINES
                 THRU C-374-EXIT
              GO TO C-372-EXIT.
      *
041450     IF BE-DATE-FORMAT = 'I'
041460        MOVE 'CAW'                 TO DC-OPERATION
041470     ELSE
041480        MOVE 'CAE'                 TO DC-OPERATION.
      *
039690 C-372-CHECK-PA-OR-XA.                                            02.75
           MOVE 'N'                      TO WS-ERROR-SW.                03.42V
039700     IF MIAR-SUB-TRAN = 'PA'
004410        MOVE 'Y'                   TO KDA-HAS-PA-SW
039720     ELSE                                                         02.75
039700     IF MIAR-SUB-TRAN = 'XA'                                      02.75
004410        MOVE 'Y'                   TO KDA-HAS-XA-SW               02.75
039720     ELSE
039730        GO TO C-372-CHECK-PL-OR-XL.                               02.75

042690     MOVE ' PURCHA: MESSAGE ID '   TO RSA9A-TITLE1.
042710     MOVE ' DISCOUNT '             TO RSA9A-TITLE2.
042990     MOVE ' FREIGHT '              TO RSA9A-TITLE3.
042990     MOVE ' DATE '                 TO RSA9A-TITLE4.
042990     MOVE ' DUTY '                 TO RSA9B-TITLE1.
042990     MOVE ' VAT AMT '              TO RSA9B-TITLE2.
042990     MOVE ' VAT RATE '             TO RSA9B-TITLE3.
042990     MOVE ' VAT REF '              TO RSA9B-TITLE4.
042990     MOVE ' SHIP POST '            TO RSA9C-TITLE1.
042990     MOVE ' DEST POST '            TO RSA9C-TITLE2.
042990     MOVE ' DEST COUNTRY '         TO RSA9C-TITLE3.
042990     MOVE ' ACCOUNT '              TO RSA9C-TITLE4.
042990     MOVE ' AUTH CD '              TO RSA9C-TITLE5.               03.42V
042990     MOVE ' INVLVL DISC TR '       TO RSA9D-TITLE1.               03.42V
042990     MOVE ' TAX TR '               TO RSA9D-TITLE2.               03.42V
042990     MOVE ' DISC SIGN '            TO RSA9D-TITLE3.               03.42V
042990     MOVE ' FRT SIGN '             TO RSA9D-TITLE4.               03.42V
042990     MOVE ' DUTY SIGN '            TO RSA9D-TITLE5.               03.42V
042990     MOVE ' VAT SIGN '             TO RSA9D-TITLE6.               03.42V
042990     MOVE ' SERVICE ID '           TO RSA9D-TITLE7.               03.42V
      *
042730     MOVE '-'                      TO RSA9A-DASH-1.
042730     MOVE MIAR-SUB-SEQ-X           TO RSA9A-ITEM-SEQ.
039740     IF MIVIII-MESSAGE-ID = SPACES
003140        MOVE ERR-LVL3-MESSAGE-ID   TO MIVIII-MESSAGE-ID.
042730     MOVE MIVIII-MESSAGE-ID        TO RSA9A-MESSAGE-ID.
039740     IF EIVPA-MESSAGE-ID NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9A-MESSAGE-ID.              03.42V
042730     IF MIVPA-DISCOUNT-AMT NUMERIC
042730        MOVE MIVPA-DISCOUNT-AMT    TO RSA9A-DISCOUNT-AMT
051190        CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
051200                 C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
051210                 C-TYPEA  RSA9A-DISCOUNT-AMT  C-LGTH20
051240                 C-TYPEEND
042730     ELSE
042730        MOVE MIVPA-DISCOUNT-AMT    TO RSA9A-DISCOUNT-AMT-X.
039740     IF EIVPA-DISCOUNT-AMT NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9A-DISCOUNT-AMT.            03.42V
042730     IF MIVPA-FREIGHT-AMT NUMERIC
042730        MOVE MIVPA-FREIGHT-AMT     TO RSA9A-FREIGHT-AMT
051190        CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
051200                 C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
051210                 C-TYPEA  RSA9A-FREIGHT-AMT  C-LGTH20
051240                 C-TYPEEND
042730     ELSE
042730        MOVE MIVPA-FREIGHT-AMT     TO RSA9A-FREIGHT-AMT-X.
039740     IF EIVPA-FREIGHT-AMT NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9A-FREIGHT-AMT.             03.42V
042730     MOVE MIVPA-ORDER-DATE         TO RSA9A-ORDER-DATE.
039740     IF EIVPA-ORDER-DATE NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9A-ORDER-DATE.              03.42V
      *
042730     IF MIVPA-DUTY-AMT NUMERIC
042730        MOVE MIVPA-DUTY-AMT        TO RSA9B-DUTY-AMT
051190        CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
051200                 C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
051210                 C-TYPEA  RSA9B-DUTY-AMT  C-LGTH20
051240                 C-TYPEEND
042730     ELSE
042730        MOVE MIVPA-DUTY-AMT        TO RSA9B-DUTY-AMT-X.
039740     IF EIVPA-DUTY-AMT NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9B-DUTY-AMT.                03.42V
042730     IF MIVPA-VAT-TAX-AMT NUMERIC
042730        MOVE MIVPA-VAT-TAX-AMT     TO RSA9B-VAT-TAX-AMT
051190        CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
051200                 C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
051210                 C-TYPEA  RSA9B-VAT-TAX-AMT  C-LGTH20
051240                 C-TYPEEND
042730     ELSE
042730        MOVE MIVPA-VAT-TAX-AMT     TO RSA9B-VAT-TAX-AMT-X.
039740     IF EIVPA-VAT-TAX-AMT NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9B-VAT-TAX-AMT.             03.42V
042730     IF MIVPA-VAT-TAX-RATE NUMERIC
042730        MOVE MIVPA-VAT-TAX-RATE    TO RSA9B-VAT-TAX-RATE
042730     ELSE
042730        MOVE MIVPA-VAT-TAX-RATE    TO RSA9B-VAT-TAX-RATE-X.
039740     IF EIVPA-VAT-TAX-RATE NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9B-VAT-TAX-RATE.            03.42V
042730     MOVE MIVPA-VAT-INVOICE-REF    TO RSA9B-VAT-INVOICE-REF.
039740     IF EIVPA-VAT-INVOICE-REF NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9B-VAT-INVOICE-REF.         03.42V
      *
042730     MOVE MIVPA-SHIP-POSTAL-CD     TO RSA9C-SHIP-POSTAL-CD.
039740     IF EIVPA-SHIP-POSTAL-CD NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9C-SHIP-POSTAL-CD.          03.42V
042730     MOVE MIVPA-DEST-POSTAL-CD     TO RSA9C-DEST-POSTAL-CD.
039740     IF EIVPA-DEST-POSTAL-CD NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9C-DEST-POSTAL-CD.          03.42V
042730     MOVE MIVPA-DEST-CNTRY-CD      TO RSA9C-DEST-CNTRY-CD.
039740     IF EIVPA-DEST-CNTRY-CD NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9C-DEST-CNTRY-CD.           03.42V
042730     MOVE MIVPA-ACCOUNT            TO RSA9C-ACCOUNT.
039740     IF EIVPA-ACCOUNT NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9C-ACCOUNT.                 03.42V
042730     MOVE '-'                      TO RSA9C-DASH-1.
042730     MOVE MIVPA-ACCOUNT-EXT        TO RSA9C-ACCOUNT-EXT.
039740     IF EIVPA-ACCOUNT-EXT NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9C-ACCOUNT-EXT.             03.42V
042730     MOVE MIVPA-AUTH-CODE          TO RSA9C-AUTH-CD.              03.42V
039740     IF EIVPA-AUTH-CD NOT = SPACE                                 03.42V
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9C-AUTH-CD.                 03.42V
      *
042730     MOVE MIVPA-INV-LVL-DISC-TMNT  TO RSA9D-INV-LVL-DISC-TR.      03.42V
039740     IF EIVPA-INV-LVL-DISC-TMNT NOT = SPACE                       03.42V
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9D-INV-LVL-DISC-TR.         03.42V
042730     MOVE MIVPA-TAX-TMNT       TO RSA9D-TAX-TR.                   03.42V
039740     IF EIVPA-TAX-TMNT NOT = SPACE                                03.42V
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9D-TAX-TR.                  03.42V
042730     MOVE MIVPA-DISC-AMT-SIGN  TO RSA9D-DISC-AMT-SIGN.            03.42V
039740     IF EIVPA-DISC-AMT-SIGN      NOT = SPACE                      03.42V
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9D-DISC-AMT-SIGN.           03.42V
042730     MOVE MIVPA-FREIGHT-AMT-SIGN   TO RSA9D-FRT-AMT-SIGN.         03.42V
039740     IF EIVPA-FREIGHT-AMT-SIGN NOT = SPACE                        03.42V
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9D-FRT-AMT-SIGN.            03.42V
042730     MOVE MIVPA-DUTY-AMT-SIGN  TO RSA9D-DUTY-AMT-SIGN.            03.42V
039740     IF EIVPA-DUTY-AMT-SIGN NOT = SPACE                           03.42V
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9D-DUTY-AMT-SIGN.           03.42V
042730     MOVE MIVPA-VAT-TAX-AMT-SIGN   TO RSA9D-VAT-TAX-SIGN.         03.42V
039740     IF EIVPA-VAT-TAX-AMT-SIGN NOT = SPACE                        03.42V
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9D-VAT-TAX-SIGN.            03.42V
042730     MOVE MIVIII-SERVICE-ID    TO RSA9D-SERVICE-ID.               03.42V
039740     IF EIVPA-SERVICE-ID NOT = SPACE                              03.42V
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA9D-SERVICE-ID.              03.42V
      *                                                                 03.42V
           IF ERROR-FOUND                                               03.42V
              MOVE 110                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)03.42V
039590        MOVE 'Y'               TO PET-LVL3-SUS-FLAG               03.42V
              SET ADD-ER-INDX UP BY 1                                   03.42V
           END-IF.                                                      03.42V
      *                                                                 03.42V
039590     IF PET-LVL3-SUS-FLAG = 'Y'
039700        IF MIAR-SUB-TRAN = 'PA'                                   02.75
004410           MOVE 'E'                TO KDA-HAS-PA-SW               02.75
039700        ELSE                                                      02.75
004410           MOVE 'E'                TO KDA-HAS-XA-SW               02.75
              END-IF                                                    02.75
018160        MOVE '*'                   TO RSA9A-SUS-FLAG              02.75
           END-IF.                                                      02.75
042830     IF ADD-ER-CD-3-DIG (1) > 0
042840        MOVE ADD-ER-CD-3-DIG (1)   TO RSA9A-ERROR-CD-1.
042850     IF ADD-ER-CD-3-DIG (2) > 0
042860        MOVE ADD-ER-CD-3-DIG (2)   TO RSA9A-ERROR-CD-2.
042870     IF ADD-ER-CD-3-DIG (3) > 0
042880        MOVE ADD-ER-CD-3-DIG (3)   TO RSA9A-ERROR-CD-3.
042890     IF ADD-ER-CD-3-DIG (4) > 0
042900        MOVE ADD-ER-CD-3-DIG (4)   TO RSA9A-ERROR-CD-4.
042910     IF ADD-ER-CD-3-DIG (5) > 0
042920        MOVE ADD-ER-CD-3-DIG (5)   TO RSA9A-ERROR-CD-5.
042830     IF ADD-ER-CD-3-DIG (6) > 0
042840        MOVE ADD-ER-CD-3-DIG (6)   TO RSA9B-ERROR-CD-1.
042850     IF ADD-ER-CD-3-DIG (7) > 0
042860        MOVE ADD-ER-CD-3-DIG (7)   TO RSA9B-ERROR-CD-2.
042870     IF ADD-ER-CD-3-DIG (8) > 0
042880        MOVE ADD-ER-CD-3-DIG (8)   TO RSA9B-ERROR-CD-3.
042890     IF ADD-ER-CD-3-DIG (9) > 0
042900        MOVE ADD-ER-CD-3-DIG (9)   TO RSA9B-ERROR-CD-4.
042910     IF ADD-ER-CD-3-DIG (10) > 0
042920        MOVE ADD-ER-CD-3-DIG (10)  TO RSA9B-ERROR-CD-5.
042830     IF ADD-ER-CD-3-DIG (11) > 0
042840        MOVE ADD-ER-CD-3-DIG (11)  TO RSA9C-ERROR-CD-1.
042850     IF ADD-ER-CD-3-DIG (12) > 0
042860        MOVE ADD-ER-CD-3-DIG (12)  TO RSA9C-ERROR-CD-2.
042870     IF ADD-ER-CD-3-DIG (13) > 0
042880        MOVE ADD-ER-CD-3-DIG (13)  TO RSA9C-ERROR-CD-3.
042890     IF ADD-ER-CD-3-DIG (14) > 0
042900        MOVE ADD-ER-CD-3-DIG (14)  TO RSA9C-ERROR-CD-4.
042910     IF ADD-ER-CD-3-DIG (15) > 0
042920        MOVE ADD-ER-CD-3-DIG (15)  TO RSA9C-ERROR-CD-5.
042830     IF ADD-ER-CD-3-DIG (16) > 0                                  03.42V
042840        MOVE ADD-ER-CD-3-DIG (16)  TO RSA9D-ERROR-CD-1.           03.42V
042850     IF ADD-ER-CD-3-DIG (17) > 0                                  03.42V
042860        MOVE ADD-ER-CD-3-DIG (17)  TO RSA9D-ERROR-CD-2.           03.42V
042870     IF ADD-ER-CD-3-DIG (18) > 0                                  03.42V
042880        MOVE ADD-ER-CD-3-DIG (18)  TO RSA9D-ERROR-CD-3.           03.42V
042890     IF ADD-ER-CD-3-DIG (19) > 0                                  03.42V
042900        MOVE ADD-ER-CD-3-DIG (19)  TO RSA9D-ERROR-CD-4.           03.42V
042910     IF ADD-ER-CD-3-DIG (20) > 0                                  03.42V
042920        MOVE ADD-ER-CD-3-DIG (20)  TO RSA9D-ERROR-CD-5.           03.42V
      *
           COMPUTE SUB2 = +4.                                           03.42V
           IF REPORT-ERROR-HILITE-ADD9A NOT = SPACES
              COMPUTE SUB2 = SUB2 + 1.
           IF REPORT-ERROR-HILITE-ADD9B NOT = SPACES
              COMPUTE SUB2 = SUB2 + 1.
           IF REPORT-ERROR-HILITE-ADD9C NOT = SPACES
              COMPUTE SUB2 = SUB2 + 1.
           IF REPORT-ERROR-HILITE-ADD9D NOT = SPACES                    03.42V
              COMPUTE SUB2 = SUB2 + 1.                                  03.42V
      *
           IF (WS-RPT-LINE-CNT + SUB2) > WS-RPT-MAX-CNT
              PERFORM S-100-PRINT-PAGE-HDR
                 THRU S-100-EXIT.
      *
042730     MOVE ZERO                     TO RSA9A-CC.
042050     MOVE RPT-SLS-ADDENDUM-9A      TO RLW-DETAIL-LINE.
042050     MOVE SPACES                   TO RPT-SLS-ADDENDUM-9A.
           PERFORM R-921-WRITE-REPORT-REC
              THRU R-921-EXIT.
           MOVE 'I'                      TO RAD-ED-LINE-TYPE.
           MOVE +0                       TO RAD-ED-TRAN-AMT.
042050     IF REPORT-ERROR-HILITE-ADD9A NOT = SPACES
042050        MOVE REPORT-ERROR-HILITE-ADD9A
042050                                   TO RLW-DETAIL-LINE
042050        MOVE SPACES                TO REPORT-ERROR-HILITE-ADD9A
              PERFORM R-921-WRITE-REPORT-REC
                 THRU R-921-EXIT.
042050     MOVE RPT-SLS-ADDENDUM-9B      TO RLW-DETAIL-LINE.
042050     MOVE SPACES                   TO RPT-SLS-ADDENDUM-9B.
           PERFORM R-921-WRITE-REPORT-REC
              THRU R-921-EXIT.
042050     IF REPORT-ERROR-HILITE-ADD9B NOT = SPACES
042050        MOVE REPORT-ERROR-HILITE-ADD9B
042050                                   TO RLW-DETAIL-LINE
042050        MOVE SPACES                TO REPORT-ERROR-HILITE-ADD9B
              PERFORM R-921-WRITE-REPORT-REC
                 THRU R-921-EXIT.
042050     MOVE RPT-SLS-ADDENDUM-9C      TO RLW-DETAIL-LINE.
042050     MOVE SPACES                   TO RPT-SLS-ADDENDUM-9C.
           PERFORM R-921-WRITE-REPORT-REC
              THRU R-921-EXIT.
042050     IF REPORT-ERROR-HILITE-ADD9C NOT = SPACES
042050        MOVE REPORT-ERROR-HILITE-ADD9C
042050                                   TO RLW-DETAIL-LINE
042050        MOVE SPACES                TO REPORT-ERROR-HILITE-ADD9C
              PERFORM R-921-WRITE-REPORT-REC
                 THRU R-921-EXIT.
042050     MOVE RPT-SLS-ADDENDUM-9D      TO RLW-DETAIL-LINE.            03.42V
042050     MOVE SPACES                   TO RPT-SLS-ADDENDUM-9D.        03.42V
           PERFORM R-921-WRITE-REPORT-REC                               03.42V
              THRU R-921-EXIT.                                          03.42V
042050     IF REPORT-ERROR-HILITE-ADD9D NOT = SPACES                    03.42V
042050        MOVE REPORT-ERROR-HILITE-ADD9D                            03.42V
042050                                   TO RLW-DETAIL-LINE             03.42V
042050        MOVE SPACES                TO REPORT-ERROR-HILITE-ADD9D   03.42V
              PERFORM R-921-WRITE-REPORT-REC                            03.42V
                 THRU R-921-EXIT.                                       03.42V
039560     GO TO C-372-EXIT.
      *
       C-372-CHECK-PL-OR-XL.                                            02.75
           MOVE 'N'                      TO WS-ERROR-SW.                03.42V
           IF MIAR-SUB-TRAN = 'PL'
              MOVE 'Y'                   TO KDA-HAS-PL-SW
           ELSE                                                         02.75
           IF MIAR-SUB-TRAN = 'XL'                                      02.75
              MOVE 'Y'                   TO KDA-HAS-XL-SW               02.75
           ELSE
              DISPLAY 'ADDENDUM ERROR CARD #   --->' WS-LEFT-SHIFT-NUM
              DISPLAY 'SUB TRAN NOT RECOGNIZED --->'
                       MERCHANT-INPUT-ADDENDUM(1:14)
              GO TO C-372-EXIT.
042690     MOVE ' PURCHL: MESSAGE ID '   TO RSA10A-TITLE1.
042710     MOVE ' ITEM CD '              TO RSA10A-TITLE2.
042990     MOVE ' ITEM DESCR '           TO RSA10A-TITLE3.
042990     MOVE ' PRODUCT CD '           TO RSA10A-TITLE4.
042990     MOVE ' QUANTITY '             TO RSA10B-TITLE1.
042990     MOVE ' UNIT MEASURE CD '      TO RSA10B-TITLE2.
042990     MOVE ' UNIT COST '            TO RSA10B-TITLE3.
042990     MOVE ' LINE ITEM TRMT '       TO RSA10B-TITLE4.              03.42V
042990     MOVE ' VAT TAX '              TO RSA10C-TITLE1.
042990     MOVE ' VAT RATE '             TO RSA10C-TITLE2.
042990     MOVE ' ITEM DISC '            TO RSA10C-TITLE3.
042990     MOVE ' ITEM TOTAL '           TO RSA10C-TITLE4.
042990     MOVE ' SERVICE ID '           TO RSA10D-TITLE1.              03.42V
      *
042730     MOVE '-'                      TO RSA10A-DASH-1
042730                                      RSA10A-DASH-2.
039740     IF MIVIII-MESSAGE-ID = SPACES
003140        MOVE ERR-LVL3-MESSAGE-ID   TO MIVIII-MESSAGE-ID.
042730     MOVE MIVIII-MESSAGE-ID        TO RSA10A-MESSAGE-ID.
039740     IF EIVPL-MESSAGE-ID NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10A-MESSAGE-ID.             03.42V
042730     MOVE MIAR-SUB-SEQ-X           TO RSA10A-ITEM-SEQ.
039740     IF EIVPL-ITEM-SEQ NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10A-ITEM-SEQ.               03.42V
042730     MOVE MIVPL-LINE-ITEM-IND      TO RSA10A-LINE-ITEM-IND.
039740     IF EIVPL-LINE-ITEM-IND NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10A-LINE-ITEM-IND.          03.42V
042730     MOVE MIVPL-ITEM-COMM-CD       TO RSA10A-ITEM-COMM-CD.
039740     IF EIVPL-ITEM-COMM-CD NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10A-ITEM-COMM-CD.           03.42V
042730     MOVE MIVPL-ITEM-DESCRIPTOR    TO RSA10A-ITEM-DESCRIPTOR.
039740     IF EIVPL-ITEM-DESCRIPTOR NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10A-ITEM-DESCRIPTOR.        03.42V
042730     MOVE MIVPL-PRODUCT-CD         TO RSA10A-PRODUCT-CD.
039740     IF EIVPL-PRODUCT-CD NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10A-PRODUCT-CD.             03.42V
      *
042730     IF MIVPL-QUANTITY NUMERIC
042730        MOVE MIVPL-QUANTITY        TO RSA10B-QUANTITY
051190        CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
051210                 C-TYPEC  RSA10B-QUANTITY  C-LGTH15
051240                 C-TYPEEND
042730     ELSE
042730        MOVE MIVPL-QUANTITY        TO RSA10B-QUANTITY-X.
039740     IF EIVPL-QUANTITY NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10B-QUANTITY.               03.42V
042730     MOVE MIVPL-UNIT-MEASURE-CD    TO RSA10B-UNIT-MEASURE-CD.
039740     IF EIVPL-UNIT-MEASURE-CD NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10B-UNIT-MEASURE-CD.        03.42V
042730     IF MIVPL-UNIT-COST NUMERIC
042730        MOVE MIVPL-UNIT-COST       TO RSA10B-UNIT-COST
042730     ELSE
042730        MOVE MIVPL-UNIT-COST       TO RSA10B-UNIT-COST-X.
039740     IF EIVPL-UNIT-COST NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10B-UNIT-COST.              03.42V
042730     MOVE MIVPL-LINE-ITEM-TMNT-CODE    TO RSA10B-LINE-ITEM-TRMT.  03.42V
039740     IF EIVPL-LINE-ITEM-TMNT-CODE NOT = SPACE                     03.42V
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10B-LINE-ITEM-TRMT.         03.42V
      *
042730     IF MIVPL-VAT-TAX-AMT NUMERIC
042730        MOVE MIVPL-VAT-TAX-AMT     TO RSA10C-VAT-TAX-AMT
051190        CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
051200                 C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
051210                 C-TYPEA  RSA10C-VAT-TAX-AMT  C-LGTH20
051240                 C-TYPEEND
042730     ELSE
042730        MOVE MIVPL-VAT-TAX-AMT     TO RSA10C-VAT-TAX-AMT-X.
039740     IF EIVPL-VAT-TAX-AMT NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10C-VAT-TAX-AMT.            03.42V
042730     IF MIVPL-VAT-TAX-RATE NUMERIC
042730        MOVE MIVPL-VAT-TAX-RATE    TO RSA10C-VAT-TAX-RATE
042730     ELSE
042730        MOVE MIVPL-VAT-TAX-RATE    TO RSA10C-VAT-TAX-RATE-X.
039740     IF EIVPL-VAT-TAX-RATE NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10C-VAT-TAX-RATE.           03.42V
042730     IF MIVPL-LINE-ITEM-DISC NUMERIC
042730        MOVE MIVPL-LINE-ITEM-DISC  TO RSA10C-LINE-ITEM-DISC
051190        CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
051200                 C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
051210                 C-TYPEA  RSA10C-LINE-ITEM-DISC  C-LGTH20
051240                 C-TYPEEND
042730     ELSE
042730        MOVE MIVPL-LINE-ITEM-DISC  TO RSA10C-LINE-ITEM-DISC-X.
039740     IF EIVPL-LINE-ITEM-DISC NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10C-LINE-ITEM-DISC.         03.42V
042730     IF MIVPL-LINE-ITEM-TOTAL NUMERIC
042730        MOVE MIVPL-LINE-ITEM-TOTAL TO RSA10C-LINE-ITEM-TOTAL
051190        CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
051200                 C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
051210                 C-TYPEA  RSA10C-LINE-ITEM-TOTAL  C-LGTH20
051240                 C-TYPEEND
042730     ELSE
042730        MOVE MIVPL-LINE-ITEM-TOTAL TO RSA10C-LINE-ITEM-TOTAL-X.
039740     IF EIVPL-LINE-ITEM-TOTAL NOT = SPACE
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10C-LINE-ITEM-TOTAL.        03.42V
      *                                                                 03.42V
042730     MOVE MIVIII-SERVICE-ID    TO RSA10D-SERVICE-ID.              03.42V
039740     IF EIVPL-SERVICE-ID NOT = SPACE                              03.42V
              MOVE 'Y'                TO WS-ERROR-SW                    03.42V
039760        MOVE AST-LIT           TO REHA10D-SERVICE-ID.             03.42V
      *                                                                 03.42V
           IF ERROR-FOUND                                               03.42V
              MOVE 113                   TO ADD-ER-CD-3-DIG(ADD-ER-INDX)03.42V
039590        MOVE 'Y'               TO PET-LVL3-SUS-FLAG               03.42V
              SET ADD-ER-INDX UP BY 1                                   03.42V
           END-IF.                                                      03.42V
      *
039590     IF PET-LVL3-SUS-FLAG = 'Y'
              IF MIAR-SUB-TRAN = 'PL'                                   02.75
004410           MOVE 'E'                TO KDA-HAS-PL-SW               02.75
              ELSE                                                      02.75
004410           MOVE 'E'                TO KDA-HAS-XL-SW               02.75
              END-IF                                                    02.75
018160        MOVE '*'                   TO RSA10A-SUS-FLAG             02.75
           END-IF.                                                      02.75
042830     IF ADD-ER-CD-3-DIG (1) > 0
042840        MOVE ADD-ER-CD-3-DIG (1)   TO RSA10A-ERROR-CD-1.
042850     IF ADD-ER-CD-3-DIG (2) > 0
042860        MOVE ADD-ER-CD-3-DIG (2)   TO RSA10A-ERROR-CD-2.
042870     IF ADD-ER-CD-3-DIG (3) > 0
042880        MOVE ADD-ER-CD-3-DIG (3)   TO RSA10A-ERROR-CD-3.
042890     IF ADD-ER-CD-3-DIG (4) > 0
042900        MOVE ADD-ER-CD-3-DIG (4)   TO RSA10A-ERROR-CD-4.
042910     IF ADD-ER-CD-3-DIG (5) > 0
042920        MOVE ADD-ER-CD-3-DIG (5)   TO RSA10A-ERROR-CD-5.
042830     IF ADD-ER-CD-3-DIG (6) > 0
042840        MOVE ADD-ER-CD-3-DIG (6)   TO RSA10B-ERROR-CD-1.
042850     IF ADD-ER-CD-3-DIG (7) > 0
042860        MOVE ADD-ER-CD-3-DIG (7)   TO RSA10B-ERROR-CD-2.
042870     IF ADD-ER-CD-3-DIG (8) > 0
042880        MOVE ADD-ER-CD-3-DIG (8)   TO RSA10B-ERROR-CD-3.
042890     IF ADD-ER-CD-3-DIG (9) > 0
042900        MOVE ADD-ER-CD-3-DIG (9)   TO RSA10B-ERROR-CD-4.
042910     IF ADD-ER-CD-3-DIG (10) > 0
042920        MOVE ADD-ER-CD-3-DIG (10)  TO RSA10B-ERROR-CD-5.
042830     IF ADD-ER-CD-3-DIG (11) > 0
042840        MOVE ADD-ER-CD-3-DIG (11)  TO RSA10C-ERROR-CD-1.
042850     IF ADD-ER-CD-3-DIG (12) > 0
042860        MOVE ADD-ER-CD-3-DIG (12)  TO RSA10C-ERROR-CD-2.
042870     IF ADD-ER-CD-3-DIG (13) > 0
042880        MOVE ADD-ER-CD-3-DIG (13)  TO RSA10C-ERROR-CD-3.
042890     IF ADD-ER-CD-3-DIG (14) > 0
042900        MOVE ADD-ER-CD-3-DIG (14)  TO RSA10C-ERROR-CD-4.
042910     IF ADD-ER-CD-3-DIG (15) > 0
042920        MOVE ADD-ER-CD-3-DIG (15)  TO RSA10C-ERROR-CD-5.
042830     IF ADD-ER-CD-3-DIG (16) > 0                                  03.42V
042840        MOVE ADD-ER-CD-3-DIG (16)  TO RSA10D-ERROR-CD-1.          03.42V
042850     IF ADD-ER-CD-3-DIG (17) > 0                                  03.42V
042860        MOVE ADD-ER-CD-3-DIG (17)  TO RSA10D-ERROR-CD-2.          03.42V
042870     IF ADD-ER-CD-3-DIG (18) > 0                                  03.42V
042880        MOVE ADD-ER-CD-3-DIG (18)  TO RSA10D-ERROR-CD-3.          03.42V
042890     IF ADD-ER-CD-3-DIG (19) > 0                                  03.42V
042900        MOVE ADD-ER-CD-3-DIG (19)  TO RSA10D-ERROR-CD-4.          03.42V
042910     IF ADD-ER-CD-3-DIG (20) > 0                                  03.42V
042920        MOVE ADD-ER-CD-3-DIG (20)  TO RSA10D-ERROR-CD-5.          03.42V
      *
           COMPUTE SUB2 = +4.                                           03.42V
           IF REPORT-ERROR-HILITE-ADD10A NOT = SPACES
              COMPUTE SUB2 = SUB2 + 1.
           IF REPORT-ERROR-HILITE-ADD10B NOT = SPACES
              COMPUTE SUB2 = SUB2 + 1.
           IF REPORT-ERROR-HILITE-ADD10C NOT = SPACES
              COMPUTE SUB2 = SUB2 + 1.
           IF REPORT-ERROR-HILITE-ADD10D NOT = SPACES                   03.42V
              COMPUTE SUB2 = SUB2 + 1.                                  03.42V
      *
           IF (WS-RPT-LINE-CNT + SUB2) > WS-RPT-MAX-CNT
              PERFORM S-100-PRINT-PAGE-HDR
                 THRU S-100-EXIT.
      *
042730     MOVE ZERO                     TO RSA10A-CC.
042050     MOVE RPT-SLS-ADDENDUM-10A     TO RLW-DETAIL-LINE.
042050     MOVE SPACES                   TO RPT-SLS-ADDENDUM-10A.
           PERFORM R-921-WRITE-REPORT-REC
              THRU R-921-EXIT.
           MOVE 'I'                      TO RAD-ED-LINE-TYPE.
           MOVE +0                       TO RAD-ED-TRAN-AMT.
042050     IF REPORT-ERROR-HILITE-ADD10A NOT = SPACES
042050        MOVE REPORT-ERROR-HILITE-ADD10A
042050                                   TO RLW-DETAIL-LINE
042050        MOVE SPACES                TO REPORT-ERROR-HILITE-ADD10A
              PERFORM R-921-WRITE-REPORT-REC
                 THRU R-921-EXIT.
042050     MOVE RPT-SLS-ADDENDUM-10B     TO RLW-DETAIL-LINE.
042050     MOVE SPACES                   TO RPT-SLS-ADDENDUM-10B.
           PERFORM R-921-WRITE-REPORT-REC
              THRU R-921-EXIT.
042050     IF REPORT-ERROR-HILITE-ADD10B NOT = SPACES
042050        MOVE REPORT-ERROR-HILITE-ADD10B
042050                                   TO RLW-DETAIL-LINE
042050        MOVE SPACES                TO REPORT-ERROR-HILITE-ADD10B
              PERFORM R-921-WRITE-REPORT-REC
                 THRU R-921-EXIT.
042050     MOVE RPT-SLS-ADDENDUM-10C     TO RLW-DETAIL-LINE.
042050     MOVE SPACES                   TO RPT-SLS-ADDENDUM-10C.
           PERFORM R-921-WRITE-REPORT-REC
              THRU R-921-EXIT.
042050     IF REPORT-ERROR-HILITE-ADD10C NOT = SPACES
042050        MOVE REPORT-ERROR-HILITE-ADD10C
042050                                   TO RLW-DETAIL-LINE
042050        MOVE SPACES                TO REPORT-ERROR-HILITE-ADD10C
              PERFORM R-921-WRITE-REPORT-REC
                 THRU R-921-EXIT.
042050     MOVE RPT-SLS-ADDENDUM-10D     TO RLW-DETAIL-LINE.            03.42V
042050     MOVE SPACES                   TO RPT-SLS-ADDENDUM-10D.       03.42V
           PERFORM R-921-WRITE-REPORT-REC                               03.42V
              THRU R-921-EXIT.                                          03.42V
042050     IF REPORT-ERROR-HILITE-ADD10D NOT = SPACES                   03.42V
042050        MOVE REPORT-ERROR-HILITE-ADD10D                           03.42V
042050                                   TO RLW-DETAIL-LINE             03.42V
042050        MOVE SPACES                TO REPORT-ERROR-HILITE-ADD10D  03.42V
              PERFORM R-921-WRITE-REPORT-REC                            03.42V
                 THRU R-921-EXIT.                                       03.42V
039560     GO TO C-372-EXIT.
      *
041090 C-372-EXIT.
041100     EXIT.
041110*
041120 C-373-BUILD-ADDENDUM-RECORDS.
041130     IF PET-SUS-FLAG = 'Y'
041140        GO TO C-373-EXIT.
041260     MOVE MIAR-SUB-TRAN            TO AWR-TRAN.
041240     MOVE WS-ADDENDUM-REF-ID       TO AWR-REF-NO.
041240     MOVE MIAR-SUB-SEQ-X           TO AWR-SEQ-X.
041290     PERFORM C-390-WRITE-ADDENDUM
041300        THRU C-390-EXIT.
041320*
041330 C-373-EXIT.
041340     EXIT.
041320*
041330 C-374-PRINT-ADDENDUM-LINES.
      *
           MOVE ZERO                     TO RRA-CC.
           IF ERR-CD-SUB > +0
              MOVE '*'                   TO RRA-SUS-FLAG.
      *
           COMPUTE SUB2 = ERR-LINE-SUB.
      *
           IF (WS-RPT-LINE-CNT + SUB2) > WS-RPT-MAX-CNT
              PERFORM S-100-PRINT-PAGE-HDR
                 THRU S-100-EXIT.
      *
018160     MOVE +1                       TO WS-SUB3.
018900     PERFORM
018900        VARYING WS-SUB1 FROM +1 BY +1
018900        UNTIL   WS-SUB1 > ERR-LINE-SUB
018900           IF ERR-LINE(WS-SUB1) = SPACES
018900              MOVE ERR-LINE-SUB    TO WS-SUB1
018900           ELSE
018900              MOVE ERR-LINE(WS-SUB1)
018900                                   TO RRA-DETAIL
018900              PERFORM
018900                 VARYING WS-SUB2 FROM +1 BY +1
018900                 UNTIL   WS-SUB2 > +5 OR
018900                         WS-SUB3 > ERR-CD-SUB
019120                    IF ERR-CD-3-DIG-X(WS-SUB3) NUMERIC
019120                       MOVE ERR-CD-3-DIG(WS-SUB3)
019120                                   TO RRA-ERROR-CD(WS-SUB2)
019120                    ELSE
019120                       MOVE ERR-CD-3-DIG-X(WS-SUB3)
019120                                   TO RRA-ERROR-CD-X(WS-SUB2)
019120                    END-IF
019120                    ADD +1         TO WS-SUB3
018900              END-PERFORM
042050              MOVE RPT-REPORT-ADDENDUM
042050                                   TO RLW-DETAIL-LINE
                    PERFORM R-921-WRITE-REPORT-REC
                       THRU R-921-EXIT
                    MOVE 'I'             TO RAD-ED-LINE-TYPE
                    MOVE +0              TO RAD-ED-TRAN-AMT
042050              MOVE SPACES          TO RPT-REPORT-ADDENDUM
018900           END-IF
018900     END-PERFORM.
044450*
041330 C-374-EXIT.
041340     EXIT.
044450*
044460 C-380-BUILD-MERCHANT-ADDENDUMS.
041130     IF PET-SUS-FLAG = 'Y'
041140        GO TO C-380-EXIT.
041240     MOVE SPACES                     TO MI-MC-SPEC-INT-ADDENDUM.
041240     MOVE 'AM07'                     TO MIAR-TRANSCODE.
041240     MOVE WS-ADDENDUM-REF-ID         TO AWR-REF-NO.
041260     MOVE '00'                       TO MIAR-SUB-TRAN
041260                                        AWR-TRAN.
041260     MOVE '0001'                     TO MIAR-SUB-SEQ-X
041260                                        MIAR-SUB-SEQ-TOT-X
041260                                        AWR-SEQ-X.
           MOVE ZEROS                    TO MIMPCA-INDUSTRY-REC-NO-X.   02.20
      *
           MOVE 'N'                      TO WS-MOVE-DONE-SW.
           MOVE SPACES                   TO MIMSIM-ADDRESS.
           PERFORM
             VARYING SUB1 FROM +1 BY +1
             UNTIL   SUB1 > +25 OR
                     MOVE-DONE
               IF NME-NAME-ADDRESS(2)(SUB1:1) NOT = SPACE               02.77
                  PERFORM
                    VARYING SUB2 FROM +1 BY +1
                    UNTIL   SUB1 > +25 OR
                            SUB2 > +25
                      IF NME-NAME-ADDRESS(2)(SUB1:1) = '\'              02.77
                         MOVE '/'        TO MIMSIM-ADDRESS(SUB2:1)
                      ELSE
                         MOVE NME-NAME-ADDRESS(2)(SUB1:1)               02.77
                                         TO MIMSIM-ADDRESS(SUB2:1)
                      END-IF
                      COMPUTE SUB1 = SUB1 + 1
                  END-PERFORM
                  MOVE 'Y'               TO WS-MOVE-DONE-SW
               END-IF
           END-PERFORM.
           IF NME-SOLE-PROP-NAME (1:1) = SPACE                          02.77
               MOVE SPACES     TO HOLD2-FIELD
               MOVE +1         TO START-SUB
               MOVE +25        TO END-SUB END2-SUB
               MOVE NME-SOLE-PROP-NAME TO HOLD-FIELD                    02.77
               PERFORM C-381-EDIT-MA-FIELDS THRU C-381-EXIT
               MOVE HOLD2-FIELD TO MIMSIM-SP-NAME
           ELSE
               MOVE NME-SOLE-PROP-NAME TO MIMSIM-SP-NAME.               02.77
           IF NME-LEGAL-CORP-NAME (1:1) = SPACE                         02.77
               MOVE SPACES     TO HOLD2-FIELD
               MOVE +1         TO START-SUB
               MOVE +30        TO END-SUB END2-SUB
               MOVE NME-LEGAL-CORP-NAME TO HOLD-FIELD                   02.77
               PERFORM C-381-EDIT-MA-FIELDS THRU C-381-EXIT
               MOVE HOLD2-FIELD TO MIMSIM-LEGAL-CORP-NAME
           ELSE
               MOVE NME-LEGAL-CORP-NAME    TO MIMSIM-LEGAL-CORP-NAME.   02.77
           IF HLD-ZIP-WORK = SPACES OR
              HLD-ZIP-WORK(1:5) = '00000' OR
              HLD-ZIP-WORK(1:5) = '99999'
                 MOVE SPACES             TO MIMSIM-LOC-POSTAL-CODE
           ELSE
              MOVE HLD-ZIP-WORK          TO MIMSIM-LOC-POSTAL-CODE.
           IF WS-BATCH-ICA-REGN = '1'  AND
              WS-CHD-ICA-REGN = '1'
              IF HLD-ZIP-WORK(1:5) NOT NUMERIC
                 MOVE SPACES             TO MIMSIM-LOC-POSTAL-CODE
              ELSE
              IF HLD-ZIP-WORK(6:4) = SPACES
                 NEXT SENTENCE
              ELSE
              IF HLD-ZIP-WORK(6:4) NOT NUMERIC
                 MOVE SPACES             TO MIMSIM-LOC-POSTAL-CODE(6:4).
           IF MIMSIM-LOC-POSTAL-CODE = SPACES
              MOVE 'N'                   TO KDA-PQ-MC-USA-LRG-TKT-SW
                                            KDA-PQ-MC-USA-F2F-SW
                                            KDA-PQ-MC-USA-TNEI-SW
                                            KDA-PQ-MC-USA-TNEII-SW
                                            KDA-PQ-MC-USA-TNEIII-SW
                                            KDA-PQ-MC-USA-DRI-SW
                                            KDA-PQ-MC-USA-DRII-SW
                                            KDA-PQ-MC-USA-DRIII-SW
                                            KDA-PQ-MC-INT-DRII-SW
           END-IF.
           MOVE HLD-RESET-URL            TO MIMSIM-URL.                 02.37
           MOVE HLD-RESET-EMAIL          TO MIMSIM-EMAIL-ADDR.          02.37
           MOVE MIMSIM-EMAIL-ADDR        TO KDA-CONTACT-EMAIL.
           MOVE WS-MIMFCC-TOTAL-TAXES-X
                                         TO MIMSIM-TOTAL-TAXES-X.
           MOVE WS-MIMFCC-FUEL-INFO      TO MIMSIM-FUEL-INFO.
           MOVE WS-MIMFCC-ODOMETER-READING
                                         TO MIMSIM-ODOMETER-READING.
           IF NOT KDA-HAS-M1
              GO TO C-380-WRITE-00-ADDENDUM.
           IF HOLD-M11-CUSTOM-ID NOT = SPACES
              MOVE HOLD-M11-CUSTOM-ID    TO MIMSIM-CUSTOM-ID.
       C-380-WRITE-00-ADDENDUM.
           MOVE +4                       TO WS-ADD-REC-CNT.
041290     PERFORM C-390-WRITE-ADDENDUM
041300        THRU C-390-EXIT.
       C-380-CHECK-MIMCCC-ADDENDUM.
           IF NOT PET-VALID-SALE                                        03.31
              GO TO C-380-EXIT.
           IF NOT KDA-CHD-ICA-IS-MC-BCFPCARD
              GO TO C-380-EXIT.
           IF HLD-INET-COUNTRY NOT = 'USA'
              GO TO C-380-EXIT.
      * PDS 0173                                                        02.39
           IF MIMSIM-LEGAL-CORP-NAME = SPACES
              MOVE 'N'                   TO KDA-PQ-MC-USA-LRG-TKT-SW
                                            KDA-PQ-MC-USA-F2F-SW
                                            KDA-PQ-MC-USA-TNEI-SW
                                            KDA-PQ-MC-USA-TNEII-SW
                                            KDA-PQ-MC-USA-TNEIII-SW
                                            KDA-PQ-MC-USA-DRI-SW
                                            KDA-PQ-MC-USA-DRII-SW
                                            KDA-PQ-MC-USA-DRIII-SW
                                            KDA-PQ-MC-USA-EPAY-SW       02.39
                                            KDA-PQ-MC-USA-UTIL-SW       02.39
           END-IF.
           IF KDA-98-P1-HAD-ERRORS
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 117                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1
              GO TO C-380-EXIT.
           IF KDA-HAS-98-P1
              IF PET-MC-SUS-FLAG = 'Y'
                 IF KDA-HAS-98-F1                                       02.39
                    IF KDA-HAS-98-P2                                    03.25
      *                ALL ADDENDUMS BESIDES P1-COMMON & F1-FLEET &     03.25
      *                P2-LINE ITEM DETAIL ARE REJECTED                 03.25
                       MOVE 'G'             TO PET-MC-SUS-FLAG          03.25
                    ELSE                                                03.25
      *                ALL ADDS BESIDES P1-COMMON & F1-FLEET ARE RJCTD  03.25
                       MOVE 'F'             TO PET-MC-SUS-FLAG          02.39
                    END-IF                                              03.25
                 ELSE                                                   02.39
                    IF KDA-HAS-98-P2                                    03.25
      *                ALL ADDS BESIDES P1-COMMON & P2-DETAIL ARE RJCTD 03.25
                       MOVE 'Q'             TO PET-MC-SUS-FLAG          03.25
                    ELSE                                                03.25
      *                ALL ADDS BESIDES P1-COMMON ARE REJECTED          03.25
                       MOVE 'P'             TO PET-MC-SUS-FLAG          02.39
                    END-IF                                              03.25
                 END-IF                                                 02.39
              END-IF
              GO TO C-380-EXIT
           END-IF.
       C-380-ADD-MIMCCC-ADDENDUM.
           MOVE ZEROS                    TO WS-SAVE-SUB-SEQ.
           MOVE 1                        TO WS-NEXT-SUB-SEQ.
           MOVE ZEROS                    TO WS-SAVE-SUB-SEQ-TOT.
           MOVE 'N'                      TO WS-SEQ-TOTAL-REACHED.
           MOVE SPACES                   TO WS-CHECK-ADD-TRAN
                                            WS-LAST-ADD-TRAN.
      *
           MOVE SPACES                   TO MERCHANT-INPUT-ADDENDUM.
           MOVE 'AM07'                   TO MIAR-TRANSCODE.
           MOVE '98'                     TO MIAR-SUB-TRAN
                                            WS-CHECK-SUB-TRAN.
           MOVE '0001'                   TO MIAR-SUB-SEQ-X.
           MOVE WS-LAST-98-SEQ-TOT       TO MIAR-SUB-SEQ-TOT-NUM.
           MOVE ZEROS                    TO MIMPCA-INDUSTRY-REC-NO-X
                                            WS-CHECK-SUB-CODE.
      *
           SET ATE-INDX                  TO 1.
           SEARCH WS-AT-ENTRY
              VARYING ATE-INDX
                 AT END
                    GO TO C-380-EXIT
                 WHEN WS-ATE-TRAN(ATE-INDX) = WS-CHECK-ADD-TRAN
                    MOVE WS-ATE-LGTH(ATE-INDX)
                                         TO WS-ADD-REM-LGTH
                    MOVE WS-ATE-VALID-1ST(ATE-INDX)
                                         TO WS-ADD-VALID-1ST
                    MOVE WS-ATE-MAX-NO(ATE-INDX)
                                         TO WS-ADD-MAX-NO.
      *
           IF ADD-IS-VALID-2ND-REQ
              MOVE 'N'                   TO WS-2ND-RECEIVED-FLAG
           ELSE
              MOVE 'Y'                   TO WS-2ND-RECEIVED-FLAG.
      *
           MOVE +8                       TO WS-ADD-REC-CNT.
           PERFORM C-370-EDIT-ADDENDUM
              THRU C-370-EXIT.
           IF KDA-98-P1-HAD-ERRORS
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 118                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1
           ELSE
              IF PET-MC-SUS-FLAG = 'Y'
                 IF KDA-HAS-98-F1                                       02.39
                    IF KDA-HAS-98-P2                                    03.25
      *                ALL ADDENDUMS BESIDES P1-COMMON & F1-FLEET &     03.25
      *                P2-LINE ITEM DETAIL ARE REJECTED                 03.25
                       MOVE 'G'             TO PET-MC-SUS-FLAG          03.25
                    ELSE                                                03.25
      *                ALL ADDS BESIDES P1-COMMON & F1-FLEET ARE RJCTD  03.25
                       MOVE 'F'             TO PET-MC-SUS-FLAG          02.39
                    END-IF                                              03.25
                 ELSE                                                   02.39
                    IF KDA-HAS-98-P2                                    03.25
      *                ALL ADDS BESIDES P1-COMMON & P2-DETAIL ARE RJCTD 03.25
                       MOVE 'Q'             TO PET-MC-SUS-FLAG          03.25
                    ELSE                                                03.25
      *                ALL ADDS BESIDES P1-COMMON ARE REJECTED          03.25
                       MOVE 'P'             TO PET-MC-SUS-FLAG          02.39
                    END-IF                                              03.25
                 END-IF                                                 02.39
              END-IF
           END-IF.
044530 C-380-EXIT.
044540     EXIT.
044450*
044460 C-381-EDIT-MA-FIELDS.
           IF HOLD-FIELD (START-SUB:1) = SPACE
              ADD +1 TO START-SUB
              SUBTRACT 1 FROM END2-SUB
              IF START-SUB > END-SUB
                 MOVE SPACES TO HOLD2-FIELD
                 GO TO C-381-EXIT
              ELSE
                 GO TO C-381-EDIT-MA-FIELDS.
           MOVE HOLD-FIELD (START-SUB:END2-SUB) TO HOLD2-FIELD.
044530 C-381-EXIT.
044540     EXIT.
076830*
       C-382-CHECK-ZERO-FILL.                                           02.41
      *                                                                 02.41
           MOVE 'Y'                      TO WS-ERROR-SW.                02.41
           PERFORM                                                      02.41
             VARYING WS-SUB2 FROM +1 BY +1                              02.41
             UNTIL   WS-SUB2 > WS-SUB1                                  02.41
               IF WK-ZERO-FIELD(WS-SUB2:1) = ZERO OR SPACE              02.41
                  CONTINUE                                              02.41
               ELSE                                                     02.41
                  MOVE 'N'               TO WS-ERROR-SW                 02.41
                  COMPUTE WS-SUB2 = WS-SUB1                             02.41
               END-IF                                                   02.41
           END-PERFORM.                                                 02.41
      *                                                                 02.41
       C-382-EXIT.                                                      02.41
           EXIT.                                                        02.41
      *                                                                 02.41
       C-384-CHECK-AMEX-ADDENDUM.                                       02.63
      *                                                                 02.63
           IF PET-SUS-FLAG = 'Y'                                        02.63
              GO TO C-384-EXIT.                                         02.63
           IF KDA-HAS-AX-LD                                             02.63
              GO TO C-384-SET-AMEX-SUS-FLAG.                            02.63
           IF KDA-AX-LD-HAD-ERRORS                                      02.63
              MOVE 'Y'                   TO PET-SUS-FLAG                02.63
              MOVE 117                   TO ER-CD-3-DIG(ER-INDX)        02.63
              SET ER-INDX UP BY 1                                       02.63
              GO TO C-384-EXIT                                          02.63
           END-IF.                                                      02.63
      *                                                                 02.63
       C-384-ADD-AMEX-LD.                                               02.63
      *                                                                 02.63
           MOVE ZEROS                    TO WS-SAVE-SUB-SEQ.            02.63
           MOVE 1                        TO WS-NEXT-SUB-SEQ.            02.63
           MOVE ZEROS                    TO WS-SAVE-SUB-SEQ-TOT.        02.63
           MOVE 'N'                      TO WS-SEQ-TOTAL-REACHED.       02.63
           MOVE SPACES                   TO WS-CHECK-ADD-TRAN           02.63
                                            WS-LAST-ADD-TRAN.           02.63
      *                                                                 02.63
           MOVE SPACES                   TO MERCHANT-INPUT-ADDENDUM.    02.63
           MOVE 'AM07'                   TO MIAR-TRANSCODE.             02.63
           MOVE 'AX'                     TO MIAR-SUB-TRAN               02.63
                                            WS-CHECK-SUB-TRAN.          02.63
           MOVE '0001'                   TO MIAR-SUB-SEQ-X              02.63
                                            MIAR-SUB-SEQ-TOT-NUM.       02.63
           MOVE '9900'                   TO MIAX-TYPE-DATA              02.63
                                            WS-CHECK-SUB-CODE.          02.63
      *                                                                 02.63
           IF KDA-IS-PAY-SVCS-PROVIDER                                  02.95
              MOVE KDA-FE-BANK-NAME-1 (1:20) TO MIAXLD-LOC-NAME (1:20)  02.95
              MOVE '*'                   TO MIAXLD-LOC-NAME (21:1)      02.95
              MOVE PET-MERCH-NAME(1:17)  TO MIAXLD-LOC-NAME (22:17)     02.95
              MOVE KDA-MM-DESCR-CITY     TO MIAXLD-LOC-CITY             03.62A
              MOVE KDA-MM-DESCR-STATE    TO MIAXLD-LOC-REGN             03.62A
              MOVE KDA-MM-DESCR-ADDR     TO MIAXLD-LOC-ADDR             03.62A
              MOVE KDA-MM-DESCR-CNTRY    TO MIAXLD-LOC-COUNTRY          03.62A
              MOVE KDA-MM-DESCR-POSTAL   TO MIAXLD-LOC-POST             03.62A
              MOVE KDA-AX-MRCH-TYP       TO MIAXLD-LOC-MCC              03.16A
              MOVE PET-MERCH-NMBR        TO WS-ACCOUNT                  02.95
              MOVE WS-ACCOUNT-MID        TO MIAXLD-LOC-SELLER-ID(1:10)  02.95
              MOVE '*'                   TO MIAXLD-LOC-SELLER-ID(11:1)  02.95
              MOVE PET-MERCH-NAME (1:9)  TO MIAXLD-LOC-SELLER-ID(12:9)  02.95
           ELSE                                                         02.95
              MOVE HLD-DESCR-NAME           TO MIAXLD-LOC-NAME          02.95
              MOVE HLD-DESCR-ADDR           TO MIAXLD-LOC-ADDR          02.95
              MOVE HLD-DESCR-CITY           TO MIAXLD-LOC-CITY          02.95
              MOVE HLD-DESCR-STATE          TO MIAXLD-LOC-REGN          02.95
              MOVE HLD-DESCR-COUNTRY        TO MIAXLD-LOC-COUNTRY       02.95
              MOVE HLD-ZIP-WORK             TO MIAXLD-LOC-POST          02.95
              MOVE KDA-AX-MRCH-TYP          TO MIAXLD-LOC-MCC           03.16A
              IF WS-MRCH-IS-AMX-EAP                                     03.16A
                 MOVE SPACES                TO MIAXLD-LOC-SELLER-ID     03.16A
                 MOVE PET-MERCH-NMBR        TO WS-ACCOUNT               03.16A
                 MOVE HLD-BANK-KEY          TO MIAXLD-LOC-SELLER-ID(1:6)03.16A
                 IF NOT KDA-AX-FE-SELLER                                03.62A
                    MOVE WS-ACCOUNT-MID    TO MIAXLD-LOC-SELLER-ID(7:10)03.62A
                 ELSE                                                   03.62A
                    MOVE WS-ACCOUNT-MID (2:9)                           03.62A
                                           TO MIAXLD-LOC-SELLER-ID(7:9) 03.62A
                 END-IF                                                 03.62A
              END-IF                                                    03.16A
           END-IF.                                                      02.95
      *                                                                 02.63
           SET ATE-INDX                  TO 1.                          02.63
           SEARCH WS-AT-ENTRY                                           02.63
              VARYING ATE-INDX                                          02.63
                 AT END                                                 02.63
                    GO TO C-384-EXIT                                    02.63
                 WHEN WS-ATE-TRAN(ATE-INDX) = WS-CHECK-ADD-TRAN         02.63
                    MOVE WS-ATE-LGTH(ATE-INDX)                          02.63
                                         TO WS-ADD-REM-LGTH             02.63
                    MOVE WS-ATE-VALID-1ST(ATE-INDX)                     02.63
                                         TO WS-ADD-VALID-1ST            02.63
                    MOVE WS-ATE-MAX-NO(ATE-INDX)                        02.63
                                         TO WS-ADD-MAX-NO.              02.63
      *                                                                 02.63
           IF ADD-IS-VALID-2ND-REQ                                      02.63
              MOVE 'N'                   TO WS-2ND-RECEIVED-FLAG        02.63
           ELSE                                                         02.63
              MOVE 'Y'                   TO WS-2ND-RECEIVED-FLAG.       02.63
      *                                                                 02.63
           MOVE +2                       TO WS-ADD-REC-CNT.             02.63
           PERFORM C-370-EDIT-ADDENDUM                                  02.63
              THRU C-370-EXIT.                                          02.63
           IF KDA-AX-LD-HAD-ERRORS                                      02.63
              MOVE 'Y'                   TO PET-SUS-FLAG                02.63
              MOVE 118                   TO ER-CD-3-DIG(ER-INDX)        02.63
              SET ER-INDX UP BY 1                                       02.63
              GO TO C-384-EXIT                                          02.63
           END-IF.                                                      02.63
      *                                                                 02.63
       C-384-SET-AMEX-SUS-FLAG.                                         02.63
      *                                                                 02.63
           IF PET-AMEX-SUS-FLAG = 'Y'                                   02.63
              MOVE 02                    TO PET-AMEX-SE-FC              02.63
                                            RAX-1-SE-FC                 02.63
              IF KDA-HAS-AX-LD                                          02.63
                 MOVE 'L'                TO PET-AMEX-SUS-FLAG           02.63
                 IF HOLD-AMEX-SE-FC NOT = '02'                          02.63
                    MOVE '?'             TO RAX-1-SE-FC-ERR-IND         02.63
                 END-IF                                                 02.63
              END-IF                                                    02.63
           ELSE                                                         02.63
              IF KDA-HAS-AX-RI OR                                       02.63
                 KDA-HAS-AX-LG OR                                       02.63
                 KDA-HAS-AX-II OR                                       02.63
                 KDA-HAS-AX-VR OR                                       02.63
                 KDA-HAS-AX-AI OR                                       03.44
                 KDA-HAS-AX-ET                                          02.63
                    MOVE HOLD-AMEX-SE-FC TO PET-AMEX-SE-FC              02.63
              ELSE                                                      02.63
                 MOVE 02                 TO PET-AMEX-SE-FC              02.63
                                            RAX-1-SE-FC                 02.63
                 IF HOLD-AMEX-SE-FC NOT = '02'                          02.63
                    MOVE '?'             TO RAX-1-SE-FC-ERR-IND         02.63
                 END-IF                                                 02.63
              END-IF                                                    02.63
           END-IF.                                                      02.63
      *                                                                 02.63
       C-384-EXIT.                                                      02.63
           EXIT.                                                        02.63
      *                                                                 02.63
076840 C-390-WRITE-ADDENDUM.
041240     MOVE SPACES                   TO AWR-ADDENDUM-SORT-DATA.
044520     MOVE WS-ADD-REC-CNT           TO AWR-REC-CNT.
044520     MOVE ADDENDUM-WORK-RECORD     TO ADDENDUM-RECORD-OUT.
076850     WRITE ADDENDUM-RECORD-OUT.
076860 C-390-EXIT.
076870     EXIT.
004550*
044560 C-400-CARDHOLDER-TRANS.
           IF MR1-VALID-RETURN                                          03.31
              MOVE 'C'                   TO WS-CREDIT-OR-DEBIT.         03.31
045000     PERFORM C-500-EDIT-SALES
045010        THRU C-500-EXIT.
045030*
045040*   ACCUMULATE TOTAL ITEMS AND DOLLAR AMOUNTS BY TRANSCODE
045050*
045060     IF PET-SUS-FLAG EQUAL 'Y'
045070         ADD 1 TO SUS-COUNTER.
           IF MR1-VALID-SALE OR                                         03.31
              MR1-VALID-CASH                                            03.31
                 ADD 1                   TO CALC-CH-DEBIT-ITMS          03.31
                 ADD PET-ACQ-AMOUNT      TO CALC-CH-DEBIT-AMT           03.31
           END-IF.                                                      03.31
           IF MR1-VALID-RETURN                                          03.31
              ADD 1                      TO CALC-CH-CREDIT-ITMS         03.31
              ADD PET-ACQ-AMOUNT         TO CALC-CH-CREDIT-AMT          03.31
           END-IF.                                                      03.31
045220*
045570 C-400-EXIT.
045580     EXIT.
000000
000000 C-410-NO-EDITS.
           IF MR1-VALID-RETURN                                          03.31
              MOVE 'C'                   TO WS-CREDIT-OR-DEBIT.         03.31
045000     PERFORM C-550-SALES-NO-EDITS
045010        THRU C-550-EXIT.
045030*
045040*   ACCUMULATE TOTAL ITEMS AND DOLLAR AMOUNTS BY TRANSCODE
045050*
045060     IF PET-SUS-FLAG EQUAL 'Y'
045070         ADD 1 TO SUS-COUNTER.
           IF MR1-VALID-SALE OR                                         03.31
              MR1-VALID-CASH                                            03.31
                 ADD 1                   TO CALC-CH-DEBIT-ITMS          03.31
                 ADD PET-ACQ-AMOUNT      TO CALC-CH-DEBIT-AMT           03.31
           END-IF.                                                      03.31
           IF MR1-VALID-RETURN                                          03.31
              ADD 1                      TO CALC-CH-CREDIT-ITMS         03.31
              ADD PET-ACQ-AMOUNT         TO CALC-CH-CREDIT-AMT          03.31
           END-IF.                                                      03.31
045310*
045570 C-410-EXIT.
045580     EXIT.
045590*
045600*   THIS MODULE EDITS ALL TRANSACTIONS THAT FOLLOW A 20XX
045610*     BATCH HEADER AND 30XX OR 31XX GROUP SUMMARY.
045620*
045630*     SALES -- TRANS. 06XX,
045640*     RETURNS -- TRANS. 07XX,
045650*     CASH ADVANCES -- TRANS. 0OXX,
045660*     AN OUTPUT RECORD AND A DETAIL LINE ARE GENERATED FOR
045670*       EACH TRANSACTION
045680*
045690 C-500-EDIT-SALES.
           IF INV-GRP-TC-SW = 'Y'
              IF MR1-VALID-RETURN                                       03.31
                 MOVE ONE-AST            TO RCL-1-FATAL-FLAG
              ELSE
                 MOVE ONE-AST            TO RF1-1-FATAL-FLAG.
045720     MOVE BASCRATE-SD-IIIAAA-CURR-CD TO PET-IIIAAA-CURR-CODE.
045720     MOVE BASCRATE-SD-REIMB-CURR-CD TO PET-REIMB-CURR-CODE.
045720     MOVE BASCRATE-SD-BATCH-CURR-CD TO PET-ACQ-CURR-CODE
045730                                      PET-ORIG-INT-SETL-CURR-CODE.
045740     IF PET-DEST-BANK-KEY = +0
              IF WS-CARD-TYPE = 'M'                                     02.41
045830           MOVE 'M'                TO PET-MC-SETTLEMENT-IND
045800           MOVE +840               TO PET-ISS-CURR-CODE
045810                                      PET-DEST-INT-SETL-CURR-CODE
045910        ELSE
045920            MOVE BASCRATE-SD-BATCH-CURR-CD
045930                                   TO PET-ISS-CURR-CODE
045940                                      PET-DEST-INT-SETL-CURR-CODE
045950     ELSE
045920        MOVE BASCRATE-SD-BATCH-CURR-CD
045930                                   TO PET-ISS-CURR-CODE
045940                                      PET-DEST-INT-SETL-CURR-CODE.
           IF MR1-VALID-RETURN                                          03.31
046120        MOVE 'C'                   TO WS-CREDIT-OR-DEBIT
046130     ELSE
046140        MOVE 'D'                   TO WS-CREDIT-OR-DEBIT.
           IF MR1-VALID-MIS3-TRAN                                       03.31
046160        PERFORM C-530-SALES-FORMAT-3
046170           THRU C-530-EXIT
046180     ELSE
046190        PERFORM C-510-SALES-FORMAT-1
046200           THRU C-510-EXIT.
046210     PERFORM S-810-MERCH-TOTS
046220        THRU S-810-EXIT.
046250     IF PET-SUS-FLAG EQUAL 'Y'
046260         NEXT SENTENCE
046270     ELSE
046280         PERFORM S-840-NOTONUS-TOTS
046290            THRU S-840-EXIT.
046300 C-500-GRP-TOT.
           IF MR1-VALID-RETURN                                          03.31
046320         SUBTRACT PET-ACQ-AMOUNT FROM CALC-GRP-AMOUNT
046330     ELSE
046340         ADD PET-ACQ-AMOUNT TO CALC-GRP-AMOUNT.
046350 C-500-EXIT.
046360     EXIT.
046370*
046840 C-510-SALES-FORMAT-1.
046850     IF GROUP-SUS-SW EQUAL 'Y'
046860        MOVE HLD-MRCH-ER-CD TO ER-CD (ER-INDX)
046870        SET ER-INDX UP BY 1
046880        MOVE 'Y' TO PET-SUS-FLAG.
      *
047040     MOVE MIS1-AMOUNT-X          TO AMOUNT-CHK-X.
047050     PERFORM U-200-SLS-AMT-EDIT
047060        THRU U-200-EXIT.
           IF MIS1-AMOUNT NUMERIC
              MOVE MIS1-AMOUNT           TO RF1-1-TRAN-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RF1-1-TRAN-AMT  C-LGTH24
                   C-TYPEEND
           ELSE
              MOVE MIS1-AMOUNT-X         TO RF1-1-TRAN-AMT-X.
           IF AMT-ERR-CD NOT = 00
              MOVE ONE-AST               TO RCL-1-TRAN-AMT-ERR-IND.
047090     PERFORM U-110-VALIDATE-AUTH
047100        THRU U-110-EXIT.
           IF AUTH-ERR
              MOVE 4                     TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE ONE-AST               TO RF1-2-AUTH-CODE-ERR-IND
           ELSE
              MOVE AUTH-SPACE-WORK       TO PET-AUTH-CD.
047450*
047460 C-510-SALES-CONT.
047480*
           MOVE MR1-TRANSCODE          TO PET-TRANS
                                          RF1-1-TRANSCODE.
047510     MOVE HLD-BANK-KEY           TO PET-ORIG-BANK-KEY.
           MOVE WS-MIS3-CARD-TYPE      TO RF1-1-CARD-TYPE.
           MOVE HLD-ACCOUNT-IN         TO RF1-1-ACCT-NO.
           IF HLD-ACCOUNT-IN-EXT NOT = SPACES
              MOVE '-'                 TO RF1-1-DASH
              MOVE HLD-ACCOUNT-IN-EXT  TO RF1-1-ACCT-NO-EXT.
047530     MOVE HLD-SUM-MERCH-NMBR     TO PET-MERCH-NMBR.
047540     IF PET-INCOMING-FORMAT = 'V'
              MOVE KDA-CUST-SVC-PHONE    TO PET-TELE-NUM
              MOVE KDA-PROPERTY-PHONE    TO PET-PROPERTY-PHONE
              IF NOT KDA-VC-PROG-REGIST-FLAG
                 MOVE 'N'                TO KDA-VISA-PROG-REGIST-FLAG
              END-IF
              MOVE HOLD-MERCH-ID         TO PET-TMP-CARD-ACCEPTOR
              MOVE HLD-VOLUME-TIER-IND   TO PET-VOLUME-TIER-IND
047550        MOVE WS-CHD-AR-REPORT-BIN  TO PET-TMP-DESTIN-BIN
047550        MOVE WS-BATCH-BIN          TO PET-TMP-SOURCE-BIN
047550        IF HLD-ZIP-FRST-5 NOT NUMERIC
047550           MOVE ZEROS              TO PET-TMP-MERCH-ZIP
047550        ELSE
047550           MOVE HLD-ZIP-FRST-5     TO PET-TMP-MERCH-ZIP
047550        END-IF
047560        MOVE HLD-DESCR-COUNTRY     TO PET-TMP-ST-PROV
047570        MOVE KDA-SIC-MRCH-TYP      TO PET-MERCH-TYPE
                                            RF1-2-CAT-CODE
                                            RF1-2-CAT-CODE
047590     ELSE
           IF PET-INCOMING-FORMAT = 'D'
              MOVE KDA-DS-MRCH-TYP       TO PET-MERCH-TYPE              02.39
                                            RF1-2-CAT-CODE
              MOVE ZEROS                 TO KDA-PROCESS-CODE
              IF MR1-VALID-RETURN                                       03.31
                 MOVE 20                 TO KDA-PC-TRAN-TYPE
              END-IF
              IF MR1-VALID-CASH                                         03.31
                 MOVE 01                 TO KDA-PC-TRAN-TYPE
              END-IF
              MOVE KDA-PROCESS-CODE-X    TO PET-DS-PROC-CD
           ELSE
           IF PET-INCOMING-FORMAT = 'A'                                 02.29
              MOVE KDA-AX-MRCH-TYP       TO PET-MERCH-TYPE              02.29
                                            RF1-2-CAT-CODE              02.29
           ELSE                                                         02.29
047600        MOVE HLD-INET-COUNTRY      TO PET-INET-COUNTRY
047610        MOVE KDA-MC-MRCH-TYP       TO PET-MERCH-TYPE
                                            RF1-2-CAT-CODE.
047540     IF PET-INCOMING-FORMAT = 'V'                                 03.62V
047570        IF KDA-SIC-MRCH-TYP    = '6010' OR '6011'                 03.62V
103220           MOVE '0'                TO PET-ATM-ACCT                03.62V
              ELSE                                                      03.62V
103220           MOVE SPACES             TO PET-ATM-ACCT                03.62V
              END-IF                                                    03.62V
           END-IF.                                                      03.62V
047630*
047640     IF  INVALID-MERCH-SW = 'N'
047650         PERFORM U-195-CHECK-MERCH-TYPE
047660            THRU U-195-EXIT
047670         IF  INVALID-MERCH-TYPE = 'Y'
047680             MOVE AST-LIT          TO RF1-2-CAT-CODE-ERR-IND.
PROMST     MOVE PSI-RUN                  TO PET-SOURCE-ID.
047780     PERFORM S-760-SET-INT-SETL-GRP
047790        THRU S-760-EXIT.
           MOVE MIS1-REF-NO-X            TO RF1-2-REF-NO-X.
           IF MIS1-REF-NO-X NUMERIC AND
             (MIS1-REF-NO-X NOT = ZEROS)
                 MOVE MIS1-REF-NO        TO WS-REF-NO-11-DIGITS
           ELSE
              ADD 1                      TO WS-REF-NO-CALC
              MOVE WS-REF-NO-CALC        TO WS-REF-NO-11-DIGITS
           END-IF.
           MOVE MIS1-PHONE-ORD           TO KDA-PHONE-ORD
                                            RF1-2-MOTO-ECOM.
      *
           IF PET-CARD-TYPE-VISA                                        03.27
              IF KDA-PHONE-ORD = '2'
                 IF KDA-BATCH-BIN-REGION NOT = '1'
                    MOVE SPACE           TO KDA-PHONE-ORD
                    MOVE 'R'             TO PET-POS-ENVIRONMENT
                 END-IF
              END-IF
              IF NOT KDA-VC-PHONE-ORD
                 MOVE SPACE              TO KDA-PHONE-ORD
              END-IF
              IF KDA-MERCAT-DIRECT-MKT AND
                 KDA-VC-PHONE-ORD-SPACE
                 IF PET-POS-ENVIRONMENT = SPACE                         02.29
                    MOVE 'I'             TO PET-POS-ENVIRONMENT         02.29
                                            KDA-POS-ENV                 02.29
                 ELSE                                                   02.29
                    IF KDA-BATCH-BIN-REGION = '1'
                       MOVE '4'          TO KDA-PHONE-ORD
                    ELSE
                       IF PET-POS-ENVIRONMENT NOT = 'R'
                          MOVE '4'       TO KDA-PHONE-ORD
                       END-IF
                    END-IF
                 END-IF
              END-IF
              MOVE KDA-PHONE-ORD         TO PET-MAIL-PHONE-IND
           END-IF.
      *
047860     IF PET-CARD-TYPE-MC
068290        MOVE MIS1-PHONE-ORD        TO PET-MC-MAIL-PHONE-IND
              PERFORM U-430-DEFAULT-PROCESS-CODE                        02.53
                 THRU U-430-EXIT                                        02.53
047880        MOVE HOLD-MERCH-ID         TO PET-MERCH-ID
              MOVE KDA-CUST-SVC-PHONE    TO PET-TELE-NUM
              MOVE KDA-PROPERTY-PHONE    TO PET-PROPERTY-PHONE
              MOVE WS-MC-BANKNET-REF-NO  TO PET-BANKNET-REF-NO          02.45
              MOVE WS-MC-BANKNET-DATE    TO PET-BANKNET-DATE            02.45
              IF KDA-VC-PHONE-ORD-MERCH
                 MOVE 0                  TO PET-MC-OPER-ENV
              END-IF
           END-IF.
      *
           MOVE MIS1-DESCR-MERCH         TO RF1-7-MRCH-NAME.
           MOVE MIS1-DESCR-CITY          TO RF1-7-MRCH-CITY.
           MOVE MIS1-DESCR-STATE         TO RF1-7-MRCH-STATE.
           IF MIS1-REF-NO NUMERIC
              MOVE SPACES                TO RF1-7-MRCH-COUNTRY
           ELSE
              MOVE MIS1-DESCR-CNTRY      TO RF1-7-MRCH-COUNTRY
           END-IF.
           MOVE HLD-TRAN-MERCH-NMBR-X    TO RF1-7-MRCH-ID.
           IF KDA-MERCAT-DIRECT-MKT
              IF MIS1-DESCR-MERCH NOT = SPACES
                 MOVE SPACES             TO HLD-DESCR-NAME
                 PERFORM
                   VARYING SUB1 FROM +1 BY +1
                   UNTIL   SUB1 > +25
                     IF MIS1-DESCR-MERCH(SUB1:1) NOT = SPACE
                        PERFORM
                          VARYING SUB2 FROM +1 BY +1
                          UNTIL   SUB1 > +25
                            IF MIS1-DESCR-MERCH(SUB1:1) = '\'
                               MOVE '/'  TO HLD-DESCR-NAME(SUB2:1)
                            ELSE
                               MOVE MIS1-DESCR-MERCH(SUB1:1)
                                         TO HLD-DESCR-NAME(SUB2:1)
                            END-IF
                            COMPUTE SUB1 = SUB1 + 1
                        END-PERFORM
                     END-IF
                 END-PERFORM
              END-IF
              IF MIS1-DESCR-CITY NOT = SPACES
                 MOVE SPACES             TO HLD-DESCR-CITY
                 PERFORM
                   VARYING SUB1 FROM +1 BY +1
                   UNTIL   SUB1 > +13
                     IF MIS1-DESCR-CITY(SUB1:1) NOT = SPACE
                        PERFORM
                          VARYING SUB2 FROM +1 BY +1
                          UNTIL   SUB1 > +13 OR
                                  SUB2 > +13
                            IF MIS1-DESCR-CITY(SUB1:1) = '\'
                               MOVE '/'  TO HLD-DESCR-CITY(SUB2:1)
                            ELSE
                               MOVE MIS1-DESCR-CITY(SUB1:1)
                                         TO HLD-DESCR-CITY(SUB2:1)
                            END-IF
                            COMPUTE SUB1 = SUB1 + 1
                        END-PERFORM
                     END-IF
                 END-PERFORM
              END-IF
           END-IF.
      *
           PERFORM S-640-CALCULATE-NEW-REFERENCE
              THRU S-640-EXIT.
           PERFORM S-642-CALCULATE-CHK-DIGIT
              THRU S-642-EXIT.
           IF KDA-VR-11-DIGITS = ZERO
              MOVE ONE-AST               TO RF1-2-REF-NO-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 226                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
           MOVE KDA-VISA-REF             TO PET-REF-NMBR
                                            RCL-8-REF-NO.
      *
           IF PET-CARD-TYPE-VISA                                        03.27
              PERFORM Z999-CALL-TCR2-PROC
                 THRU Z999-EXIT.
      *
047940     PERFORM I-100-CHECK-INCENTIVES
047950        THRU I-100-EXIT.
      *
           MOVE HLD-DESCR-NAME           TO RCL-8-MRCH-NAME.
           MOVE HLD-DESCR-CITY           TO RCL-8-MRCH-CITY.
           MOVE HLD-DESCR-STATE          TO RCL-8-MRCH-STATE
           MOVE HLD-DESCR-COUNTRY        TO RCL-8-MRCH-COUNTRY.
           MOVE HLD-ZIP-WORK(1:5)        TO RCL-8-MRCH-ZIP.
      *
           IF PET-CARD-TYPE-VISA OR                                     03.27
              PET-CARD-TYPE-MC OR
              PET-CARD-TYPE-DISCOVER OR                                 02.29
              PET-CARD-TYPE-PAYPAL   OR                                 03.47
              PET-CARD-TYPE-AMEX                                        02.29
                 MOVE BASCRATE-SD-REIMB-CURR-CD
                                         TO RIL-1-REIMB-CURR
                 MOVE PET-REIMB-AMT      TO RIL-1-REIMB-AMT
                 MOVE PET-REIMB-INT-FEE-AMT
                                         TO RIL-1-REIMB-FEE
                 CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                       C-TYPED  BASCRATE-SD-REIMB-CURR-DEC
                       C-TYPEA  RIL-1-REIMB-AMT  C-LGTH20
                                RIL-1-REIMB-FEE  C-LGTH16
                       C-TYPEEND
                 MOVE BASCRATE-SD-IIIAAA-CURR-CD
                                         TO RIL-1-SETTLE-CURR
                 MOVE PET-IIIAAA-AMT     TO RIL-1-SETTLE-AMT
                 MOVE PET-IIIAAA-INT-FEE-AMT
                                         TO RIL-1-INTCHG-FEE
                 CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                       C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC
                       C-TYPEA  RIL-1-SETTLE-AMT  C-LGTH20
                                RIL-1-INTCHG-FEE  C-LGTH16
                       C-TYPEEND.
      *
           PERFORM C-595-TOTAL-TRANS
              THRU C-595-EXIT.
           IF PET-SUS-FLAG = 'Y'
              MOVE '*'                   TO RF1-1-SUS-FLAG.
           PERFORM U-100-OUT-WORK-REC
              THRU U-100-EXIT.
           PERFORM R-923-PRINT-FORMAT-1-REC
              THRU R-923-EXIT.
048000 C-510-EXIT.
048010     EXIT.
048020*
048030 C-530-SALES-FORMAT-3.
048040     MOVE HLD-SUM-MERCH-NMBR     TO PET-MERCH-NMBR.
           IF PET-INCOMING-FORMAT = 'V'                                 02.39
              MOVE KDA-SIC-MRCH-TYP      TO PET-MERCH-TYPE
                                            RCL-6-CAT-CODE
           ELSE
           IF PET-INCOMING-FORMAT = 'A'                                 02.29
              MOVE KDA-AX-MRCH-TYP       TO PET-MERCH-TYPE              02.29
                                            RCL-6-CAT-CODE              02.29
           ELSE                                                         02.29
           IF PET-INCOMING-FORMAT = 'D'                                 02.39
              MOVE KDA-DS-MRCH-TYP       TO PET-MERCH-TYPE              02.39
                                            RCL-6-CAT-CODE              02.39
           ELSE                                                         02.39
              MOVE KDA-MC-MRCH-TYP       TO PET-MERCH-TYPE
                                            RCL-6-CAT-CODE.
           IF INVALID-MERCH-SW = 'N'
              PERFORM U-195-CHECK-MERCH-TYPE
                 THRU U-195-EXIT
              IF INVALID-MERCH-TYPE = 'Y'
                 MOVE ONE-AST            TO RCL-6-CAT-CODE-ERR-IND.
      *
048300     MOVE MIS3-AMOUNT-X            TO AMOUNT-CHK-X.
048310     PERFORM U-200-SLS-AMT-EDIT
048320        THRU U-200-EXIT.
           IF MIS3-AMOUNT NUMERIC
              MOVE MIS3-AMOUNT           TO RCL-1-TRAN-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RCL-1-TRAN-AMT  C-LGTH24
                   C-TYPEEND
           ELSE
              MOVE MIS3-AMOUNT-X         TO RCL-1-TRAN-AMT-X.
           IF AMT-ERR-CD NOT = 00
              MOVE ONE-AST               TO RCL-1-TRAN-AMT-ERR-IND.
           MOVE MR1-TRANSCODE          TO PET-TRANS
                                          RCL-1-TRANSCODE.
048350     MOVE HLD-BANK-KEY           TO PET-ORIG-BANK-KEY.
           MOVE MIS3-CARD-TYPE         TO RCL-1-CARD-TYPE.
           MOVE HLD-ACCOUNT-IN         TO RCL-1-ACCT-NO.
           IF HLD-ACCOUNT-IN-EXT NOT = SPACES
              MOVE '-'                 TO RCL-1-DASH
              MOVE HLD-ACCOUNT-IN-EXT  TO RCL-1-ACCT-NO-EXT.
049330     IF PET-CARD-TYPE-VISA
              IF MIS3-VS-TRAN-CD-QUAL-X NOT NUMERIC                     02.53
047530           MOVE 0                  TO PET-TRAN-CODE-QUAL
047530        ELSE
                 MOVE MIS3-VS-TRAN-CD-QUAL                              02.53
                                         TO PET-TRAN-CODE-QUAL          02.53
              END-IF                                                    02.53
           END-IF.                                                      02.53
           MOVE MIS3-CARD-EXP-DATE-X     TO RCL-2-EXP-DATE.
086070     IF (MIS3-CARD-EXP-DATE NUMERIC) AND
086070        (MIS3-CARD-EXP-DATE NOT = ZEROS)
086070           MOVE MIS3-CARD-EXP-DATE-X(1:2)
086070                                   TO VALIDATE-DATE(1:2)
086070           MOVE '01'               TO VALIDATE-DATE(3:2)
086070           MOVE MIS3-CARD-EXP-DATE-X(3:2)
086070                                   TO VALIDATE-DATE(5:2)
085850           PERFORM S-801-VALIDATE-MMDDYY-DATE
085860              THRU S-801-EXIT
085870           IF INVALID-DATE-SW = SPACE
086070              MOVE MIS3-CARD-EXP-DATE
086070                                   TO PET-EXP-DATE
047420           ELSE
                    MOVE ONE-AST         TO RCL-2-EXP-DATE-ERR-IND
099430              MOVE 'Y'             TO PET-SUS-FLAG
047430              MOVE 15              TO ER-CD (ER-INDX)
047440              SET ER-INDX UP BY 1.
PROMST     MOVE PSI-RUN                  TO PET-SOURCE-ID.
048470     IF PET-INCOMING-FORMAT = 'V'
047550        MOVE WS-CHD-AR-REPORT-BIN  TO PET-TMP-DESTIN-BIN
047550        MOVE WS-BATCH-BIN          TO PET-TMP-SOURCE-BIN
047550        IF HLD-ZIP-FRST-5 NOT NUMERIC
047550           MOVE ZEROS              TO PET-TMP-MERCH-ZIP
047550        ELSE
047550           MOVE HLD-ZIP-FRST-5     TO PET-TMP-MERCH-ZIP
047550        END-IF
048490        MOVE HLD-DESCR-COUNTRY     TO PET-TMP-ST-PROV
048500        MOVE HOLD-VISA-INT-SETL-GRP
048510                                   TO PET-ORIG-INT-SETL-GRP
           ELSE                                                         02.29
           IF PET-INCOMING-FORMAT = 'A'                                 02.29
              IF WS-MRCH-IS-AMX-SETL OR WS-MRCH-IS-AMX-EAP              03.61
                 MOVE HOLD-AX-INT-SETL-GRP  TO PET-ORIG-INT-SETL-GRP    03.61
              ELSE                                                      03.61
                 MOVE HOLD-AX-INT-SETL-GRP-NS                           03.61
                                            TO PET-ORIG-INT-SETL-GRP    03.61
              END-IF                                                    03.61
           ELSE                                                         02.29
           IF PET-INCOMING-FORMAT = 'D'                                 02.29
              MOVE HOLD-DS-INT-SETL-GRP  TO PET-ORIG-INT-SETL-GRP       02.29
048520     ELSE
           IF PET-INCOMING-FORMAT = 'M'                                 02.41
048530        MOVE HLD-INET-COUNTRY      TO PET-INET-COUNTRY
048540        MOVE HOLD-MC-INT-SETL-GRP  TO PET-ORIG-INT-SETL-GRP
048520     ELSE
048540        MOVE HOLD-MRCH-INT-SETL-GRP TO PET-ORIG-INT-SETL-GRP.
048550     IF  PET-ORIG-INT-SETL-GRP EQUAL +0
048560         MOVE 46 TO ER-CD (ER-INDX)
048570         SET ER-INDX UP BY 1
048580         MOVE 'Y' TO PET-SUS-FLAG.
      *
           MOVE MIS3-REF-NMBR-X          TO RCL-2-REF-NO-X.
           IF MIS3-REF-NMBR-X NUMERIC AND
             (MIS3-REF-NMBR-X NOT = ZEROS)
                 MOVE MIS3-REF-NMBR      TO WS-REF-NO-11-DIGITS
           ELSE
              ADD 1                      TO WS-REF-NO-CALC
              MOVE WS-REF-NO-CALC        TO WS-REF-NO-11-DIGITS
           END-IF.
           PERFORM S-640-CALCULATE-NEW-REFERENCE
              THRU S-640-EXIT.
           PERFORM S-642-CALCULATE-CHK-DIGIT
              THRU S-642-EXIT.
           IF KDA-VR-11-DIGITS = ZERO
              MOVE ONE-AST               TO RF1-2-REF-NO-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 226                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
           MOVE KDA-VISA-REF             TO PET-REF-NMBR
                                            RCL-8-REF-NO.
      *
           MOVE MIS3-TERM-ID             TO RCL-4-TERM-ID.
           IF MIS3-TERM-ID = SPACES OR ZEROS
              MOVE HOLD-MERCH-ID(8:8)    TO MIS3-TERM-ID.
           MOVE MIS3-TERM-ID             TO PET-TERM-ID.
      *
           MOVE ZEROS                    TO WK-TIMESTAMP-9.             02.53
           IF MIS3-TIMESTAMP = SPACES                                   03.60
              MOVE ZEROES                TO MIS3-TIMESTAMP              03.60
           END-IF.                                                      03.60
           IF MIS3-TIMESTAMP NUMERIC
              MOVE MIS3-TIMESTAMP        TO WK-TIMESTAMP-HHMMSS         02.53
              MOVE WK-TIMESTAMP-HH       TO RCL-3-TIME-STAMP(1:2)
              MOVE WK-TIMESTAMP-MM       TO RCL-3-TIME-STAMP(4:2)
              MOVE WK-TIMESTAMP-SS       TO RCL-3-TIME-STAMP(7:2)
              MOVE ':'                   TO RCL-3-TIME-STAMP(3:1)
                                            RCL-3-TIME-STAMP(6:1)
              IF WK-TIMESTAMP-HHMMSS > 0                                02.53
                 IF WK-TIMESTAMP-HH > 23 OR
                    WK-TIMESTAMP-MM > 59 OR
                    WK-TIMESTAMP-SS > 59                                02.53
                       MOVE ZEROS        TO WK-TIMESTAMP-HHMMSS         02.53
                       IF PET-CARD-TYPE-DISCOVER                        03.47
                       OR PET-CARD-TYPE-PAYPAL                          03.47
                          MOVE ONE-AST   TO RCL-3-TIME-STAMP-ERR-IND
                          MOVE 'Y'       TO PET-SUS-FLAG
                          MOVE 248       TO ER-CD-3-DIG(ER-INDX)
                          SET ER-INDX UP BY 1
                       END-IF
                 END-IF
                 MOVE WK-TIMESTAMP-9     TO PET-TIMESTAMP
                 IF PET-CARD-TYPE-DISCOVER                              03.47
                 OR PET-CARD-TYPE-PAYPAL                                03.47
                    MOVE WK-TIMESTAMP-HHMMSS
                                         TO PET-DS-TRAN-TIME
                 END-IF
              END-IF
           ELSE
              IF PET-CARD-TYPE-DISCOVER                                 03.47
              OR PET-CARD-TYPE-PAYPAL                                   03.47
                 MOVE ONE-AST            TO RCL-3-TIME-STAMP-ERR-IND
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 248                TO ER-CD-3-DIG(ER-INDX)
                 SET ER-INDX UP BY 1
              END-IF
           END-IF.
      *
           MOVE MIS3-AUTH-RESP-CD        TO RCL-5-AUTH-RESP
                                            KDA-AUTH-RESP-CD
                                            PET-AUTHORIZ-RESP.
           MOVE MIS3-AVS-RESPONSE-CODE   TO RCL-6-AVS-RESP
                                            KDA-AVS-RESPONSE-CODE
                                            PET-AVS-RESP-CODE.
      *
           IF PET-CARD-TYPE-VISA                                        03.27
048670        PERFORM U-300-SPCL-VISA-EDIT
048680           THRU U-300-EXIT
048690     ELSE
048700        IF PET-CARD-TYPE-MC
048720           PERFORM U-400-SPCL-MC-EDIT
048730              THRU U-400-EXIT
048740        ELSE
                 IF PET-CARD-TYPE-DISCOVER                              02.61
                 OR PET-CARD-TYPE-PAYPAL                                03.47
                    PERFORM U-600-SPCL-DS-EDIT                          02.61
                       THRU U-600-EXIT                                  02.61
                 ELSE                                                   02.61
                    PERFORM U-500-SPCL-PL-EDIT                          02.61
                       THRU U-500-EXIT                                  02.61
                 END-IF                                                 02.61
              END-IF                                                    02.61
           END-IF.                                                      02.61
      *
           PERFORM R-925-LOAD-FORMAT-3-REC
              THRU R-925-EXIT.
      *
048990     PERFORM C-360-GET-ADDENDUMS
049000        THRU C-360-EXIT.
      *
           MOVE MIS3-MRCH-NAME           TO RCL-7-MRCH-NAME.
           MOVE MIS3-MRCH-CITY           TO RCL-7-MRCH-CITY.
           MOVE MIS3-UNIQUE-TRAN-ID      TO PET-UNIQUE-TRAN-ID
                                            RCL-7-UNIQUE-TRAN-ID.
           MOVE HLD-TRAN-MERCH-NMBR-X    TO RCL-7-MRCH-ID.
      *
           IF MIS3-MRCH-NAME NOT = SPACES
              MOVE 'N'                   TO WS-MOVE-DONE-SW
              MOVE SPACES                TO HLD-DESCR-NAME
              PERFORM
                VARYING SUB1 FROM +1 BY +1
                UNTIL   SUB1 > +25 OR
                        MOVE-DONE
                  IF MIS3-MRCH-NAME(SUB1:1) NOT = SPACE
                     PERFORM
                       VARYING SUB2 FROM +1 BY +1
                       UNTIL   SUB1 > +25 OR
                               SUB2 > +25
                         IF MIS3-MRCH-NAME(SUB1:1) = '\'
                            MOVE '/'     TO HLD-DESCR-NAME(SUB2:1)
                         ELSE
                            MOVE MIS3-MRCH-NAME(SUB1:1)
                                         TO HLD-DESCR-NAME(SUB2:1)
                         END-IF
                         COMPUTE SUB1 = SUB1 + 1
                     END-PERFORM
                     MOVE 'Y'               TO WS-MOVE-DONE-SW
                  END-IF
              END-PERFORM
           END-IF.
           IF MIS3-MRCH-CITY NOT = SPACES
              MOVE 'N'                   TO WS-MOVE-DONE-SW
              MOVE SPACES                TO HLD-DESCR-CITY
              PERFORM
                VARYING SUB1 FROM +1 BY +1
                UNTIL   SUB1 > +13 OR
                        MOVE-DONE
                  IF MIS3-MRCH-CITY(SUB1:1) NOT = SPACE
                     PERFORM
                       VARYING SUB2 FROM +1 BY +1
                       UNTIL   SUB1 > +13 OR
                               SUB2 > +13
                         IF MIS3-MRCH-CITY(SUB1:1) = '\'
                            MOVE '/'     TO HLD-DESCR-CITY(SUB2:1)
                         ELSE
                            MOVE MIS3-MRCH-CITY(SUB1:1)
                                         TO HLD-DESCR-CITY(SUB2:1)
                         END-IF
                         COMPUTE SUB1 = SUB1 + 1
                     END-PERFORM
                     MOVE 'Y'               TO WS-MOVE-DONE-SW
                  END-IF
              END-PERFORM
           END-IF.
      *
           IF PET-CARD-TYPE-VISA                                        03.27
              PERFORM Z999-CALL-TCR2-PROC
                 THRU Z999-EXIT.
      *
049020     PERFORM I-100-CHECK-INCENTIVES
049030        THRU I-100-EXIT.
      *
           MOVE HLD-DESCR-NAME           TO RCL-8-MRCH-NAME.
           MOVE HLD-DESCR-CITY           TO RCL-8-MRCH-CITY.
           MOVE HLD-DESCR-STATE          TO RCL-8-MRCH-STATE
           MOVE HLD-DESCR-COUNTRY        TO RCL-8-MRCH-COUNTRY.
           MOVE HLD-ZIP-WORK(1:5)        TO RCL-8-MRCH-ZIP.
049300*
003140     IF KDA-HAS-LU
041400        MOVE HOLD-LU1              TO MID-LAYOUT(1)
041400        MOVE HOLD-LU2              TO MID-LAYOUT(2)
003140        IF KDA-HAS-PA OR
003140           KDA-HAS-XA OR                                          02.75
003140           KDA-HAS-CI
041400               CONTINUE
041400        ELSE
041400           MOVE SPACES             TO MIVLU-MESSAGE-ID
003140        END-IF
041420        PERFORM C-373-BUILD-ADDENDUM-RECORDS
041430           THRU C-373-EXIT
003140     END-IF.
      *
           IF PET-CARD-TYPE-VISA OR                                     03.27
              PET-CARD-TYPE-MC OR
              PET-CARD-TYPE-DISCOVER OR                                 02.29
              PET-CARD-TYPE-PAYPAL   OR                                 03.47
              PET-CARD-TYPE-AMEX OR                                     02.29
             (PET-CARD-TYPE-PL AND                                      02.29
              KDA-CHD-IS-VALID-PD)                                      02.29
                 MOVE BASCRATE-SD-REIMB-CURR-CD
                                         TO RIL-1-REIMB-CURR
                 MOVE PET-REIMB-AMT      TO RIL-1-REIMB-AMT
                 MOVE PET-REIMB-INT-FEE-AMT
                                         TO RIL-1-REIMB-FEE
                 CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                       C-TYPED  BASCRATE-SD-REIMB-CURR-DEC
                       C-TYPEA  RIL-1-REIMB-AMT  C-LGTH20
                                RIL-1-REIMB-FEE  C-LGTH16
                       C-TYPEEND
                 MOVE BASCRATE-SD-IIIAAA-CURR-CD
                                         TO RIL-1-SETTLE-CURR
                 MOVE PET-IIIAAA-AMT     TO RIL-1-SETTLE-AMT
                 MOVE PET-IIIAAA-INT-FEE-AMT
                                         TO RIL-1-INTCHG-FEE
                 CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                       C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC
                       C-TYPEA  RIL-1-SETTLE-AMT  C-LGTH20
                                RIL-1-INTCHG-FEE  C-LGTH16
                       C-TYPEEND.
      *
           PERFORM C-595-TOTAL-TRANS
              THRU C-595-EXIT.
           IF PET-SUS-FLAG = 'Y'
              MOVE '*'                   TO RCL-1-SUS-FLAG              02.96
              MOVE HLD-SUM-GROUP-TYPE    TO PET-RATE-FLAG               02.96
           END-IF.                                                      02.96
           PERFORM U-100-OUT-WORK-REC
              THRU U-100-EXIT.
           PERFORM R-922-WRITE-FORMAT-3-REC
              THRU R-922-EXIT.
049440 C-530-EXIT.
049450     EXIT.
000000
045690 C-550-SALES-NO-EDITS.
068040     MOVE PET-CARD-TYPE-X          TO PET-ORIG-PLAN-TYPE-X(3:2)
                                            PET-PLAN-TYPE(3:2).
068040     MOVE '01'                     TO PET-ORIG-PLAN-TYPE-X(1:2)
                                            PET-PLAN-TYPE-X(1:2).
045720     MOVE BASCRATE-SD-IIIAAA-CURR-CD TO PET-IIIAAA-CURR-CODE.
045720     MOVE BASCRATE-SD-REIMB-CURR-CD TO PET-REIMB-CURR-CODE.
045720     MOVE BASCRATE-SD-BATCH-CURR-CD
045720                                  TO PET-ACQ-CURR-CODE
045730                                     PET-ORIG-INT-SETL-CURR-CODE.
           IF PET-DEST-BANK-KEY = +0
              IF PET-CARD-USED = 'M'
                 MOVE +840               TO PET-ISS-CURR-CODE
                                            PET-DEST-INT-SETL-CURR-CODE
              ELSE
                 MOVE BASCRATE-SD-BATCH-CURR-CD
                                        TO PET-ISS-CURR-CODE
                                           PET-DEST-INT-SETL-CURR-CODE
           ELSE
              MOVE BASCRATE-SD-BATCH-CURR-CD
                                        TO PET-ISS-CURR-CODE
                                           PET-DEST-INT-SETL-CURR-CODE.
           IF MR1-VALID-RETURN                                          03.31
046120        MOVE 'C'                   TO WS-CREDIT-OR-DEBIT
046130     ELSE
046140        MOVE 'D'                   TO WS-CREDIT-OR-DEBIT.
           IF MR1-VALID-MIS3-TRAN                                       03.31
046160        PERFORM C-580-SALES-FORMAT-3
046170           THRU C-580-EXIT
046180     ELSE
046190        PERFORM C-560-SALES-FORMAT-1
046200           THRU C-560-EXIT.
046210     PERFORM S-810-MERCH-TOTS
046220        THRU S-810-EXIT.
046250     IF PET-SUS-FLAG EQUAL 'Y'
046260         NEXT SENTENCE
046270     ELSE
046280         PERFORM S-840-NOTONUS-TOTS
046290            THRU S-840-EXIT.
046300 C-550-GRP-TOT.
           PERFORM C-595-TOTAL-TRANS
              THRU C-595-EXIT.
           IF MR1-VALID-RETURN                                          03.31
046320         SUBTRACT PET-ACQ-AMOUNT FROM CALC-GRP-AMOUNT
046330     ELSE
046340         ADD PET-ACQ-AMOUNT TO CALC-GRP-AMOUNT.
046350 C-550-EXIT.
046360     EXIT.
046370*
046840 C-560-SALES-FORMAT-1.
           MOVE MIS1-DATE-X              TO VD-MM-DD                    02.61
                                            RF1-1-TRAN-DATE.
046900     PERFORM S-800-VALID-DATE
046910        THRU S-800-EXIT.
047020     PERFORM U-150-CH-INVAL-DT-CHK
047030        THRU U-150-EXIT.
           IF INVALID-DATE-SW = 'Y'
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE ONE-AST               TO RF1-1-TRAN-DATE-ERR-IND
           ELSE
              MOVE VALID-DATE            TO PET-DATE.
047040     MOVE MIS1-AMOUNT-X          TO AMOUNT-CHK-X.
047050     PERFORM U-200-SLS-AMT-EDIT
047060        THRU U-200-EXIT.
           IF MIS1-AMOUNT NUMERIC
              MOVE MIS1-AMOUNT           TO RF1-1-TRAN-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RF1-1-TRAN-AMT  C-LGTH24
                   C-TYPEEND
           ELSE
              MOVE MIS1-AMOUNT-X         TO RF1-1-TRAN-AMT-X.
           IF AMT-ERR-CD NOT = 00
              MOVE ONE-AST               TO RF1-1-TRAN-AMT-ERR-IND.
           MOVE MIS1-AUTH-NO             TO PET-AUTH-CD.                02.39
047450*
047460 C-560-SALES-CONT.
047480*
           MOVE MR1-TRANSCODE          TO PET-TRANS
                                          RF1-1-TRANSCODE.
047510     MOVE HLD-BANK-KEY           TO PET-ORIG-BANK-KEY.
           MOVE WS-MIS3-CARD-TYPE      TO RF1-1-CARD-TYPE.
           MOVE HLD-ACCOUNT-IN         TO RF1-1-ACCT-NO.
           IF HLD-ACCOUNT-IN-EXT NOT = SPACES
              MOVE '-'                 TO RF1-1-DASH
              MOVE HLD-ACCOUNT-IN-EXT  TO RF1-1-ACCT-NO-EXT.
047530     MOVE HLD-SUM-MERCH-NMBR     TO PET-MERCH-NMBR.
047540     IF PET-INCOMING-FORMAT = 'V'
047550        MOVE WS-CHD-AR-REPORT-BIN  TO PET-TMP-DESTIN-BIN
047550        MOVE WS-BATCH-BIN          TO PET-TMP-SOURCE-BIN
047550        IF HLD-ZIP-FRST-5 NOT NUMERIC
047550           MOVE ZEROS              TO PET-TMP-MERCH-ZIP
047550        ELSE
047550           MOVE HLD-ZIP-FRST-5     TO PET-TMP-MERCH-ZIP
047550        END-IF
047560        MOVE HLD-DESCR-COUNTRY     TO PET-TMP-ST-PROV
047570        MOVE KDA-SIC-MRCH-TYP      TO PET-MERCH-TYPE
                                            RF1-2-CAT-CODE
047590     ELSE
           IF PET-INCOMING-FORMAT = 'A'                                 02.29
              MOVE KDA-AX-MRCH-TYP       TO PET-MERCH-TYPE              02.29
                                            RF1-2-CAT-CODE              02.29
           ELSE                                                         02.29
           IF PET-INCOMING-FORMAT = 'D'                                 02.39
              MOVE KDA-DS-MRCH-TYP       TO PET-MERCH-TYPE              02.39
                                            RF1-2-CAT-CODE              02.39
           ELSE                                                         02.39
047600        MOVE HLD-INET-COUNTRY      TO PET-INET-COUNTRY
047610        MOVE KDA-MC-MRCH-TYP       TO PET-MERCH-TYPE
                                            RF1-2-CAT-CODE.
047540     IF PET-INCOMING-FORMAT = 'V'                                 03.62V
047570        IF KDA-SIC-MRCH-TYP    = '6010' OR '6011'                 03.62V
103220           MOVE '0'                TO PET-ATM-ACCT                03.62V
              ELSE                                                      03.62V
103220           MOVE SPACES             TO PET-ATM-ACCT                03.62V
              END-IF                                                    03.62V
           END-IF.                                                      03.62V
047630*
PROMST     MOVE PSI-RUN                  TO PET-SOURCE-ID.
047780     PERFORM S-760-SET-INT-SETL-GRP
047790        THRU S-760-EXIT.
           MOVE ZEROS                    TO KDA-POS-ENTRY-MODE.
      *
           MOVE MIS1-REF-NO-X            TO RF1-2-REF-NO-X.
           IF MIS1-REF-NO-X NUMERIC AND
             (MIS1-REF-NO-X NOT = ZEROS)
                 MOVE MIS1-REF-NO        TO WS-REF-NO-11-DIGITS
           ELSE
              ADD 1                      TO WS-REF-NO-CALC
              MOVE WS-REF-NO-CALC        TO WS-REF-NO-11-DIGITS
           END-IF.
      *
           IF PET-CARD-TYPE-VISA                                        03.27
           OR PET-CARD-TYPE-MC
           OR PET-CARD-TYPE-DISCOVER
           OR PET-CARD-TYPE-PAYPAL                                      03.47
           OR PET-CARD-TYPE-AMEX
              PERFORM S-640-CALCULATE-NEW-REFERENCE
                 THRU S-640-EXIT
              PERFORM S-642-CALCULATE-CHK-DIGIT
                 THRU S-642-EXIT
              MOVE KDA-VISA-REF          TO PET-REF-NMBR
                                            RCL-8-REF-NO.
      *
           IF PET-CARD-TYPE-PL
              MOVE WS-REF-NO-11-DIGITS   TO PL-REF-SEQ
              MOVE PL-REF-NMBR-X         TO PET-REF-NMBR
                                            RCL-8-REF-NO
           END-IF.
      *
           MOVE MIS1-PHONE-ORD           TO KDA-PHONE-ORD
                                            RF1-2-MOTO-ECOM.
           IF PET-CARD-TYPE-VISA                                        03.27
              MOVE MIS1-PHONE-ORD        TO PET-MAIL-PHONE-IND.
047860     IF PET-CARD-TYPE-MC
068290        MOVE MIS1-PHONE-ORD        TO PET-MC-MAIL-PHONE-IND
              PERFORM U-430-DEFAULT-PROCESS-CODE
                 THRU U-430-EXIT
047880        MOVE HOLD-MERCH-ID         TO PET-MERCH-ID
              IF KDA-VC-PHONE-ORD-MERCH
                 MOVE 0                  TO PET-MC-OPER-ENV
              END-IF
           END-IF.
           MOVE HLD-DESCR                TO PET-DESCR.
           MOVE MIS1-DESCR-MERCH         TO RF1-7-MRCH-NAME.
           MOVE MIS1-DESCR-CITY          TO RF1-7-MRCH-CITY.
           MOVE MIS1-DESCR-STATE         TO RF1-7-MRCH-STATE.
           MOVE MIS1-DESCR-CNTRY         TO RF1-7-MRCH-COUNTRY.
           MOVE HLD-TRAN-MERCH-NMBR-X    TO RF1-7-MRCH-ID.
048470     IF PET-INCOMING-FORMAT = 'A'
048490        IF PET-STATE = SPACES
048490           MOVE HLD-DESCR-COUNTRY-2
048490                                   TO PET-STATE.
      *
           PERFORM C-590-SET-NON-SETL-PLANS
              THRU C-590-EXIT.
           IF PET-SUS-FLAG = 'Y'
              MOVE '*'                   TO RF1-1-SUS-FLAG.
           PERFORM U-100-OUT-WORK-REC
              THRU U-100-EXIT.
           PERFORM R-923-PRINT-FORMAT-1-REC
              THRU R-923-EXIT.
048000 C-560-EXIT.
048010     EXIT.
000000
048030 C-580-SALES-FORMAT-3.
048040     MOVE HLD-SUM-MERCH-NMBR     TO PET-MERCH-NMBR.
           IF PET-INCOMING-FORMAT = 'V'                                 02.39
              MOVE KDA-SIC-MRCH-TYP      TO PET-MERCH-TYPE
                                            RCL-6-CAT-CODE
           ELSE
           IF PET-INCOMING-FORMAT = 'A'                                 02.29
              MOVE KDA-AX-MRCH-TYP       TO PET-MERCH-TYPE              02.29
                                            RCL-6-CAT-CODE              02.29
           ELSE                                                         02.29
           IF PET-INCOMING-FORMAT = 'D'                                 02.39
              MOVE KDA-DS-MRCH-TYP       TO PET-MERCH-TYPE              02.39
                                            RCL-6-CAT-CODE              02.39
           ELSE                                                         02.39
              MOVE KDA-MC-MRCH-TYP       TO PET-MERCH-TYPE
                                            RCL-6-CAT-CODE.
           MOVE MIS3-DATE                TO VD-MM-DD
                                            RCL-1-TRAN-DATE.
048160     PERFORM S-800-VALID-DATE
048170        THRU S-800-EXIT.
048280     PERFORM U-150-CH-INVAL-DT-CHK
048290        THRU U-150-EXIT.
      *
           IF INVALID-DATE-SW = 'Y'
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE ONE-AST               TO RCL-1-TRAN-DATE-ERR-IND
           ELSE
              MOVE VALID-DATE            TO PET-DATE
              IF PET-CARD-TYPE-DISCOVER
              OR PET-CARD-TYPE-PAYPAL                                   03.47
                 MOVE PET-DATE           TO DC-SEND-DATE
                 MOVE 'CAD'              TO DC-OPERATION
                 PERFORM D-100-CALL-DATECONV
                    THRU D-100-EXIT
                 IF DC-SUCCESSFUL
                    MOVE DC-RETURN-DATE  TO PET-DS-TRAN-DATE
                 END-IF
              END-IF
           END-IF.
      *
048300     MOVE MIS3-AMOUNT-X            TO AMOUNT-CHK-X.
048310     PERFORM U-200-SLS-AMT-EDIT
048320        THRU U-200-EXIT.
           IF MIS3-AMOUNT NUMERIC
              MOVE MIS3-AMOUNT           TO RCL-1-TRAN-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RCL-1-TRAN-AMT  C-LGTH24
                   C-TYPEEND
           ELSE
              MOVE MIS3-AMOUNT-X         TO RCL-1-TRAN-AMT-X.
           IF AMT-ERR-CD NOT = 00
              MOVE ONE-AST               TO RCL-1-TRAN-AMT-ERR-IND.
           MOVE MR1-TRANSCODE          TO PET-TRANS
                                          RCL-1-TRANSCODE.
048350     MOVE HLD-BANK-KEY           TO PET-ORIG-BANK-KEY.
           MOVE MIS3-CARD-TYPE         TO RCL-1-CARD-TYPE.
           MOVE HLD-ACCOUNT-IN         TO RCL-1-ACCT-NO.
           IF HLD-ACCOUNT-IN-EXT NOT = SPACES
              MOVE '-'                 TO RCL-1-DASH
              MOVE HLD-ACCOUNT-IN-EXT  TO RCL-1-ACCT-NO-EXT.
049330     IF PET-CARD-TYPE-VISA
              IF MIS3-VS-TRAN-CD-QUAL-X NOT NUMERIC                     02.53
047530           MOVE 0                  TO PET-TRAN-CODE-QUAL
047530        ELSE
                 MOVE MIS3-VS-TRAN-CD-QUAL                              02.53
                                         TO PET-TRAN-CODE-QUAL          02.53
              END-IF                                                    02.53
           END-IF.                                                      02.53
           MOVE MIS3-CARD-EXP-DATE-X     TO RCL-2-EXP-DATE.
086070     IF (MIS3-CARD-EXP-DATE NUMERIC) AND
086070        (MIS3-CARD-EXP-DATE NOT = ZEROS)
086070           MOVE MIS3-CARD-EXP-DATE-X(1:2)
086070                                   TO VALIDATE-DATE(1:2)
086070           MOVE '01'               TO VALIDATE-DATE(3:2)
086070           MOVE MIS3-CARD-EXP-DATE-X(3:2)
086070                                   TO VALIDATE-DATE(5:2)
085850           PERFORM S-801-VALIDATE-MMDDYY-DATE
085860              THRU S-801-EXIT
086070           MOVE MIS3-CARD-EXP-DATE TO PET-EXP-DATE
085870           IF INVALID-DATE-SW NOT = SPACE
                    IF PET-CARD-TYPE-AMEX
                       MOVE ONE-AST      TO RCL-2-EXP-DATE-ERR-IND
099430                 MOVE 'Y'          TO PET-SUS-FLAG
047430                 MOVE 15           TO ER-CD (ER-INDX)
047440                 SET ER-INDX UP BY 1.
PROMST     MOVE PSI-RUN                  TO PET-SOURCE-ID.
048470     IF PET-INCOMING-FORMAT = 'V'
047550        MOVE WS-CHD-AR-REPORT-BIN  TO PET-TMP-DESTIN-BIN
047550        MOVE WS-BATCH-BIN          TO PET-TMP-SOURCE-BIN
047550        IF HLD-ZIP-FRST-5 NOT NUMERIC
047550           MOVE ZEROS              TO PET-TMP-MERCH-ZIP
047550        ELSE
047550           MOVE HLD-ZIP-FRST-5     TO PET-TMP-MERCH-ZIP
047550        END-IF
048490        MOVE HLD-DESCR-COUNTRY     TO PET-TMP-ST-PROV
048500        MOVE HOLD-VISA-INT-SETL-GRP
048510                                   TO PET-ORIG-INT-SETL-GRP
           ELSE                                                         02.29
           IF PET-INCOMING-FORMAT = 'A'                                 02.29
              IF WS-MRCH-IS-AMX-SETL OR WS-MRCH-IS-AMX-EAP              03.61
                 MOVE HOLD-AX-INT-SETL-GRP  TO PET-ORIG-INT-SETL-GRP    03.61
              ELSE                                                      03.61
                 MOVE HOLD-AX-INT-SETL-GRP-NS                           03.61
                                            TO PET-ORIG-INT-SETL-GRP    03.61
              END-IF                                                    03.61
           ELSE                                                         02.29
           IF PET-INCOMING-FORMAT = 'D'                                 02.29
              MOVE HOLD-DS-INT-SETL-GRP  TO PET-ORIG-INT-SETL-GRP       02.29
           ELSE
           IF PET-INCOMING-FORMAT = 'M'
              MOVE HLD-INET-COUNTRY      TO PET-INET-COUNTRY
              MOVE HOLD-MC-INT-SETL-GRP  TO PET-ORIG-INT-SETL-GRP
048520     ELSE
048540        MOVE HOLD-MRCH-INT-SETL-GRP TO PET-ORIG-INT-SETL-GRP.
           MOVE MIS3-POS-ENTRY-MODE      TO KDA-POS-ENTRY-MODE.
      *
           MOVE MIS3-REF-NMBR-X          TO RCL-2-REF-NO-X.
           IF MIS3-REF-NMBR-X NUMERIC AND
             (MIS3-REF-NMBR-X NOT = ZEROS)
                 MOVE MIS3-REF-NMBR      TO WS-REF-NO-11-DIGITS
           ELSE
              ADD 1                      TO WS-REF-NO-CALC
              MOVE WS-REF-NO-CALC        TO WS-REF-NO-11-DIGITS
           END-IF.
      *
           IF PET-CARD-TYPE-VISA                                        03.27
           OR PET-CARD-TYPE-MC
           OR PET-CARD-TYPE-DISCOVER
           OR PET-CARD-TYPE-PAYPAL                                      03.47
           OR PET-CARD-TYPE-AMEX
              PERFORM S-640-CALCULATE-NEW-REFERENCE
                 THRU S-640-EXIT
              PERFORM S-642-CALCULATE-CHK-DIGIT
                 THRU S-642-EXIT
              MOVE KDA-VISA-REF          TO PET-REF-NMBR
                                            RCL-8-REF-NO.
      *
           IF PET-CARD-TYPE-PL
              MOVE WS-REF-NO-11-DIGITS   TO PL-REF-SEQ
              MOVE PL-REF-NMBR-X         TO PET-REF-NMBR
                                            RCL-8-REF-NO
           END-IF.
      *
           MOVE MIS3-TERM-ID             TO RCL-4-TERM-ID.
           IF MIS3-TERM-ID = SPACES OR ZEROS
              MOVE HOLD-MERCH-ID(8:8)    TO MIS3-TERM-ID.
           MOVE MIS3-TERM-ID             TO PET-TERM-ID.
      *
           MOVE ZEROS                    TO WK-TIMESTAMP-9.             02.53
           IF MIS3-TIMESTAMP = SPACES                                   03.60
              MOVE ZEROES                TO MIS3-TIMESTAMP              03.60
           END-IF.                                                      03.60
           IF MIS3-TIMESTAMP NUMERIC
              MOVE MIS3-TIMESTAMP        TO WK-TIMESTAMP-HHMMSS         02.53
              MOVE WK-TIMESTAMP-9        TO PET-TIMESTAMP               02.53
              IF MIS3-TIMESTAMP > +0
                 MOVE WK-TIMESTAMP-HH    TO RCL-3-TIME-STAMP(1:2)
                 MOVE WK-TIMESTAMP-MM    TO RCL-3-TIME-STAMP(4:2)
                 MOVE WK-TIMESTAMP-SS    TO RCL-3-TIME-STAMP(7:2)
                 MOVE ':'                TO RCL-3-TIME-STAMP(3:1)
                                            RCL-3-TIME-STAMP(6:1).
      *
           MOVE MIS3-AUTH-RESP-CD        TO RCL-5-AUTH-RESP
                                            KDA-AUTH-RESP-CD
                                            PET-AUTHORIZ-RESP.
           MOVE MIS3-AVS-RESPONSE-CODE   TO RCL-6-AVS-RESP
                                            KDA-AVS-RESPONSE-CODE
                                            PET-AVS-RESP-CODE.
      *
           IF PET-CARD-TYPE-VISA                                        03.27
048670        PERFORM U-301-SPCL-VISA-NO-EDIT
048680           THRU U-301-EXIT
048690     ELSE
048700        IF PET-CARD-TYPE-MC
048720           PERFORM U-401-SPCL-MC-NO-EDIT
048730              THRU U-401-EXIT
048690     ELSE
048700        IF PET-CARD-TYPE-PL
048720           PERFORM U-550-SPCL-PL-NO-EDIT
048730              THRU U-550-EXIT
048740     ELSE
              IF PET-CARD-TYPE-DISCOVER
              OR PET-CARD-TYPE-PAYPAL                                   03.47
                 PERFORM U-601-SPCL-DS-NO-EDIT
                    THRU U-601-EXIT
              ELSE
                  MOVE MIS3-AUTHORIZE    TO PET-AUTH-CD.                02.39
           MOVE MIS3-PHONE-ORD           TO RCL-2-MOTO-ECOM
                                            RCL-2-MOTO-ECOM-OUT.
           MOVE MIS3-POS-ENTRY-MODE      TO RCL-3-POS-E-MOD.
           MOVE MIS3-AUTHORIZE-SRCE      TO RCL-3-AUTH-SRC.
           MOVE MIS3-POS-TERM            TO RCL-3-POS-TRM-CAP.
           MOVE MIS3-CARDHLDR-ID         TO RCL-4-CRD-ID-MTHD.
           MOVE MIS3-CAT-TERM-LVL        TO RCL-5-CAT-TRM.
           IF PET-CARD-TYPE-VISA                                        03.27
              MOVE MIS3-VS-AUTH-CHAR-IND TO RCL-4-AUTH-CHAR             02.53
                                            RCL-4-AUTH-CHAR-OUT         02.53
              MOVE MIS3-VS-PURCH-IDENT-FRMT                             02.53
                                         TO RCL-6-PRCH-ID-FMT           02.53
              MOVE MIS3-VS-PURCH-IDENT   TO RCL-6-PRCH-ID-NO            02.53
           END-IF.                                                      02.53
           IF PET-CARD-TYPE-DISCOVER
           OR PET-CARD-TYPE-PAYPAL                                      03.47
              MOVE MIS3-DS-TRANS-ID      TO RRD-DS-TRANS-ID
              MOVE MIGR-MERCH-NMBR       TO PET-DS-TRANS-ID             03.62D
           END-IF.
      *
           PERFORM R-925-LOAD-FORMAT-3-REC
              THRU R-925-EXIT.
      *
           PERFORM C-360-GET-ADDENDUMS
              THRU C-360-EXIT.
      *
           IF PET-CARD-TYPE-VISA                                        03.27
              MOVE MIS3-VS-POS-ENVIRONMENT                              02.53
                                         TO PET-POS-ENVIRONMENT         02.53
068290        MOVE MIS3-PHONE-ORD        TO PET-MAIL-PHONE-IND.
047860     IF PET-CARD-TYPE-MC
068290        MOVE MIS3-POS-ENTRY-MODE   TO PET-MC-POS-ENTRY-MOD
068290        MOVE MIS3-PHONE-ORD        TO PET-MC-MAIL-PHONE-IND.
      *
           MOVE MIS3-MRCH-NAME           TO RCL-7-MRCH-NAME.
           MOVE MIS3-MRCH-CITY           TO RCL-7-MRCH-CITY.
           MOVE MIS3-UNIQUE-TRAN-ID      TO PET-UNIQUE-TRAN-ID
                                            RCL-7-UNIQUE-TRAN-ID.
           MOVE HLD-TRAN-MERCH-NMBR-X    TO RCL-7-MRCH-ID.
      *
           IF MIS3-MRCH-NAME(1:1) NOT = SPACE
              MOVE MIS3-MRCH-NAME        TO HLD-DESCR-NAME.
           IF MIS3-MRCH-CITY(1:1) NOT = SPACE
              MOVE MIS3-MRCH-CITY        TO HLD-DESCR-CITY.
048470     IF PET-INCOMING-FORMAT = 'A'
048490        IF PET-STATE = SPACES
048490           MOVE HLD-DESCR-COUNTRY-2
048490                                   TO PET-STATE.
      *
           MOVE HLD-DESCR-NAME           TO RCL-8-MRCH-NAME.
           MOVE HLD-DESCR-CITY           TO RCL-8-MRCH-CITY.
           MOVE HLD-DESCR-STATE          TO RCL-8-MRCH-STATE
           MOVE HLD-DESCR-COUNTRY        TO RCL-8-MRCH-COUNTRY.
           MOVE HLD-ZIP-WORK(1:5)        TO RCL-8-MRCH-ZIP.
      *
           PERFORM C-590-SET-NON-SETL-PLANS
              THRU C-590-EXIT.
      *
           IF PET-SUS-FLAG = 'Y'
              MOVE '*'                   TO RCL-1-SUS-FLAG.
           PERFORM U-100-OUT-WORK-REC
              THRU U-100-EXIT.
           PERFORM R-922-WRITE-FORMAT-3-REC
              THRU R-922-EXIT.
049440 C-580-EXIT.
049450     EXIT.
      *
       C-590-SET-NON-SETL-PLANS.
      *
           MOVE 'N'                      TO WS-PLAN-CODE-FOUND-SW.
           MOVE ZEROS                    TO KDA-PLAN-QUAL-CODE.
      *
           IF PET-CARD-TYPE-PL
              IF WS-MIS3-CARD-TYPE = 'DB'
                 MOVE 'DB'               TO PET-DEBIT-NETWORK-ID        02.29
                 MOVE '0203'             TO KDA-ORIG-PLAN-CODE-X
              ELSE
              IF WS-MIS3-CARD-TYPE = 'EB'
                 MOVE 'EB'               TO PET-DEBIT-NETWORK-ID        02.29
                 MOVE '0303'             TO KDA-ORIG-PLAN-CODE-X
              ELSE
                 MOVE '0103'             TO KDA-ORIG-PLAN-CODE-X.
      *
           IF PET-CARD-TYPE-AMEX
              PERFORM I-104-AMEX-INCENTIVES
                 THRU I-104-EXIT
              IF INVALID-ACCT-SW = 'Y'
                 IF MR1-VALID-RETURN                                    03.31
                    MOVE ONE-AST         TO RCL-1-ACCT-NO-ERR-IND
                 ELSE
                    MOVE ONE-AST         TO RF1-1-ACCT-NO-ERR-IND
                 END-IF.
      *
           IF PET-CARD-TYPE-DISCOVER
           OR PET-CARD-TYPE-PAYPAL                                      03.47
              PERFORM I-105-DISCOVER-INCENTIVES
                 THRU I-105-EXIT
              IF INVALID-ACCT-SW = 'Y'
                 IF MR1-VALID-MIS3-TRAN                                 03.31
                    MOVE ONE-AST         TO RCL-1-ACCT-NO-ERR-IND
                 ELSE
                    MOVE ONE-AST         TO RF1-1-ACCT-NO-ERR-IND
                 END-IF.
      *
           IF PET-CARD-TYPE-VISA
              MOVE '0111'                TO KDA-ORIG-PLAN-CODE-X.
      *
           IF PET-CARD-TYPE-MC
              MOVE '0112'                TO KDA-ORIG-PLAN-CODE-X.
      *
           IF PET-SUS-FLAG = 'Y'
              IF VALID-MIS3-DB-CARD-TYPE OR                             02.64
                 VALID-MIS3-EB-CARD-TYPE                                02.64
                    MOVE 'D'             TO PET-RATE-FLAG               02.64
              END-IF                                                    02.21
           ELSE
              MOVE KDA-ORIG-PLAN-CODE-X  TO WS-PLAN-CODE
              PERFORM D-500-SEARCH-PLAN-PACKAGE
                 THRU D-500-EXIT
              IF KDA-PLAN-QUAL-CODE = ZEROS
                 IF MR1-VALID-MIS3-TRAN                                 03.31
                    MOVE ONE-AST         TO RCL-1-ACCT-NO-ERR-IND
                 ELSE
                    MOVE ONE-AST         TO RF1-1-ACCT-NO-ERR-IND
                 END-IF
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 289                TO ER-CD-3-DIG(ER-INDX)
                 SET ER-INDX UP BY 1
              ELSE
                 MOVE KDA-PLAN-QUAL-CODE TO PET-PLAN-TYPE
                 MOVE PET-PLAN-TYPE-X    TO RCL-10-POST-PLAN            02.95
                 MOVE KDA-ORIG-PLAN-CODE TO PET-ORIG-PLAN-TYPE
                 MOVE PET-ORIG-PLAN-TYPE-X
                                         TO RCL-10-INT-PLAN.            02.95
      *
       C-590-EXIT.
           EXIT.
      *
       C-595-TOTAL-TRANS.
      *
           IF PET-CARD-TYPE-NON-SETL
              MOVE +8                    TO SUB1                        02.31
           ELSE                                                         03.47
           IF PET-CARD-TYPE-PAYPAL                                      03.47
              MOVE +9                    TO SUB1                        03.47
           ELSE
           IF PET-CARD-TYPE-MC
              MOVE +1                    TO SUB1
           ELSE
           IF PET-CARD-TYPE-VISA                                        03.27
              MOVE +2                    TO SUB1
           ELSE
           IF PET-CARD-TYPE-DISCOVER
              MOVE +3                    TO SUB1
           ELSE
           IF PET-CARD-TYPE-AMEX                                        02.31
              MOVE +4                    TO SUB1                        02.31
           ELSE                                                         02.31
           IF (PET-CARD-TYPE-PL AND                                     02.31
               PET-DBI-IS-PIN-DEBIT)                                    02.31
                 MOVE +5                 TO SUB1                        02.31
           ELSE                                                         02.31
           IF (PET-CARD-TYPE-PL AND                                     02.31
               PET-DBI-IS-DEBIT-NET)                                    02.31
                 MOVE +6                 TO SUB1                        02.31
           ELSE                                                         02.31
              MOVE +7                    TO SUB1.                       02.31
      *
           IF PET-SUS-FLAG = 'Y'
              MOVE +4                    TO SUB2
           ELSE
           IF MR1-VALID-SALE                                            03.31
              MOVE +1                    TO SUB2
           ELSE
           IF MR1-VALID-RETURN                                          03.31
              MOVE +2                    TO SUB2
           ELSE
              MOVE +3                    TO SUB2.
      *
           ADD +1                        TO WS-CTT-CNT(SUB1,SUB2).
           IF MR1-VALID-RETURN                                          03.31
              SUBTRACT WORK-CENTER-AMT FROM WS-CTT-AMT(SUB1,SUB2)
           ELSE
              ADD WORK-CENTER-AMT        TO WS-CTT-AMT(SUB1,SUB2).
      *    SET CARD TYPE FOR KM30'S AS BASDTDTA NEEDS CARD TYPE         03.16C
           IF PET-MIS3-CARD-TYPE = SPACES AND                           03.16C
              WS-MIS3-CARD-TYPE > SPACES                                03.16C
                 MOVE WS-MIS3-CARD-TYPE TO PET-MIS3-CARD-TYPE           03.16C
           END-IF.                                                      03.16C
      *    SET AX/DS PLAN CODE FOR ANY REJECTS AS BASDTDTA NEEDS PLAN   03.16C
           IF PET-PLAN-TYPE = SPACES OR ZEROS                           03.16C
              IF PET-CARD-TYPE-AMEX-NSETL                               03.16C
                 IF WS-NSC-NON-CLEAR-AX                                 03.16C
                    MOVE '0204'          TO PET-PLAN-TYPE               03.16C
                 ELSE                                                   03.16C
                    MOVE '0104'          TO PET-PLAN-TYPE               03.16C
              END-IF                                                    03.16C
              IF PET-CARD-TYPE-DISCOVER-NSETL                           03.16C
                 IF WS-NSC-NON-CLEAR-DS                                 03.16C
                    MOVE '0205'          TO PET-PLAN-TYPE               03.16C
                 ELSE                                                   03.16C
                    MOVE '0105'          TO PET-PLAN-TYPE               03.16C
              END-IF                                                    03.16C
              IF PET-CARD-TYPE-PAYPAL-NSETL                             03.47
                 IF WS-NSC-NON-CLEAR-DS                                 03.47
                    MOVE '0205'          TO PET-PLAN-TYPE               03.47
                 ELSE                                                   03.47
                    MOVE '0106'          TO PET-PLAN-TYPE               03.47F
              END-IF                                                    03.47
           END-IF.                                                      03.16C
      *
           SET BASDTDTA-CT-TRAN          TO TRUE.                       03.13
           PERFORM Z9TDAT-CALL-BASDTDTA                                 03.13
              THRU Z9TDAT-EXIT.                                         03.13
      *                                                                 03.13
       C-595-EXIT.
           EXIT.
      *
049470 C-700-EDIT-MISC.
000000     IF INV-GRP-TC-SW = 'Y'
049490        MOVE '*'                   TO RRL-1-FATAL-FLAG.
           IF MR1-TC-PREF = '32' OR '58'
              IF NOT PARM-IS-1-SIDED                                    03.31
                    PERFORM C-890-EDIT-MERCH-CORR                       03.31
                       THRU C-890-EXIT                                  03.31
                    GO TO C-700-GRP-TOT                                 03.31
              END-IF                                                    03.31
           END-IF.                                                      03.31
049550*
049560     DISPLAY '***** ABORT BANKCARD EDIT *****'.
049570     DISPLAY 'INVALID TRANSCODE ' MR1-TRANSCODE
049580         ' IN C-700-EDIT-MISC'.
049590     DISPLAY 'PROGRAM PROBLEM'.
049600     MOVE 35 TO HLD-RETURN-CD.
049610     MOVE 'Y' TO ABORT-RUN-SW.
049620     GO TO A-100-CLOSE-FILES.
049630*
049640 C-700-GRP-TOT.
049650     IF MR1-TC-PREF EQUAL '58'
049660         ADD PET-MRCH-AMOUNT TO CALC-GRP-AMOUNT
049670     ELSE
049680         SUBTRACT PET-MRCH-AMOUNT FROM CALC-GRP-AMOUNT.
049690*
049710     IF PET-SUS-FLAG EQUAL SPACE                                  03.47
049720        PERFORM S-840-NOTONUS-TOTS                                03.47
049730           THRU S-840-EXIT.                                       03.47
049740*
049750 C-700-EXIT.
049760     EXIT.
049770*
049780* THE FOLLOWING SECTION EDITS MERCHANT CORRECTIONS --
049790*    3200
049800*    5800
049810*
      * ADD INCOMING TRANSACTION COUNT AND AMOUNT TO BALANCING RECORD   02.64
      *                                                                 02.64
       C-750-TALLY-BAL-REC-INPUT.                                       02.64
      *                                                                 02.64
           MOVE +1                       TO BAL-SUB.                    02.64
      *                                                                 02.64
           IF MR1-VALID-RETURN OR                                       03.31
              MR1-TC-PREF = '58'                                        03.31
                 MOVE 'R'                TO WS-BAL-TRAN-TYPE            03.31
           ELSE                                                         02.64
              IF MR1-VALID-CASH                                         03.31
                 MOVE 'C'                TO WS-BAL-TRAN-TYPE            02.64
              ELSE                                                      02.64
                 MOVE 'S'                TO WS-BAL-TRAN-TYPE            02.64
              END-IF                                                    02.64
           END-IF.                                                      02.64
      *                                                                 02.64
           IF MR1-TC-PREF = '32' OR '58'                                02.64
              MOVE MIMC-CORR-AMOUNT-X    TO AMOUNT-CHK-X                02.64
              MOVE 'UK'                  TO WS-MIS3-CARD-TYPE           02.64
           ELSE                                                         02.64
              IF MR1-VALID-MIS3-TRAN                                    03.31
                 MOVE MIS3-CARD-TYPE     TO WS-MIS3-CARD-TYPE           02.64
                 MOVE MIS3-AMOUNT-X      TO AMOUNT-CHK-X                02.64
              ELSE                                                      02.64
                 MOVE MIS1-CARD-TYPE     TO WS-MIS3-CARD-TYPE           02.64
                 MOVE MIS1-AMOUNT-X      TO AMOUNT-CHK-X                02.64
              END-IF                                                    02.64
           END-IF.                                                      02.64
      *                                                                 02.64
           IF AMOUNT-CHK NUMERIC                                        02.64
              IF WS-BAL-TRAN-IS-RETURN                                  02.64
                 IF NOT AMOUNT-CHK NEGATIVE                             02.64
                    COMPUTE AMOUNT-CHK = AMOUNT-CHK * -1                02.64
                 END-IF                                                 02.64
              ELSE                                                      02.64
                 IF AMOUNT-CHK NEGATIVE                                 02.64
                    COMPUTE AMOUNT-CHK = AMOUNT-CHK * -1                02.64
                 END-IF                                                 02.64
              END-IF                                                    02.64
           ELSE                                                         02.64
              COMPUTE AMOUNT-CHK = +0                                   02.64
           END-IF.                                                      02.64
      *                                                                 02.64
           PERFORM C-770-TALLY-BAL-REC                                  02.64
              THRU C-770-EXIT.                                          02.64
      *                                                                 02.64
       C-750-EXIT.                                                      02.64
           EXIT.                                                        02.64
      *                                                                 02.64
      * ADD ACCEPTED TRANSACTION COUNT AND AMOUNT TO BALANCING RECORD   02.64
      *                                                                 02.64
       C-760-TALLY-BAL-REC-OUTPUT.                                      02.64
      *                                                                 02.64
           IF PET-VALID-MONETARY                                        03.31
              MOVE +2                    TO BAL-SUB                     02.64
           ELSE                                                         02.64
              GO TO C-760-EXIT                                          02.64
           END-IF.                                                      02.64
      *                                                                 02.64
           IF PET-VALID-RETURN                                          03.31
              MOVE 'R'                   TO WS-BAL-TRAN-TYPE            02.64
           ELSE                                                         02.64
              IF PET-VALID-CASH                                         03.31
                 MOVE 'C'                TO WS-BAL-TRAN-TYPE            02.64
              ELSE                                                      02.64
                 MOVE 'S'                TO WS-BAL-TRAN-TYPE            02.64
              END-IF                                                    02.64
           END-IF.                                                      02.64
      *                                                                 02.64
           MOVE PET-ACQ-AMOUNT           TO AMOUNT-CHK.                 02.64
           MOVE SPACES                   TO WS-MIS3-CARD-TYPE.          02.64
           IF PET-DEBIT-NETWORK-ID NOT = SPACES                         02.64
              MOVE PET-DEBIT-NETWORK-ID  TO WS-MIS3-CARD-TYPE           02.64
           ELSE                                                         02.64
              IF PET-CARD-TYPE-VISA                                     03.27
                 MOVE 'V '               TO WS-MIS3-CARD-TYPE           02.64
              END-IF                                                    02.64
              IF PET-CARD-TYPE-MC                                       02.64
                 MOVE 'M '               TO WS-MIS3-CARD-TYPE           02.64
              END-IF                                                    02.64
              IF PET-CARD-TYPE-AMEX                                     02.64
                 MOVE 'AX'               TO WS-MIS3-CARD-TYPE           02.64
              END-IF                                                    02.64
              IF PET-CARD-TYPE-DISCOVER                                 02.64
                 MOVE 'DS'               TO WS-MIS3-CARD-TYPE           02.64
              END-IF                                                    02.64
              IF PET-CARD-TYPE-PAYPAL                                   03.47
                 MOVE 'PP'               TO WS-MIS3-CARD-TYPE           03.47
              END-IF                                                    03.47
           END-IF.                                                      02.64
           MOVE WS-MIS3-CARD-TYPE        TO KDA-CHD-PD-NETWORK-TYPE.    02.64
      *                                                                 02.64
           IF AMOUNT-CHK NUMERIC                                        02.64
              IF WS-BAL-TRAN-IS-RETURN                                  02.64
                 IF NOT AMOUNT-CHK NEGATIVE                             02.64
                    COMPUTE AMOUNT-CHK = AMOUNT-CHK * -1                02.64
                 END-IF                                                 02.64
              ELSE                                                      02.64
                 IF AMOUNT-CHK NEGATIVE                                 02.64
                    COMPUTE AMOUNT-CHK = AMOUNT-CHK * -1                02.64
                 END-IF                                                 02.64
              END-IF                                                    02.64
           ELSE                                                         02.64
              COMPUTE AMOUNT-CHK = +0                                   02.64
           END-IF.                                                      02.64
      *                                                                 02.64
           PERFORM C-770-TALLY-BAL-REC                                  02.64
              THRU C-770-EXIT.                                          02.64
      *                                                                 02.64
       C-760-EXIT.                                                      02.64
           EXIT.                                                        02.64
      *                                                                 02.64
      * ADD COUNT AND AMOUNT TO BALANCING RECORD                        02.64
      *                                                                 02.64
       C-770-TALLY-BAL-REC.                                             02.64
      *                                                                 02.64
           IF WS-BAL-TRAN-IS-SALE                                       02.64
              IF BAL-SUB = +1 AND                                       02.64
                 WS-MIS3-CARD-TYPE = 'UK'                               02.64
                    ADD +1               TO PRES-S-UK-CNT(BAL-SUB)      02.64
                    ADD AMOUNT-CHK       TO PRES-S-UK-AMT(BAL-SUB)      02.64
                    GO TO C-770-EXIT                                    02.64
              END-IF                                                    02.64
              IF KDA-CHD-IS-VALID-PD                                    02.64
                 ADD +1                  TO PRES-S-DN-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-S-DN-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
              END-IF                                                    02.64
              IF VALID-MIS3-VISA-CARD-TYPE                              03.47
                    ADD +1               TO PRES-S-VI-CNT(BAL-SUB)      02.64
                    ADD AMOUNT-CHK       TO PRES-S-VI-AMT(BAL-SUB)      02.64
                    GO TO C-770-EXIT                                    02.64
              END-IF                                                    02.64
              IF VALID-MIS3-MC-CARD-TYPE                                02.64
                 ADD +1                  TO PRES-S-MC-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-S-MC-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
              END-IF                                                    02.64
              IF VALID-MIS3-DS-CARD-TYPE                                02.64
                 ADD +1                  TO PRES-S-DS-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-S-DS-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
              END-IF                                                    02.64
              IF VALID-MIS3-PP-CARD-TYPE                                03.47
                 ADD +1                  TO PRES-S-PP-CNT(BAL-SUB)      03.47
                 ADD AMOUNT-CHK          TO PRES-S-PP-AMT(BAL-SUB)      03.47
                 GO TO C-770-EXIT                                       03.47
              END-IF                                                    03.47
              IF VALID-MIS3-AX-CARD-TYPE                                02.64
                 ADD +1                  TO PRES-S-AX-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-S-AX-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
              END-IF                                                    02.64
              IF VALID-MIS3-DB-CARD-TYPE                                02.64
                 ADD +1                  TO PRES-S-PD-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-S-PD-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
              END-IF                                                    02.64
              IF VALID-MIS3-EB-CARD-TYPE                                02.64
                 ADD +1                  TO PRES-S-EB-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-S-EB-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
              END-IF                                                    02.64
              ADD +1                     TO PRES-S-OT-CNT(BAL-SUB)      02.64
              ADD AMOUNT-CHK             TO PRES-S-OT-AMT(BAL-SUB)      02.64
              GO TO C-770-EXIT                                          02.64
           END-IF.                                                      02.64
      *                                                                 02.64
           IF WS-BAL-TRAN-IS-CASH                                       02.64
              IF BAL-SUB = +1 AND                                       02.64
                 WS-MIS3-CARD-TYPE = 'UK'                               02.64
                    ADD +1               TO PRES-C-UK-CNT(BAL-SUB)      02.64
                    ADD AMOUNT-CHK       TO PRES-C-UK-AMT(BAL-SUB)      02.64
                    GO TO C-770-EXIT                                    02.64
              END-IF                                                    02.64
              IF KDA-CHD-IS-VALID-PD                                    02.64
                 ADD +1                  TO PRES-C-DN-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-C-DN-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
              END-IF                                                    02.64
              IF VALID-MIS3-VISA-CARD-TYPE                              03.47
                    ADD +1               TO PRES-C-VI-CNT(BAL-SUB)      02.64
                    ADD AMOUNT-CHK       TO PRES-C-VI-AMT(BAL-SUB)      02.64
                    GO TO C-770-EXIT                                    02.64
              END-IF                                                    02.64
              IF VALID-MIS3-MC-CARD-TYPE                                02.64
                 ADD +1                  TO PRES-C-MC-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-C-MC-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
              END-IF                                                    02.64
              IF VALID-MIS3-DS-CARD-TYPE                                02.64
                 ADD +1                  TO PRES-C-DS-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-C-DS-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
              END-IF                                                    02.64
              IF VALID-MIS3-PP-CARD-TYPE                                03.47
                 ADD +1                  TO PRES-C-PP-CNT(BAL-SUB)      03.47
                 ADD AMOUNT-CHK          TO PRES-C-PP-AMT(BAL-SUB)      03.47
                 GO TO C-770-EXIT                                       03.47
              END-IF                                                    03.47
              IF VALID-MIS3-AX-CARD-TYPE                                02.64
                 ADD +1                  TO PRES-C-AX-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-C-AX-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
              END-IF                                                    02.64
              IF VALID-MIS3-DB-CARD-TYPE                                02.64
                 ADD +1                  TO PRES-C-PD-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-C-PD-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
              END-IF                                                    02.64
              IF VALID-MIS3-EB-CARD-TYPE                                02.64
                 ADD +1                  TO PRES-C-EB-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-C-EB-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
              END-IF                                                    02.64
              ADD +1                     TO PRES-C-OT-CNT(BAL-SUB)      02.64
              ADD AMOUNT-CHK             TO PRES-C-OT-AMT(BAL-SUB)      02.64
              GO TO C-770-EXIT                                          02.64
           END-IF.                                                      02.64
      *                                                                 02.64
           IF BAL-SUB = +1 AND                                          02.64
              WS-MIS3-CARD-TYPE = 'UK'                                  02.64
                 ADD +1                  TO PRES-R-UK-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-R-UK-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
           END-IF.                                                      02.64
           IF KDA-CHD-IS-VALID-PD                                       02.64
              ADD +1                     TO PRES-R-DN-CNT(BAL-SUB)      02.64
              ADD AMOUNT-CHK             TO PRES-R-DN-AMT(BAL-SUB)      02.64
              GO TO C-770-EXIT                                          02.64
           END-IF.                                                      02.64
           IF VALID-MIS3-VISA-CARD-TYPE                                 03.47
                 ADD +1                  TO PRES-R-VI-CNT(BAL-SUB)      02.64
                 ADD AMOUNT-CHK          TO PRES-R-VI-AMT(BAL-SUB)      02.64
                 GO TO C-770-EXIT                                       02.64
           END-IF.                                                      02.64
           IF VALID-MIS3-MC-CARD-TYPE                                   02.64
              ADD +1                     TO PRES-R-MC-CNT(BAL-SUB)      02.64
              ADD AMOUNT-CHK             TO PRES-R-MC-AMT(BAL-SUB)      02.64
              GO TO C-770-EXIT                                          02.64
           END-IF.                                                      02.64
           IF VALID-MIS3-DS-CARD-TYPE                                   02.64
              ADD +1                     TO PRES-R-DS-CNT(BAL-SUB)      02.64
              ADD AMOUNT-CHK             TO PRES-R-DS-AMT(BAL-SUB)      02.64
              GO TO C-770-EXIT                                          02.64
           END-IF.                                                      02.64
           IF VALID-MIS3-PP-CARD-TYPE                                   03.47
              ADD +1                     TO PRES-R-PP-CNT(BAL-SUB)      03.47
              ADD AMOUNT-CHK             TO PRES-R-PP-AMT(BAL-SUB)      03.47
              GO TO C-770-EXIT                                          03.47
           END-IF.                                                      03.47
           IF VALID-MIS3-AX-CARD-TYPE                                   02.64
              ADD +1                     TO PRES-R-AX-CNT(BAL-SUB)      02.64
              ADD AMOUNT-CHK             TO PRES-R-AX-AMT(BAL-SUB)      02.64
              GO TO C-770-EXIT                                          02.64
           END-IF.                                                      02.64
           IF VALID-MIS3-DB-CARD-TYPE                                   02.64
              ADD +1                     TO PRES-R-PD-CNT(BAL-SUB)      02.64
              ADD AMOUNT-CHK             TO PRES-R-PD-AMT(BAL-SUB)      02.64
              GO TO C-770-EXIT                                          02.64
           END-IF.                                                      02.64
           IF VALID-MIS3-EB-CARD-TYPE                                   02.64
              ADD +1                     TO PRES-R-EB-CNT(BAL-SUB)      02.64
              ADD AMOUNT-CHK             TO PRES-R-EB-AMT(BAL-SUB)      02.64
              GO TO C-770-EXIT                                          02.64
           END-IF.                                                      02.64
           ADD +1                        TO PRES-R-OT-CNT(BAL-SUB).     02.64
           ADD AMOUNT-CHK                TO PRES-R-OT-AMT(BAL-SUB).     02.64
      *                                                                 02.64
       C-770-EXIT.                                                      02.64
           EXIT.                                                        02.64
      *                                                                 02.64
      * WRITE BALANCING RECORDS IF ANY DATA PROCESSED                   02.64
      *                                                                 02.64
       C-780-WRITE-BAL-REC-OUTPUT.                                      02.64
      *                                                                 02.64
           IF BAL-REC-CURR-CODE NOT = LOW-VALUES                        02.64
              ADD +1                     TO BALANCE-RECS-CNT            02.64
              WRITE BALANCE-FILE-RECORD FROM BALANCING-RECORD           02.64
           END-IF.                                                      02.64
      *                                                                 02.64
       C-780-EXIT.                                                      02.64
           EXIT.                                                        02.64
      *                                                                 02.64
       C-785-WRITE-BATCH-FILE.                                          02.87
      *                                                                 02.87
           IF PARM-IS-BALANCE-RECON                                     02.87
              ADD +1                     TO BATCH-RECS-CNT              02.87
              WRITE BATCH-FILE-RECORD  FROM BUR-BATCH-UPDATE-RECORD     02.87
           END-IF.                                                      02.87
      *                                                                 02.87
       C-785-EXIT.                                                      02.87
           EXIT.                                                        02.87
      *                                                                 02.87
       C-790-WRITE-RECON-DATA-FILE.                                     02.87
      *                                                                 02.87
           IF PARM-IS-BALANCE-RECON                                     02.87
              ADD +1                     TO RECON-DATA-RECS-CNT         02.87
              WRITE RECON-DATA-FILE-RECORD                              02.87
                                       FROM RCU-UPDATE-RECORD           02.87
           END-IF.                                                      02.87
      *                                                                 02.87
       C-790-EXIT.                                                      02.87
           EXIT.                                                        02.87
      *                                                                 02.87
049820 C-890-EDIT-MERCH-CORR.
049830     MOVE SPACES                 TO PET-MERCHANT.
           MOVE 'Y'                    TO PET-MRCH-REASON-CD.
           MOVE 99                     TO PET-MRCH-ER-CODE.
           MOVE +0                     TO PET-MRCH-SUM-AMOUNT
                                          PET-MRCH-DR-ITEMS
                                          PET-MRCH-DR-AMT
                                          PET-MRCH-CR-ITEMS
                                          PET-MRCH-CR-AMT
                                          PET-MRCH-DR-ITEMS-REJ         02.58
                                          PET-MRCH-DR-AMT-REJ           02.58
                                          PET-MRCH-CR-ITEMS-REJ         02.58
                                          PET-MRCH-CR-AMT-REJ           02.58
                                          PET-MRCH-DR-ITEMS-NS          03.00
                                          PET-MRCH-DR-AMT-NS            03.00
                                          PET-MRCH-CR-ITEMS-NS          03.00
                                          PET-MRCH-CR-AMT-NS            03.00
                                          PET-MRCH-DR-ITEMS-REJ-NS      03.10
                                          PET-MRCH-DR-AMT-REJ-NS        03.10
                                          PET-MRCH-CR-ITEMS-REJ-NS      03.10
                                          PET-MRCH-CR-AMT-REJ-NS        03.10
                                          PET-MRCH-CHD-ACCOUNT
                                          PET-MRCH-ITEMS
                                          PET-MRCH-300-FLAG
                                          PET-MRCH-SUS-NMBR
                                          PET-MRCH-TIMESTAMP
                                          PET-MRCH-AMOUNT
                                          PET-MRCH-REIMB-AMT
                                          PET-MRCH-NON-SETL-REIMB-AMT
                                          PET-MRCH-IIIAAA-AMT.
           MOVE MR1-TRANSCODE          TO PET-MRCH-ORIGINAL-TRAN-CODE
                                          PET-MRCH-TRANSCODE
                                          RRL-1-TRANSCODE.
           MOVE PSI-RUN                TO PET-MRCH-SOURCE-ID.
           MOVE HOLD-VISA-INT-SETL-GRP TO PET-MRCH-OWNER-INST.
           IF MIMC-MERCH-NMBR NOT NUMERIC
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE ONE-AST               TO RRL-1-MERCH-NMBR-ERR-IND
              MOVE 44                    TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1
           ELSE
           IF MIMC-MERCH-NMBR NOT = HLD-SUM-MERCH-NMBR
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE ONE-AST               TO RRL-1-MERCH-NMBR-ERR-IND
              MOVE 48                    TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1.
           IF MIMC-REF-MM-DD NOT NUMERIC
              MOVE HLD-WAO-MM            TO MIMC-REF-MM
              MOVE HLD-WAO-DD            TO MIMC-REF-DD.
           MOVE MIMC-REF-NMBR(7:12)      TO PET-MRCH-USER-REFERENCE-NO.
           IF MIMC-REF-NMBR = HLD-SUM-REF-NMBR
               MOVE HLD-SUM-REF-NMBR     TO PET-MRCH-REF-NMBR
           ELSE
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE ONE-AST               TO RRL-2-REF-NO-ERR-IND
              MOVE 06                    TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1.
      *
           IF MIMC-CORR-AMOUNT NOT NUMERIC
              MOVE +0                    TO RAD-ED-TRAN-AMT
              MOVE MIMC-CORR-AMOUNT-X    TO RRL-1-AMT-X
              MOVE ONE-AST               TO RRL-1-AMT-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 41                    TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1
           ELSE
              MOVE MIMC-CORR-AMOUNT      TO RAD-ED-TRAN-AMT
              IF MIMC-CORR-AMOUNT NEGATIVE
                 COMPUTE MIMC-CORR-AMOUNT = MIMC-CORR-AMOUNT * -1
              END-IF
              MOVE MIMC-CORR-AMOUNT      TO PET-MRCH-AMOUNT
                                            RRL-1-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRL-1-AMT  C-LGTH20
                   C-TYPEEND.
      *
           IF MIMC-REASON-FRST-2 = SPACES
              MOVE ONE-AST               TO RRL-2-CORR-REASON-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 20                    TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1.
           IF WS-RPT-LINE-CNT > +54
              PERFORM S-100-PRINT-PAGE-HDR
                 THRU S-100-EXIT.
050310     MOVE HLD-BANK-KEY           TO PET-MRCH-BANK-KEY.
050330     MOVE HLD-WORK-AS-OF-DATE    TO PET-MRCH-DATE.
050360     MOVE HLD-SUM-MERCH-NMBR     TO PET-MRCH-MERCH-NMBR.
           MOVE MIMC-MERCH-NMBR          TO RRL-1-MERCH-NMBR.
           MOVE MIMC-REF-NMBR            TO RRL-2-REF-NO.
050420     MOVE HLD-SUM-REF-NMBR       TO PET-MRCH-REF-NMBR
050430                                    PET-MRCH-ITEM-REF.
           MOVE MIMC-REASON              TO PET-MRCH-ER-16
                                            RRL-2-CORR-REASON.
           IF MR1-TC-PREF = '32'
              ADD 1                      TO TC-MRCH-ITMS (3)
              ADD PET-MRCH-AMOUNT        TO TC-MRCH-AMOUNT (3)
              ADD +1                     TO WS-CBT-OT-RJ-CNT
              SUBTRACT WORK-CENTER-AMT FROM WS-CBT-OT-RJ-AMT
           ELSE
              ADD 1                      TO TC-MRCH-ITMS (4)
              ADD PET-MRCH-AMOUNT        TO TC-MRCH-AMOUNT (4)
              ADD +1                     TO WS-CBT-OT-RJ-CNT
              ADD WORK-CENTER-AMT        TO WS-CBT-OT-RJ-AMT
           END-IF.
           IF PET-MRCH-SUS-FLAG = 'Y'
              MOVE '*'                   TO RRL-1-SUS-FLAG.
           MOVE POST-EDIT-TRANS          TO WORK-DATA.
050580     PERFORM S-300-WRITE-PET-WORK-REC
050590        THRU S-300-EXIT.
      *
           IF ER-CD-3-DIG (1) > ZERO
              MOVE ER-CD-3-DIG (1)       TO RRL-1-ERROR-CD-1.
           IF ER-CD-3-DIG (2) > ZERO
              MOVE ER-CD-3-DIG (2)       TO RRL-1-ERROR-CD-2.
           IF ER-CD-3-DIG (3) > ZERO
              MOVE ER-CD-3-DIG (3)       TO RRL-1-ERROR-CD-3.
           IF ER-CD-3-DIG (4) > ZERO
              MOVE ER-CD-3-DIG (4)       TO RRL-2-ERROR-CD-1.
           IF ER-CD-3-DIG (5) > ZERO
              MOVE ER-CD-3-DIG (5)       TO RRL-2-ERROR-CD-2.
           IF ER-CD-3-DIG (6) > ZERO
              MOVE ER-CD-3-DIG (6)       TO RRL-2-ERROR-CD-3.
      *
           MOVE '1'                      TO RAD-ED-LINE-TYPE.
           MOVE RPT-RANDC-LINE-1         TO RLW-DETAIL-LINE.
           PERFORM R-920-WRITE-REPORT-RECORD
              THRU R-920-EXIT.
           MOVE '9'                      TO RAD-ED-LINE-TYPE.
           MOVE RESET-RPT-RANDC-LINE-1   TO RPT-RANDC-LINE-1.
      *
           MOVE RPT-RANDC-LINE-2         TO RLW-DETAIL-LINE.
           PERFORM R-920-WRITE-REPORT-RECORD
              THRU R-920-EXIT.
           MOVE RESET-RPT-RANDC-LINE-2   TO RPT-RANDC-LINE-2.
      *
050620 C-890-EXIT.
050630     EXIT.
050640*
050650 D-100-CALL-DATECONV.
050660*****************************************************************
050670*  THIS SECTION IS PERFORMED FROM SEVERAL DIFFERENT AREAS W/IN **
050680*  BAC00110 TO CONVERT DATES.  THE CALLING AREAS ARE RESPONSIBLE*
050690*  FOR SETTING UP THE WORK AREA (DATECONV-PASSAREA) BEFORE     **
050700*  PERFORMING THIS SECTION FOR THE CALL.  EACH CALLING SECTION **
050710*  WITHIN THIS PROGRAM ALSO HANDLES THE CHECKING OF ERROR CODES**
050720*  AS EACH IS UNIQUE.                                          **
050730*****************************************************************
050740*
050750     CALL DATECONV USING DATECONV-PASSAREA.
050760 D-100-EXIT.
050770     EXIT.
      *
       D-500-SEARCH-PLAN-PACKAGE.
      *
           MOVE WS-PLAN-CODE             TO WS-SEARCH-PLAN-X.
           PERFORM D-510-SEARCH-MRCH-PLAN
              THRU D-510-EXIT.
      *
           PERFORM
             VARYING WS-PSUB FROM +1 BY +1                              02.23
             UNTIL   WS-PSUB > PPA-PKG-CNT OR                           02.23
                     WS-PLAN-CODE-FOUND                                 02.23
               IF PPA-PPT-PLAN-CODE(WS-PSUB) = WS-PLAN-CODE-NUM         02.23
                  MOVE PPA-PPT-PKG-CODE(WS-PSUB)                        02.23
                                         TO WS-SEARCH-PLAN
                  PERFORM D-510-SEARCH-MRCH-PLAN
                     THRU D-510-EXIT
               END-IF
           END-PERFORM.
      *
       D-500-EXIT.
           EXIT.
      *
       D-510-SEARCH-MRCH-PLAN.
      *
           SET KDA-PC-INDX TO 1.
           SEARCH KDA-PLAN-CODE-ENTRY
             VARYING KDA-PC-INDX
               AT END
                 MOVE 'N'                TO WS-PLAN-CODE-FOUND-SW
               WHEN KDA-PLAN-CODE(KDA-PC-INDX) = WS-SEARCH-PLAN
                 MOVE 'Y'                TO WS-PLAN-CODE-FOUND-SW
                 MOVE WS-SEARCH-PLAN     TO KDA-PLAN-QUAL-CODE.
           MOVE 'Y'                      TO ANMTR-SRCH-SW.              03.16B
      *
       D-510-EXIT.
           EXIT.
      *
       I-100-CHECK-INCENTIVES.
      *
      * EVALUATE ALL TRANSACTIONS BY CARD TYPE TO DETERMINE
      * THE TYPE OF INCENTIVES THAT APPLY.
      *
           IF PET-SUS-FLAG = 'Y' AND
              PET-CARD-TYPE-MC
              MOVE HOLD-MC-PROG-REGIST-ID
                                         TO ROD-MC-PROG-REGIST-ID
              MOVE HOLD-MC-ASSIGN-MRCH-ID                               02.39
                                         TO RCL-4-MC-ASSIGN-ID          02.39
              MOVE '   ASGN ID '         TO RCL-4-MC-ASSIGN-ID-TITLE    02.39
              MOVE PET-MC-SRV-LVL-CODE   TO ROD-MC-SRV-LVL-CODE
              MOVE PET-MC-SRV-ID-CODE    TO ROD-MC-SRV-ID-CODE
              MOVE PET-MC-SRV-IRD        TO ROD-MC-SRV-IRD
              MOVE PET-MC-PRODUCT-ID     TO ROD-MC-PRODUCT-ID-OUT
              MOVE PET-MC-ACCEPT-BRAND-CD
                                         TO ROD-MC-ACCEPT-BRAND-CD
              MOVE RCL-OPTIONAL-DATA-10-MC                              02.95
                                         TO RCL-10-OPTIONAL-DATA        02.95
              MOVE RESET-RCL-OPTIONAL-DATA-10-MC                        02.95
                                         TO RCL-OPTIONAL-DATA-10-MC     02.95
           END-IF.
      *
           IF PET-SUS-FLAG = 'Y' AND
              PET-CARD-TYPE-VISA                                        03.27
              MOVE KDA-CHD-AR-ACCT-FUND-SRC                             02.81
                                         TO RVS-2-ACCT-FUND-SRC         02.81
              MOVE PET-REIMB-IND         TO ROD-VS-REIMB-IND
              MOVE PET-FEE-PROGRAM-IND   TO ROD-VS-FEE-PGM-IND
              MOVE PET-PAY-SVC-IND       TO ROD-VS-PAY-SVC-IND
              MOVE HOLD-NAF-MVV          TO RCL-4-MVV-TIER
              MOVE '   MVV '             TO RCL-4-MVV-TIER-TITLE
              IF HOLD-NAF-MVV NOT = HOLD-PET-MVV
                 MOVE '?'                TO RCL-4-MVV-TIER-ERR-IND
              END-IF
              MOVE KDA-CHD-AR-TECH-IND   TO ROD-VS-TECH-IND             02.41
              MOVE KDA-CHD-AR-REGULATED-IND                             02.68
                                         TO ROD-VS-REG-IND              02.68
              MOVE KDA-CHD-AR-LRG-TKT-IND                               02.81
                                         TO ROD-VS-LRG-TKT              02.81
              MOVE KDA-CHD-AR-ACCT-LVL-PROC-IND                         02.81
                                         TO ROD-VS-ACCT-LVL-IND         02.81
              MOVE KDA-CHD-AR-CARD-USAGE TO ROD-VS-CARD-USAGE
              MOVE RCL-OPTIONAL-DATA-10-VS                              02.95
                                         TO RCL-10-OPTIONAL-DATA        02.95
              MOVE RESET-RCL-OPTIONAL-DATA-10-VS                        02.95
                                         TO RCL-OPTIONAL-DATA-10-VS     02.95
           END-IF.
      *
           IF PET-SUS-FLAG EQUAL 'Y'
              GO TO I-100-EXIT.
           IF INVALID-DATE-SW EQUAL 'Y'
              GO TO I-100-EXIT.
           IF ER-CD-3-DIG (1) > 0
              GO TO I-100-EXIT.
           IF PET-CARD-TYPE-VISA                                        03.27
           OR PET-CARD-TYPE-DISCOVER
           OR PET-CARD-TYPE-PAYPAL                                      03.47
           OR PET-CARD-TYPE-AMEX                                        02.29
           OR PET-CARD-TYPE-MC
           OR PET-CARD-TYPE-PL
              NEXT SENTENCE
           ELSE
              GO TO I-100-EXIT.
           IF INVALID-MERCH-SW = 'Y' OR 'Z'
              GO TO I-100-EXIT.
           IF INVALID-NAME-ADDR-SW NOT = SPACES
              GO TO I-100-EXIT.
      *
           MOVE PET-DATE                 TO DC-SEND-DATE.
           MOVE HLD-WORK-AS-OF-DATE      TO DC-SEND-NUM.
           MOVE 'DAA'                    TO DC-OPERATION.
           PERFORM D-100-CALL-DATECONV
              THRU D-100-EXIT.
           IF DC-SUCCESSFUL AND
             (DC-RESULT NOT = '01') AND
              DC-RETURN-NUM < 180
                 NEXT SENTENCE
           ELSE
              IF MR1-VALID-MIS3-TRAN                                    03.31
                 MOVE ONE-AST            TO RCL-1-TRAN-DATE-ERR-IND     02.61
              ELSE                                                      02.61
                 MOVE ONE-AST            TO RF1-1-TRAN-DATE-ERR-IND     02.61
              END-IF                                                    02.61
              SET WS-ARC-SET-E27 TO TRUE
              MOVE 142                   TO ER-CD-3-DIG(ER-INDX)
              MOVE 'Y'                   TO PET-SUS-FLAG
              SET ER-INDX UP BY 1
              GO TO I-100-EXIT.
      *
           MOVE 'N'                      TO WS-PLAN-CODE-FOUND-SW
                                            KDA-MRCH-NAME-ERR-SW
                                            KDA-US-AIR-FLAG
                                            KDA-AUTH-ERR-SW.
      *
           MOVE ZEROS                    TO KDA-ORIG-PLAN-CODE
                                            KDA-PLAN-QUAL-CODE.
           MOVE +0                       TO KDA-LOW-ITEM-AMT
           MOVE +999999999999.999        TO KDA-LOW-RATE-AMT
                                            KDA-LOW-MRCH-AMT.
           MOVE SPACES                   TO KDA-DOWNGRADE-TABLE.
      *
           IF PET-CARD-TYPE-VISA                                        03.27
              PERFORM I-101-VISA-INCENTIVES
                 THRU I-101-EXIT
           ELSE
              IF PET-CARD-TYPE-MC
                 PERFORM I-102-MCARD-INCENTIVES
                    THRU I-102-EXIT
           ELSE
              IF PET-CARD-TYPE-AMEX                                     02.29
                 PERFORM I-104-AMEX-INCENTIVES                          02.29
                    THRU I-104-EXIT                                     02.29
                 IF KDA-VC-AX-KEY-ENTERED                               03.16A
                    MOVE 'Y'             TO PET-AMEX-KEY-ENTERED        03.16A
                 END-IF                                                 03.16A
           ELSE                                                         02.29
              IF PET-CARD-TYPE-DISCOVER
              OR PET-CARD-TYPE-PAYPAL                                   03.47
                 PERFORM I-105-DISCOVER-INCENTIVES
                    THRU I-105-EXIT
           ELSE
              PERFORM I-103-PRIVATE-INCENTIVES
                 THRU I-103-EXIT.
      *
           IF INVALID-ACCT-SW = 'Y'
              MOVE ONE-AST               TO RCL-1-ACCT-NO-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 37                    TO ER-CD(ER-INDX)
              SET ER-INDX UP BY 1
              GO TO I-100-EXIT.
      *
           IF KDA-VS-EIRF-TO-STD-ERR = 'Y'                              03.66
              MOVE ONE-AST               TO RCL-1-ACCT-NO-ERR-IND       03.66
              MOVE 'Y'                   TO PET-SUS-FLAG                03.66
              MOVE 272                   TO ER-CD-3-DIG(ER-INDX)        03.66
              SET ER-INDX UP BY 1                                       03.66
           END-IF                                                       03.66
      *                                                                 03.66
           IF KDA-PLAN-QUAL-CODE = ZEROS
              MOVE ONE-AST               TO RCL-1-ACCT-NO-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 289                   TO ER-CD-3-DIG(ER-INDX)
              SET ER-INDX UP BY 1.
      *
           COMPUTE SUB2 = +1.
           PERFORM
             VARYING SUB1 FROM +1 BY +1
             UNTIL   SUB1 > +10
               IF KDA-DT-ENTRY(SUB1) = SPACES
                  COMPUTE SUB1 = +10
               ELSE
                  IF KDA-DTE-AMT(SUB1) < KDA-LOW-RATE-AMT
                     MOVE KDA-DTE-PLAN-X(SUB1)
                                         TO RDL-PED-PLAN(SUB2)
                     MOVE KDA-DTE-PLAN(SUB1)
                                         TO WS-DFR-PLAN(SUB2)
                     MOVE '-'            TO RDL-PED-DASH(SUB2)
                     MOVE KDA-DTE-CODE(SUB1)
                                         TO RDL-PED-ERROR(SUB2)
                                            WS-DFR-REASON(SUB2)
                     MOVE SUB2           TO WS-DFR-CNT
                     COMPUTE SUB2 = SUB2 + 1
                  END-IF
               END-IF
           END-PERFORM.
      *
           IF WS-DFR-CNT > ZERO
              IF PET-SUS-FLAG NOT = 'Y'
                 IF NOT PARM-IS-1-SIDED                                 03.31
                    WRITE DOWN-FILE-REC FROM WS-DOWN-FILE-REC           03.31
                 END-IF                                                 03.31
              END-IF
           END-IF.
      *
           MOVE KDA-PLAN-QUAL-CODE       TO PET-PLAN-TYPE.
           MOVE PET-PLAN-TYPE-X          TO RCL-10-POST-PLAN.           02.95
           MOVE KDA-ORIG-PLAN-CODE       TO PET-ORIG-PLAN-TYPE.
           MOVE PET-ORIG-PLAN-TYPE-X     TO RCL-10-INT-PLAN.            03.48
           MOVE RCL-10-POST-PLAN-ADD-IND TO WS-10-POST-PLAN-ADD-IND.    02.95
           IF PET-CUSTOM-PLAN NOT = SPACES                              02.84
              MOVE RCL-10-POST-PLAN      TO RCL-10CU-POST-PLAN          02.95
              MOVE RCL-10-POST-PLAN-ADD-IND                             02.95
                                         TO RCL-10CU-POST-PLAN-ADD-IND  02.95
              MOVE PET-CUSTOM-PLAN       TO RCL-10CU-CUSTOM-PLAN        02.95
              MOVE RCL-10-INT-PLAN       TO RCL-10CU-INT-PLAN           02.95
              MOVE RPT-ALT-CUSTOM-LINE-10 TO RCL-10-ALTERNATE-DATA      02.95
           END-IF.                                                      02.84
      *                                                                 02.84
       I-100-EXIT.
           EXIT.
      *
       I-101-VISA-INCENTIVES.
      *
      * CHECK FOR ALL VISA TRANSACTIONS
      *
           IF KDA-HAS-LU
              IF PET-LVL3-SUS-FLAG = 'Y'
                 MOVE 'U'                TO PET-LVL3-SUS-FLAG
              END-IF
           END-IF.
      *
           IF PET-VALID-MIS3-TRAN AND                                   03.31
             (PET-VALID-SALE OR                                         03.31
              PET-VALID-RETURN)                                         03.31
                 PERFORM S-520-VISA-MRCH-NME-CHKS                       03.31
                    THRU S-520-EXIT.                                    03.31
      *
           MOVE HLD-DESCR                TO PET-DESCR.
      *
           PERFORM S-530-CHECK-VISA-AUTH
              THRU S-530-EXIT.
      *
           IF KDA-BATCH-BIN-REGION = '1' AND                            02.39
              KDA-CHD-AR-BIN-REGION = '1'                               02.39
                 PERFORM Z99VU-CALL-BAS110VU                            02.51
                    THRU Z99VU-EXIT                                     02.51
           ELSE                                                         02.39
              PERFORM Z99VI-CALL-BAS110VI                               02.51
                 THRU Z99VI-EXIT                                        02.51
           END-IF.                                                      02.39
      *
           IF PET-RATE-FLAG = 'X' AND
             (NOT PARM-IS-1-SIDED) AND                                  03.31
              KDA-IS-PASS-THRU-VS
                 MOVE KDA-ORIG-PLAN-CODE TO KDA-PLAN-QUAL-CODE
                                            GPR-NEW-PLAN                02.38
                 MOVE 0101               TO GPR-FROM-PLAN               02.38
                 PERFORM S-500-AUTO-GEN-PLAN                            02.38
                    THRU S-500-EXIT                                     02.38
                 IF GPR-FROM-PLAN = 0101                                02.38
                    MOVE 'A'             TO RCL-10-POST-PLAN-ADD-IND    02.95
                 ELSE                                                   02.38
                    MOVE 'T'             TO RCL-10-POST-PLAN-ADD-IND    02.95
                 END-IF                                                 02.38
           ELSE
              MOVE SPACE                 TO PET-RATE-FLAG.
      *
      * VISA MULTIPLE CLEARING SEQ NBR AND SEQUENCE CNT FIELDS MUST     03.42V
      * BE NON-ZERO TO DISTINGUISH THE CLEARING MESSAGES AS PASSENGER   03.42V
      * TRANSPORT.                                                      03.42V
      *                                                                 03.42V
      * 293/PT CP CONSUMER      294/PT CP DB           295/PT CP PP     03.42V
      * 296/PT CNP CONSUMER     297/PT CNP DB          298/PT CNP PP    03.42V
      * 168/PT PREF CONSUMER    192/PT PREF DB         322/PT PRE PP    03.42V
      *                                                                 03.42V
           IF (PET-FEE-PROGRAM-IND  = '293' OR '294' OR '295' OR        03.42V
                                      '296' OR '297' OR '298' OR        03.42V
                                      '168' OR '192' OR '322') AND      03.42V
             (MIS3-VS-MULTI-CLR-SEQ-NO = ZEROES OR                      03.42V
              MIS3-VS-MULTI-CLR-SEQ-CNT = ZEROES)                       03.42V
              MOVE 01                    TO PET-MULT-CLEARING-SEQ-NUM   03.42V
                                            PET-MULT-CLEARING-SEQ-CNT   03.42V
              MOVE '01'                  TO RVS-1-MCS-NO                03.42V
                                            RVS-1-MCS-CNT               03.42V
              MOVE '?'                   TO RVS-1-MCS-ERR-IND           03.42V
           END-IF.                                                      03.42V
      *                                                                 03.42V
           MOVE PET-REIMB-IND            TO ROD-VS-REIMB-IND.
           MOVE PET-FEE-PROGRAM-IND      TO ROD-VS-FEE-PGM-IND.
           MOVE PET-PAY-SVC-IND          TO ROD-VS-PAY-SVC-IND.
           MOVE PET-AUTH-CHAR-IND        TO RCL-4-AUTH-CHAR-OUT.
           IF MR1-VALID-RETURN                                          03.31
              MOVE PET-MAIL-PHONE-IND    TO RCL-2-MOTO-ECOM-OUT
           ELSE
              MOVE PET-MAIL-PHONE-IND    TO RF1-2-MOTO-ECOM-OUT
           END-IF.
           MOVE HOLD-NAF-MVV             TO RCL-4-MVV-TIER.
           MOVE '   MVV '                TO RCL-4-MVV-TIER-TITLE.
           MOVE KDA-MM-VS-VPP-IND        TO RVS-4-VISA-VPP.             03.63
           MOVE KDA-CHD-AR-ACCT-FUND-SRC TO RVS-2-ACCT-FUND-SRC.        02.81
           MOVE KDA-CHD-AR-TECH-IND      TO ROD-VS-TECH-IND.            02.41
           MOVE KDA-CHD-AR-REGULATED-IND TO ROD-VS-REG-IND.             02.68
           MOVE KDA-CHD-AR-LRG-TKT-IND   TO ROD-VS-LRG-TKT.             02.81
           MOVE KDA-CHD-AR-ACCT-LVL-PROC-IND                            02.81
                                         TO ROD-VS-ACCT-LVL-IND.        02.81
           MOVE KDA-CHD-AR-CARD-USAGE    TO ROD-VS-CARD-USAGE.
           MOVE RCL-OPTIONAL-DATA-10-VS  TO RCL-10-OPTIONAL-DATA.       02.95
           MOVE RESET-RCL-OPTIONAL-DATA-10-VS                           02.95
                                         TO RCL-OPTIONAL-DATA-10-VS.    02.95
      *
       I-101-CALC-INT-FEE.
      *
           IF KDA-LOW-RATE-AMT = +0 OR
              KDA-LOW-RATE-AMT = +999999999999.999
                 GO TO I-101-EXIT.
      *
           IF PET-VALID-CASH                                            03.31
              IF KDA-LOW-RATE-AMT NOT = +0
                 COMPUTE KDA-LOW-RATE-AMT = KDA-LOW-RATE-AMT * -1
              END-IF
              IF KDA-LOW-ITEM-AMT NOT = +0
                 COMPUTE KDA-LOW-ITEM-AMT = KDA-LOW-ITEM-AMT * -1
              END-IF
           END-IF.
      *
           IF PET-REIMB-CURR-CODE = +840
              MOVE KDA-LOW-RATE-AMT      TO PET-REIMB-INT-FEE-AMT
              MOVE KDA-LOW-ITEM-AMT      TO PET-REIMB-INT-FEE-ITEM
           ELSE
              EVALUATE TRUE                                             03.31
                WHEN PET-VALID-RETURN                                   03.31
                  COMPUTE PET-REIMB-INT-FEE-AMT =
                      KDA-LOW-RATE-AMT * BASCRATE-RD-REIMB-VSSB-RATE
                  COMPUTE PET-REIMB-INT-FEE-ITEM =
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-REIMB-VSSB-RATE
                WHEN OTHER
                  COMPUTE PET-REIMB-INT-FEE-AMT =
                      KDA-LOW-RATE-AMT * BASCRATE-RD-REIMB-VSBS-RATE
                  COMPUTE PET-REIMB-INT-FEE-ITEM =
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-REIMB-VSBS-RATE
              END-EVALUATE
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                    C-TYPED  BASCRATE-SD-REIMB-CURR-DEC
                    C-TYPER  PET-REIMB-INT-FEE-AMT
                    C-TYPEEND
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                    C-TYPED  BASCRATE-SD-REIMB-CURR-DEC
                    C-TYPER  PET-REIMB-INT-FEE-ITEM
                    C-TYPEEND
           END-IF.
      *
           IF PET-IIIAAA-CURR-CODE = +840
              MOVE KDA-LOW-RATE-AMT      TO PET-IIIAAA-INT-FEE-AMT
              MOVE KDA-LOW-ITEM-AMT      TO PET-IIIAAA-INT-FEE-ITEM
           ELSE
              EVALUATE TRUE                                             03.31
                WHEN PET-VALID-RETURN                                   03.31
                  COMPUTE PET-IIIAAA-INT-FEE-AMT =
                      KDA-LOW-RATE-AMT * BASCRATE-RD-IIIAAA-VSSB-RATE
                  COMPUTE PET-IIIAAA-INT-FEE-ITEM =
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-IIIAAA-VSSB-RATE
                WHEN OTHER
                  COMPUTE PET-IIIAAA-INT-FEE-AMT =
                      KDA-LOW-RATE-AMT * BASCRATE-RD-IIIAAA-VSBS-RATE
                  COMPUTE PET-IIIAAA-INT-FEE-ITEM =
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-IIIAAA-VSBS-RATE
              END-EVALUATE
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                    C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC
                    C-TYPER  PET-IIIAAA-INT-FEE-AMT
                    C-TYPEEND
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                    C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC
                    C-TYPER  PET-IIIAAA-INT-FEE-ITEM
                    C-TYPEEND
           END-IF.
      *
       I-101-EXIT.
           EXIT.
      *
       I-102-MCARD-INCENTIVES.
      *
      * CHECK FOR ALL MASTERCARD TRANSACTIONS
      *
           IF KDA-MMERCAT-MC-NOT-VALID
              GO TO I-102-EXIT.
      *
           IF PET-AUTH-CD = SPACES OR
                            ZEROS OR
                           '999999'
              MOVE 'Y'                   TO KDA-AUTH-ERR-SW
           END-IF.
      *
           PERFORM C-380-BUILD-MERCHANT-ADDENDUMS
              THRU C-380-EXIT.
      *
           IF HLD-DESCR-NAME = SPACES OR
              HLD-DESCR-CITY = SPACES
                 NEXT SENTENCE
           ELSE
              MOVE 'Y'                   TO PET-DESCR-FLAG.
      *
       I-102-I-OR-D.
      *
           IF PET-CARD-TYPE-MC AND KDA-MC-OTHER-AIR                     03.12
              MOVE HLD-DESCR-NAME        TO WS-DESCR-NAME               03.12
              MOVE SPACES                TO HLD-DESCR-NAME              03.12
              MOVE WS-DESCR-NAME(1:9)    TO HLD-DESCR-NAME              03.12
           END-IF.                                                      03.12
           MOVE HLD-DESCR                TO PET-DESCR.
      *
           IF PET-MERCH-NAME = SPACES
              MOVE 'Y'                   TO KDA-MRCH-NAME-ERR-SW.
           IF PET-INET-COUNTRY = SPACES
              MOVE 'Y'                   TO KDA-MRCH-NAME-ERR-SW
           ELSE
           IF PET-INET-COUNTRY = 'USA' AND
              PET-STATE = SPACES
                 MOVE 'Y'                TO KDA-MRCH-NAME-ERR-SW.
           PERFORM S-790-VALIDATE-MC-ZIP                                02.48
              THRU S-790-EXIT.                                          02.48
           IF ERROR-FOUND                                               02.48
              MOVE ONE-AST               TO RCL-8-MRCH-ZIP-ERR-IND      02.48
              MOVE 62                    TO ER-CD(ER-INDX)              02.60
              MOVE 'Y'                   TO PET-SUS-FLAG                02.48
                                            KDA-MRCH-NAME-ERR-SW        02.48
              SET ER-INDX UP BY 1                                       02.48
           END-IF.                                                      02.48
      *
           MOVE SPACE                    TO INVALID-ACCT-SW.
           IF WS-MC-LAST-PREFIX-HIGH-BIN = WS-WRK-IA-PREFIX-HIGH-BIN AND
              KDA-CHD-ICA-ACCEPT-BRAND = WS-WRK-IA-ACCEPT-BRAND
                 GO TO I-102-LOAD-PRODUCT-DATA.
      *
           MOVE 'S'                      TO BAS10004-CALL-TYPE.
           MOVE SPACES                   TO MC-IB-KEY.
           MOVE 'I'                      TO MC-REC-KEY-ID.
           MOVE WS-MC-PREFIX-HIGH-BIN    TO MC-IB-AR-HIGH.
           IF KDA-CHD-ICA-ACCEPT-BRAND = 'DMC'
              MOVE 'D'                   TO MC-IB-ACCEPT-BRAND
           ELSE
              MOVE 'C'                   TO MC-IB-ACCEPT-BRAND.
           MOVE MC-IB-KEY                TO BAS10004-MCEDFILE-READ-KEY.
           PERFORM Z9996-CALL-BAS10004 THRU Z9996-EXIT.
           IF BAS10004-RC-NOT-FOUND
              MOVE 'Y'                   TO INVALID-ACCT-SW
              GO TO I-102-EXIT
           ELSE
           IF BAS10004-RC-ERROR
              MOVE 99                    TO HLD-RETURN-CD
              GO TO A-100-FINISHUP.
           IF WS-MC-PREFIX-HIGH-BIN < MC-IB-AR-LOW
              MOVE 'Y'                   TO INVALID-ACCT-SW
              GO TO I-102-EXIT.
      *
           MOVE WS-MC-LAST-PREFIX-HIGH-BIN
                                         TO WS-WRK-IA-PREFIX-HIGH-BIN.
           MOVE KDA-CHD-ICA-ACCEPT-BRAND TO WS-WRK-IA-ACCEPT-BRAND.
           MOVE MC-IB-DATA               TO WS-WRK-IA-DATA.
      *
           EVALUATE KDA-CHD-ICA-ACCEPT-BRAND
              WHEN 'DMC'
                 MOVE WS-DMC-ACQ-WORK-AREA
                                         TO WS-WRK-AA-DATA
              WHEN OTHER
                 MOVE WS-MCC-ACQ-WORK-AREA
                                         TO WS-WRK-AA-DATA
           END-EVALUATE.
      *
           COMPUTE WS-SUB3 = +0.
           COMPUTE WS-WRK-CA-CNT = +0.
           PERFORM
              VARYING WS-SUB1 FROM +1 BY +1
              UNTIL   WS-SUB1 > WS-WRK-AA-CNT
                 PERFORM
                    VARYING WS-SUB2 FROM +1 BY +1
                    UNTIL   WS-SUB2 > WS-WRK-IA-CNT
                       IF WS-WRK-AA-BSA(WS-SUB1) =
                                            WS-WRK-IA-BSA(WS-SUB2)
                          COMPUTE WS-SUB3 = WS-SUB3 + 1
                          MOVE WS-WRK-IA-ENTRY(WS-SUB2)
                                         TO WS-WRK-CA-ENTRY(WS-SUB3)
                          COMPUTE WS-WRK-CA-CNT = WS-SUB3
                       END-IF
                 END-PERFORM
           END-PERFORM.
      *
       I-102-LOAD-PRODUCT-DATA.
      *
           IF KDA-CHD-ICA-CARD-TYPE = WS-WRK-PRODUCT-ID AND             03.15
              KDA-CHD-ICA-ACCEPT-BRAND = WS-WRK-PROD-ACCEPT-BRAND       03.15
                 GO TO I-102-LOAD-COMMON-BSA-IRD.                       03.15
      *
           MOVE KDA-CHD-ICA-CARD-TYPE    TO WS-WRK-PRODUCT-ID.
           MOVE KDA-CHD-ICA-ACCEPT-BRAND TO WS-WRK-PROD-ACCEPT-BRAND.
      *
           EVALUATE KDA-CHD-ICA-ACCEPT-BRAND
             WHEN 'DMC'
               PERFORM
                 VARYING WS-SUB1 FROM +1 BY +1
                 UNTIL   WS-SUB1 > WS-DMC-PROD-NO-ENTRIES
                   IF KDA-CHD-ICA-CARD-TYPE = WS-DMC-PRODUCT-ID(WS-SUB1)
                      MOVE WS-DMC-PROD-DATA(WS-SUB1)
                                         TO WS-WRK-PROD-DATA
                      MOVE WS-DMC-PROD-NO-ENTRIES
                                         TO WS-SUB1
                   END-IF
               END-PERFORM
             WHEN OTHER
               PERFORM
                 VARYING WS-SUB1 FROM +1 BY +1
                 UNTIL   WS-SUB1 > WS-MCC-PROD-NO-ENTRIES
                   IF KDA-CHD-ICA-CARD-TYPE = WS-MCC-PRODUCT-ID(WS-SUB1)
                      MOVE WS-MCC-PROD-DATA(WS-SUB1)
                                         TO WS-WRK-PROD-DATA
                      MOVE WS-MCC-PROD-NO-ENTRIES
                                         TO WS-SUB1
                   END-IF
               END-PERFORM
           END-EVALUATE.
      *
       I-102-LOAD-COMMON-BSA-IRD.
      *
           COMPUTE WS-SUB4 = +0.
           PERFORM
             VARYING WS-SUB1 FROM +1 BY +1
             UNTIL   WS-SUB1 > WS-WRK-CA-CNT
               PERFORM
                 VARYING WS-SUB2 FROM +1 BY +1
                 UNTIL   WS-SUB2 > WS-WRK-PROD-CNT
                   IF WS-WRK-CA-BSA(WS-SUB1) = WS-WRK-PROD-BSA(WS-SUB2)
                      PERFORM
                        VARYING WS-SUB3 FROM +1 BY +1
                        UNTIL   WS-SUB3 >
                                WS-WRK-PROD-IRD-CNT(WS-SUB2)
                          COMPUTE WS-SUB4 = WS-SUB4 + 1
                          MOVE WS-WRK-CA-BSA(WS-SUB1)
                            TO WS-WRK-CBIA-BSA(WS-SUB4)
                          MOVE WS-WRK-CA-BSA-ENF-IND(WS-SUB1)
                            TO WS-WRK-CBIA-BSA-ENF-IND(WS-SUB4)
                          MOVE WS-WRK-PROD-IRD(WS-SUB2,WS-SUB3)
                            TO WS-WRK-CBIA-IRD(WS-SUB4)
                      END-PERFORM
                   END-IF
               END-PERFORM
           END-PERFORM.
      *
           COMPUTE WS-WRK-CBIA-CNT = WS-SUB4.
      *
       I-102-LOAD-CALL-PARAMETERS.
      *
           PERFORM S-550-LOAD-CAB-PROG-WORK
              THRU S-550-EXIT.
      *
           IF KDA-CHD-ICA-ACCEPT-BRAND = 'DMC'
              EVALUATE PET-MC-PC-TRAN-TYPE
                 WHEN 00
                    MOVE WS-DMC-00-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN 01
                    MOVE WS-DMC-01-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN 09
                    MOVE WS-DMC-09-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN 12
                    MOVE WS-DMC-12-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN 18
                    MOVE WS-DMC-18-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN 20
                    MOVE WS-DMC-20-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN 28
                    MOVE WS-DMC-28-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
              END-EVALUATE
           ELSE
              EVALUATE PET-MC-PC-TRAN-TYPE
                 WHEN 00
                    MOVE WS-MCC-00-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN 01
                    MOVE WS-MCC-01-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN 12
                    MOVE WS-MCC-12-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN 18
                    MOVE WS-MCC-18-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN 20
                    MOVE WS-MCC-20-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
                 WHEN 28
                    MOVE WS-MCC-28-STALE-DATE-WORK
                      TO WS-WRK-STALE-DATE-WORK
              END-EVALUATE
           END-IF.
           EVALUATE PET-MC-PC-FROM-TYPE
              WHEN 00
                 COMPUTE WS-SUB1 = +1
              WHEN 10
                 COMPUTE WS-SUB1 = +2
              WHEN 20
                 COMPUTE WS-SUB1 = +3
              WHEN 30
                 COMPUTE WS-SUB1 = +4
              WHEN 39                                                   02.23
                 COMPUTE WS-SUB1 = +5                                   02.23
              WHEN 60
                 COMPUTE WS-SUB1 = +6                                   02.23
           END-EVALUATE.
           MOVE WS-WRK-SD-DATA(WS-SUB1)  TO KSD-STALE-DATE-TABLE.
      *
       I-102-CALL-BAS110.                                               02.51
      *
           IF WS-BATCH-ICA-REGN = '1' AND                               02.51
              WS-CHD-ICA-REGN = '1'                                     02.51
                 PERFORM Z99MU-CALL-BAS110MU                            02.51
                    THRU Z99MU-EXIT                                     02.51
           ELSE                                                         02.51
              PERFORM Z99MI-CALL-BAS110MI                               02.51
                 THRU Z99MI-EXIT                                        02.51
           END-IF.                                                      02.51
      *                                                                 02.51
           IF PET-RATE-FLAG = 'X' AND
             (NOT PARM-IS-1-SIDED) AND                                  03.31
              KDA-IS-PASS-THRU-MC                                       02.29
                 MOVE KDA-ORIG-PLAN-CODE TO KDA-PLAN-QUAL-CODE
                                            GPR-NEW-PLAN                02.38
                 MOVE 0102               TO GPR-FROM-PLAN               02.38
                 PERFORM S-500-AUTO-GEN-PLAN                            02.38
                    THRU S-500-EXIT                                     02.38
                 IF GPR-FROM-PLAN = 0102                                02.38
                    MOVE 'A'             TO RCL-10-POST-PLAN-ADD-IND    02.95
                 ELSE                                                   02.38
                    MOVE 'T'             TO RCL-10-POST-PLAN-ADD-IND    02.95
                 END-IF                                                 02.38
           ELSE
              MOVE SPACE                 TO PET-RATE-FLAG.
      *
           MOVE HOLD-MC-PROG-REGIST-ID   TO ROD-MC-PROG-REGIST-ID.
           MOVE HOLD-MC-ASSIGN-MRCH-ID   TO RCL-4-MC-ASSIGN-ID.         02.39
           MOVE '   ASGN ID '            TO RCL-4-MC-ASSIGN-ID-TITLE.   02.39
           MOVE PET-MC-SRV-LVL-CODE      TO ROD-MC-SRV-LVL-CODE.
           MOVE PET-MC-SRV-ID-CODE       TO ROD-MC-SRV-ID-CODE.
           MOVE PET-MC-SRV-IRD           TO ROD-MC-SRV-IRD.
           MOVE PET-MC-PRODUCT-ID        TO ROD-MC-PRODUCT-ID-OUT.
           MOVE PET-MC-ACCEPT-BRAND-CD   TO ROD-MC-ACCEPT-BRAND-CD.
           MOVE RCL-OPTIONAL-DATA-10-MC  TO RCL-10-OPTIONAL-DATA.       02.95
           MOVE RESET-RCL-OPTIONAL-DATA-10-MC                           02.95
                                         TO RCL-OPTIONAL-DATA-10-MC.    02.95
      *
       I-102-CALC-INT-FEE.
      *
           IF KDA-LOW-RATE-AMT = +0 OR
              KDA-LOW-RATE-AMT = +999999999999.999
                 GO TO I-102-EXIT.
      *
           IF PET-VALID-CASH                                            03.31
              IF KDA-LOW-RATE-AMT NOT = +0
                 COMPUTE KDA-LOW-RATE-AMT = KDA-LOW-RATE-AMT * -1
              END-IF
              IF KDA-LOW-ITEM-AMT NOT = +0
                 COMPUTE KDA-LOW-ITEM-AMT = KDA-LOW-ITEM-AMT * -1
              END-IF
           END-IF.
      *
           IF PET-REIMB-CURR-CODE = +840
              MOVE KDA-LOW-RATE-AMT      TO PET-REIMB-INT-FEE-AMT
              MOVE KDA-LOW-ITEM-AMT      TO PET-REIMB-INT-FEE-ITEM
           ELSE
              EVALUATE TRUE                                             03.31
                WHEN PET-VALID-RETURN                                   03.31
                  COMPUTE PET-REIMB-INT-FEE-AMT =
                      KDA-LOW-RATE-AMT * BASCRATE-RD-REIMB-MCSB-RATE
                  COMPUTE PET-REIMB-INT-FEE-ITEM =
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-REIMB-MCSB-RATE
                WHEN OTHER
                  COMPUTE PET-REIMB-INT-FEE-AMT =
                      KDA-LOW-RATE-AMT * BASCRATE-RD-REIMB-MCBS-RATE
                  COMPUTE PET-REIMB-INT-FEE-ITEM =
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-REIMB-MCBS-RATE
              END-EVALUATE
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                    C-TYPED  BASCRATE-SD-REIMB-CURR-DEC
                    C-TYPER  PET-REIMB-INT-FEE-AMT
                    C-TYPEEND
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                    C-TYPED  BASCRATE-SD-REIMB-CURR-DEC
                    C-TYPER  PET-REIMB-INT-FEE-ITEM
                    C-TYPEEND
           END-IF.
      *
           IF PET-IIIAAA-CURR-CODE = +840
              MOVE KDA-LOW-RATE-AMT      TO PET-IIIAAA-INT-FEE-AMT
              MOVE KDA-LOW-ITEM-AMT      TO PET-IIIAAA-INT-FEE-ITEM
           ELSE
              EVALUATE TRUE                                             03.31
                WHEN PET-VALID-RETURN                                   03.31
                  COMPUTE PET-IIIAAA-INT-FEE-AMT =
                      KDA-LOW-RATE-AMT * BASCRATE-RD-IIIAAA-MCSB-RATE
                  COMPUTE PET-IIIAAA-INT-FEE-ITEM =
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-IIIAAA-MCSB-RATE
                WHEN OTHER
                  COMPUTE PET-IIIAAA-INT-FEE-AMT =
                      KDA-LOW-RATE-AMT * BASCRATE-RD-IIIAAA-MCBS-RATE
                  COMPUTE PET-IIIAAA-INT-FEE-ITEM =
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-IIIAAA-MCBS-RATE
              END-EVALUATE
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                    C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC
                    C-TYPER  PET-IIIAAA-INT-FEE-AMT
                    C-TYPEEND
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                    C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC
                    C-TYPER  PET-IIIAAA-INT-FEE-ITEM
                    C-TYPEEND
           END-IF.
      *
       I-102-EXIT.
           EXIT.
      *
       I-103-PRIVATE-INCENTIVES.
      *
      * CHECK FOR ALL PRIVATE LABEL TRANSACTIONS
      *
           IF KDA-CHD-IS-VALID-PD                                       02.29
              MOVE KDA-CHD-PD-NETWORK-TYPE                              02.29
                                         TO PET-DEBIT-NETWORK-ID        02.29
              GO TO I-103-PIN-DEBIT-NETWORK.                            02.29
      *                                                                 02.29
           MOVE '0103'                   TO WS-PLAN-CODE.               02.29
           PERFORM D-500-SEARCH-PLAN-PACKAGE                            02.29
              THRU D-500-EXIT.                                          02.29
      *                                                                 02.29
           IF WS-PLAN-CODE-FOUND-SW = 'N'                               02.29
              MOVE ONE-AST               TO RCL-1-ACCT-NO-ERR-IND       02.29
              MOVE 'Y'                   TO PET-SUS-FLAG                02.29
              MOVE 289                   TO ER-CD-3-DIG(ER-INDX)        02.29
              SET ER-INDX UP BY 1                                       02.29
              MOVE '0000'                TO KDA-ORIG-PLAN-CODE-X        02.29
           ELSE                                                         02.29
              MOVE '0103'                TO KDA-ORIG-PLAN-CODE-X        02.29
           END-IF.                                                      02.29
      *                                                                 02.29
           GO TO I-103-EXIT.                                            02.29
      *                                                                 02.29
       I-103-PIN-DEBIT-NETWORK.                                         02.29
      *                                                                 02.29
           IF KDA-CHD-IS-PD-MAESTRO OR                                  02.92
              KDA-CHD-IS-PD-INTERLINK                                   02.92
              MOVE MIS3-PD-CROSS-BDR     TO KDA-CHD-PD-X-BDR            02.92
                                            PET-PDN-X-BDR               02.92
              IF NOT KDA-CHD-IS-PD-X-VLD                                02.92
                 MOVE ' '                TO KDA-CHD-PD-X-BDR            02.92
                                            PET-PDN-X-BDR               02.92
              END-IF                                                    02.52
           ELSE                                                         02.52
              MOVE ' '                   TO KDA-CHD-PD-X-BDR            02.92
           END-IF.                                                      02.52
      *                                                                 02.52
           IF KDA-CHD-IS-PD-INTERLINK                                   02.52
              MOVE MIS3-INTERLINK-REIMB  TO KDA-CHD-PD-INTERLINK-REIMB  02.53
                                            PET-PDN-INTERLINK-REIMB     02.76
              IF NOT KDA-CHD-IS-PD-IR-VALID                             02.52
                 MOVE SPACE              TO KDA-CHD-PD-INTERLINK-REIMB  02.52
                                            PET-PDN-INTERLINK-REIMB     02.76
              END-IF                                                    02.52
           ELSE                                                         02.52
              MOVE SPACE                 TO KDA-CHD-PD-INTERLINK-REIMB  02.52
           END-IF.                                                      02.52
      *                                                                 02.53
           IF KDA-CHD-IS-PD-PULSE-ANY                                   02.53
              MOVE MIS3-PULSE-REGIST-IND TO KDA-CHD-PD-PULSE-REGIST-IND 02.53
                                            PET-PDN-PULSE-REGIST-IND    02.76
              IF NOT KDA-CHD-IS-PD-PULSE-REG-VALID                      02.53
                 MOVE 'N'                TO KDA-CHD-PD-PULSE-REGIST-IND 02.53
                                            PET-PDN-PULSE-REGIST-IND    02.76
              END-IF                                                    02.53
           ELSE                                                         02.53
              MOVE 'N'                   TO KDA-CHD-PD-PULSE-REGIST-IND 02.53
           END-IF.                                                      02.53
      *                                                                 02.53
           IF KDA-CHD-IS-PD-STAR-ANY                                    02.53
              MOVE MIS3-STAR-BILLPAY-IND TO KDA-CHD-PD-STAR-BILLPAY-IND 02.53
                                            PET-PDN-STAR-BILLPAY-IND    02.76
              IF NOT KDA-CHD-IS-PD-STAR-BPAY-VALID                      02.53
                 MOVE 'N'                TO KDA-CHD-PD-STAR-BILLPAY-IND 02.53
                                            PET-PDN-STAR-BILLPAY-IND    02.76
              END-IF                                                    02.53
              MOVE MIS3-STAR-ITX-GRP-ID  TO PET-PDN-STAR-ITX-GRP-ID     02.76
           ELSE                                                         02.53
              MOVE 'N'                   TO KDA-CHD-PD-STAR-BILLPAY-IND 02.53
           END-IF.                                                      02.53
      *                                                                 02.76
           MOVE MIS3-PD-PREPAID-IND      TO KDA-CHD-PD-PREPAID-IND.     02.92
           IF KDA-CHD-IS-PD-PREPAID-VALID                               02.92
              MOVE KDA-CHD-PD-PREPAID-IND TO PET-PDN-PD-PREPAID-IND     02.92
           ELSE                                                         02.92
              MOVE SPACES                TO KDA-CHD-PD-PREPAID-IND      02.92
                                            PET-PDN-PD-PREPAID-IND      02.92
           END-IF.                                                      02.92
      *                                                                 02.92
           MOVE MIS3-PD-CNVC-PYMNT-IND   TO KDA-CHD-PD-CNVC-PAY-IND.    02.92
           IF KDA-CHD-IS-PD-CNVC-PAY-VALID                              02.92
              MOVE KDA-CHD-PD-CNVC-PAY-IND TO PET-PDN-PD-CNVC-PAY-IND   02.92
           ELSE                                                         02.92
              MOVE SPACES                TO KDA-CHD-PD-CNVC-PAY-IND     02.92
                                            PET-PDN-PD-CNVC-PAY-IND     02.92
           END-IF.                                                      02.92
      *                                                                 02.92
           MOVE MIS3-PD-VOLUME-TIER-IND  TO KDA-CHD-PD-NET-VOL-TIER-IND.02.92
           IF (KDA-CHD-IS-PD-ACCEL AND KDA-CHD-IS-PD-VT-ACCEL) OR       02.92
              (KDA-CHD-IS-PD-CU-24 AND KDA-CHD-IS-PD-VT-CU24) OR        02.92
              (KDA-CHD-IS-PD-MAESTRO AND KDA-CHD-IS-PD-VT-MAESTRO) OR   02.92
              (KDA-CHD-IS-PD-SHAZAM AND KDA-CHD-IS-PD-VT-SHAZAM) OR     02.92
              (KDA-CHD-IS-PD-NYCE-ANY AND KDA-CHD-IS-PD-VT-NYCE) OR     02.92
              (KDA-CHD-IS-PD-PULSE-ANY AND KDA-CHD-IS-PD-VT-PULSE) OR   02.92
              (KDA-CHD-IS-PD-STAR-ANY AND KDA-CHD-IS-PD-VT-STAR)        02.92
              MOVE KDA-CHD-PD-NET-VOL-TIER-IND TO                       02.92
                                            PET-PDN-PD-NET-VOL-TIER     02.92
           ELSE                                                         02.92
              MOVE SPACES                TO KDA-CHD-PD-NET-VOL-TIER-IND 02.92
                                            PET-PDN-PD-NET-VOL-TIER     02.92
           END-IF.                                                      02.92
      *                                                                 02.92
           MOVE MIS3-PD-NETW-CRD-TYP-IND  TO                            02.92
                                     KDA-CHD-PD-NET-CARD-TYPE-IND.      02.92
           IF (KDA-CHD-IS-PD-ACCEL AND KDA-CHD-IS-PD-CT-ACCEL) OR       02.92
              (KDA-CHD-IS-PD-JEANIE AND KDA-CHD-IS-PD-CT-JEANIE) OR     02.92
              (KDA-CHD-IS-PD-NYCE-ANY AND KDA-CHD-IS-PD-CT-NYCE) OR     02.92
              (KDA-CHD-IS-PD-PULSE-ANY AND KDA-CHD-IS-PD-CT-PULSE) OR   02.92
              (KDA-CHD-IS-PD-INTERLINK AND                              02.92
                                       KDA-CHD-IS-PD-CT-INTERLINK) OR   02.92
              (KDA-CHD-IS-PD-STAR-ANY AND KDA-CHD-IS-PD-CT-STAR) OR     02.95
              (KDA-CHD-IS-PD-VISA AND KDA-CHD-IS-PD-CT-VISA-DB-BUS)     02.95
              MOVE KDA-CHD-PD-NET-CARD-TYPE-IND TO                      02.92
                                          PET-PDN-PD-NET-CARD-TYPE      02.92
           ELSE                                                         02.92
              MOVE SPACES             TO KDA-CHD-PD-NET-CARD-TYPE-IND   02.92
                                         PET-PDN-PD-NET-CARD-TYPE       02.92
           END-IF.                                                      02.92
      *                                                                 02.92
           MOVE MIS3-PD-ECOMM-IND TO                                    02.92
                                     KDA-CHD-PD-ECOM-IND.               02.92
           IF KDA-CHD-IS-PD-ECOM-VALID                                  02.92
              MOVE KDA-CHD-PD-ECOM-IND TO                               02.92
                                          PET-PDN-PD-ECOM-IND           02.92
           ELSE                                                         02.92
              MOVE SPACES             TO KDA-CHD-PD-ECOM-IND            02.92
                                         PET-PDN-PD-ECOM-IND            02.92
           END-IF.                                                      02.92
      *                                                                 02.92
           MOVE MIS3-PD-PIN-IND          TO PET-PDN-PD-PIN-IND.         02.76
           MOVE MIS3-PD-AUTH-RETR-REF    TO PET-PDN-AUTH-RETR-REF.      02.76
           MOVE MIS3-PD-PROCESS-CODE     TO PET-PDN-PROCESS-CODE.       02.76
           MOVE MIS3-PD-FNS              TO PET-PDN-FNS.                02.76
           MOVE MIS3-PD-ABA-ROUTE-NO     TO PET-PDN-ABA-ROUTE-NO.       02.76
           MOVE MIS3-PD-REG-IND          TO PET-PDN-PD-REG-IND.         02.81
      *                                                                 02.53
           PERFORM Z99PU-CALL-BAS110PU                                  02.51
              THRU Z99PU-EXIT.                                          02.51
      *                                                                 02.29
           IF PET-RATE-FLAG = 'X' AND                                   02.92
             (NOT PARM-IS-1-SIDED) AND                                  03.31
             (KDA-IS-PASS-THRU-AC OR KDA-IS-PASS-THRU-AF OR             02.92
              KDA-IS-PASS-THRU-AK OR KDA-IS-PASS-THRU-CU OR             02.92
              KDA-IS-PASS-THRU-IL OR KDA-IS-PASS-THRU-JN OR             02.92
              KDA-IS-PASS-THRU-MS OR KDA-IS-PASS-THRU-NT OR             02.92
              KDA-IS-PASS-THRU-NY OR KDA-IS-PASS-THRU-PU OR             02.92
              KDA-IS-PASS-THRU-SZ OR KDA-IS-PASS-THRU-ST OR             02.92
              KDA-IS-PASS-THRU-QT OR KDA-IS-PASS-THRU-PL OR             02.92
              KDA-IS-PASS-THRU-VD)                                      02.92
                 MOVE KDA-ORIG-PLAN-CODE TO KDA-PLAN-QUAL-CODE          02.29
                                            GPR-NEW-PLAN                02.38
                 EVALUATE TRUE                                          02.92
                    WHEN KDA-IS-PASS-THRU-AC                            02.92
                       MOVE 0170         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-AF                            02.92
                       MOVE 0171         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-AK                            02.92
                       MOVE 0172         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-IL                            02.92
                       MOVE 0173         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-CU                            02.92
                       MOVE 0174         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-JN                            02.92
                       MOVE 0175         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-MS                            02.92
                       MOVE 0176         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-NT                            02.92
                       MOVE 0177         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-SZ                            02.92
                       MOVE 0178         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-NY                            02.92
                       MOVE 0179         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-PU                            02.92
                       MOVE 0180         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-ST                            02.92
                       MOVE 0181         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-QT                            02.92
                       MOVE 0187         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-PL                            02.92
                       MOVE 0188         TO GPR-FROM-PLAN               02.92
                    WHEN KDA-IS-PASS-THRU-VD                            02.92
                       MOVE 0189         TO GPR-FROM-PLAN               02.92
                 END-EVALUATE                                           02.92
                 PERFORM S-500-AUTO-GEN-PLAN                            02.38
                    THRU S-500-EXIT                                     02.38
                 IF GPR-FROM-PLAN = 0170 OR 0171 OR 0172 OR 0173 OR     02.92
                                    0174 OR 0175 OR 0176 OR 0177 OR     02.92
                                    0178 OR 0179 OR 0180 OR 0181 OR     02.92
                                    0187 OR 0188 OR 0189                02.92
                    MOVE 'A'             TO RCL-10-POST-PLAN-ADD-IND    02.95
                 ELSE                                                   02.38
                    MOVE 'T'             TO RCL-10-POST-PLAN-ADD-IND    02.95
                 END-IF                                                 02.38
           ELSE                                                         02.29
              MOVE SPACE                 TO PET-RATE-FLAG               02.29
           END-IF.                                                      02.29
      *                                                                 02.29
           IF KDA-LOW-RATE-AMT = +0 OR                                  02.29
              KDA-LOW-RATE-AMT = +999999999999.999                      02.29
                 GO TO I-103-EXIT                                       02.29
           END-IF.                                                      02.29
      *                                                                 02.29
           IF PET-REIMB-CURR-CODE = +840                                02.29
              MOVE KDA-LOW-RATE-AMT      TO PET-REIMB-INT-FEE-AMT       02.29
              MOVE KDA-LOW-ITEM-AMT      TO PET-REIMB-INT-FEE-ITEM      02.29
           ELSE                                                         02.29
              EVALUATE TRUE                                             03.31
                WHEN PET-VALID-RETURN                                   03.31
                  COMPUTE PET-REIMB-INT-FEE-AMT =                       02.29
                      KDA-LOW-RATE-AMT * BASCRATE-RD-REIMB-MCSB-RATE    02.29
                  COMPUTE PET-REIMB-INT-FEE-ITEM =                      02.29
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-REIMB-MCSB-RATE    02.29
                WHEN OTHER                                              02.29
                  COMPUTE PET-REIMB-INT-FEE-AMT =                       02.29
                      KDA-LOW-RATE-AMT * BASCRATE-RD-REIMB-MCBS-RATE    02.29
                  COMPUTE PET-REIMB-INT-FEE-ITEM =                      02.29
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-REIMB-MCBS-RATE    02.29
              END-EVALUATE                                              02.29
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY                  02.29
                    C-TYPED  BASCRATE-SD-REIMB-CURR-DEC                 02.29
                    C-TYPER  PET-REIMB-INT-FEE-AMT                      02.29
                    C-TYPEEND                                           02.29
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY                  02.29
                    C-TYPED  BASCRATE-SD-REIMB-CURR-DEC                 02.29
                    C-TYPER  PET-REIMB-INT-FEE-ITEM                     02.29
                    C-TYPEEND                                           02.29
           END-IF.                                                      02.29
      *                                                                 02.29
           IF PET-IIIAAA-CURR-CODE = +840                               02.29
              MOVE KDA-LOW-RATE-AMT      TO PET-IIIAAA-INT-FEE-AMT      02.29
              MOVE KDA-LOW-ITEM-AMT      TO PET-IIIAAA-INT-FEE-ITEM     02.29
           ELSE                                                         02.29
              EVALUATE TRUE                                             03.31
                WHEN PET-VALID-RETURN                                   03.31
                  COMPUTE PET-IIIAAA-INT-FEE-AMT =                      02.29
                      KDA-LOW-RATE-AMT * BASCRATE-RD-IIIAAA-MCSB-RATE   02.29
                  COMPUTE PET-IIIAAA-INT-FEE-ITEM =                     02.29
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-IIIAAA-MCSB-RATE   02.29
                WHEN OTHER                                              02.29
                  COMPUTE PET-IIIAAA-INT-FEE-AMT =                      02.29
                      KDA-LOW-RATE-AMT * BASCRATE-RD-IIIAAA-MCBS-RATE   02.29
                  COMPUTE PET-IIIAAA-INT-FEE-ITEM =                     02.29
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-IIIAAA-MCBS-RATE   02.29
              END-EVALUATE                                              02.29
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY                  02.29
                    C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC                02.29
                    C-TYPER  PET-IIIAAA-INT-FEE-AMT                     02.29
                    C-TYPEEND                                           02.29
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY                  02.29
                    C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC                02.29
                    C-TYPER  PET-IIIAAA-INT-FEE-ITEM                    02.29
                    C-TYPEEND                                           02.29
           END-IF.                                                      02.29
      *                                                                 02.29
       I-103-EXIT.
           EXIT.
      *
       I-104-AMEX-INCENTIVES.
      *
      * CHECK FOR ALL AMEX TRANSACTIONS
      *
           IF MR1-VALID-CASH                                            03.31
              IF MR1-VALID-MIS3-TRAN                                    03.31
                 MOVE ONE-AST            TO RCL-1-TRANSCODE
              ELSE
                 MOVE ONE-AST            TO RF1-1-TRANSCODE
              END-IF
              MOVE 84                    TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1
           END-IF.
      *
           MOVE SPACE                    TO INVALID-ACCT-SW.
           IF WS-BATCH-IS-AMX-REJECT                                    02.29
              MOVE ONE-AST               TO RCL-1-ACCT-NO-ERR-IND       02.29
              MOVE 51                    TO ER-CD (ER-INDX)             02.60
              MOVE 'Y'                   TO PET-SUS-FLAG                02.29
                                            INVALID-ACCT-SW             02.29
              SET ER-INDX UP BY 1                                       02.29
              GO TO I-104-EXIT.                                         02.29
      *
           IF MR1-VALID-RETURN                                          03.31
              MOVE ZEROS                 TO MIS3-AX-TRANS-IDENT-X       02.53
           END-IF.                                                      02.46
           IF MIS3-AX-TRANS-IDENT-X = SPACES                            02,53
              MOVE '?'                   TO RRD-AMX-TRANS-IDENT-ERR-IND
              MOVE ZEROS                 TO MIS3-AX-TRANS-IDENT-X       02.53
           END-IF.
           MOVE MIS3-AX-TRANS-IDENT-X    TO RRD-AMX-TRANS-IDENT-X.      02.53
           IF MIS3-AX-TRANS-IDENT-X NOT NUMERIC
              MOVE ONE-AST               TO RRD-AMX-TRANS-IDENT-ERR-IND
              MOVE 218                   TO ER-CD-3-DIG(ER-INDX)
              MOVE 'Y'                   TO PET-SUS-FLAG
              SET ER-INDX UP BY 1
           ELSE
              MOVE MIS3-AX-TRANS-IDENT   TO PET-TRANS-IDNTFIER          02.53
           END-IF.
           MOVE RRD-AMX-DATA             TO RCL-2-OPTIONAL-DATA.
           MOVE RESET-RRD-AMX-DATA       TO RRD-AMX-DATA.
      *
           MOVE KDA-AX-VOL-DISC-CODE     TO RAX-1-VOL-DISC-CODE.        02.68
      *                                                                 02.68
           IF HOLD-AMEX-SE = ZEROS
              MOVE ONE-AST               TO RAX-1-SE-ERR-IND
              MOVE 202                   TO ER-CD-3-DIG(ER-INDX)
              MOVE 'Y'                   TO PET-SUS-FLAG
              SET ER-INDX UP BY 1
           END-IF.
           MOVE HOLD-AMEX-SE             TO PET-AMEX-SE
                                            RAX-1-SE.
      *
           IF NOT VALID-AMEX-SE-FC
              MOVE ONE-AST               TO RAX-1-SE-FC-ERR-IND
              MOVE 209                   TO ER-CD-3-DIG(ER-INDX)
              MOVE 'Y'                   TO PET-SUS-FLAG
              SET ER-INDX UP BY 1
           END-IF.
           MOVE HOLD-AMEX-SE-FC          TO PET-AMEX-SE-FC
                                            RAX-1-SE-FC.
      *
           PERFORM C-384-CHECK-AMEX-ADDENDUM                            02.63
              THRU C-384-EXIT.                                          02.63
      *                                                                 02.63
           IF HOLD-MERCH-ID NOT = SPACES AND                            03.16A
              HOLD-MERCH-ID NOT = '000000000000000'                     03.16A
              MOVE HOLD-MERCH-ID         TO PET-AMEX-MRCH-LOC-ID        03.16A
                                            RAX-1-MRCH-LOC-ID           03.16A
           ELSE                                                         03.16A
              MOVE PET-MERCH-NMBR        TO WS-ACCOUNT                  03.16A
              MOVE WS-ACCOUNT-MID (2:9)  TO PET-AMEX-MRCH-LOC-ID(7:9)   03.16A
              MOVE HLD-BANK-KEY          TO WS-ACCOUNT-INST             03.16A
              MOVE WS-ACCOUNT-INST       TO PET-AMEX-MRCH-LOC-ID(1:6)   03.16A
              MOVE PET-AMEX-MRCH-LOC-ID  TO RAX-1-MRCH-LOC-ID           03.16A
           END-IF.                                                      03.16A
      *
           MOVE ZEROS                    TO KDA-PROCESS-CODE.           02.53
           MOVE '?'                      TO RCL-5-PROC-CD-ERR-IND.      02.53
           IF MR1-VALID-RETURN                                          03.31
              MOVE 20                    TO KDA-PC-TRAN-TYPE            02.53
           END-IF.                                                      02.53
           MOVE KDA-PROCESS-CODE-X       TO RCL-5-PROC-CD
                                            PET-AMEX-PROC-CD.
      *
           IF MR1-VALID-MIS3-TRAN                                       03.56
              MOVE MIS3-AX-ECI           TO PET-AMEX-ECI                03.56
                                            KDA-AX-ECI                  03.56
                                            RAX-2-ECI                   03.56
              IF NOT KDA-AX-ECI-VALID                                   03.56
                 MOVE ONE-AST            TO RAX-2-ECI-ERR-IND           03.56
                 MOVE 168                TO ER-CD-3-DIG(ER-INDX)        03.56
                 MOVE 'Y'                TO PET-SUS-FLAG                03.56
                 SET ER-INDX UP BY 1                                    03.56
              END-IF                                                    03.56
           END-IF.                                                      03.56
      *                                                                 03.56
           PERFORM I-104A-AMEX-POS-DATA-CODES THRU I-104A-EXIT.         02.95
      *                                                                 02.95
           IF MIS3-AX-EXTEND-PAY-X = SPACES                             02.53
              MOVE '01'                  TO MIS3-AX-EXTEND-PAY-X        02.53
              MOVE '?'                   TO RAX-2-EXTEND-PAY-ERR-IND
           END-IF.
           MOVE MIS3-AX-EXTEND-PAY-X     TO PET-AMEX-EXTEND-PAY-X       02.53
                                            KDA-AMEX-EXTEND-PAY
                                            RAX-2-EXTEND-PAY.
           IF NOT KDA-VC-AX-EXTEND-PAY
              MOVE ONE-AST               TO RAX-2-EXTEND-PAY-ERR-IND
              MOVE 233                   TO ER-CD-3-DIG(ER-INDX)
              MOVE 'Y'                   TO PET-SUS-FLAG
              SET ER-INDX UP BY 1
           END-IF.
      *
           MOVE MIS3-AX-MEDIA-CD         TO PET-AMEX-MEDIA-CD           02.53
                                            KDA-AMEX-MEDIA-CD
                                            RAX-2-MEDIA-CD.
           IF NOT KDA-VC-AX-MEDIA-CD
              MOVE ONE-AST               TO RAX-2-MEDIA-CD-ERR-IND
              MOVE 234                   TO ER-CD-3-DIG(ER-INDX)
              MOVE 'Y'                   TO PET-SUS-FLAG
              SET ER-INDX UP BY 1
           END-IF.
      *
           MOVE MIS3-AX-SUB-MTHD         TO PET-AMEX-SUB-MTHD           02.53
                                            KDA-AMEX-SUB-MTHD
                                            RAX-2-SUB-MTHD.
           IF NOT KDA-VC-AX-SUB-MTHD
              MOVE ONE-AST               TO RAX-2-SUB-MTHD-ERR-IND
              MOVE 235                   TO ER-CD-3-DIG(ER-INDX)
              MOVE 'Y'                   TO PET-SUS-FLAG
              SET ER-INDX UP BY 1
           END-IF.
      *                                                                 02.37
      *  DEFAULT IS '1'. SET IND TO '1' IF VALID VALUE NOT RECEIVED     02.37
           MOVE MIS3-AX-DESCR-FORMAT-IND TO WS-AX-DESCR-FORMAT-IND.     02.39
           IF NOT WS-VALID-AX-DESCR-FORMAT-IND                          02.37
              MOVE '1'                   TO WS-AX-DESCR-FORMAT-IND.     02.37
      *                                                                 02.37
      *  THE CONTENTS PASSED IN 'MIS3-TELE-NUM' WILL BE TREATED AS THE  02.37
      *  #1 HEIRARCHY FIELD.   CAPTURE 'MIS3-TELE-NUM' FIELD CONTENT:   02.37
      *                                                                 02.37
           IF WS-VALID-AX-DESCR-FORMAT-1-2                              02.37
              IF MIS3-TELE-NUM(1:10) NOT = SPACES                       02.37
                 IF HLD-INET-COUNTRY = 'CAN' OR 'USA'                   02.37
                    IF (MIS3-TELE-NUM(1:10) NUMERIC)     AND            02.37
                       (MIS3-TELE-NUM(1:3) NOT = ZEROS)  AND            02.37
                       (MIS3-TELE-NUM(4:3) NOT = ZEROS)                 02.37
                          MOVE MIS3-TELE-NUM(1:10)                      02.37
                                         TO KDA-CUST-SVC-PHONE          02.37
                          MOVE '-'       TO WS-US-CAN-CS-PHONE(4:1)     02.37
                                            WS-US-CAN-CS-PHONE(8:1)     02.37
                          MOVE MIS3-TELE-NUM(1:3)                       02.37
                                         TO WS-US-CAN-CS-PHONE(1:3)     02.37
                          MOVE MIS3-TELE-NUM(4:3)                       02.37
                                         TO WS-US-CAN-CS-PHONE(5:3)     02.37
                          MOVE MIS3-TELE-NUM(7:4)                       02.37
                                         TO WS-US-CAN-CS-PHONE(9:4)     02.37
                    END-IF                                              02.37
                 ELSE                                                   02.37
                    MOVE MIS3-TELE-NUM(1:10)                            02.37
                                         TO KDA-CUST-SVC-PHONE          02.37
                 END-IF                                                 02.37
              END-IF                                                    02.37
           ELSE                                                         02.37
              IF WS-VALID-AX-DESCR-FORMAT-3-4                           02.37
                 IF MIS3-TELE-NUM NOT = SPACES                          02.37
                    MOVE MIS3-TELE-NUM   TO WS-URL                      02.37
                 END-IF                                                 02.37
              ELSE                                                      02.37
                 IF MIS3-TELE-NUM NOT = SPACES                          02.37
                    MOVE MIS3-TELE-NUM   TO WS-EMAIL                    02.37
                 END-IF                                                 02.37
              END-IF                                                    02.37
           END-IF.                                                      02.37
      *                                                                 02.37
      *  LOAD AMEX-CONTACT BASED ON FORMAT-IND.                         02.37
      *                                                                 02.37
           MOVE SPACES                   TO PET-AMEX-CONTACT.           1.93
           IF WS-VALID-AX-DESCR-FORMAT-1-2                              02.37
              MOVE WS-US-CAN-CS-PHONE    TO PET-AMEX-CONTACT            02.37
           ELSE                                                         02.37
              IF WS-VALID-AX-DESCR-FORMAT-3-4                           02.37
                 MOVE WS-URL             TO PET-AMEX-CONTACT            02.37
              ELSE                                                      02.37
                 MOVE WS-EMAIL           TO PET-AMEX-CONTACT            02.37
              END-IF                                                    02.37
           END-IF.                                                      02.37
           IF PET-AMEX-CONTACT NOT = SPACES                             02.37
             GO TO I-104-AX-CONTACT-DONE.                               02.37
      *                                                                 02.37
           IF WS-VALID-AX-DESCR-FORMAT-3-OR-5                           02.37
              MOVE WS-US-CAN-CS-PHONE    TO PET-AMEX-CONTACT            02.37
           ELSE                                                         02.37
              IF WS-VALID-AX-DESCR-FORMAT-1-OR-6                        02.37
                 MOVE WS-URL             TO PET-AMEX-CONTACT            02.37
              ELSE                                                      02.37
                 MOVE WS-EMAIL           TO PET-AMEX-CONTACT            02.37
              END-IF                                                    02.37
           END-IF.                                                      02.37
           IF PET-AMEX-CONTACT NOT = SPACES                             02.37
             GO TO I-104-AX-CONTACT-DONE.                               02.37
      *                                                                 02.37
           IF WS-VALID-AX-DESCR-FORMAT-4-OR-6                           02.37
              MOVE WS-US-CAN-CS-PHONE    TO PET-AMEX-CONTACT            02.37
           ELSE                                                         02.37
              IF WS-VALID-AX-DESCR-FORMAT-2-OR-5                        02.37
                 MOVE WS-URL             TO PET-AMEX-CONTACT            02.37
              ELSE                                                      02.37
                 MOVE WS-EMAIL           TO PET-AMEX-CONTACT            02.37
              END-IF                                                    02.37
           END-IF.                                                      02.37
      *                                                                 02.37
       I-104-AX-CONTACT-DONE.                                           02.37
      *                                                                 02.37
           IF PET-AMEX-CONTACT NOT = SPACES                             02.37
              IF PET-AMEX-CONTACT(1:1) = SPACE                          02.37
                 MOVE SPACES             TO HOLD2-FIELD                 02.37
                 MOVE +1                 TO START-SUB                   02.37
                 MOVE +40                TO END-SUB                     02.37
                                            END2-SUB                    02.37
                 MOVE PET-AMEX-CONTACT   TO HOLD-FIELD                  02.37
                 PERFORM C-381-EDIT-MA-FIELDS                           02.37
                    THRU C-381-EXIT                                     02.37
                 MOVE HOLD2-FIELD        TO PET-AMEX-CONTACT            02.37
              END-IF                                                    02.37
           END-IF.                                                      02.37
           MOVE PET-AMEX-CONTACT         TO RAX-2-CONTACT.
      *                                                                 03.16A
           IF (WS-MRCH-IS-AMX-EAP AND                                   03.16A
               BE-AMEX-EAP-SUBMITTER-ID = SPACES) OR                    03.16A
              (WS-MRCH-IS-AMX-SETL AND                                  03.16A
               BE-AMEX-1PT-SUBMITTER-ID = SPACES) OR                    03.16A
              (WS-MRCH-IS-AMX-NON-SETL AND                              03.16A
               BE-AMEX-ESA-SUBMITTER-ID = SPACES)                       03.16A
                 MOVE 17                 TO ER-CD-3-DIG(ER-INDX)        03.16A
                 MOVE 'Y'                TO PET-SUS-FLAG                03.16A
                 SET ER-INDX UP BY 1                                    03.16A
           END-IF.                                                      03.16A
      *                                                                 02.47
           MOVE MIS3-AX-INV-REF-NUM      TO PET-AMEX-INV-REF-NUM        03.29
                                            RAX-3-INV-REF-NBR.          03.29
      *
           MOVE HOLD-MERCH-ID            TO PET-AMEX-SA-MRCH-ID.        02.61
      *                                                                 03.34F
           IF NME-AMEX-SETL-PGM = SPACE                                 03.38
              IF WS-MRCH-IS-AMX-NON-SETL                                03.38
                 MOVE BE-AMEX-ESA-SUBMITTER-ID                          03.38
                                         TO PET-AMEX-SUBMITTER-ID       03.38
              ELSE                                                      03.38
                 IF WS-MRCH-IS-AMX-EAP                                  03.38
                    MOVE BE-AMEX-EAP-SUBMITTER-ID                       03.38
                                         TO PET-AMEX-SUBMITTER-ID       03.38
                 ELSE                                                   03.38
                    MOVE BE-AMEX-1PT-SUBMITTER-ID                       03.38
                                         TO PET-AMEX-SUBMITTER-ID       03.38
                 END-IF                                                 03.38
              END-IF                                                    03.38
           END-IF.                                                      03.38
           MOVE PET-AMEX-SUBMITTER-ID    TO RAX-3-SUBMIT-ID.            03.47
      *                                                                 03.47
           IF WS-NEW-AMX-PLAN-CODE-X NOT = SPACES                       03.47
              MOVE WS-NEW-AMX-PLAN-CODE  TO KDA-ORIG-PLAN-CODE          03.47
                                            KDA-PLAN-QUAL-CODE          03.47
           END-IF.                                                      03.47
      *                                                                 02.61
           IF PET-CARD-TYPE-NON-SETL AND                                03.47
              MIS3-AX-SETL-PGM-ID = SPACES                              03.47
              IF WS-NSC-NON-CLEAR-AX                                    03.47F
                 MOVE '0204'             TO WS-PLAN-CODE                03.47F
              ELSE                                                      03.47F
                 MOVE '0104'             TO WS-PLAN-CODE                03.47F
              END-IF                                                    03.47F
              PERFORM D-500-SEARCH-PLAN-PACKAGE                         03.47
                 THRU D-500-EXIT                                        03.47
              MOVE KDA-PLAN-QUAL-CODE    TO KDA-ORIG-PLAN-CODE.         03.47
      *                                                                 03.34F
           IF WS-MRCH-IS-INVALID-AMX                                    03.34F
           OR WS-MRCH-IS-AMX-NON-SETL                                   03.34F
              GO TO I-104-EXIT.                                         03.34F
      *                                                                 03.34F
           MOVE SPACES                   TO RCL-3-OPTIONAL-DATA
                                            RCL-4-OPTIONAL-DATA
                                            RCL-5-OPTIONAL-DATA.
      *                                                                 02.29
           IF WS-MRCH-IS-AMX-EAP                                        03.16A
              PERFORM Z99AE-CALL-BAS110AE                               03.16A
                 THRU Z99AE-EXIT                                        03.16A
           ELSE                                                         03.16A
              PERFORM Z99AU-CALL-BAS110AU                               03.16A
                 THRU Z99AU-EXIT                                        03.16A
           END-IF.                                                      03.16A
           IF PET-RATE-FLAG = 'X' AND                                   02.29
             (NOT PARM-IS-1-SIDED) AND                                  03.31
            ((WS-MRCH-IS-AMX-SETL AND KDA-IS-PASS-THRU-AX) OR           03.16A
             (WS-MRCH-IS-AMX-EAP  AND KDA-IS-PASS-THRU-AE))             03.16A
                 MOVE KDA-ORIG-PLAN-CODE TO KDA-PLAN-QUAL-CODE          02.29
                                            GPR-NEW-PLAN                02.38
                 IF WS-MRCH-IS-AMX-EAP                                  03.16A
                    MOVE 0154            TO GPR-FROM-PLAN               03.16A
                 ELSE                                                   03.16A
                    MOVE 0114            TO GPR-FROM-PLAN               03.16A
                 END-IF                                                 03.16A
                 PERFORM S-500-AUTO-GEN-PLAN                            02.38
                    THRU S-500-EXIT                                     02.38
                 IF GPR-FROM-PLAN = 0114 OR 0154                        03.16A
                    MOVE 'A'             TO RCL-10-POST-PLAN-ADD-IND    02.95
                 ELSE                                                   02.38
                    MOVE 'T'             TO RCL-10-POST-PLAN-ADD-IND    02.95
                 END-IF                                                 02.38
           ELSE                                                         02.29
              MOVE SPACE                 TO PET-RATE-FLAG               02.29
           END-IF.                                                      02.29
      *                                                                 02.29
       I-104-CALC-INT-FEE.                                              02.29
      *                                                                 02.29
           IF KDA-LOW-RATE-AMT = +0 OR                                  02.29
              KDA-LOW-RATE-AMT = +999999999999.999                      02.29
                 GO TO I-104-EXIT.                                      02.29
      *                                                                 02.29
           IF PET-VALID-CASH                                            03.31
              IF KDA-LOW-RATE-AMT NOT = +0                              02.29
                 COMPUTE KDA-LOW-RATE-AMT = KDA-LOW-RATE-AMT * -1       02.29
              END-IF                                                    02.29
              IF KDA-LOW-ITEM-AMT NOT = +0                              02.29
                 COMPUTE KDA-LOW-ITEM-AMT = KDA-LOW-ITEM-AMT * -1       02.29
              END-IF                                                    02.29
           END-IF.                                                      02.29
      *                                                                 02.29
           IF PET-REIMB-CURR-CODE = +840                                02.29
              MOVE KDA-LOW-RATE-AMT      TO PET-REIMB-INT-FEE-AMT       02.29
              MOVE KDA-LOW-ITEM-AMT      TO PET-REIMB-INT-FEE-ITEM      02.29
           ELSE                                                         02.29
              EVALUATE TRUE                                             03.31
                WHEN PET-VALID-RETURN                                   03.31
                  COMPUTE PET-REIMB-INT-FEE-AMT =                       02.29
                      KDA-LOW-RATE-AMT * BASCRATE-RD-REIMB-MCSB-RATE    02.29
                  COMPUTE PET-REIMB-INT-FEE-ITEM =                      02.29
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-REIMB-MCSB-RATE    02.29
                WHEN OTHER                                              02.29
                  COMPUTE PET-REIMB-INT-FEE-AMT =                       02.29
                      KDA-LOW-RATE-AMT * BASCRATE-RD-REIMB-MCBS-RATE    02.29
                  COMPUTE PET-REIMB-INT-FEE-ITEM =                      02.29
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-REIMB-MCBS-RATE    02.29
              END-EVALUATE                                              02.29
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY                  02.29
                    C-TYPED  BASCRATE-SD-REIMB-CURR-DEC                 02.29
                    C-TYPER  PET-REIMB-INT-FEE-AMT                      02.29
                    C-TYPEEND                                           02.29
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY                  02.29
                    C-TYPED  BASCRATE-SD-REIMB-CURR-DEC                 02.29
                    C-TYPER  PET-REIMB-INT-FEE-ITEM                     02.29
                    C-TYPEEND                                           02.29
           END-IF.                                                      02.29
      *                                                                 02.29
           IF PET-IIIAAA-CURR-CODE = +840                               02.29
              MOVE KDA-LOW-RATE-AMT      TO PET-IIIAAA-INT-FEE-AMT      02.29
              MOVE KDA-LOW-ITEM-AMT      TO PET-IIIAAA-INT-FEE-ITEM     02.29
           ELSE                                                         02.29
              EVALUATE TRUE                                             03.31
                WHEN PET-VALID-RETURN                                   03.31
                  COMPUTE PET-IIIAAA-INT-FEE-AMT =                      02.29
                      KDA-LOW-RATE-AMT * BASCRATE-RD-IIIAAA-MCSB-RATE   02.29
                  COMPUTE PET-IIIAAA-INT-FEE-ITEM =                     02.29
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-IIIAAA-MCSB-RATE   02.29
                WHEN OTHER                                              02.29
                  COMPUTE PET-IIIAAA-INT-FEE-AMT =                      02.29
                      KDA-LOW-RATE-AMT * BASCRATE-RD-IIIAAA-MCBS-RATE   02.29
                  COMPUTE PET-IIIAAA-INT-FEE-ITEM =                     02.29
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-IIIAAA-MCBS-RATE   02.29
              END-EVALUATE                                              02.29
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY                  02.29
                    C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC                02.29
                    C-TYPER  PET-IIIAAA-INT-FEE-AMT                     02.29
                    C-TYPEEND                                           02.29
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY                  02.29
                    C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC                02.29
                    C-TYPER  PET-IIIAAA-INT-FEE-ITEM                    02.29
                    C-TYPEEND                                           02.29
           END-IF.                                                      02.29
      *
       I-104-EXIT.
           EXIT.
      *
       I-104A-AMEX-POS-DATA-CODES.                                      02.95
      *                                                                 02.95
      * POPULATE AMEX POS DATA CODES AND PERFORM EDITING.               02.95
      *                                                                 02.95
           IF KDA-HAS-AX-EMV OR KDA-AX-EMV-HAD-ERRORS                   02.95
              GO TO I-104A-EXIT.                                        02.95
      *                                                                 02.95
           IF MIS3-AX-POS-DATA-CODES = SPACES                           02.95
              MOVE PET-AMEX-POS-DTA-CODE TO MIS3-AX-POS-DATA-CODES      02.95
           ELSE                                                         02.95
              MOVE MIS3-AX-POS-DATA-CODES                               02.95
                                         TO PET-AMEX-POS-DTA-CODE.      02.95
           MOVE MIS3-AX-POS-DATA-CODES   TO KDA-POS-DTA-CODE.           02.95
      *                                                                 02.95
           PERFORM                                                      02.95
             VARYING SUB1 FROM +1 BY +1                                 02.95
             UNTIL   SUB1 > +12                                         02.95
               MOVE KDA-POS-DTA-CODE(SUB1:1)                            02.95
                                         TO RAX-1-POS-DATA-CD(SUB1)     02.95
           END-PERFORM.                                                 02.95
      *                                                                 02.95
           MOVE 'N'                      TO WS-ERROR-SW.                02.95
           IF NOT KDA-VC-AX-CRD-DTA-INP-CAP                             02.95
              MOVE 'Y'                 TO WS-ERROR-SW                   02.95
              MOVE ONE-AST             TO RAX-1-POS-DATA-CD-ERR-IND(1). 02.95
           IF NOT KDA-VC-AX-CRDHLDR-ATHN-CAP                            02.95
              MOVE 'Y'                 TO WS-ERROR-SW                   02.95
              MOVE ONE-AST             TO RAX-1-POS-DATA-CD-ERR-IND(2). 02.95
           IF NOT KDA-VC-AX-CRD-CAPTURE-CAP                             02.95
              MOVE 'Y'                 TO WS-ERROR-SW                   02.95
              MOVE ONE-AST             TO RAX-1-POS-DATA-CD-ERR-IND(3). 02.95
           IF NOT KDA-VC-AX-OPER-ENV                                    02.95
              MOVE 'Y'                 TO WS-ERROR-SW                   02.95
              MOVE ONE-AST             TO RAX-1-POS-DATA-CD-ERR-IND(4). 02.95
           IF NOT KDA-VC-AX-CRDHLDR-PRSNT                               02.95
              MOVE 'Y'                 TO WS-ERROR-SW                   02.95
              MOVE ONE-AST             TO RAX-1-POS-DATA-CD-ERR-IND(5). 02.95
           IF NOT KDA-VC-AX-CRD-PRSNT                                   02.95
              MOVE 'Y'                 TO WS-ERROR-SW                   02.95
              MOVE ONE-AST             TO RAX-1-POS-DATA-CD-ERR-IND(6). 02.95
           IF NOT KDA-VC-AX-DTA-INP-MOD                                 02.95
              MOVE 'Y'                 TO WS-ERROR-SW                   02.95
              MOVE ONE-AST             TO RAX-1-POS-DATA-CD-ERR-IND(7). 02.95
           IF NOT KDA-VC-AX-CRDHLDR-ATHN-MTHD                           02.95
              MOVE 'Y'                 TO WS-ERROR-SW                   02.95
              MOVE ONE-AST             TO RAX-1-POS-DATA-CD-ERR-IND(8). 02.95
           IF NOT KDA-VC-AX-CRDHLDR-ATHN-ENT                            02.95
              MOVE 'Y'                 TO WS-ERROR-SW                   02.95
              MOVE ONE-AST             TO RAX-1-POS-DATA-CD-ERR-IND(9). 02.95
           IF NOT KDA-VC-AX-CRD-DTA-OUT-CAP                             02.95
              MOVE 'Y'                 TO WS-ERROR-SW                   02.95
              MOVE ONE-AST             TO RAX-1-POS-DATA-CD-ERR-IND(10).02.95
           IF NOT KDA-VC-AX-TRM-DTA-OUT-CAP                             02.95
              MOVE 'Y'                 TO WS-ERROR-SW                   02.95
              MOVE ONE-AST             TO RAX-1-POS-DATA-CD-ERR-IND(11).02.95
           IF NOT KDA-VC-AX-PIN-CAPTURE-CAP                             02.95
              MOVE 'Y'                 TO WS-ERROR-SW                   02.95
              MOVE ONE-AST             TO RAX-1-POS-DATA-CD-ERR-IND(12).02.95
           IF KDA-AX-ECI-TOKEN AND                                      03.56
              KDA-VC-CRD-PRSNT-Z                                        03.56
              IF KDA-VC-CRDHLDR-PRSNT-1 OR                              03.56
                 KDA-VC-CRDHLDR-PRSNT-2 OR                              03.56
                 KDA-VC-CRDHLDR-PRSNT-3 OR                              03.56
                 KDA-VC-CRDHLDR-PRSNT-S                                 03.56
                 CONTINUE                                               03.56
              ELSE                                                      03.56
                 MOVE 'Y'              TO WS-ERROR-SW                   03.56
                 MOVE ONE-AST          TO RAX-1-POS-DATA-CD-ERR-IND(05) 03.56
              END-IF                                                    03.56
              IF KDA-VC-DTA-INP-MOD-5                                   03.56
                 CONTINUE                                               03.56
              ELSE                                                      03.56
                 MOVE 'Y'              TO WS-ERROR-SW                   03.56
                 MOVE ONE-AST          TO RAX-1-POS-DATA-CD-ERR-IND(07) 03.56
              END-IF                                                    03.56
           END-IF.                                                      03.56
           IF KDA-AX-ECI-TOKEN AND                                      03.56
             (KDA-VC-CRDHLDR-PRSNT-4 OR                                 03.56
              KDA-VC-CRDHLDR-PRSNT-9)                                   03.56
              IF KDA-VC-CRD-PRSNT-0                                     03.56
                 CONTINUE                                               03.56
              ELSE                                                      03.56
                 MOVE 'Y'              TO WS-ERROR-SW                   03.56
                 MOVE ONE-AST          TO RAX-1-POS-DATA-CD-ERR-IND(06) 03.56
              END-IF                                                    03.56
           END-IF.                                                      03.56
      *                                                                 02.95
           IF ERROR-FOUND                                               02.95
              MOVE 'Y'                   TO PET-SUS-FLAG                02.95
              MOVE 241                   TO ER-CD-3-DIG(ER-INDX)        02.95
              SET ER-INDX UP BY 1.                                      02.95
      *                                                                 02.95
       I-104A-EXIT.                                                     02.95
           EXIT.                                                        02.95
      *                                                                 02.95
       I-104B-AMEX-SETL-PGM-ID.                                         03.30
      *                                                                 03.30
           MOVE SPACES TO WS-NEW-AMX-PLAN-CODE-X.                       03.47
           EVALUATE MIS3-AX-SETL-PGM-ID                                 03.30
               WHEN 'A'                                                 03.30
               WHEN 'O'                                                 03.30
               WHEN 'E'                                                 03.30
               WHEN 'X'                                                 03.30
                   MOVE MIS3-AX-SETL-PGM-ID   TO RAX-3-SETTLE-FLG       03.47
                                                 RAX-3-SETTLE-FLG-OUT   03.47
               WHEN OTHER                                               03.30
      * BOTH MIS3 AND NME SETL FLAGS ARE SPACES                         03.47
                   IF MIS3-AX-SETL-PGM-ID = NME-AMEX-SETL-PGM           03.47
                     MOVE MIS3-AX-SETL-PGM-ID   TO RAX-3-SETTLE-FLG     03.47
                                                   RAX-3-SETTLE-FLG-OUT 03.47
                   ELSE                                                 03.47
                     MOVE MIS3-AX-SETL-PGM-ID   TO RAX-3-SETTLE-FLG     03.47
                     MOVE NME-AMEX-SETL-PGM     TO RAX-3-SETTLE-FLG-OUT 03.47
                     MOVE '?'                TO RAX-3-SETTLE-FLG-ERR-IND03.47
                   END-IF                                               03.47
                   MOVE NME-AMEX-SETL-PGM TO MIS3-AX-SETL-PGM-ID        03.30
           END-EVALUATE.                                                03.30
      *                                                                 03.34F
           IF MIS3-AX-SETL-PGM-ID = SPACES                              03.47
              GO TO I-104B-AX-MERCHANT-TYPE-DONE.                       03.47
      *                                                                 03.47
           IF MIS3-AX-SETL-PGM-ID = NME-AMEX-SETL-PGM                   03.34F
              MOVE WS-SAVE-MRCH-AMX-TYPE     TO WS-MRCH-AMX-TYPE        03.34F
              MOVE WS-SAVE-AMX-PLAN-CODE-X   TO WS-NEW-AMX-PLAN-CODE-X  03.34F
              GO TO I-104B-AX-MERCHANT-TYPE-DONE.                       03.34F
      *                                                                 03.34F
           IF WS-NSC-NON-CLEAR-AX                                       03.39
               MOVE 'N'                      TO WS-MRCH-AMX-TYPE        03.34F
               MOVE '0204'                   TO WS-PLAN-CODE            03.34F
               PERFORM D-500-SEARCH-PLAN-PACKAGE                        03.34F
                  THRU D-500-EXIT                                       03.34F
           ELSE                                                         03.34F
               EVALUATE MIS3-AX-SETL-PGM-ID                             03.34F
                   WHEN 'E'                                             03.34F
                      MOVE 'E'                  TO WS-MRCH-AMX-TYPE     03.34F
                      MOVE '0154'               TO WS-PLAN-CODE         03.34F
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                      IF KDA-CAP-AMEX-X = SPACES OR '0000'              03.34G
                         CONTINUE                                       03.34G
                      ELSE                                              03.34G
                         MOVE 'Y'              TO WS-PLAN-CODE-FOUND-SW 03.34G
                      END-IF                                            03.34G
                   WHEN 'O'                                             03.34F
                      MOVE 'S'                  TO WS-MRCH-AMX-TYPE     03.34F
                      MOVE '0114'               TO WS-PLAN-CODE         03.34F
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                      IF KDA-CAP-AMEX-X = SPACES OR '0000'              03.34G
                         CONTINUE                                       03.34G
                      ELSE                                              03.34G
                         MOVE 'Y'              TO WS-PLAN-CODE-FOUND-SW 03.34G
                      END-IF                                            03.34G
                   WHEN 'A'                                             03.34F
                      MOVE 'N'                  TO WS-MRCH-AMX-TYPE     03.34F
                      MOVE '0104'               TO WS-PLAN-CODE         03.34F
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                   WHEN 'X'                                             03.34F
                      MOVE 'N'                  TO WS-MRCH-AMX-TYPE     03.34F
                      MOVE '0204'               TO WS-PLAN-CODE         03.34F
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                   WHEN '9'                                             03.34F
                      MOVE 'N'                 TO WS-PLAN-CODE-FOUND-SW 03.34F
               END-EVALUATE                                             03.34F
           END-IF.                                                      03.34F
           IF WS-PLAN-CODE-FOUND-SW = 'N'                               03.34F
              MOVE 'Z'                      TO WS-MRCH-AMX-TYPE         03.34F
              MOVE '0000'                   TO WS-NEW-AMX-PLAN-CODE-X   03.34F
           ELSE                                                         03.34F
              MOVE KDA-PLAN-QUAL-CODE       TO WS-NEW-AMX-PLAN-CODE     03.34F
           END-IF.                                                      03.34F
      *                                                                 03.34F
       I-104B-AX-MERCHANT-TYPE-DONE.                                    03.34F
      *                                                                 03.30
      *  'A' FOR ESA       (CLEAR, NON-SETTLE)                          03.30
      *  'O' FOR ONE POINT (CLEAR AND SETTLE)                           03.30
      *  'E' FOR EAP       (CLEAR AND SETTLE)                           03.30
      *  'X' IS USED FOR NON-CLEAR, NON-SETTLE                          03.30
      *                                                                 03.30
           EVALUATE MIS3-AX-SETL-PGM-ID                                 03.30
               WHEN 'A'                                                 03.30
                   MOVE BE-AMEX-ESA-SUBMITTER-ID                        03.30
                                               TO PET-AMEX-SUBMITTER-ID 03.30
               WHEN 'O'                                                 03.30
                   MOVE BE-AMEX-1PT-SUBMITTER-ID                        03.30
                                               TO PET-AMEX-SUBMITTER-ID 03.30
               WHEN 'E'                                                 03.30
                   MOVE BE-AMEX-EAP-SUBMITTER-ID                        03.30
                                               TO PET-AMEX-SUBMITTER-ID 03.30
               WHEN 'X'                                                 03.30
                   MOVE BE-AMEX-ESA-SUBMITTER-ID                        03.30
                                               TO PET-AMEX-SUBMITTER-ID 03.30
           END-EVALUATE.                                                03.30
      *                                                                 03.30
           MOVE MIS3-AX-SETL-PGM-ID            TO PET-AMEX-SETL-PGM-ID. 03.30
      *                                                                 03.30
       I-104B-EXIT.                                                     03.30
           EXIT.                                                        03.30
      *                                                                 03.30
       I-105-DISCOVER-INCENTIVES.
      *
           MOVE SPACE                    TO INVALID-ACCT-SW.
           MOVE HOLD-DISCOVER-NO         TO RDS-1-NO.                   03.39
           MOVE HOLD-DISCOVER-COUNTRY-A  TO RDS-1-MRCH-COUNTRY-A.       03.39
           MOVE HOLD-DISCOVER-COUNTRY-N  TO RDS-1-MRCH-COUNTRY-N.       03.39
           IF WS-BATCH-IS-DIS-REJECT
              MOVE ONE-AST               TO RCL-1-ACCT-NO-ERR-IND
              MOVE 52                    TO ER-CD (ER-INDX)             02.60
              MOVE 'Y'                   TO PET-SUS-FLAG
                                            INVALID-ACCT-SW
              SET ER-INDX UP BY 1
              GO TO I-105-EXIT.
           IF HOLD-DISCOVER-NO = ZEROS
              MOVE ONE-AST               TO RDS-1-NO-ERR-IND
              MOVE 249                   TO ER-CD-3-DIG(ER-INDX)
              MOVE 'Y'                   TO PET-SUS-FLAG
              SET ER-INDX UP BY 1
              GO TO I-105-EXIT.
      *                                                                 03.47
           IF PET-CARD-TYPE-DISCOVER-SETL                               03.47
           OR PET-CARD-TYPE-PAYPAL-SETL                                 03.47
              IF BE-DISCOVER-ACQUIRER-ID = ZEROES                       03.47
                 MOVE ONE-AST            TO RDS-3-ACQ-ID-ERR-IND        03.47
                 MOVE 251                TO ER-CD-3-DIG(ER-INDX)        03.47
                 MOVE 'Y'                TO PET-SUS-FLAG                03.47
                 SET ER-INDX UP BY 1.                                   03.47
      *                                                                 03.47
           IF PET-CARD-TYPE-NON-SETL AND                                03.39
             (NOT WS-NSC-NON-CLEAR-DS) AND                              03.47
              MIS3-DS-SETL-PGM-ID NOT = 'X'                             03.47
      *       IF HOLD-DISCOVER-PREFIX = ZEROS OR                        03.47F2
      *          BE-DISCOVER-CLIENT-ID = ZEROS                          03.47F2
      *          IF BE-DISCOVER-CLIENT-ID = ZEROS                       03.47F2
      *             MOVE ONE-AST         TO RDS-3-CLIENT-ID-ERR-IND     03.47F2
      *          END-IF                                                 03.47F2
              IF HOLD-DISCOVER-PREFIX = ZEROS                           03.47F2
                 MOVE ONE-AST            TO RDS-3-PREFIX-ERR-IND        03.47
                 MOVE 250                TO ER-CD-3-DIG(ER-INDX)        03.47
                 MOVE 'Y'                TO PET-SUS-FLAG                03.47
                 SET ER-INDX UP BY 1.                                   03.47
      *
           IF KDA-VC-DS-CRD-NOT-PRSNT                                   03.16D
              MOVE SPACES                      TO HLD-DESCR-CITY        03.16D
              IF KDA-CUST-SVC-PHONE > SPACES                            03.16D
                 MOVE KDA-CUST-SVC-PHONE       TO HLD-DESCR-CITY        03.16D
              ELSE                                                      03.16D
                IF KDA-PROPERTY-PHONE > SPACES                          03.16D
                   MOVE KDA-PROPERTY-PHONE     TO HLD-DESCR-CITY        03.16D
                ELSE                                                    03.16D
                   MOVE '000-000-0000 '        TO HLD-DESCR-CITY        03.16D
                END-IF                                                  03.16D
              END-IF                                                    03.16D
           END-IF.                                                      03.16D
           MOVE HLD-DESCR                TO PET-DESCR.
           IF PET-MERCH-NAME = SPACES
              MOVE ONE-AST               TO RCL-8-MRCH-NAME-ERR-IND
              MOVE 60                    TO ER-CD (ER-INDX)             02.60
              MOVE 'Y'                   TO PET-SUS-FLAG
                                            KDA-MRCH-NAME-ERR-SW
              SET ER-INDX UP BY 1
           END-IF.
           IF PET-MERCH-CITY = SPACES
              MOVE ONE-AST               TO RCL-8-MRCH-CITY-ERR-IND
              MOVE 61                    TO ER-CD (ER-INDX)             02.60
              MOVE 'Y'                   TO PET-SUS-FLAG
                                            KDA-MRCH-NAME-ERR-SW
              SET ER-INDX UP BY 1
           END-IF.
           IF HOLD-DISCOVER-COUNTRY-A = 'USA' AND
              HLD-ZIP-WORK = SPACES
                 MOVE ONE-AST            TO RCL-8-MRCH-ZIP-ERR-IND
                 MOVE 62                 TO ER-CD (ER-INDX)             02.60
                 MOVE 'Y'                TO PET-SUS-FLAG
                                            KDA-MRCH-NAME-ERR-SW
                 SET ER-INDX UP BY 1
           END-IF.
      *
           IF PET-CARD-TYPE-DISCOVER
           OR PET-CARD-TYPE-PAYPAL                                      03.47
              IF PET-VALID-CASH                                         03.31
                 MOVE 'CA'               TO PET-DS-TRAN-TYPE
              ELSE
                 IF PET-VALID-RETURN                                    03.31
                    MOVE 'RT'            TO PET-DS-TRAN-TYPE
                 ELSE
                    MOVE 'SA'            TO PET-DS-TRAN-TYPE
                 END-IF
              END-IF
           END-IF.
           MOVE PET-DS-TRAN-TYPE         TO RDS-1-TRAN-TYP.
      *
           MOVE BE-DISCOVER-ACQUIRER-ID  TO PET-DS-ACQUIRER-ID          03.47
                                            RDS-3-ACQ-ID.               03.47
           MOVE BE-DISCOVER-CLIENT-ID    TO PET-DS-CLIENT-ID            03.47
                                            RDS-3-CLIENT-ID.            03.47
           MOVE HOLD-DISCOVER-PREFIX     TO PET-DS-CLIENT-PRFX          03.47
                                            RDS-3-PREFIX.               03.47
           MOVE HOLD-DISCOVER-NO         TO PET-DS-NO.                  03.39
           MOVE HOLD-DISCOVER-COUNTRY-A  TO PET-DS-MRCH-COUNTRY-ALPHA.  03.39
           MOVE HOLD-DISCOVER-COUNTRY-N  TO PET-DS-MRCH-COUNTRY-NUM.    03.39
           MOVE HLD-ZIP-WORK             TO PET-DS-MRCH-ZIP-CD.
      *
           IF WS-NEW-DIS-PLAN-CODE-X NOT = SPACES                       03.47
              IF PET-CARD-TYPE-PAYPAL                                   03.47
                EVALUATE WS-NEW-DIS-PLAN-CODE-X                         03.47
                  WHEN '0115'                                           03.47
                    MOVE '0148'              TO WS-NEW-DIS-PLAN-CODE-X  03.47
                  WHEN '0105'                                           03.47
                    MOVE '0106'              TO WS-NEW-DIS-PLAN-CODE-X  03.47F
                END-EVALUATE                                            03.47
              END-IF                                                    03.47
              MOVE WS-NEW-DIS-PLAN-CODE  TO KDA-ORIG-PLAN-CODE          03.47
                                            KDA-PLAN-QUAL-CODE          03.47
           END-IF.                                                      03.47
      *                                                                 03.38
           IF PET-CARD-TYPE-NON-SETL                                    03.38
              MOVE '0000'                TO PET-DS-INTCHG-PGM-CD-X.     03.34
      *                                                                 03.47
           IF PET-CARD-TYPE-NON-SETL AND                                03.47
              MIS3-DS-SETL-PGM-ID = SPACES                              03.47
              IF WS-NSC-NON-CLEAR-DS                                    03.47F
                 MOVE '0205'             TO WS-PLAN-CODE                03.47F
              ELSE                                                      03.47F
              IF PET-CARD-TYPE-PAYPAL                                   03.47
                 MOVE '0106'             TO WS-PLAN-CODE                03.47F
              ELSE                                                      03.47
                 MOVE '0105'             TO WS-PLAN-CODE                03.47
              END-IF                                                    03.47
              END-IF                                                    03.47F
              PERFORM D-500-SEARCH-PLAN-PACKAGE                         03.47
                 THRU D-500-EXIT                                        03.47
              MOVE KDA-PLAN-QUAL-CODE    TO KDA-ORIG-PLAN-CODE.         03.47
      *                                                                 03.34F
           IF WS-MRCH-IS-INVALID-DIS                                    03.34F
           OR WS-MRCH-IS-DIS-NON-SETL                                   03.34F
              GO TO I-105-RATES-SET.                                    03.34F
      *                                                                 03.34F
           PERFORM Z99DU-CALL-BAS110DU                                  02.51
              THRU Z99DU-EXIT.                                          02.51
      *
           IF ((PET-RATE-FLAG = 'X' AND KDA-IS-PASS-THRU-DS)  OR        03.34
               (PET-RATE-FLAG = 'Y' AND KDA-IS-PASS-THRU-PP)) AND       03.34
              (NOT PARM-IS-1-SIDED)                                     03.34
                 MOVE KDA-ORIG-PLAN-CODE TO KDA-PLAN-QUAL-CODE
                                            GPR-NEW-PLAN                02.38
                 IF PET-CARD-TYPE-PAYPAL                                03.47
                    MOVE 0148            TO GPR-FROM-PLAN               03.47
                 ELSE                                                   03.47
                    MOVE 0115            TO GPR-FROM-PLAN               03.47
                 END-IF                                                 03.47
                 PERFORM S-500-AUTO-GEN-PLAN                            02.38
                    THRU S-500-EXIT                                     02.38
                 IF GPR-FROM-PLAN = 0115 OR 0148                        03.47
                    MOVE 'A'             TO RCL-10-POST-PLAN-ADD-IND    02.95
                 ELSE                                                   02.38
                    MOVE 'T'             TO RCL-10-POST-PLAN-ADD-IND    02.95
                 END-IF                                                 02.38
           ELSE
              MOVE SPACE                 TO PET-RATE-FLAG
           END-IF.
      *
           IF KDA-LOW-RATE-AMT = +0 OR
              KDA-LOW-RATE-AMT = +999999999999.999
                 GO TO I-105-RATES-SET
           END-IF.
      *
           IF PET-VALID-CASH                                            03.31
              IF KDA-LOW-RATE-AMT NOT = +0
                 COMPUTE KDA-LOW-RATE-AMT = KDA-LOW-RATE-AMT * -1
              END-IF
              IF KDA-LOW-ITEM-AMT NOT = +0
                 COMPUTE KDA-LOW-ITEM-AMT = KDA-LOW-ITEM-AMT * -1
              END-IF
           END-IF.
      *
           IF PET-REIMB-CURR-CODE = +840
              MOVE KDA-LOW-RATE-AMT      TO PET-REIMB-INT-FEE-AMT
              MOVE KDA-LOW-ITEM-AMT      TO PET-REIMB-INT-FEE-ITEM
           ELSE
              EVALUATE TRUE                                             03.31
                WHEN PET-VALID-RETURN                                   03.31
                  COMPUTE PET-REIMB-INT-FEE-AMT =
                      KDA-LOW-RATE-AMT * BASCRATE-RD-REIMB-VSSB-RATE
                  COMPUTE PET-REIMB-INT-FEE-ITEM =
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-REIMB-VSSB-RATE
                WHEN OTHER
                  COMPUTE PET-REIMB-INT-FEE-AMT =
                      KDA-LOW-RATE-AMT * BASCRATE-RD-REIMB-VSBS-RATE
                  COMPUTE PET-REIMB-INT-FEE-ITEM =
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-REIMB-VSBS-RATE
              END-EVALUATE
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                    C-TYPED  BASCRATE-SD-REIMB-CURR-DEC
                    C-TYPER  PET-REIMB-INT-FEE-AMT
                    C-TYPEEND
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                    C-TYPED  BASCRATE-SD-REIMB-CURR-DEC
                    C-TYPER  PET-REIMB-INT-FEE-ITEM
                    C-TYPEEND
           END-IF.
      *
           IF PET-IIIAAA-CURR-CODE = +840
              MOVE KDA-LOW-RATE-AMT      TO PET-IIIAAA-INT-FEE-AMT
              MOVE KDA-LOW-ITEM-AMT      TO PET-IIIAAA-INT-FEE-ITEM
           ELSE
              EVALUATE TRUE                                             03.31
                WHEN PET-VALID-RETURN                                   03.31
                  COMPUTE PET-IIIAAA-INT-FEE-AMT =
                      KDA-LOW-RATE-AMT * BASCRATE-RD-IIIAAA-VSSB-RATE
                  COMPUTE PET-IIIAAA-INT-FEE-ITEM =
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-IIIAAA-VSSB-RATE
                WHEN OTHER
                  COMPUTE PET-IIIAAA-INT-FEE-AMT =
                      KDA-LOW-RATE-AMT * BASCRATE-RD-IIIAAA-VSBS-RATE
                  COMPUTE PET-IIIAAA-INT-FEE-ITEM =
                      KDA-LOW-ITEM-AMT * BASCRATE-RD-IIIAAA-VSBS-RATE
              END-EVALUATE
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                    C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC
                    C-TYPER  PET-IIIAAA-INT-FEE-AMT
                    C-TYPEEND
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                    C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC
                    C-TYPER  PET-IIIAAA-INT-FEE-ITEM
                    C-TYPEEND
           END-IF.
      *
       I-105-RATES-SET.
      *
           MOVE PET-DS-INTCHG-PGM-CD-X   TO ROD-DS-INTCHG-PGM-ID.
           MOVE RCL-OPTIONAL-DATA-10-DS  TO RCL-10-OPTIONAL-DATA.       02.95
           MOVE RESET-RCL-OPTIONAL-DATA-10-DS                           02.95
                                         TO RCL-OPTIONAL-DATA-10-DS.    02.95
      *
       I-105-EXIT.
           EXIT.
      *
       I-105B-DSC-SETL-PGM-ID.                                          03.34F
      *                                                                 03.34F
             MOVE SPACES TO WS-NEW-DIS-PLAN-CODE-X.                     03.47
             EVALUATE MIS3-DS-SETL-PGM-ID                               03.34F
                 WHEN 'N'                                               03.34F
                 WHEN 'M'                                               03.34F
                 WHEN 'X'                                               03.34F
                   MOVE MIS3-DS-SETL-PGM-ID   TO RDS-3-SETTLE-FLG       03.47
                                                 RDS-3-SETTLE-FLG-OUT   03.47
                 WHEN OTHER                                             03.34F
      * BOTH MIS3 AND NME SETL FLAGS ARE SPACES                         03.47
                   IF MIS3-DS-SETL-PGM-ID = NME-DISCOVER-SETL-PGM       03.47
                     MOVE MIS3-DS-SETL-PGM-ID   TO RDS-3-SETTLE-FLG     03.47
                                                   RDS-3-SETTLE-FLG-OUT 03.47
                   ELSE                                                 03.47
                     MOVE MIS3-DS-SETL-PGM-ID   TO RDS-3-SETTLE-FLG     03.47
                     MOVE NME-DISCOVER-SETL-PGM TO RDS-3-SETTLE-FLG-OUT 03.47
                     MOVE '?'                TO RDS-3-SETTLE-FLG-ERR-IND03.47
                   END-IF                                               03.47
                   MOVE NME-DISCOVER-SETL-PGM                           03.47
                                              TO MIS3-DS-SETL-PGM-ID    03.47
             END-EVALUATE.                                              03.34F
      *                                                                 03.34F
           IF MIS3-DS-SETL-PGM-ID = SPACES                              03.47
              GO TO I-105B-DSC-MERCHANT-TYPE-DONE.                      03.47
      *                                                                 03.47
           IF MIS3-DS-SETL-PGM-ID = NME-DISCOVER-SETL-PGM               03.34F
              MOVE WS-SAVE-MRCH-DIS-TYPE     TO WS-MRCH-DIS-TYPE        03.34F
              MOVE WS-SAVE-DIS-PLAN-CODE-X   TO WS-NEW-DIS-PLAN-CODE-X  03.34F
              GO TO I-105B-DSC-MERCHANT-TYPE-DONE.                      03.34F
      *                                                                 03.34F
           IF WS-NON-SETTLE-CLEAR = 'D' OR 'B'                          03.34F
               MOVE 'N'                      TO WS-MRCH-DIS-TYPE        03.34F
               MOVE '0205'                   TO WS-PLAN-CODE            03.34F
               PERFORM D-500-SEARCH-PLAN-PACKAGE                        03.34F
                  THRU D-500-EXIT                                       03.34F
           ELSE                                                         03.34F
               EVALUATE MIS3-DS-SETL-PGM-ID                             03.34F
                   WHEN 'M'                                             03.34F
                      MOVE 'S'                  TO WS-MRCH-DIS-TYPE     03.34F
                      IF PET-CARD-TYPE-PAYPAL                           03.47
                          MOVE '0148'           TO WS-PLAN-CODE         03.47
                      ELSE                                              03.47
                          MOVE '0115'           TO WS-PLAN-CODE         03.47
                      END-IF                                            03.47
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                      IF ((KDA-CAP-DISC-X = SPACES OR '0000') AND       03.47
                           PET-CARD-TYPE-DISCOVER)            OR        03.47
                         ((KDA-CAP-PAYP-X = SPACES OR '0000') AND       03.47
                           PET-CARD-TYPE-PAYPAL)                        03.47
                         CONTINUE                                       03.34G
                      ELSE                                              03.34G
                         MOVE 'Y'              TO WS-PLAN-CODE-FOUND-SW 03.34G
                      END-IF                                            03.34G
                   WHEN 'N'                                             03.34F
                      MOVE 'N'                  TO WS-MRCH-DIS-TYPE     03.34F
                      IF PET-CARD-TYPE-PAYPAL                           03.47
                         MOVE '0106'            TO WS-PLAN-CODE         03.47F
                      ELSE                                              03.47
                         MOVE '0105'            TO WS-PLAN-CODE         03.47
                      END-IF                                            03.47
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                   WHEN 'X'                                             03.34F
                      MOVE 'N'                  TO WS-MRCH-DIS-TYPE     03.34F
                      MOVE '0205'               TO WS-PLAN-CODE         03.34F
                      PERFORM D-500-SEARCH-PLAN-PACKAGE                 03.34F
                         THRU D-500-EXIT                                03.34F
                   WHEN '9'                                             03.34F
                      MOVE 'N'                 TO WS-PLAN-CODE-FOUND-SW 03.34F
               END-EVALUATE                                             03.34F
           END-IF.                                                      03.34F
           IF WS-PLAN-CODE-FOUND-SW = 'N'                               03.30
              MOVE 'Z'                      TO WS-MRCH-DIS-TYPE         03.34F
              MOVE '0000'                   TO WS-NEW-DIS-PLAN-CODE-X   03.34F
           ELSE                                                         03.34F
              MOVE KDA-PLAN-QUAL-CODE       TO WS-NEW-DIS-PLAN-CODE     03.34F
           END-IF.                                                      03.34F
      *                                                                 03.34F
       I-105B-DSC-MERCHANT-TYPE-DONE.                                   03.34F
      *                                                                 03.34F
           MOVE MIS3-DS-SETL-PGM-ID            TO PET-DS-SETL-PGM-ID.   03.34F
      *                                                                 03.34F
       I-105B-EXIT.                                                     03.34F
           EXIT.                                                        03.34F
      *                                                                 03.34F
050790 R-500-BATCH-BREAK.
050800     IF BATCH-HDR-MISSING
050810         MOVE SPACE TO BATCH-HDR-MISSING-SW
050820         GO TO R-500-CONT.
050830     PERFORM R-510-MON-BATCH
050840        THRU R-510-EXIT.
050850 R-500-CONT.
050860     CLOSE WORK-FILE.
050870     OPEN OUTPUT WORK-FILE.
050880     MOVE SPACE TO BATCH-REJ-SW
                         CRITICAL-BATCH-REJ-SW                          02.73
050890                   BATCH-BYPASSED-SW
050900                   HLD-HDR-TC
050910                   HLD-HDR-REF-NMBR.
050920     MOVE ZERO TO  HLD-BANK-NMBR.
050930 R-500-EXIT.
050940     EXIT.
050950*
050960 R-510-MON-BATCH.
050970     IF BATCH-BYPASSED
050980         GO TO R-510-BALANCE-BATCH.
050990     IF GROUP-SUS-CTR EQUAL GROUP-CTR
051000         MOVE '*' TO RND1-SUS-FLAG
051000                     RND1-FATAL-FLAG
051010         MOVE 088 TO RND1-ERROR-CD-1
              MOVE 'R'                   TO RAD-ED-LINE-TYPE
              MOVE '0'                   TO RAD-ED-REPORT-TYPE
              MOVE SB-BATCH-AMT          TO RAD-ED-TRAN-AMT
051020         PERFORM S-200-PRINT-NON-MON-DET-1
051030            THRU S-200-EXIT
051040         MOVE 'Y' TO BATCH-REJ-SW.
051050     PERFORM R-600-GROUP-SUM-BREAK
051060        THRU R-600-EXIT.
051070     PERFORM S-100-PRINT-PAGE-HDR
051080        THRU S-100-EXIT.
051090 R-510-BALANCE-BATCH.
051100     MOVE SB-BATCH-FRST-2  TO RBT-BATCH-FRST-2.
051110     MOVE SB-BATCH-LAST-4  TO RBT-BATCH-LAST-4.
051120     MOVE SB-BATCH-AMT             TO RBT-BATCH-AMT.
051130     MOVE SB-CALC-AMT  TO RBT-CALC-AMT.
051140     COMPUTE ST-DIFF = SB-BATCH-AMT -
051150             SB-CALC-AMT.
051160     MOVE ST-DIFF TO RBT-DIFF.
051170     IF ST-DIFF NOT EQUAL +0
051180         MOVE 'Y' TO BATCH-REJ-SW.
051190     CALL BACONDEC USING BASCRATE-SD-BANK-KEY
051200              C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
051210              C-TYPEA  RBT-BATCH-AMT  C-LGTH24
051220                       RBT-CALC-AMT   C-LGTH24
051230                       RBT-DIFF       C-LGTH24
051240              C-TYPEEND.
           MOVE 'B'                      TO RAD-ED-LINE-TYPE.
           MOVE SB-BATCH-AMT             TO RAD-ED-TRAN-AMT.
           MOVE '0'                      TO RAD-ED-REPORT-TYPE.
051250     MOVE RPT-BATCH-TOT-LINE    TO RLW-DETAIL-LINE.
051260     PERFORM R-920-WRITE-REPORT-RECORD
051270        THRU R-920-EXIT.
           MOVE REPORT-SORT-KEY          TO WS-RPT-REC-KEY.
           IF WS-RBS-PASSTHRU
              MOVE 1                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           IF WS-RBS-DOWNGRADE
              MOVE 2                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           IF WS-RBS-PBD-EBT
              MOVE 4                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           IF WS-RBS-DEFAULT
              MOVE 8                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           IF WS-RBS-REJECT
              MOVE 9                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           MOVE +0                       TO RAD-ED-TRAN-AMT.
051280     MOVE WS-BATCH-CURRENCY-NAME   TO RBC-CURR-NAME.
051300     MULTIPLY 2 BY INV-DATE-CTR.
051310     IF SB-CNT  IS LESS THAN INV-DATE-CTR
051000         MOVE '*' TO RND1-SUS-FLAG
051000                     RND1-FATAL-FLAG
051330         MOVE 090 TO RND1-ERROR-CD-1
              MOVE 'R'                   TO RAD-ED-LINE-TYPE
              MOVE '0'                   TO RAD-ED-REPORT-TYPE
051340         PERFORM S-200-PRINT-NON-MON-DET-1
051350            THRU S-200-EXIT
051360         MOVE 'Y' TO BATCH-REJ-SW
051370         DISPLAY 'MORE THAN HALF OF ITEMS IN BATCH HAVE'
051380         DISPLAY '  TRANSACTION DATE GREATER THAN WAO DATE'
051390         DISPLAY 'BCF HAS WRONG WAO DATE OR EDIT RUN ON WRONG DAY'
051400         DISPLAY 'NOTIFY BANKCARD PROGRAMMER'
051410         MOVE 4 TO HLD-RETURN-CD.
051420     IF SB-CNT  EQUAL SUS-COUNTER
051000        MOVE '*' TO RND1-SUS-FLAG
051000                    RND1-FATAL-FLAG
051440        MOVE 075 TO RND1-ERROR-CD-1
              MOVE 'R'                   TO RAD-ED-LINE-TYPE
              MOVE '0'                   TO RAD-ED-REPORT-TYPE
051450        PERFORM S-200-PRINT-NON-MON-DET-1
051460           THRU S-200-EXIT
051470        MOVE 'Y' TO BATCH-REJ-SW.
051480        MOVE ZEROS TO SUS-COUNTER.
051490     IF BATCH-REJ-SW EQUAL 'Y'
051500         ADD 1                          TO CALC-RUN-CNT-REJ
051510         ADD WS-CENTER-AMT              TO CALC-RUN-AMT-REJ
051520         PERFORM R-530-REJECT-BATCH
051530            THRU R-530-EXIT
051540     ELSE
051550         MOVE SPACES                    TO SB-REJ
051560         ADD 1                          TO CALC-RUN-CNT-ACC
051570         ADD WS-CENTER-AMT              TO CALC-RUN-AMT-ACC
051580         PERFORM R-520-ACCEPT-BATCH
051590            THRU R-520-EXIT.
051600     MOVE ZERO TO  HLD-BTCH-AMOUNT
051610                   SB-CALC-AMT.
051620 R-510-EXIT.
051630     EXIT.
051640*
051650 R-520-ACCEPT-BATCH.
           PERFORM
             VARYING SUB1 FROM +1 BY +1
             UNTIL   SUB1 > +9                                          03.47
               PERFORM
                 VARYING SUB2 FROM +1 BY +1
                 UNTIL   SUB2 > +4
                   ADD WS-CTT-CNT(SUB1,SUB2)
                                         TO WS-CBT-CNT(SUB1,SUB2)
                   MOVE +0               TO WS-CTT-CNT(SUB1,SUB2)
                   ADD WS-CTT-AMT(SUB1,SUB2)
                                         TO WS-CBT-AMT(SUB1,SUB2)
                   MOVE +0               TO WS-CTT-AMT(SUB1,SUB2)
               END-PERFORM
           END-PERFORM.
           COMPUTE PEN-TOTAL-AMOUNT = PEN-VISA-AMOUNT + PEN-MC-AMOUNT
                                    + PEN-AMEX-AMOUNT + PEN-DISC-AMOUNT
                                    + PEN-PAYPAL-AMOUNT +PEN-PL-AMOUNT. 03.47
           COMPUTE PEN-TOTAL-ITMS = PEN-VISA-ITMS + PEN-MC-ITMS
                                  + PEN-AMEX-ITMS + PEN-DISC-ITMS
                                  + PEN-PAYPAL-ITMS + PEN-PL-ITMS.      03.47
           IF PEN-TOTAL-ITMS = ZERO
051690         NEXT SENTENCE
051700     ELSE
051710         MOVE HLD-BANK-KEY TO PEN-BANK-KEY
051720         MOVE POST-EDIT-NOTONUS-TOTALS TO WORK-DATA
051730         MOVE +0                       TO  WORK-BATCH-AMT
051730         MOVE +0                       TO  WORK-REIMB-AMT
051730         MOVE +0                       TO  WORK-IIIAAA-AMT
051740         MOVE +0                       TO  WORK-III999-AMT
051750         MOVE +0                       TO  WORK-CENTER-AMT
               PERFORM S-300-WRITE-PET-WORK-REC
                  THRU S-300-EXIT.
051770     MOVE 'N' TO END-OF-WORK-FILE-SW.
051780     CLOSE WORK-FILE.
051790     OPEN INPUT WORK-FILE.
051800     PERFORM R-580-OUTPUT-BATCH
051810        THRU R-580-EXIT
051820         UNTIL END-OF-WORK-FILE.
051830*
051840*   PRINT BATCH TOTALS BY TRANS. CODE
051850*
           MOVE ZERO                     TO RAD-ED-LINE-TYPE
                                            RAD-ED-REPORT-TYPE.
051860     MOVE SPACE TO RPT-TRANS-TOTS.
051870     MOVE RPT-TRANS-TOT-HDR-1   TO RLW-DETAIL-LINE.
051880     PERFORM R-920-WRITE-REPORT-RECORD
051890        THRU R-920-EXIT.
051900     MOVE RPT-TRANS-TOT-HDR-2   TO RLW-DETAIL-LINE.
051910     PERFORM R-920-WRITE-REPORT-RECORD
051920        THRU R-920-EXIT.
051930     MOVE RPT-TRANS-TOT-HDR-3   TO RLW-DETAIL-LINE.
051940     PERFORM R-920-WRITE-REPORT-RECORD
051950        THRU R-920-EXIT.
052010
051960     MOVE '0'                      TO RTT-CC.
051970     PERFORM R-535-PRINT-TC-TOTS
051980        THRU R-535-EXIT
051990             VARYING SUB-T FROM 1 BY 1
052000             UNTIL SUB-T > 3.
052010
051070     PERFORM S-100-PRINT-PAGE-HDR
051080        THRU S-100-EXIT.
052010
051860     MOVE SPACE TO RPT-TRANS-TOTS.
051870     MOVE RPT-TRANS-TOT-HDR-1   TO RLW-DETAIL-LINE.
051880     PERFORM R-920-WRITE-REPORT-RECORD
051890        THRU R-920-EXIT.
051900     MOVE RPT-TRANS-TOT-HDR-2B  TO RLW-DETAIL-LINE.
051910     PERFORM R-920-WRITE-REPORT-RECORD
051920        THRU R-920-EXIT.
051930     MOVE RPT-TRANS-TOT-HDR-3   TO RLW-DETAIL-LINE.
051940     PERFORM R-920-WRITE-REPORT-RECORD
051950        THRU R-920-EXIT.
052010
051960     MOVE '0'                      TO RTT-CC.
051970     PERFORM R-537-PRINT-TC-TOTS
051980        THRU R-537-EXIT
051990         VARYING SUB-T FROM 1 BY 1
052000             UNTIL SUB-T > 3.
052010
051070     PERFORM S-100-PRINT-PAGE-HDR
051080        THRU S-100-EXIT.
052010
000000     MOVE SPACES TO RPT-BATCH-CH-TOTS.
052020     MOVE '-' TO RCT-CC.
052030     MOVE 'DEBIT ITEMS' TO RCT-DESCR.
052040     MOVE CALC-CH-DEBIT-ITMS TO RCT-ITMS.
052050     MOVE RPT-BATCH-CH-TOTS     TO RLW-DETAIL-LINE.
052060     PERFORM R-920-WRITE-REPORT-RECORD
052070        THRU R-920-EXIT.
052080     MOVE SPACE TO RCT-CC.
052090     MOVE 'CREDIT ITEMS' TO RCT-DESCR.
052100     MOVE CALC-CH-CREDIT-ITMS TO RCT-ITMS.
052110     MOVE RPT-BATCH-CH-TOTS     TO RLW-DETAIL-LINE.
052120     PERFORM R-920-WRITE-REPORT-RECORD
052130        THRU R-920-EXIT.
052140     MOVE SPACES TO RCT-TOT.
052150     MOVE 'DEBIT AMOUNT' TO RCT-DESCR.
052160     MOVE CALC-CH-DEBIT-AMT TO RCT-AMT.
052170     CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
052180              C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
052190              C-TYPEA  RCT-AMT  C-LGTH23
052200              C-TYPEEND.
052210     MOVE RPT-BATCH-CH-TOTS     TO RLW-DETAIL-LINE.
052220     PERFORM R-920-WRITE-REPORT-RECORD
052230        THRU R-920-EXIT.
052240     MOVE 'CREDIT AMOUNT' TO RCT-DESCR.
052250     MOVE CALC-CH-CREDIT-AMT TO RCT-AMT.
052260     CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
052270              C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
052280              C-TYPEA  RCT-AMT  C-LGTH23
052290              C-TYPEEND.
052300     MOVE RPT-BATCH-CH-TOTS     TO RLW-DETAIL-LINE.
052310     PERFORM R-920-WRITE-REPORT-RECORD
052320        THRU R-920-EXIT.
052330     MOVE HL1-INST-NBR            TO RBC-BANK.
052340     MOVE BASCRATE-SD-BATCH-CURR-CD-X
052340                                  TO RBC-CURR-CODE.
052350     MOVE WS-BATCH-CURRENCY-NAME   TO RBC-CURR-NAME.
052360     MOVE RPT-BATCH-CURR-LINE     TO RLW-DETAIL-LINE.
052370     PERFORM R-920-WRITE-REPORT-RECORD
052380        THRU R-920-EXIT.
           MOVE 60                        TO WS-RPT-LINE-CNT.
052390 R-520-EXIT.
052400     EXIT.
052410*
053300 R-526-FORMAT-AMOUNT.
053310     IF RTT-DET-ENTRY (PRT-SUB) = SPACES
053320        GO TO R-526-EXIT.
053330     CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
053340                 C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
053350                 C-TYPEA  RTT-AMOUNT(PRT-SUB)  C-LGTH24
053360                 C-TYPEEND.
053370 R-526-EXIT.
053380     EXIT.
053290*
053400 R-530-REJECT-BATCH.
      *                                                                 03.13
           SET BASDTDTA-CT-DELETE        TO TRUE.                       03.13
           PERFORM Z9TDAT-CALL-BASDTDTA                                 03.13
              THRU Z9TDAT-EXIT.                                         03.13
      *                                                                 03.13
           PERFORM
             VARYING SUB1 FROM +1 BY +1
             UNTIL   SUB1 > +9                                          03.47
               PERFORM
                 VARYING SUB2 FROM +1 BY +1
                 UNTIL   SUB2 > +4
                   ADD WS-CTT-CNT(SUB1,SUB2)
                                         TO WS-CBT-CNT(SUB1,5)
                   MOVE +0               TO WS-CTT-CNT(SUB1,SUB2)
                   ADD WS-CTT-AMT(SUB1,SUB2)
                                         TO WS-CBT-AMT(SUB1,5)
                   MOVE +0               TO WS-CTT-AMT(SUB1,SUB2)
               END-PERFORM
           END-PERFORM.
053410     MOVE '**' TO SB-REJ
053420     MOVE HLD-BANK-KEY           TO SB-BANK-KEY.
053430     MOVE WS-BATCH-AMT             TO SB-BATCH-AMT.
053430     MOVE WS-REIMB-AMT             TO SB-REIMB-AMT.
053930     MOVE BASCRATE-SD-BATCH-CURR-CD-X
034510                                   TO SB-CURR-CODE.
053930     MOVE BASCRATE-SD-IIIAAA-CURR-CD-X
053930                                   TO SB-IIIAAA-CURR-CODE.
053930     MOVE BASCRATE-SD-III999-CURR-CD-X
053930                                   TO SB-III999-CURR-CODE.
053930     MOVE BASCRATE-SD-CENTER-CURR-CD-X
053930                                   TO SB-CENTER-CURR-CODE.
053930     MOVE BASCRATE-SD-BATCH-CURR-DEC
053930                                   TO SB-BATCH-CURR-DEC.
053930     MOVE BASCRATE-SD-IIIAAA-CURR-DEC
053930                                   TO SB-IIIAAA-CURR-DEC.
053930     MOVE BASCRATE-SD-III999-CURR-DEC
053930                                   TO SB-III999-CURR-DEC.
053930     MOVE BASCRATE-SD-CENTER-CURR-DEC
053930                                   TO SB-CENTER-CURR-DEC.
007060     MOVE WS-BATCH-CURRENCY-NAME   TO SB-BATCH-CURR-NAME.
007060     MOVE WS-IIIAAA-CURRENCY-NAME  TO SB-IIIAAA-CURR-NAME.
007060     MOVE WS-III999-CURRENCY-NAME  TO SB-III999-CURR-NAME.
007060     MOVE WS-CENTER-CURRENCY-NAME  TO SB-CENTER-CURR-NAME.
053430     MOVE WS-IIIAAA-AMT            TO SB-IIIAAA-AMT.
053440     MOVE WS-III999-AMT            TO SB-III999-AMT.
053450     MOVE WS-CENTER-AMT            TO SB-CENTER-AMT.
053460     WRITE SYS-ASSN-REC FROM SB-TOTAL-REC.
053470     MOVE +0                       TO WS-BATCH-AMT
053470                                      WS-REIMB-AMT
053470                                      WS-IIIAAA-AMT
053480                                      WS-III999-AMT
053490                                      WS-CENTER-AMT
053500                                      SB-CNT.
053510     MOVE SPACES                   TO SB-REJ.
053520     MOVE LIT-BATCH-REJ TO RND1-MESG.
053530     MOVE '-' TO RND1-CC.
           MOVE 'R'                      TO RAD-ED-LINE-TYPE.
           MOVE SB-BATCH-AMT             TO RAD-ED-TRAN-AMT.
053540     PERFORM S-200-PRINT-NON-MON-DET-1
053550        THRU S-200-EXIT.
           MOVE +0                       TO RAD-ED-TRAN-AMT.
           MOVE 99                       TO WS-RPT-LINE-CNT.
      *                                                                 02.88
           MOVE 'N'                      TO END-OF-WORK-FILE-SW.        02.88
           CLOSE WORK-FILE.                                             02.88
           OPEN INPUT WORK-FILE.                                        02.88
           PERFORM R-585-OUTPUT-REJECT-BATCH                            02.88
              THRU R-585-EXIT                                           02.88
                   UNTIL END-OF-WORK-FILE.                              02.88
      *                                                                 02.88
053560 R-530-EXIT.
053570     EXIT.
052410*
052420 R-535-PRINT-TC-TOTS.
052430     IF VISA-NOU-TC (SUB-T) NOT = SPACE
052440        MOVE VISA-NOU-TC (SUB-T)     TO RTT-TC (1)
052450        MOVE VISA-NOU-ITMS (SUB-T)   TO RTT-ITMS (1)
052460        MOVE VISA-NOU-AMOUNT (SUB-T) TO RTT-AMOUNT (1).
052470     IF MC-NOU-TC (SUB-T) NOT = SPACE
052480        MOVE MC-NOU-TC (SUB-T)       TO RTT-TC (2)
052490        MOVE MC-NOU-ITMS (SUB-T)     TO RTT-ITMS (2)
052500        MOVE MC-NOU-AMOUNT (SUB-T)   TO RTT-AMOUNT (2).
052430     IF AMEX-NOU-TC (SUB-T) NOT = SPACE
052440        MOVE AMEX-NOU-TC (SUB-T)     TO RTT-TC (3)
052450        MOVE AMEX-NOU-ITMS (SUB-T)   TO RTT-ITMS (3)
052460        MOVE AMEX-NOU-AMOUNT (SUB-T) TO RTT-AMOUNT (3).
053190     PERFORM R-526-FORMAT-AMOUNT
053200        THRU R-526-EXIT
053210             VARYING PRT-SUB FROM 1 BY 1
053220             UNTIL PRT-SUB > 3.
053230     MOVE RPT-TRANS-TOTS           TO RLW-DETAIL-LINE.
053240     PERFORM R-920-WRITE-REPORT-RECORD
053250        THRU R-920-EXIT.
053260     MOVE SPACE                    TO RPT-TRANS-TOTS.
053270 R-535-EXIT.
053280     EXIT.
053290*
052420 R-537-PRINT-TC-TOTS.
052470     IF DISC-NOU-TC (SUB-T) NOT = SPACE
052480        MOVE DISC-NOU-TC (SUB-T)     TO RTT-TC (1)
052490        MOVE DISC-NOU-ITMS (SUB-T)   TO RTT-ITMS (1)
052500        MOVE DISC-NOU-AMOUNT (SUB-T) TO RTT-AMOUNT (1).
052470     IF PP-NOU-TC (SUB-T) NOT = SPACE                             03.47
052480        MOVE PP-NOU-TC (SUB-T)       TO RTT-TC (2)                03.47
052490        MOVE PP-NOU-ITMS (SUB-T)     TO RTT-ITMS (2)              03.47
052500        MOVE PP-NOU-AMOUNT (SUB-T) TO RTT-AMOUNT (2).             03.47
052430     IF PL-NOU-TC (SUB-T) NOT = SPACE                             03.47
052440        MOVE PL-NOU-TC (SUB-T)     TO RTT-TC (3)                  03.47
052450        MOVE PL-NOU-ITMS (SUB-T)   TO RTT-ITMS (3)                03.47
052460        MOVE PL-NOU-AMOUNT (SUB-T) TO RTT-AMOUNT (3).             03.47
053190     PERFORM R-526-FORMAT-AMOUNT
053200        THRU R-526-EXIT
053210             VARYING PRT-SUB FROM 1 BY 1
053220             UNTIL PRT-SUB > 3.                                   03.47
053230     MOVE RPT-TRANS-TOTS        TO RLW-DETAIL-LINE.
053240     PERFORM R-920-WRITE-REPORT-RECORD
053250        THRU R-920-EXIT.
053260     MOVE SPACE TO RPT-TRANS-TOTS.
053270 R-537-EXIT.
053380     EXIT.
053580*
053580 R-580-OUTPUT-BATCH.
053590     READ WORK-FILE
053600         AT END
053610             MOVE 'Y' TO FIRST-BATCHREC-SW
053620             MOVE 'Y' TO END-OF-WORK-FILE-SW
053630             GO TO R-580-EXIT.
053640     MOVE WORK-DATA      TO POST-EDIT-TRANS.
           MOVE WORK-ERROR-CODES         TO ERROR-CODE-HOLD-TABLE.
           IF PET-VALID-1-SIDED OR                                      03.31
              PET-VALID-1-SIDED-BATCH OR                                03.31
              PET-VALID-1-SIDED-GROUP                                   03.31
                 NEXT SENTENCE                                          03.31
           ELSE                                                         03.31
              PERFORM R-595-SEL-MRCH-TRANS                              03.31
                 THRU R-595-EXIT                                        03.31
           END-IF.                                                      03.31
053670     ADD +1                  TO WS-OTR-SEQ-NO.
           IF NOT PET-VALID-MONETARY                                    03.31
053580        GO TO R-580-CHECK-IS-BATCH.
053690     IF PET-SUS-FLAG = 'Y'
              SET BASDTRAN-CT-REJECT     TO TRUE                        02.88
              SET BASDTRAN-TD-INDIVIDUAL TO TRUE                        02.88
              MOVE POST-EDIT-TRANS       TO BASDTRAN-TD-PET             02.88
              MOVE WORK-ERROR-CODES      TO ERROR-CODE-HOLD-TABLE       02.88
              PERFORM S-090-LOAD-REJECT-ERRORS                          02.88
                 THRU S-090-EXIT                                        02.88
              MOVE ZEROS                 TO ERROR-CODE-HOLD-TABLE       02.88
              MOVE WORK-EXTRA-DATA       TO BASDTRAN-TD-EXTRA-DATA      02.88
              MOVE WS-MIS3-CARD-TYPE       TO WS-SAVE-MIS3-TYPE         02.99
              MOVE SPACES                TO BASDTRAN-CARD-TYPE          03.09
              MOVE PET-MIS3-CARD-TYPE(1:1) TO BASDTRAN-CARD-TYPE        02.99
              MOVE PET-MIS3-CARD-TYPE      TO WS-MIS3-CARD-TYPE         03.05
              IF PET-MIS3-CARD-TYPE (1:1) = 'A' OR 'D' OR 'P'           03.47
                  IF PET-MIS3-CARD-TYPE (1:1) = 'A' AND                 03.16A
                     WS-PLAN-CODE (3:2) = '54'                          03.16A
                      MOVE '3'              TO BASDTRAN-CARD-TYPE (2:1) 03.16A
                  ELSE                                                  03.16A
                  IF PET-MIS3-CARD-TYPE (1:1) = 'A'                     03.09
                      MOVE 'X'              TO BASDTRAN-CARD-TYPE (2:1) 03.09
                  ELSE                                                  03.47
                  IF PET-MIS3-CARD-TYPE (1:1) = 'D'                     03.47
                      MOVE 'S'              TO BASDTRAN-CARD-TYPE (2:1) 03.47
                  ELSE                                                  03.47
                  IF PET-MIS3-CARD-TYPE (1:1) = 'P'                     03.47
                      MOVE 'P'              TO BASDTRAN-CARD-TYPE (2:1) 03.47
                  END-IF                                                03.47
                  END-IF                                                03.47
                  END-IF                                                03.16A
                  END-IF                                                03.09
                  EVALUATE WS-PLAN-CODE                                 03.08
                      WHEN 0104                                         03.09
                      WHEN 0105                                         03.47
                      WHEN 0106                                         03.47F
                          MOVE '1'       TO BASDTRAN-CARD-TYPE (2:1)    03.08
                      WHEN 0204                                         03.47
                      WHEN 0205                                         03.09
                          MOVE '2'       TO BASDTRAN-CARD-TYPE (2:1)    03.08
                  END-EVALUATE                                          03.08
              END-IF                                                    03.08
              IF VALID-MIS3-VISA-CARD-TYPE                              02.99
                 MOVE 'V '                TO BASDTRAN-CARD-TYPE         03.09
              ELSE                                                      02.99
                 IF VALID-MIS3-DB-CARD-TYPE                             02.99
                    MOVE 'P'             TO BASDTRAN-CARD-TYPE          02.99
                 ELSE                                                   02.99
                    IF VALID-MIS3-PD-NET                                02.99
                       MOVE 'N'          TO BASDTRAN-CARD-TYPE          02.99
                    END-IF                                              02.99
                 END-IF                                                 02.99
              END-IF                                                    02.99
              MOVE WS-SAVE-MIS3-TYPE     TO WS-MIS3-CARD-TYPE           02.99
              PERFORM Z9TRN-CALL-BASDTRAN                               02.88
                 THRU Z9TRN-EXIT                                        02.88
053700        PERFORM R-590-CHANGE-TO-MRCH-SUS
053710           THRU R-590-EXIT
              GO TO R-580-EXIT                                          02.88
           END-IF.                                                      02.88
053580 R-580-CHECK-IS-BATCH.
           IF PET-VALID-BATCH                                           03.31
053890        MOVE PET-HDR-BANK-KEY   TO WS-OTR-INST-ASSN
053900                                   SB-BANK-KEY
053910        MOVE PET-HDR-BATCH-NMBR TO WS-OTR-BATCH-ID
053920        MOVE '1'                TO WS-OTR-ID
053930        MOVE BASCRATE-SD-BATCH-CURR-CD-X
034510                                   TO SB-CURR-CODE
053930        MOVE BASCRATE-SD-REIMB-CURR-CD-X
053930                                   TO PET-HDR-REIMB-CURR-CODE
053930        MOVE BASCRATE-SD-IIIAAA-CURR-CD-X
053930                                   TO SB-IIIAAA-CURR-CODE
053930                                      PET-HDR-IIIAAA-CURR-CODE
053930        MOVE BASCRATE-SD-III999-CURR-CD-X
053930                                   TO SB-III999-CURR-CODE
053930        MOVE BASCRATE-SD-CENTER-CURR-CD-X
053930                                   TO SB-CENTER-CURR-CODE
053930        MOVE BASCRATE-SD-BATCH-CURR-DEC
053930                                   TO SB-BATCH-CURR-DEC
053930        MOVE BASCRATE-SD-IIIAAA-CURR-DEC
053930                                   TO SB-IIIAAA-CURR-DEC
053930        MOVE BASCRATE-SD-III999-CURR-DEC
053930                                   TO SB-III999-CURR-DEC
053930        MOVE BASCRATE-SD-CENTER-CURR-DEC
053930                                   TO SB-CENTER-CURR-DEC
007060        MOVE WS-BATCH-CURRENCY-NAME
007060                                   TO SB-BATCH-CURR-NAME
007060        MOVE WS-IIIAAA-CURRENCY-NAME
007060                                   TO SB-IIIAAA-CURR-NAME
007060        MOVE WS-III999-CURRENCY-NAME
007060                                   TO SB-III999-CURR-NAME
007060        MOVE WS-CENTER-CURRENCY-NAME
007060                                   TO SB-CENTER-CURR-NAME
053940        MOVE WS-BATCH-AMT          TO SB-BATCH-AMT
053940        MOVE WS-REIMB-AMT          TO SB-REIMB-AMT
053940                                      PET-HDR-REIMB-AMT
053930        MOVE WS-IIIAAA-AMT         TO OTR-IIIAAA-AMT
053940                                      SB-IIIAAA-AMT
053940                                      PET-HDR-IIIAAA-AMT
053950        MOVE WS-III999-AMT         TO OTR-III999-AMT
053960                                      SB-III999-AMT
053970        MOVE WS-CENTER-AMT         TO OTR-CENTER-AMT
053980                                      SB-CENTER-AMT
053990        WRITE SYS-ASSN-REC FROM SB-TOTAL-REC
054000        MOVE 1                     TO WS-ASSN-RECS
054010        MOVE +0                    TO WS-BATCH-AMT
054010                                      WS-REIMB-AMT
054010                                      WS-IIIAAA-AMT
054020                                      WS-III999-AMT
054030                                      WS-CENTER-AMT
054040                                      SB-CNT
054050        MOVE SPACES                TO SB-REJ
054060     ELSE
            IF PET-VALID-GROUP                                          03.31
               MOVE WS-GRP-REIMB-AMT     TO PET-MRCH-REIMB-AMT          02.89
054740         PERFORM R-582-SET-NON-SETL-REIMB
054740            THRU R-582-EXIT
037460         MOVE BASCRATE-SD-IIIAAA-CURR-CD-X
                                         TO PET-MRCH-IIIAAA-CURR-CODE   02.89
054080         MOVE WS-GRP-IIIAAA-AMT    TO OTR-IIIAAA-AMT
                                            PET-MRCH-IIIAAA-AMT         02.89
054090         MOVE WS-GRP-III999-AMT    TO OTR-III999-AMT
054100         MOVE WS-GRP-CENTER-AMT    TO OTR-CENTER-AMT
               MOVE PET-MRCH-REF-NMBR    TO WK-GROUP-REF-NMBR           02.89
               IF PET-MRCH-SELECT = 'G'                                 02.89
                  SET BASDTRAN-CT-REJECT TO TRUE                        02.88
                  SET BASDTRAN-TD-GROUP  TO TRUE                        02.88
                  MOVE POST-EDIT-HOLD-MERCH                             02.88
                                         TO BASDTRAN-TD-PET             02.88
                  MOVE PET-MRCH-ERROR-CODES                             02.89
                                         TO ERROR-CODE-HOLD-TABLE       02.88
                  PERFORM S-090-LOAD-REJECT-ERRORS                      02.88
                     THRU S-090-EXIT                                    02.88
                  MOVE ZEROS             TO ERROR-CODE-HOLD-TABLE       02.88
                  PERFORM Z9TRN-CALL-BASDTRAN                           02.88
                     THRU Z9TRN-EXIT                                    02.88
               END-IF                                                   02.88
               IF PET-VALID-1-SIDED-GROUP                               03.31
                  MOVE WS-GRP-IIIAAA-AMT TO OTR-IIIAAA-AMT              03.31
                  MOVE WS-GRP-III999-AMT TO OTR-III999-AMT              03.31
                  MOVE WS-GRP-CENTER-AMT TO OTR-CENTER-AMT              03.31
                  MOVE +0                TO WS-GRP-BATCH-AMT            03.31
                                            WS-GRP-REIMB-AMT            03.31
                                            WS-GRP-IIIAAA-AMT           03.31
                                            WS-GRP-III999-AMT           03.31
                                            WS-GRP-CENTER-AMT           03.31
                                            WS-GRP-REIMB-AMT-VISA       03.31
                                            WS-GRP-IIIAAA-AMT-VISA      03.31
                                            WS-GRP-III999-AMT-VISA      03.31
                                            WS-GRP-CENTER-AMT-VISA      03.31
                                            WS-GRP-REIMB-AMT-MC         03.31
                                            WS-GRP-IIIAAA-AMT-MC        03.31
                                            WS-GRP-III999-AMT-MC        03.31
                                            WS-GRP-CENTER-AMT-MC        03.31
                                            WS-GRP-REIMB-AMT-AMEX       03.31
                                            WS-GRP-REIMB-AMT-AMEX-NS    03.34F
                                            WS-GRP-IIIAAA-AMT-AMEX      03.31
                                            WS-GRP-IIIAAA-AMT-AMEX-NS   03.34F
                                            WS-GRP-III999-AMT-AMEX      03.31
                                            WS-GRP-III999-AMT-AMEX-NS   03.34F
                                            WS-GRP-CENTER-AMT-AMEX      03.31
                                            WS-GRP-CENTER-AMT-AMEX-NS   03.34F
                                            WS-GRP-REIMB-AMT-DISC       03.31
                                            WS-GRP-REIMB-AMT-DISC-NS    03.34F
                                            WS-GRP-IIIAAA-AMT-DISC      03.31
                                            WS-GRP-IIIAAA-AMT-DISC-NS   03.34F
                                            WS-GRP-III999-AMT-DISC      03.31
                                            WS-GRP-III999-AMT-DISC-NS   03.34F
                                            WS-GRP-CENTER-AMT-DISC      03.31
                                            WS-GRP-CENTER-AMT-DISC-NS   03.34F
               END-IF                                                   03.31
054110     ELSE
054120      IF PET-TRANS      = '4530' OR '4531'
054120         MOVE POST-EDIT-TRANS      TO POST-EDIT-MERCH-TOTALS
               MOVE PEH-MRCH-SELECT      TO PEM-MRCH-SELECT
               MOVE POST-EDIT-MERCH-TOTALS
                                         TO POST-EDIT-TRANS
054740         PERFORM R-591-CHECK-NON-SETTLE
054740            THRU R-591-EXIT
054130         MOVE WS-GRP-IIIAAA-AMT    TO OTR-IIIAAA-AMT
054140         MOVE WS-GRP-III999-AMT    TO OTR-III999-AMT
054150         MOVE WS-GRP-CENTER-AMT    TO OTR-CENTER-AMT
054080         MOVE +0                   TO WS-GRP-BATCH-AMT
054080                                      WS-GRP-REIMB-AMT
054160                                      WS-GRP-IIIAAA-AMT
054170                                      WS-GRP-III999-AMT
054180                                      WS-GRP-CENTER-AMT
054080                                      WS-GRP-REIMB-AMT-VISA
054160                                      WS-GRP-IIIAAA-AMT-VISA
054170                                      WS-GRP-III999-AMT-VISA
054180                                      WS-GRP-CENTER-AMT-VISA
054080                                      WS-GRP-REIMB-AMT-MC
054160                                      WS-GRP-IIIAAA-AMT-MC
054170                                      WS-GRP-III999-AMT-MC
054180                                      WS-GRP-CENTER-AMT-MC
054080                                      WS-GRP-REIMB-AMT-AMEX
054080                                      WS-GRP-REIMB-AMT-AMEX-NS    03.34F
054160                                      WS-GRP-IIIAAA-AMT-AMEX
054160                                      WS-GRP-IIIAAA-AMT-AMEX-NS   03.34F
054170                                      WS-GRP-III999-AMT-AMEX
054160                                      WS-GRP-III999-AMT-AMEX-NS   03.34F
054180                                      WS-GRP-CENTER-AMT-AMEX
054160                                      WS-GRP-CENTER-AMT-AMEX-NS   03.34F
054080                                      WS-GRP-REIMB-AMT-DISC
054080                                      WS-GRP-REIMB-AMT-DISC-NS    03.34F
054160                                      WS-GRP-IIIAAA-AMT-DISC
054080                                      WS-GRP-IIIAAA-AMT-DISC-NS   03.34F
054170                                      WS-GRP-III999-AMT-DISC
054080                                      WS-GRP-III999-AMT-DISC-NS   03.34F
054180                                      WS-GRP-CENTER-AMT-DISC
054080                                      WS-GRP-CENTER-AMT-DISC-NS   03.34F
054080                                      WS-GRP-REIMB-AMT-PP         03.47
054080                                      WS-GRP-REIMB-AMT-PP-NS      03.47
054160                                      WS-GRP-IIIAAA-AMT-PP        03.47
054080                                      WS-GRP-IIIAAA-AMT-PP-NS     03.47
054170                                      WS-GRP-III999-AMT-PP        03.47
054080                                      WS-GRP-III999-AMT-PP-NS     03.47
054180                                      WS-GRP-CENTER-AMT-PP        03.47
054080                                      WS-GRP-CENTER-AMT-PP-NS     03.47
054190     ELSE
054200        MOVE WORK-IIIAAA-AMT       TO OTR-IIIAAA-AMT
054210        MOVE WORK-III999-AMT       TO OTR-III999-AMT
054220        MOVE WORK-CENTER-AMT       TO OTR-CENTER-AMT
054290        PERFORM R-581-TALLY-NOT-ON-US
054290           THRU R-581-EXIT
              PERFORM C-760-TALLY-BAL-REC-OUTPUT                        02.64
                 THRU C-760-EXIT                                        02.64
              IF PET-VALID-RETURN                                       03.31
166530           SUBTRACT WORK-BATCH-AMT FROM WS-GRP-BATCH-AMT
166530           SUBTRACT WORK-REIMB-AMT FROM WS-GRP-REIMB-AMT
166530           SUBTRACT WORK-IIIAAA-AMT FROM WS-GRP-IIIAAA-AMT
166540           SUBTRACT WORK-III999-AMT FROM WS-GRP-III999-AMT
166550           SUBTRACT WORK-CENTER-AMT FROM WS-GRP-CENTER-AMT
166510        ELSE
166480           ADD WORK-BATCH-AMT      TO WS-GRP-BATCH-AMT
166480           ADD WORK-REIMB-AMT      TO WS-GRP-REIMB-AMT
166480           ADD WORK-IIIAAA-AMT     TO WS-GRP-IIIAAA-AMT
166490           ADD WORK-III999-AMT     TO WS-GRP-III999-AMT
166500           ADD WORK-CENTER-AMT     TO WS-GRP-CENTER-AMT.
           MOVE ZEROS                    TO ERROR-CODE-HOLD-TABLE.
054260     MOVE POST-EDIT-TRANS    TO OTR-DATA.
054270     MOVE WS-OTR-KEY         TO OTR-KEY.
054280     WRITE OUT-TRANS-REC.
054290 R-580-EXIT.
054300     EXIT.
054310*
054290 R-581-TALLY-NOT-ON-US.
054330     IF PET-DEST-BANK-KEY NOT = +0
054290        GO TO R-581-EXIT.
096120     IF PET-CARD-USED = 'V'
              IF PET-VALID-RETURN                                       03.31
166530           SUBTRACT WORK-REIMB-AMT FROM WS-GRP-REIMB-AMT-VISA
166530           SUBTRACT WORK-IIIAAA-AMT FROM WS-GRP-IIIAAA-AMT-VISA
166540           SUBTRACT WORK-III999-AMT FROM WS-GRP-III999-AMT-VISA
166550           SUBTRACT WORK-CENTER-AMT FROM WS-GRP-CENTER-AMT-VISA
166510        ELSE
166480           ADD WORK-REIMB-AMT      TO WS-GRP-REIMB-AMT-VISA
166480           ADD WORK-IIIAAA-AMT     TO WS-GRP-IIIAAA-AMT-VISA
166490           ADD WORK-III999-AMT     TO WS-GRP-III999-AMT-VISA
166500           ADD WORK-CENTER-AMT     TO WS-GRP-CENTER-AMT-VISA.
096120     IF PET-CARD-USED = 'M'
              IF PET-VALID-RETURN                                       03.31
166530           SUBTRACT WORK-REIMB-AMT FROM WS-GRP-REIMB-AMT-MC
166530           SUBTRACT WORK-IIIAAA-AMT FROM WS-GRP-IIIAAA-AMT-MC
166540           SUBTRACT WORK-III999-AMT FROM WS-GRP-III999-AMT-MC
166550           SUBTRACT WORK-CENTER-AMT FROM WS-GRP-CENTER-AMT-MC
166510        ELSE
166480           ADD WORK-REIMB-AMT      TO WS-GRP-REIMB-AMT-MC
166480           ADD WORK-IIIAAA-AMT     TO WS-GRP-IIIAAA-AMT-MC
166490           ADD WORK-III999-AMT     TO WS-GRP-III999-AMT-MC
166500           ADD WORK-CENTER-AMT     TO WS-GRP-CENTER-AMT-MC.
096120     IF PET-CARD-USED = 'A'
              IF PET-VALID-RETURN                                       03.31
                IF PET-CARD-TYPE-AMEX-NSETL                             03.34F
166530           SUBTRACT WORK-REIMB-AMT FROM WS-GRP-REIMB-AMT-AMEX-NS  03.34F
166530           SUBTRACT WORK-IIIAAA-AMT FROM WS-GRP-IIIAAA-AMT-AMEX-NS03.34F
166540           SUBTRACT WORK-III999-AMT FROM WS-GRP-III999-AMT-AMEX-NS03.34F
166550           SUBTRACT WORK-CENTER-AMT FROM WS-GRP-CENTER-AMT-AMEX-NS03.34F
                ELSE                                                    03.34F
166530           SUBTRACT WORK-REIMB-AMT FROM WS-GRP-REIMB-AMT-AMEX
166530           SUBTRACT WORK-IIIAAA-AMT FROM WS-GRP-IIIAAA-AMT-AMEX
166540           SUBTRACT WORK-III999-AMT FROM WS-GRP-III999-AMT-AMEX
166550           SUBTRACT WORK-CENTER-AMT FROM WS-GRP-CENTER-AMT-AMEX
                END-IF                                                  03.34F
166510        ELSE
                IF PET-CARD-TYPE-AMEX-NSETL                             03.34F
166530           ADD WORK-REIMB-AMT      TO WS-GRP-REIMB-AMT-AMEX-NS    03.34F
166530           ADD WORK-IIIAAA-AMT     TO WS-GRP-IIIAAA-AMT-AMEX-NS   03.34F
166540           ADD WORK-III999-AMT     TO WS-GRP-III999-AMT-AMEX-NS   03.34F
166550           ADD WORK-CENTER-AMT     TO WS-GRP-CENTER-AMT-AMEX-NS   03.34F
                ELSE                                                    03.34F
166480           ADD WORK-REIMB-AMT      TO WS-GRP-REIMB-AMT-AMEX
166480           ADD WORK-IIIAAA-AMT     TO WS-GRP-IIIAAA-AMT-AMEX
166490           ADD WORK-III999-AMT     TO WS-GRP-III999-AMT-AMEX
166500           ADD WORK-CENTER-AMT     TO WS-GRP-CENTER-AMT-AMEX      03.34F
                END-IF.                                                 03.34F
096120     IF PET-CARD-USED = 'D'
              IF PET-VALID-RETURN                                       03.31
                IF PET-CARD-TYPE-DISCOVER-NSETL                         03.34F
166530           SUBTRACT WORK-REIMB-AMT FROM WS-GRP-REIMB-AMT-DISC-NS  03.34F
166530           SUBTRACT WORK-IIIAAA-AMT FROM WS-GRP-IIIAAA-AMT-DISC-NS03.34F
166540           SUBTRACT WORK-III999-AMT FROM WS-GRP-III999-AMT-DISC-NS03.34F
166550           SUBTRACT WORK-CENTER-AMT FROM WS-GRP-CENTER-AMT-DISC-NS03.34F
                ELSE                                                    03.34F
166530           SUBTRACT WORK-REIMB-AMT FROM WS-GRP-REIMB-AMT-DISC
166530           SUBTRACT WORK-IIIAAA-AMT FROM WS-GRP-IIIAAA-AMT-DISC
166540           SUBTRACT WORK-III999-AMT FROM WS-GRP-III999-AMT-DISC
166550           SUBTRACT WORK-CENTER-AMT FROM WS-GRP-CENTER-AMT-DISC
                END-IF                                                  03.34F
166510        ELSE
                IF PET-CARD-TYPE-DISCOVER-NSETL                         03.34F
166480           ADD WORK-REIMB-AMT      TO WS-GRP-REIMB-AMT-DISC-NS    03.34F
166480           ADD WORK-IIIAAA-AMT     TO WS-GRP-IIIAAA-AMT-DISC-NS   03.34F
166490           ADD WORK-III999-AMT     TO WS-GRP-III999-AMT-DISC-NS   03.34F
166500           ADD WORK-CENTER-AMT     TO WS-GRP-CENTER-AMT-DISC-NS   03.34F
                ELSE                                                    03.34F
166480           ADD WORK-REIMB-AMT      TO WS-GRP-REIMB-AMT-DISC
166480           ADD WORK-IIIAAA-AMT     TO WS-GRP-IIIAAA-AMT-DISC
166490           ADD WORK-III999-AMT     TO WS-GRP-III999-AMT-DISC
166500           ADD WORK-CENTER-AMT     TO WS-GRP-CENTER-AMT-DISC      03.34F
                END-IF.                                                 03.34F
096120     IF PET-CARD-USED = 'Y'                                       03.47
              IF PET-VALID-RETURN                                       03.47
                IF PET-CARD-TYPE-PAYPAL-NSETL                           03.47
166530           SUBTRACT WORK-REIMB-AMT FROM WS-GRP-REIMB-AMT-PP-NS    03.47
166530           SUBTRACT WORK-IIIAAA-AMT FROM WS-GRP-IIIAAA-AMT-PP-NS  03.47
166540           SUBTRACT WORK-III999-AMT FROM WS-GRP-III999-AMT-PP-NS  03.47
166550           SUBTRACT WORK-CENTER-AMT FROM WS-GRP-CENTER-AMT-PP-NS  03.47
                ELSE                                                    03.47
166530           SUBTRACT WORK-REIMB-AMT FROM WS-GRP-REIMB-AMT-PP       03.47
166530           SUBTRACT WORK-IIIAAA-AMT FROM WS-GRP-IIIAAA-AMT-PP     03.47
166540           SUBTRACT WORK-III999-AMT FROM WS-GRP-III999-AMT-PP     03.47
166550           SUBTRACT WORK-CENTER-AMT FROM WS-GRP-CENTER-AMT-PP     03.47
                END-IF                                                  03.47
166510        ELSE                                                      03.47
                IF PET-CARD-TYPE-PAYPAL-NSETL                           03.47
166480           ADD WORK-REIMB-AMT      TO WS-GRP-REIMB-AMT-PP-NS      03.47
166480           ADD WORK-IIIAAA-AMT     TO WS-GRP-IIIAAA-AMT-PP-NS     03.47
166490           ADD WORK-III999-AMT     TO WS-GRP-III999-AMT-PP-NS     03.47
166500           ADD WORK-CENTER-AMT     TO WS-GRP-CENTER-AMT-PP-NS     03.47
                ELSE                                                    03.47
166480           ADD WORK-REIMB-AMT      TO WS-GRP-REIMB-AMT-PP         03.47
166480           ADD WORK-IIIAAA-AMT     TO WS-GRP-IIIAAA-AMT-PP        03.47
166490           ADD WORK-III999-AMT     TO WS-GRP-III999-AMT-PP        03.47
166500           ADD WORK-CENTER-AMT     TO WS-GRP-CENTER-AMT-PP        03.47
                END-IF.                                                 03.47
054290 R-581-EXIT.
054300     EXIT.
054310*
054740 R-582-SET-NON-SETL-REIMB.
054080     MOVE +0                       TO PET-MRCH-NON-SETL-REIMB-AMT.
086340     IF PET-MRCH-NF-VISA NOT = 'S'
054080        COMPUTE PET-MRCH-NON-SETL-REIMB-AMT =
054080                PET-MRCH-NON-SETL-REIMB-AMT +
003950                WS-GRP-REIMB-AMT-VISA.
086340     IF PET-MRCH-NF-MC NOT = 'S'
054080        COMPUTE PET-MRCH-NON-SETL-REIMB-AMT =
054080                PET-MRCH-NON-SETL-REIMB-AMT +
003950                WS-GRP-REIMB-AMT-MC.
           COMPUTE PET-MRCH-NON-SETL-REIMB-AMT =                        03.34F
054080             PET-MRCH-NON-SETL-REIMB-AMT +                        03.34F
003950             WS-GRP-REIMB-AMT-AMEX-NS.                            03.34F
           COMPUTE PET-MRCH-NON-SETL-REIMB-AMT =                        03.34F
                   PET-MRCH-NON-SETL-REIMB-AMT +                        03.34F
                   WS-GRP-REIMB-AMT-DISC-NS.                            03.34F
           COMPUTE PET-MRCH-NON-SETL-REIMB-AMT =                        03.47
                   PET-MRCH-NON-SETL-REIMB-AMT +                        03.47
                   WS-GRP-REIMB-AMT-PP-NS.                              03.47
054290 R-582-EXIT.
054300     EXIT.
054310*
       R-585-OUTPUT-REJECT-BATCH.                                       02.88
      *                                                                 02.88
           READ WORK-FILE                                               02.88
             AT END                                                     02.88
                MOVE 'Y'                 TO FIRST-BATCHREC-SW           02.88
                MOVE 'Y'                 TO END-OF-WORK-FILE-SW         02.88
                GO TO R-585-EXIT.                                       02.88
           MOVE WORK-DATA                TO POST-EDIT-TRANS.            02.88
           MOVE WORK-ERROR-CODES         TO ERROR-CODE-HOLD-TABLE.      02.88
           IF PET-VALID-GROUP OR                                        03.31
             (PET-VALID-MONETARY AND                                    03.31
              PET-SUS-FLAG = 'Y')                                       03.31
                 NEXT SENTENCE                                          03.31
           ELSE                                                         02.88
              GO TO R-585-EXIT                                          02.88
           END-IF.                                                      02.88
      *                                                                 02.88
           IF PET-VALID-GROUP                                           03.31
              SET BASDTRAN-TD-GROUP      TO TRUE                        02.88
              MOVE PET-MRCH-ERROR-CODES TO ERROR-CODE-HOLD-TABLE        03.07
           ELSE                                                         02.88
              MOVE WORK-ERROR-CODES      TO ERROR-CODE-HOLD-TABLE       03.07
              SET BASDTRAN-TD-INDIVIDUAL TO TRUE                        02.88
           END-IF.                                                      02.88
           SET BASDTRAN-CT-REJECT        TO TRUE.                       02.88
           MOVE POST-EDIT-TRANS          TO BASDTRAN-TD-PET.            02.88
           PERFORM S-090-LOAD-REJECT-ERRORS                             02.88
              THRU S-090-EXIT                                           02.88
           MOVE ZEROS                    TO ERROR-CODE-HOLD-TABLE.      02.88
           MOVE WORK-EXTRA-DATA          TO BASDTRAN-TD-EXTRA-DATA.     02.88
           IF BASDTRAN-TD-INDIVIDUAL                                    02.99
              MOVE WS-MIS3-CARD-TYPE     TO WS-SAVE-MIS3-TYPE           02.99
              MOVE SPACES                TO BASDTRAN-CARD-TYPE          03.09
              MOVE PET-MIS3-CARD-TYPE(1:1) TO BASDTRAN-CARD-TYPE        02.99
              MOVE PET-MIS3-CARD-TYPE      TO WS-MIS3-CARD-TYPE         03.05
              IF PET-MIS3-CARD-TYPE (1:1) = 'A' OR 'D'                  03.08
                  IF PET-MIS3-CARD-TYPE (1:1) = 'A' AND                 03.16A
                     WS-PLAN-CODE (3:2) = '54'                          03.16A
                      MOVE '3'              TO BASDTRAN-CARD-TYPE (2:1) 03.16A
                  ELSE                                                  03.16A
                  IF PET-MIS3-CARD-TYPE (1:1) = 'A'                     03.09
                      MOVE 'X'              TO BASDTRAN-CARD-TYPE (2:1) 03.09
                  ELSE                                                  03.09
                  IF PET-MIS3-CARD-TYPE (1:1) = 'D'                     03.09
                      MOVE 'S'              TO BASDTRAN-CARD-TYPE (2:1) 03.09
                  ELSE                                                  03.09
                  IF PET-MIS3-CARD-TYPE (1:1) = 'P'                     03.47
                      MOVE 'P'              TO BASDTRAN-CARD-TYPE (2:1) 03.47
                  END-IF                                                03.47
                  END-IF                                                03.47
                  END-IF                                                03.16A
                  END-IF                                                03.09
                  EVALUATE WS-PLAN-CODE                                 03.08
                      WHEN 0104                                         03.08
                      WHEN 0105                                         03.47
                      WHEN 0106                                         03.47F
                          MOVE '1'       TO BASDTRAN-CARD-TYPE (2:1)    03.08
                      WHEN 0204                                         03.47
                      WHEN 0205                                         03.09
                          MOVE '2'       TO BASDTRAN-CARD-TYPE (2:1)    03.08
                  END-EVALUATE                                          03.08
              END-IF                                                    03.08
              IF VALID-MIS3-VISA-CARD-TYPE                              02.99
                 MOVE 'V '               TO BASDTRAN-CARD-TYPE          03.09
              ELSE                                                      02.99
                 IF VALID-MIS3-DB-CARD-TYPE                             02.99
                    MOVE 'P'             TO BASDTRAN-CARD-TYPE          02.99
                 ELSE                                                   02.99
                    IF VALID-MIS3-PD-NET                                02.99
                       MOVE 'N'          TO BASDTRAN-CARD-TYPE          02.99
                    END-IF                                              02.99
                 END-IF                                                 02.99
              END-IF                                                    02.99
              MOVE WS-SAVE-MIS3-TYPE     TO WS-MIS3-CARD-TYPE           02.99
           END-IF.                                                      02.99
           PERFORM Z9TRN-CALL-BASDTRAN                                  02.88
              THRU Z9TRN-EXIT.                                          02.88
      *                                                                 02.88
       R-585-EXIT.                                                      02.88
           EXIT.                                                        02.88
      *                                                                 02.88
054320 R-590-CHANGE-TO-MRCH-SUS.
           PERFORM S-400-PROCESS-REJECT
              THRU S-400-EXIT.
           MOVE ZEROES                 TO PHS-MRCH-DR-ITEMS             02.31
                                          PHS-MRCH-DR-AMT               02.31
                                          PHS-MRCH-CR-ITEMS             02.31
                                          PHS-MRCH-CR-AMT               03.00
                                          PHS-MRCH-DR-ITEMS-NS          03.00
                                          PHS-MRCH-DR-AMT-NS            03.00
                                          PHS-MRCH-CR-ITEMS-NS          03.00
                                          PHS-MRCH-CR-AMT-NS.           03.00
PROMST     MOVE PET-TRANS              TO PHS-MRCH-ORIGINAL-TRAN-CODE.
PROMST     MOVE PET-AUTH-CD            TO PHS-MRCH-AUTH-CODE.
PROMST     MOVE PET-SOURCE-ID          TO PHS-MRCH-SOURCE-ID.
           MOVE PET-ORIG-INT-SETL-GRP  TO PHS-MRCH-OWNER-INST.
           MOVE PET-UNIQUE-TRAN-ID(1:13)
                                       TO PHS-MRCH-USER-REFERENCE-NO.
           MOVE PET-UNIQUE-TRAN-ID     TO PHS-MRCH-UNIQUE-TRAN-ID.
PROMST     MOVE PET-USER-ADJ-REASON    TO PHS-MRCH-USER-ADJ-REASON.
           IF PET-VALID-RETURN                                          03.31
              MOVE '3200'              TO PHS-MRCH-TRANSCODE            03.31
           ELSE                                                         03.31
              MOVE '5800'              TO PHS-MRCH-TRANSCODE            03.31
           END-IF.                                                      03.31
054370     MOVE PET-ORIG-BANK-KEY      TO PHS-MRCH-BANK-KEY.
054380     MOVE PET-MERCH-NMBR         TO PHS-MRCH-MERCH-NMBR.
054390     MOVE +0                     TO PHS-MRCH-TIMESTAMP.
054400     MOVE HLD-WORK-AS-OF-DATE    TO PHS-MRCH-DATE.
054410     MOVE ZERO                   TO PHS-MRCH-ITEMS
054420                                    PHS-MRCH-300-FLAG
054430                                    PHS-MRCH-SUS-NMBR.
054440     MOVE PET-ACQ-AMOUNT         TO PHS-MRCH-AMOUNT.
054480     MOVE PET-ACQ-CURR-CODE      TO PHS-MRCH-CURR-CODE.
054450     MOVE PET-REF-NMBR           TO PHS-MRCH-REF-NMBR
054460                                    PHS-MRCH-ITEM-REF.
054470     MOVE HLD-GRP-AMOUNT         TO PHS-MRCH-SUM-AMOUNT.
           IF (PET-DBI-IS-PIN-DEBIT OR                                  02.96
               PET-DBI-IS-EBT OR                                        02.96
               PET-DBI-IS-DEBIT-NET) AND                                02.96
              PET-RATE-FLAG = 'D'                                       02.21
                 MOVE 'D'              TO PHS-MRCH-GROUP-TYPE           02.21
           ELSE                                                         02.21
              MOVE 'C'                 TO PHS-MRCH-GROUP-TYPE           02.21
           END-IF.                                                      02.21
           MOVE PET-ACCOUNT            TO PHS-MRCH-CHD-ACCOUNT.
054490     MOVE ZEROS                  TO PHS-MRCH-CHD-EXT-7.
054500     MOVE WSL-HOLD-ZERO-LAST-3   TO PHS-MRCH-CHD-EXT-3.
           MOVE PET-MERCH-SEL-TRANS      TO PHS-MRCH-SELECT.
054520     MOVE SPACE                  TO PHS-MRCH-SUS-FLAG.
054530     MOVE PET-ERROR-CD           TO BREAKDOWN-ERROR-CODE.
054540     MOVE BEC-CODE-2             TO PHS-MRCH-ER-CODE.
           MOVE WS-GROUP-REF-ID          TO PHS-MRCH-GROUP-REF-ID.
           MOVE 'DEPOSIT CORR    '       TO PHS-MRCH-ER-16.
           MOVE PET-ADDENDUM-REF-ID      TO WS-ADDENDUM-REF-WORK.
           MOVE WS-ARW-SEQ-NUM           TO PHS-MRCH-ARI-SEQ-NUM.
037460     MOVE BASCRATE-SD-REIMB-CURR-CD-X
037700                                   TO PHS-MRCH-REIMB-CURR-CODE.
054080     MOVE WORK-REIMB-AMT           TO PHS-MRCH-REIMB-AMT.
054370     IF PET-DEST-BANK-KEY = +0
054080        MOVE WORK-REIMB-AMT        TO PHS-MRCH-NON-SETL-REIMB-AMT
054370     ELSE
054080        MOVE +0                    TO PHS-MRCH-NON-SETL-REIMB-AMT.
037460     MOVE BASCRATE-SD-IIIAAA-CURR-CD-X
037700                                   TO PHS-MRCH-IIIAAA-CURR-CODE.
054200     MOVE WORK-IIIAAA-AMT          TO OTR-IIIAAA-AMT
054080                                      PHS-MRCH-IIIAAA-AMT.
054210     MOVE WORK-III999-AMT          TO OTR-III999-AMT.
054220     MOVE WORK-CENTER-AMT          TO OTR-CENTER-AMT.
054340     IF PHS-MRCH-TRANSCODE = '3200'
166530        SUBTRACT WORK-BATCH-AMT    FROM WS-GRP-BATCH-AMT
166530        SUBTRACT WORK-REIMB-AMT    FROM WS-GRP-REIMB-AMT
166530        SUBTRACT WORK-IIIAAA-AMT   FROM WS-GRP-IIIAAA-AMT
166540        SUBTRACT WORK-III999-AMT   FROM WS-GRP-III999-AMT
166550        SUBTRACT WORK-CENTER-AMT   FROM WS-GRP-CENTER-AMT
166510     ELSE
166480        ADD WORK-BATCH-AMT         TO WS-GRP-BATCH-AMT
166480        ADD WORK-REIMB-AMT         TO WS-GRP-REIMB-AMT
166480        ADD WORK-IIIAAA-AMT        TO WS-GRP-IIIAAA-AMT
166490        ADD WORK-III999-AMT        TO WS-GRP-III999-AMT
166500        ADD WORK-CENTER-AMT        TO WS-GRP-CENTER-AMT.
           IF PET-CARD-TYPE-VISA                                        03.22
              IF PEM-NF-VISA NOT = 'S'                                  03.22
                 MOVE 'DEP CORR NSET VS'       TO PHS-MRCH-ER-16        03.22
              END-IF                                                    03.22
           END-IF.                                                      03.22
           IF PET-CARD-TYPE-MC                                          03.22
              IF PEM-NF-MC NOT = 'S'                                    03.22
                 MOVE 'DEP CORR NSET MC'       TO PHS-MRCH-ER-16        03.22
              END-IF                                                    03.22
           END-IF.                                                      03.22
           IF PET-CARD-TYPE-AMEX-NSETL                                  03.34F
              MOVE 'DEP CORR NSET AX'          TO PHS-MRCH-ER-16        03.34F
           END-IF.                                                      03.22
           IF PET-CARD-TYPE-DISCOVER-NSETL                              03.34F
              MOVE 'DEP CORR NSET DS'          TO PHS-MRCH-ER-16        03.34F
           END-IF.                                                      03.22
           IF PET-CARD-TYPE-PAYPAL-NSETL                                03.47
              MOVE 'DEP CORR NSET PP'          TO PHS-MRCH-ER-16        03.47
           END-IF.                                                      03.47
           MOVE WORK-ERROR-CODES         TO PHS-MRCH-ERROR-CODES.
054710     MOVE POST-EDIT-HOLD-SUSPENSE TO OTR-DATA.
054720     MOVE WS-OTR-KEY              TO OTR-KEY.
054730     WRITE OUT-TRANS-REC.
054740 R-590-EXIT.
054750     EXIT.
054310*
054740 R-591-CHECK-NON-SETTLE.
166530     IF WS-GRP-REIMB-AMT-VISA < +0
054330        MULTIPLY WS-GRP-REIMB-AMT-VISA BY -1
054330           GIVING WS-GRP-REIMB-AMT-VISA
054330        MULTIPLY WS-GRP-IIIAAA-AMT-VISA BY -1
054330           GIVING WS-GRP-IIIAAA-AMT-VISA
054330        MULTIPLY WS-GRP-III999-AMT-VISA BY -1
054330           GIVING WS-GRP-III999-AMT-VISA
054330        MULTIPLY WS-GRP-CENTER-AMT-VISA BY -1
054330           GIVING WS-GRP-CENTER-AMT-VISA.
166530     IF WS-GRP-REIMB-AMT-MC < +0
054330        MULTIPLY WS-GRP-REIMB-AMT-MC BY -1
054330           GIVING WS-GRP-REIMB-AMT-MC
054330        MULTIPLY WS-GRP-IIIAAA-AMT-MC BY -1
054330           GIVING WS-GRP-IIIAAA-AMT-MC
054330        MULTIPLY WS-GRP-III999-AMT-MC BY -1
054330           GIVING WS-GRP-III999-AMT-MC
054330        MULTIPLY WS-GRP-CENTER-AMT-MC BY -1
054330           GIVING WS-GRP-CENTER-AMT-MC.
166530     IF WS-GRP-REIMB-AMT-AMEX < +0
054330        MULTIPLY WS-GRP-REIMB-AMT-AMEX BY -1
054330           GIVING WS-GRP-REIMB-AMT-AMEX
054330        MULTIPLY WS-GRP-IIIAAA-AMT-AMEX BY -1
054330           GIVING WS-GRP-IIIAAA-AMT-AMEX
054330        MULTIPLY WS-GRP-III999-AMT-AMEX BY -1
054330           GIVING WS-GRP-III999-AMT-AMEX
054330        MULTIPLY WS-GRP-CENTER-AMT-AMEX BY -1
054330           GIVING WS-GRP-CENTER-AMT-AMEX.
166530     IF WS-GRP-REIMB-AMT-AMEX-NS < +0                             03.34F
054330        MULTIPLY WS-GRP-REIMB-AMT-AMEX-NS BY -1                   03.34F
054330           GIVING WS-GRP-REIMB-AMT-AMEX-NS                        03.34F
054330        MULTIPLY WS-GRP-IIIAAA-AMT-AMEX-NS BY -1                  03.34F
054330           GIVING WS-GRP-IIIAAA-AMT-AMEX-NS                       03.34F
054330        MULTIPLY WS-GRP-III999-AMT-AMEX-NS BY -1                  03.34F
054330           GIVING WS-GRP-III999-AMT-AMEX-NS                       03.34F
054330        MULTIPLY WS-GRP-CENTER-AMT-AMEX-NS BY -1                  03.34F
054330           GIVING WS-GRP-CENTER-AMT-AMEX-NS.                      03.34F
166530     IF WS-GRP-REIMB-AMT-DISC < +0
054330        MULTIPLY WS-GRP-REIMB-AMT-DISC BY -1
054330           GIVING WS-GRP-REIMB-AMT-DISC
054330        MULTIPLY WS-GRP-IIIAAA-AMT-DISC BY -1
054330           GIVING WS-GRP-IIIAAA-AMT-DISC
054330        MULTIPLY WS-GRP-III999-AMT-DISC BY -1
054330           GIVING WS-GRP-III999-AMT-DISC
054330        MULTIPLY WS-GRP-CENTER-AMT-DISC BY -1
054330           GIVING WS-GRP-CENTER-AMT-DISC.
166530     IF WS-GRP-REIMB-AMT-DISC-NS < +0                             03.34F
054330        MULTIPLY WS-GRP-REIMB-AMT-DISC-NS BY -1                   03.34F
054330           GIVING WS-GRP-REIMB-AMT-DISC-NS                        03.34F
054330        MULTIPLY WS-GRP-IIIAAA-AMT-DISC-NS BY -1                  03.34F
054330           GIVING WS-GRP-IIIAAA-AMT-DISC-NS                       03.34F
054330        MULTIPLY WS-GRP-III999-AMT-DISC-NS BY -1                  03.34F
054330           GIVING WS-GRP-III999-AMT-DISC-NS                       03.34F
054330        MULTIPLY WS-GRP-CENTER-AMT-DISC-NS BY -1                  03.34F
054330           GIVING WS-GRP-CENTER-AMT-DISC-NS.                      03.34F
166530     IF WS-GRP-REIMB-AMT-PP < +0                                  03.47
054330        MULTIPLY WS-GRP-REIMB-AMT-PP BY -1                        03.47
054330           GIVING WS-GRP-REIMB-AMT-PP                             03.47
054330        MULTIPLY WS-GRP-IIIAAA-AMT-PP BY -1                       03.47
054330           GIVING WS-GRP-IIIAAA-AMT-PP                            03.47
054330        MULTIPLY WS-GRP-III999-AMT-PP BY -1                       03.47
054330           GIVING WS-GRP-III999-AMT-PP                            03.47
054330        MULTIPLY WS-GRP-CENTER-AMT-PP BY -1                       03.47
054330           GIVING WS-GRP-CENTER-AMT-PP.                           03.47
166530     IF WS-GRP-REIMB-AMT-PP-NS < +0                               03.47
054330        MULTIPLY WS-GRP-REIMB-AMT-PP-NS BY -1                     03.47
054330           GIVING WS-GRP-REIMB-AMT-PP-NS                          03.47
054330        MULTIPLY WS-GRP-IIIAAA-AMT-PP-NS BY -1                    03.47
054330           GIVING WS-GRP-IIIAAA-AMT-PP-NS                         03.47
054330        MULTIPLY WS-GRP-III999-AMT-PP-NS BY -1                    03.47
054330           GIVING WS-GRP-III999-AMT-PP-NS                         03.47
054330        MULTIPLY WS-GRP-CENTER-AMT-PP-NS BY -1                    03.47
054330           GIVING WS-GRP-CENTER-AMT-PP-NS.                        03.47
054120     IF PEM-VISA-NOTONUS-AMT = +0
086340        NEXT SENTENCE
086340     ELSE
086340     IF PEM-NF-VISA NOT = 'S'
054120        MOVE 11                    TO WK-NON-SETL-CARD-TYPE
054120        MOVE PEM-VISA-NOTONUS-AMT  TO WK-NON-SETL-AMT
004000        MOVE WS-GRP-REIMB-AMT-VISA TO WK-NON-SETL-REIMB-AMT
004000        MOVE WS-GRP-IIIAAA-AMT-VISA
004000                                   TO WK-NON-SETL-IIIAAA-AMT
004000        MOVE WS-GRP-III999-AMT-VISA
004000                                   TO WK-NON-SETL-III999-AMT
004000        MOVE WS-GRP-CENTER-AMT-VISA
004000                                   TO WK-NON-SETL-CENTER-AMT
053700        PERFORM R-592-CHANGE-MRCH-NON-SETTLE
053710           THRU R-592-EXIT.
054120     IF PEM-MC-NOTONUS-AMT = +0
086340        NEXT SENTENCE
086340     ELSE
086340     IF PEM-NF-MC NOT = 'S'
054120        MOVE 12                    TO WK-NON-SETL-CARD-TYPE
054120        MOVE PEM-MC-NOTONUS-AMT    TO WK-NON-SETL-AMT
004000        MOVE WS-GRP-REIMB-AMT-MC   TO WK-NON-SETL-REIMB-AMT
004000        MOVE WS-GRP-IIIAAA-AMT-MC  TO WK-NON-SETL-IIIAAA-AMT
004000        MOVE WS-GRP-III999-AMT-MC  TO WK-NON-SETL-III999-AMT
004000        MOVE WS-GRP-CENTER-AMT-MC  TO WK-NON-SETL-CENTER-AMT
053700        PERFORM R-592-CHANGE-MRCH-NON-SETTLE
053710           THRU R-592-EXIT.
           IF PEM-AMEX-NOTONUS-AMT = +0                                 CPS
              NEXT SENTENCE                                             CPS
           ELSE                                                         CPS
           IF WS-GRP-REIMB-AMT-AMEX-NS > +0                             03.34F
054120        MOVE 04                    TO WK-NON-SETL-CARD-TYPE
004000        MOVE WS-GRP-REIMB-AMT-AMEX-NS                             03.34F
                                         TO WK-NON-SETL-AMT             03.34F
                                            WK-NON-SETL-REIMB-AMT       03.34F
004000        MOVE WS-GRP-IIIAAA-AMT-AMEX-NS                            03.34F
004000                                   TO WK-NON-SETL-IIIAAA-AMT
004000        MOVE WS-GRP-III999-AMT-AMEX-NS                            03.34F
004000                                   TO WK-NON-SETL-III999-AMT
004000        MOVE WS-GRP-CENTER-AMT-AMEX-NS                            03.34F
004000                                   TO WK-NON-SETL-CENTER-AMT
053700        PERFORM R-592-CHANGE-MRCH-NON-SETTLE
053710           THRU R-592-EXIT.
           IF PEM-DISC-NOTONUS-AMT = +0
              NEXT SENTENCE
           ELSE
           IF WS-GRP-REIMB-AMT-DISC-NS > +0                             03.34F
054120        MOVE 05                    TO WK-NON-SETL-CARD-TYPE
004000        MOVE WS-GRP-REIMB-AMT-DISC-NS                             03.34F
                                         TO WK-NON-SETL-AMT             03.34F
                                            WK-NON-SETL-REIMB-AMT       03.34F
004000        MOVE WS-GRP-IIIAAA-AMT-DISC-NS                            03.34F
004000                                   TO WK-NON-SETL-IIIAAA-AMT
004000        MOVE WS-GRP-III999-AMT-DISC-NS                            03.34F
004000                                   TO WK-NON-SETL-III999-AMT
004000        MOVE WS-GRP-CENTER-AMT-DISC-NS                            03.34F
004000                                   TO WK-NON-SETL-CENTER-AMT
053700        PERFORM R-592-CHANGE-MRCH-NON-SETTLE
053710           THRU R-592-EXIT.
           IF PEM-PP-NOTONUS-AMT = +0                                   03.47
              NEXT SENTENCE                                             03.47
           ELSE                                                         03.47
           IF WS-GRP-REIMB-AMT-PP-NS > +0                               03.47
054120        MOVE 08                    TO WK-NON-SETL-CARD-TYPE       03.47
004000        MOVE WS-GRP-REIMB-AMT-PP-NS                               03.47
                                         TO WK-NON-SETL-AMT             03.47
                                            WK-NON-SETL-REIMB-AMT       03.47
004000        MOVE WS-GRP-IIIAAA-AMT-PP-NS                              03.47
004000                                   TO WK-NON-SETL-IIIAAA-AMT      03.47
004000        MOVE WS-GRP-III999-AMT-PP-NS                              03.34
004000                                   TO WK-NON-SETL-III999-AMT      03.47
004000        MOVE WS-GRP-CENTER-AMT-PP-NS                              03.47
004000                                   TO WK-NON-SETL-CENTER-AMT      03.47
053700        PERFORM R-592-CHANGE-MRCH-NON-SETTLE                      03.47
053710           THRU R-592-EXIT.                                       03.47
054740 R-591-EXIT.
054750     EXIT.
054310*
054320 R-592-CHANGE-MRCH-NON-SETTLE.
037460     MOVE BASCRATE-SD-BATCH-CURR-CD-X
037700                                   TO PHS-MRCH-CURR-CODE.
037460     MOVE BASCRATE-SD-REIMB-CURR-CD-X
037700                                   TO PHS-MRCH-REIMB-CURR-CODE.
054080     MOVE WK-NON-SETL-REIMB-AMT    TO PHS-MRCH-REIMB-AMT
054080                                      PHS-MRCH-NON-SETL-REIMB-AMT.
054330     IF WK-NON-SETL-AMT < +0
054340        MOVE '32'                  TO WK-NON-SETL-TRAN-PREF
054330        MULTIPLY WK-NON-SETL-AMT BY -1
054330           GIVING WK-NON-SETL-AMT
054350     ELSE
054360        MOVE '58'                  TO WK-NON-SETL-TRAN-PREF.
054360     MOVE WK-NON-SETL-CARD-TYPE    TO WK-NON-SETL-TRAN-SUFF.
054360     MOVE WK-NON-SETL-TRANS        TO PHS-MRCH-TRANSCODE.
054370     MOVE PEM-BANK-KEY             TO PHS-MRCH-BANK-KEY.
054380     MOVE PEM-MERCH-NMBR           TO PHS-MRCH-MERCH-NMBR.
054390     MOVE +0                       TO PHS-MRCH-TIMESTAMP.
054400     MOVE HLD-WORK-AS-OF-DATE      TO PHS-MRCH-DATE.
054410     MOVE ZERO                     TO PHS-MRCH-ITEMS
054420                                      PHS-MRCH-300-FLAG
054430                                      PHS-MRCH-SUS-NMBR.
054440     MOVE WK-NON-SETL-AMT          TO PHS-MRCH-AMOUNT.
054450     MOVE WK-GROUP-REF-NMBR        TO PHS-MRCH-REF-NMBR
054460                                      PHS-MRCH-ITEM-REF.
054470     MOVE WK-NON-SETL-AMT          TO PHS-MRCH-SUM-AMOUNT.
054480     MOVE ZEROS                    TO PHS-MRCH-CHD-ACCOUNT.
054490     MOVE ZEROS                    TO PHS-MRCH-CHD-EXT-7.
054500     MOVE ZEROS                    TO PHS-MRCH-CHD-EXT-3.
           MOVE PET-MERCH-SEL-TRANS      TO PHS-MRCH-SELECT.
054530     MOVE SPACE                    TO PHS-MRCH-SUS-FLAG.
054540     MOVE ZEROS                    TO PHS-MRCH-ER-CODE.
054560     IF WK-NON-SETL-CARD-TYPE = '03'
054560        MOVE 'NON-SETTLED PL  '     TO PHS-MRCH-ER-16
054570     ELSE
054560     IF WK-NON-SETL-CARD-TYPE = '04'
054560        MOVE 'NON-SETTLED AMEX'     TO PHS-MRCH-ER-16
054570     ELSE
054580     IF WK-NON-SETL-CARD-TYPE = '05'
054590        MOVE 'NON-SETTLED DISC'     TO PHS-MRCH-ER-16
054570     ELSE                                                         03.47
054580     IF WK-NON-SETL-CARD-TYPE = '08'                              03.47
054590        MOVE 'NON-SETTLED PAYP'     TO PHS-MRCH-ER-16             03.47
054600     ELSE
054610     IF WK-NON-SETL-CARD-TYPE = '11'
054590        MOVE 'NON-SETTLED VISA'    TO PHS-MRCH-ER-16
054600     ELSE
054610     IF WK-NON-SETL-CARD-TYPE = '12'
054590        MOVE 'NON-SETTLED MC  '    TO PHS-MRCH-ER-16.             03.31
037460     MOVE BASCRATE-SD-IIIAAA-CURR-CD-X
037700                                   TO PHS-MRCH-IIIAAA-CURR-CODE.
054200     MOVE WK-NON-SETL-IIIAAA-AMT   TO OTR-IIIAAA-AMT
054080                                      PHS-MRCH-IIIAAA-AMT.
054210     MOVE WK-NON-SETL-III999-AMT   TO OTR-III999-AMT.
054220     MOVE WK-NON-SETL-CENTER-AMT   TO OTR-CENTER-AMT.
054710     MOVE POST-EDIT-HOLD-SUSPENSE  TO OTR-DATA.
054720     MOVE WS-OTR-KEY               TO OTR-KEY.
054730     WRITE OUT-TRANS-REC.
054740 R-592-EXIT.
054750     EXIT.
054750*
054760 R-595-SEL-MRCH-TRANS.
           IF PET-TRANS = '4530' OR '4531' OR '9900'
              GO TO R-595-EXIT.
           IF PET-MERCH-SEL-TRANS = 'G'
              MOVE 'N'                   TO PET-MERCH-SEL-TRANS
              GO TO R-595-EXIT.
054800     IF  FIRST-BATCHREC-SW     = 'Y'
054810         MOVE 'N'              TO  FIRST-BATCHREC-SW
054820         IF PET-VALID-BATCH                                       03.31
054830             MOVE 'Y'          TO  SEL-ALL-BATCH-TRANS
054840             GO TO R-595-EXIT
054850         ELSE
054860             MOVE 'N'          TO  SEL-ALL-BATCH-TRANS
054870             GO TO R-595-EXIT.
054880     MOVE SEL-ALL-BATCH-TRANS  TO  PET-MERCH-SEL-TRANS.
054890 R-595-EXIT.
054900     EXIT.
054910*
054920 R-600-GROUP-SUM-BREAK.
054930     IF GR-SUM-ITEMS-CTR EQUAL ZERO
051000         MOVE '*' TO RND1-SUS-FLAG
051000                     RND1-FATAL-FLAG
054950         MOVE 087 TO RND1-ERROR-CD-1
054960         PERFORM S-200-PRINT-NON-MON-DET-1
054970            THRU S-200-EXIT
054980         MOVE 'Y' TO BATCH-REJ-SW
054990         GO TO R-600-BALANCE-GROUP.
           IF NOT HLD-VALID-SUM-GROUP                                   03.31
              MOVE 'GROUP'               TO RSUM-GRP-LIT                03.31
              GO TO R-600-BALANCE-GROUP                                 03.31
           END-IF.                                                      03.31
055050*****************************************************************
055050*  COMPUTE PEH-NET-AMT = THE GROUP AMOUNT - THE TOTAL OF THE
055050*  NON SETTLEMENT CARD TYPES.
055050*  EI. 04' - AMEX, '05' - DISCOVER, '08' - PP                     03.47
055050*****************************************************************
           MOVE WORK-NON-SETL-CNT        TO PEH-MRCH-NON-SETL-CNT.      02.86
055060     MOVE WORK-NON-SETL-AMT        TO PEH-NON-SETL-AMT.
055060     MOVE WORK-NON-SETL-REIMB-AMT  TO PEH-MRCH-NON-SETL-REIMB-AMT.
055050     MOVE 'MERCHANT' TO RSUM-GRP-LIT.
055060     MOVE GR-SUM-ITEMS-CTR TO PEH-ITEMS.
055070     MOVE +0                       TO WORK-BATCH-AMT
055070                                      WORK-REIMB-AMT
055070                                      WORK-IIIAAA-AMT
055080                                      WORK-III999-AMT
055090                                      WORK-CENTER-AMT.
113800     MOVE PEM-BATCH-DR-ITEMS       TO PEH-MRCH-DR-ITEMS.
113900     MOVE PEM-BATCH-DR-AMT         TO PEH-MRCH-DR-AMT.
114000     MOVE PEM-BATCH-CR-ITEMS       TO PEH-MRCH-CR-ITEMS.
114100     MOVE PEM-BATCH-CR-AMT         TO PEH-MRCH-CR-AMT.
           MOVE PEM-BATCH-DR-ITEMS-REJ   TO PEH-MRCH-DR-ITEMS-REJ.      02.58
           MOVE PEM-BATCH-DR-AMT-REJ     TO PEH-MRCH-DR-AMT-REJ.        02.58
           MOVE PEM-BATCH-CR-ITEMS-REJ   TO PEH-MRCH-CR-ITEMS-REJ.      02.58
           MOVE PEM-BATCH-CR-AMT-REJ     TO PEH-MRCH-CR-AMT-REJ.        02.58
           MOVE PEM-BATCH-DR-ITEMS-NS    TO PEH-MRCH-DR-ITEMS-NS.       03.00
           MOVE PEM-BATCH-DR-AMT-NS      TO PEH-MRCH-DR-AMT-NS.         03.00
           MOVE PEM-BATCH-CR-ITEMS-NS    TO PEH-MRCH-CR-ITEMS-NS.       03.00
           MOVE PEM-BATCH-CR-AMT-NS      TO PEH-MRCH-CR-AMT-NS.         03.00
           MOVE PEM-BATCH-DR-ITEMS-REJ-NS                               03.10
                                         TO PEH-MRCH-DR-ITEMS-REJ-NS.   03.10
           MOVE PEM-BATCH-DR-AMT-REJ-NS  TO PEH-MRCH-DR-AMT-REJ-NS.     03.10
           MOVE PEM-BATCH-CR-ITEMS-REJ-NS                               03.10
                                         TO PEH-MRCH-CR-ITEMS-REJ-NS.   03.10
           MOVE PEM-BATCH-CR-AMT-REJ-NS  TO PEH-MRCH-CR-AMT-REJ-NS.     03.10
055100     MOVE POST-EDIT-HOLD-MERCH     TO WORK-DATA.
           PERFORM S-300-WRITE-PET-WORK-REC
              THRU S-300-EXIT.
           IF HLD-SUM-TC-PREF = '28' OR '30'                            03.31
              MOVE '4530'                TO PEM-TC                      03.31
           ELSE                                                         03.31
              MOVE '4531'                TO PEM-TC                      03.31
           END-IF.                                                      03.31
055160     MOVE HLD-BANK-KEY TO PEM-BANK-KEY.
055170     MOVE HLD-BANK-NMBR TO PEM-BANK-NMBR.
055180     MOVE PEH-MERCH-NMBR TO PEM-MERCH-NMBR.
           MOVE PEH-MRCH-SELECT          TO PEM-MRCH-SELECT.
055070     MOVE +0                       TO WORK-BATCH-AMT
055070                                      WORK-REIMB-AMT
055070                                      WORK-IIIAAA-AMT
055080                                      WORK-III999-AMT
055090                                      WORK-CENTER-AMT.
055220     MOVE POST-EDIT-MERCH-TOTALS   TO WORK-DATA.
           PERFORM S-300-WRITE-PET-WORK-REC
              THRU S-300-EXIT.
055240 R-600-BALANCE-GROUP.
055250     MOVE GR-SUM-ITEMS-CTR TO RSUM-CNT.
055260     MOVE CALC-GRP-AMOUNT TO RSUM-CALC.
055270     MOVE HLD-GRP-AMOUNT TO RSUM-AMT.
055280     COMPUTE ST-DIFF = (HLD-GRP-AMOUNT - CALC-GRP-AMOUNT).
055290     MOVE ST-DIFF TO RSUM-DIFF.
055300     CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
055310              C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
055320              C-TYPEA  RSUM-CALC  C-LGTH24
055330                       RSUM-AMT   C-LGTH24
055340                       RSUM-DIFF  C-LGTH24
055350              C-TYPEEND.
           MOVE 'G'                      TO RAD-ED-LINE-TYPE.
           MOVE '0'                      TO RAD-ED-REPORT-TYPE.
           MOVE HLD-GRP-AMOUNT           TO RAD-ED-TRAN-AMT.
           MOVE RPT-SUM-LINE             TO RLW-DETAIL-LINE.
           IF WS-GROUP-TYPE-IS-PBD-EBT
              MOVE 'Y'                   TO RAD-ED-REJECT-IND
           END-IF.
           PERFORM R-920-WRITE-REPORT-RECORD
              THRU R-920-EXIT.
           MOVE REPORT-SORT-KEY          TO WS-RPT-REC-KEY.
           IF WS-RGS-PASSTHRU
              MOVE 1                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           IF WS-RGS-DOWNGRADE
              MOVE 2                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           IF WS-RGS-PBD-EBT
              MOVE 4                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           IF WS-RGS-DEFAULT
              MOVE 8                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           IF WS-RGS-REJECT
              MOVE 9                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           MOVE SPACE                    TO RAD-ED-REJECT-IND.
055420     IF HLD-GRP-AMOUNT = CALC-GRP-AMOUNT
055430         NEXT SENTENCE
055440     ELSE
055450         MOVE 'Y' TO BATCH-REJ-SW.
055460     ADD  GR-SUM-ITEMS-CTR TO SB-CNT.
055470     ADD CALC-GRP-AMOUNT TO SB-CALC-AMT.
055480     MOVE ZERO           TO CALC-GRP-AMOUNT.
055490 R-600-EXIT.
055500     EXIT.
055510*
055520 R-700-RUN-TOTALS.
055530     MOVE 999999                 TO HL1-INST-NBR.
055540     IF SUB-BTCH IS GREATER THAN ZERO
055550     AND WS-HAVE-ASSN-RECS
055560         PERFORM R-710-CREATE-RPT
055570            THRU R-710-EXIT.
055580 R-700-EXIT.
055590     EXIT.
055600*
055610 R-710-CREATE-RPT.
055690     MOVE 'TOTALS '             TO HLB-BATCH-NMBR.
055700     MOVE 0            TO WS-END-OF-ASSN.
055710     CLOSE SYSTEM-ASSN-WORK.
055720     SORT SORT-FILE-2
055730         ON ASCENDING SORT-BANK-KEY
055740                      SORT-CURR-CODE
055750                      SORT-BATCH-NMBR
055760         USING SYSTEM-ASSN-WORK
055770         GIVING SYSTEM-ASSN-WORK.
055780     PERFORM R-715-CREATE-ASSN
055790        THRU R-715-EXIT.
055800 R-710-EXIT.
055810     EXIT.
055820*
055830 R-715-CREATE-ASSN.
055840     OPEN INPUT SYSTEM-ASSN-WORK
055850          OUTPUT SYSTEM-INST-WORK.
055860     READ SYSTEM-ASSN-WORK
055870          INTO  SORTED-ASSN-REC
055880          AT END MOVE 1    TO WS-END-OF-ASSN.
013720     MOVE +0                       TO SB-CNT
013730                                      SB-BATCH-ORIG-AMT
001340                                      SB-BATCH-AMT
001340                                      SB-REIMB-AMT
013750                                      SB-IIIAAA-AMT
013760                                      SB-III999-AMT
013770                                      SB-CENTER-AMT.
055890     MOVE SPACE            TO HL6-LIT.
055900     MOVE SAR-BANK-KEY     TO WS-PREV-BANK
055910                              HL6-BANK.
055920     MOVE 0                TO WS-IS-THIS-INST-BREAK.
055930     PERFORM R-811-WRITE-DETAIL-HEADERS
055940        THRU R-811-EXIT.
055950     PERFORM R-720-LOOP
055960        THRU R-720-EXIT
055970             UNTIL WS-ASSN-ENDED.
055980     PERFORM R-725-INST-BREAK
055990        THRU R-725-EXIT.
056000     PERFORM W-100-FINAL-REPORT
056010        THRU W-100-EXIT.
056020     CLOSE SYSTEM-INST-WORK.
056030 R-715-EXIT.
056040     EXIT.
056050*
056060 R-720-LOOP.
056070     IF SAR-BANK-INST NOT = WS-PREV-INST
056080       PERFORM R-725-INST-BREAK
056090          THRU R-725-EXIT
056100     ELSE
056110     IF SAR-BANK-ASSOC NOT = WS-PREV-ASSOC
056120       PERFORM R-730-ASSN-BREAK
056130          THRU R-730-EXIT
056140     ELSE
056150     IF SAR-CURR-CODE NOT = WS-PREV-CURR
056160       PERFORM R-735-CURRENCY-BREAK
056170          THRU R-735-EXIT
056180     ELSE
056190     IF SAR-BATCH-NMBR NOT EQUAL WS-PREV-BATCH
056200       PERFORM R-740-WRITE-BATCH-DETAIL
056210          THRU R-740-EXIT
056220     ELSE
056230       DISPLAY 'ERROR IN OUTPUT OF SORT FOR ASSOCIATION REPORT'
056240       DISPLAY 'ASSN RECORD ' SORTED-ASSN-REC.
056250     MOVE SAR-BANK-KEY     TO WS-PREV-BANK.
056260     READ SYSTEM-ASSN-WORK
056270          INTO  SORTED-ASSN-REC
056280          AT END MOVE 1   TO WS-END-OF-ASSN.
056290 R-720-EXIT.
056300     EXIT.
056310*
056320 R-725-INST-BREAK.
056330     MOVE 1            TO WS-IS-THIS-INST-BREAK.
056340     PERFORM R-730-ASSN-BREAK
056350        THRU R-730-EXIT.
056360     PERFORM V-105-INST-REPORT
056370        THRU V-105-EXIT.
056380     MOVE 0            TO WS-IS-THIS-INST-BREAK.
056390     IF NOT WS-ASSN-ENDED
056400        CLOSE SYSTEM-INST-WORK
056410        OPEN OUTPUT SYSTEM-INST-WORK
056420        PERFORM R-735-CURRENCY-BREAK
056430           THRU R-735-EXIT.
056440 R-725-EXIT.
056450     EXIT.
056460*
056470 R-730-ASSN-BREAK.
056480     PERFORM R-731-CURR-TOTALS
056490        THRU R-731-EXIT.
056500     PERFORM V-900-HEADINGS-ASSN-BREAK
056510        THRU V-900-EXIT.
056520     MOVE SAR-BANK-KEY TO HL6-BANK.
056530     MOVE HLD-BANK-KEY TO SB-BANK-KEY.
056540     MOVE HLD-BANK-KEY TO WS-BANK-2.
056550     MOVE 999          TO WS-BANK-ASSN.
056560     MOVE WS-BANK      TO HLC-CURR-BANK.
056570     MOVE SPACES       TO SCD3-LIT.
056580     MOVE WS-CT-BATCH-CNT          TO SCD3-BATCH-CNT
056590                                      SB-CNT.
056600     MOVE WS-CT-ITEM-CNT           TO SCD3-ITEM-CNT
056610                                      SB-BATCH-ORIG-AMT.
056620     MOVE WS-CT-BATCH-AMT          TO SCD3-BATCH-AMT
056630                                      SB-IIIAAA-AMT.
056710     MOVE SB-IIIAAA-CURR-CODE      TO HLC-CURR-CODE-1.
056710     MOVE SB-III999-CURR-CODE      TO HLC-CURR-CODE-2.
056720     MOVE SB-IIIAAA-CURR-NAME      TO HLC-CODE-NAME-1.
056720     MOVE SB-III999-CURR-NAME      TO HLC-CODE-NAME-2.
056910     MOVE HEAD-LINE-CURR           TO RLW-DETAIL-LINE.
056920     PERFORM R-920-WRITE-REPORT-RECORD
056930        THRU R-920-EXIT.
056940     PERFORM R-900-WRITE-TOTAL-RECORD
056950        THRU R-900-EXIT.
056960     MOVE SPACES                   TO SCD1-LIT.
056970     MOVE SCD1-CURR-TTL            TO RLW-DETAIL-LINE.
056980     PERFORM R-920-WRITE-REPORT-RECORD
056990        THRU R-920-EXIT.
057000     PERFORM R-900-WRITE-TOTAL-RECORD
057010        THRU R-900-EXIT.
056650     CALL BACONDEC USING  WS-BANK-999999
056660              C-TYPED  SB-IIIAAA-CURR-DEC
056670              C-TYPEA  SCD3-BATCH-AMT          C-LGTH24
056680              C-TYPEC  SCD3-ITEM-CNT           C-LGTH13
056690                       SCD3-BATCH-CNT          C-LGTH07
056700              C-TYPEEND.
056900     MOVE SB-III999-AMT            TO SCD3-SETTLE-AMT.
056650     CALL BACONDEC USING  WS-BANK-999999
056660              C-TYPED  SB-III999-CURR-DEC
056670              C-TYPEA  SCD3-SETTLE-AMT         C-LGTH24
056700              C-TYPEEND.
057070     MOVE SCD3-DETAIL              TO RLW-DETAIL-LINE.
057080     PERFORM R-920-WRITE-REPORT-RECORD
057090        THRU R-920-EXIT.
057100     PERFORM R-900-WRITE-TOTAL-RECORD
057110        THRU R-900-EXIT.
057120     MOVE SB-IIIAAA-CURR-CODE      TO SB-CURR-CODE.
057130     WRITE SYS-INST-REC FROM SB-TOTAL-REC.
057140     COMPUTE  WS-CT-BATCH-CNT    = +0.
057150     COMPUTE  WS-CT-ITEM-CNT     = +0.
057160     COMPUTE  WS-CT-BATCH-AMT    = +0.
057170     COMPUTE  WS-CT-SETTLE-AMT   = +0.
013720     MOVE +0                       TO SB-CNT
013730                                      SB-BATCH-ORIG-AMT
001340                                      SB-BATCH-AMT
001340                                      SB-REIMB-AMT
013750                                      SB-IIIAAA-AMT
013760                                      SB-III999-AMT
013770                                      SB-CENTER-AMT.
057240     IF NOT WS-INST-BREAK
057250       PERFORM R-811-WRITE-DETAIL-HEADERS
057260          THRU R-811-EXIT
057270       PERFORM R-735-CURRENCY-BREAK
057280          THRU R-735-EXIT.
057290 R-730-EXIT.
057300     EXIT.
057310*
057320 R-731-CURR-TOTALS.
057330     MOVE 'BATCHES'    TO SCD1-LIT.
057340     MOVE SCD1-CURR-TTL         TO RLW-DETAIL-LINE.
057350     PERFORM R-920-WRITE-REPORT-RECORD
057360        THRU R-920-EXIT.
057370     PERFORM R-900-WRITE-TOTAL-RECORD
057380        THRU R-900-EXIT.
057390     COMPUTE WS-BA-BATCH-CNT = WS-BR-BATCH-CNT - WS-BD-BATCH-CNT.
057400     COMPUTE WS-BA-ITEM-CNT  = WS-BR-ITEM-CNT - WS-BD-ITEM-CNT.
057410     COMPUTE WS-BA-ORIG-AMT  = WS-BR-ORIG-AMT - WS-BD-ORIG-AMT.
057420     COMPUTE WS-BA-BATCH-AMT = WS-BR-BATCH-AMT - WS-BD-BATCH-AMT.
057430     COMPUTE WS-BA-SETTLE-AMT = WS-BR-SETTLE-AMT -
057440                                WS-BD-SETTLE-AMT.
057450     MOVE 'READ    '      TO SCD2-LIT.
057460     MOVE WS-BR-BATCH-CNT TO SCD2-BATCH-CNT.
057470     MOVE WS-BR-ITEM-CNT TO  SCD2-ITEM-CNT.
057480     MOVE WS-BR-ORIG-AMT TO  SCD2-ORIG-AMT.
057490     MOVE WS-BR-BATCH-AMT TO  SCD2-BATCH-AMT.
057500     MOVE WS-BR-SETTLE-AMT TO SCD2-SETTLE-AMT.
057510     MOVE 0               TO SCD2-CC.
057520     PERFORM R-732-CALL-BACONDEC
057530        THRU R-732-EXIT.
057540     MOVE 'DELETED '      TO SCD2-LIT.
057550     MOVE WS-BD-BATCH-CNT TO SCD2-BATCH-CNT.
057560     MOVE WS-BD-ITEM-CNT TO  SCD2-ITEM-CNT.
057570     MOVE WS-BD-ORIG-AMT TO  SCD2-ORIG-AMT.
057580     MOVE WS-BD-BATCH-AMT TO  SCD2-BATCH-AMT.
057590     MOVE WS-BD-SETTLE-AMT TO SCD2-SETTLE-AMT.
057600     MOVE SPACE           TO SCD2-CC.
057610     PERFORM R-732-CALL-BACONDEC
057620        THRU R-732-EXIT.
057630     MOVE 'ACCEPTED'      TO SCD2-LIT.
057640     MOVE WS-BA-BATCH-CNT TO SCD2-BATCH-CNT.
057650     MOVE WS-BA-ITEM-CNT TO  SCD2-ITEM-CNT.
057660     MOVE WS-BA-ORIG-AMT TO  SCD2-ORIG-AMT.
057670     MOVE WS-BA-BATCH-AMT TO  SCD2-BATCH-AMT.
057680     MOVE WS-BA-SETTLE-AMT TO SCD2-SETTLE-AMT.
057690     MOVE SPACE           TO SCD2-CC.
057700     PERFORM R-732-CALL-BACONDEC
057710        THRU R-732-EXIT.
057720     PERFORM R-733-READY-FOR-NXT-CURR
057730        THRU R-733-EXIT.
057740 R-731-EXIT.
057750     EXIT.
057760*
057770 R-732-CALL-BACONDEC.
057790     CALL BACONDEC USING  WS-BANK-999999
057800              C-TYPED  SB-BATCH-CURR-DEC
057810              C-TYPEA  SCD2-ORIG-AMT           C-LGTH24
057820                       SCD2-BATCH-AMT          C-LGTH24
057830              C-TYPEC  SCD2-ITEM-CNT           C-LGTH13
057840                       SCD2-BATCH-CNT          C-LGTH07
057850              C-TYPEEND.
057870     CALL BACONDEC USING  WS-BANK-999999
057880              C-TYPED  SB-IIIAAA-CURR-DEC
057890              C-TYPEA  SCD2-SETTLE-AMT         C-LGTH24
057900              C-TYPEEND.
057910     MOVE SCD2-DETAIL           TO RLW-DETAIL-LINE.
057920     PERFORM R-920-WRITE-REPORT-RECORD
057930        THRU R-920-EXIT.
057940     PERFORM R-900-WRITE-TOTAL-RECORD
057950        THRU R-900-EXIT.
057960 R-732-EXIT.
057970     EXIT.
057980*
057990 R-733-READY-FOR-NXT-CURR.
058000     ADD WS-BA-BATCH-CNT   TO WS-CT-BATCH-CNT.
058010     ADD WS-BA-ITEM-CNT    TO WS-CT-ITEM-CNT.
058020     ADD WS-BA-SETTLE-AMT  TO WS-CT-BATCH-AMT.
058030     COMPUTE WS-BA-BATCH-CNT = +0.
058040     COMPUTE WS-BA-ITEM-CNT  = +0.
058050     COMPUTE WS-BA-ORIG-AMT  = +0.
058060     COMPUTE WS-BA-BATCH-AMT = +0.
058070     COMPUTE WS-BA-SETTLE-AMT = +0.
058080     COMPUTE WS-BR-BATCH-CNT = +0.
058090     COMPUTE WS-BR-ITEM-CNT  = +0.
058100     COMPUTE WS-BR-ORIG-AMT  = +0.
058110     COMPUTE WS-BR-BATCH-AMT = +0.
058120     COMPUTE WS-BR-SETTLE-AMT = +0.
058130     COMPUTE WS-BD-BATCH-CNT = +0.
058140     COMPUTE WS-BD-ITEM-CNT  = +0.
058150     COMPUTE WS-BD-ORIG-AMT  = +0.
058160     COMPUTE WS-BD-BATCH-AMT = +0.
058170     COMPUTE WS-BD-SETTLE-AMT = +0.
058180 R-733-EXIT.
058190     EXIT.
058200*
058370 R-735-CURRENCY-BREAK.
058380     MOVE SAR-CURR-CODE TO WS-PREV-CURR.
058390     MOVE 0              TO SCD1-CC.
058400     IF WS-BR-BATCH-CNT NOT = +0
058410        MOVE WS-PREV-BANK    TO HL6-BANK
058420        PERFORM R-731-CURR-TOTALS
058430           THRU R-731-EXIT
058440     ELSE
058450        MOVE SAR-BANK-KEY    TO HL6-BANK.
058460     IF WS-RPT-LINE-CNT > 40
058470        PERFORM R-811-WRITE-DETAIL-HEADERS
058480           THRU R-811-EXIT.
058500     MOVE SAR-BANK-KEY             TO HLC-CURR-BANK.
058490     MOVE SAR-CURR-CODE            TO HLC-CURR-CODE-1.
058610     MOVE SAR-BATCH-CURR-NAME      TO HLC-CODE-NAME-1.
058490     MOVE SAR-IIIAAA-CURR-CODE     TO HLC-CURR-CODE-2.
059540     MOVE SAR-IIIAAA-CURR-NAME     TO HLC-CODE-NAME-2.
058680     MOVE HEAD-LINE-CURR        TO RLW-DETAIL-LINE.
058690     PERFORM R-920-WRITE-REPORT-RECORD
058700        THRU R-920-EXIT.
058710     PERFORM R-900-WRITE-TOTAL-RECORD
058720        THRU R-900-EXIT.
058730     PERFORM R-740-WRITE-BATCH-DETAIL
058740        THRU R-740-EXIT.
058750 R-735-EXIT.
058760     EXIT.
058770*
058780 R-740-WRITE-BATCH-DETAIL.
           MOVE SPACES                   TO BUR-BATCH-UPDATE-RECORD.    02.87
           INITIALIZE BUR-BATCH-UPDATE-RECORD.                          02.87
           MOVE SAR-CURR-CODE            TO BUR-CURR-CODE.              02.87
           MOVE SAR-BANK-KEY-2           TO BUR-INST-CODE.              02.87
           MOVE SAR-INT-SETL-GRP         TO BUR-INT-SETL-GRP.           02.87
           MOVE PSI-RUN                  TO BUR-SOURCE-ID.              02.87
           MOVE WS-DATE-WORK             TO BUR-WAO-DATE.               02.87
058790     ADD 1                 TO WS-BR-BATCH-CNT.
058800     ADD SAR-CNT           TO WS-BR-ITEM-CNT.
058810     ADD SAR-BATCH-ORIG-AMT        TO WS-BR-ORIG-AMT.
058820     ADD SAR-BATCH-AMT             TO WS-BR-BATCH-AMT.
058830     ADD SAR-IIIAAA-AMT            TO WS-BR-SETTLE-AMT.
           MOVE SAR-BATCH-ORIG-AMT       TO BUR-BATCH-ORIG-AMT.         02.87
           IF SAR-BATCH-ORIG-AMT < +0                                   02.87
              MOVE '-'                   TO BUR-BATCH-ORIG-AMT-SGN      02.87
           ELSE                                                         02.87
              MOVE '+'                   TO BUR-BATCH-ORIG-AMT-SGN      02.87
           END-IF.                                                      02.87
           MOVE SAR-BATCH-AMT            TO BUR-BATCH-AMT.              02.87
           IF SAR-BATCH-AMT < +0                                        02.87
              MOVE '-'                   TO BUR-BATCH-AMT-SGN           02.87
           ELSE                                                         02.87
              MOVE '+'                   TO BUR-BATCH-AMT-SGN           02.87
           END-IF.                                                      02.87
           MOVE SAR-REIMB-AMT            TO BUR-REIMB-AMT.              02.87
           IF SAR-REIMB-AMT < +0                                        02.87
              MOVE '-'                   TO BUR-REIMB-AMT-SGN           02.87
           ELSE                                                         02.87
              MOVE '+'                   TO BUR-REIMB-AMT-SGN           02.87
           END-IF.                                                      02.87
           MOVE SAR-IIIAAA-AMT           TO BUR-IIIAAA-AMT.             02.87
           IF SAR-IIIAAA-AMT < +0                                       02.87
              MOVE '-'                   TO BUR-IIIAAA-AMT-SGN          02.87
           ELSE                                                         02.87
              MOVE '+'                   TO BUR-IIIAAA-AMT-SGN          02.87
           END-IF.                                                      02.87
           MOVE SAR-III999-AMT           TO BUR-III999-AMT.             02.87
           IF SAR-III999-AMT < +0                                       02.87
              MOVE '-'                   TO BUR-III999-AMT-SGN          02.87
           ELSE                                                         02.87
              MOVE '+'                   TO BUR-III999-AMT-SGN          02.87
           END-IF.                                                      02.87
           MOVE SAR-CENTER-AMT           TO BUR-CENTER-AMT.             02.87
           IF SAR-CENTER-AMT < +0                                       02.87
              MOVE '-'                   TO BUR-CENTER-AMT-SGN          02.87
           ELSE                                                         02.87
              MOVE '+'                   TO BUR-CENTER-AMT-SGN          02.87
           END-IF.                                                      02.87
           MOVE SAR-IIIAAA-CURR-CODE     TO SB-IIIAAA-CURR-CODE         02.87
                                            BUR-IIIAAA-CURR-CODE.       02.87
           MOVE SAR-III999-CURR-CODE     TO SB-III999-CURR-CODE         02.87
                                            BUR-III999-CURR-CODE.       02.87
           MOVE SAR-CENTER-CURR-CODE     TO SB-CENTER-CURR-CODE         02.87
                                            BUR-CENTER-CURR-CODE.       02.87
           MOVE SAR-BATCH-CURR-DEC       TO SB-BATCH-CURR-DEC           02.87
                                            BUR-BATCH-CURR-DEC.         02.87
           MOVE SAR-IIIAAA-CURR-DEC      TO SB-IIIAAA-CURR-DEC          02.87
                                            BUR-IIIAAA-CURR-DEC.        02.87
           MOVE SAR-III999-CURR-DEC      TO SB-III999-CURR-DEC          02.87
                                            BUR-III999-CURR-DEC.        02.87
           MOVE SAR-CENTER-CURR-DEC      TO SB-CENTER-CURR-DEC          02.87
                                            BUR-CENTER-CURR-DEC.        02.87
           MOVE SAR-BATCH-CURR-NAME      TO SB-BATCH-CURR-NAME          02.87
                                            BUR-BATCH-CURR-NAME.        02.87
           MOVE SAR-IIIAAA-CURR-NAME     TO SB-IIIAAA-CURR-NAME         02.87
                                            BUR-IIIAAA-CURR-NAME.       02.87
           MOVE SAR-III999-CURR-NAME     TO SB-III999-CURR-NAME         02.87
                                            BUR-III999-CURR-NAME.       02.87
           MOVE SAR-CENTER-CURR-NAME     TO SB-CENTER-CURR-NAME         02.87
                                            BUR-CENTER-CURR-NAME.       02.87
           MOVE SAR-REJ                  TO BUR-REJ.                    02.87
058840     IF SAR-REJ = '**'
058850        PERFORM R-741-REJECT-DETAIL
058860           THRU R-741-EXIT
058870     ELSE
058880        ADD SAR-III999-AMT         TO SB-III999-AMT
058890        ADD SAR-CENTER-AMT         TO SB-CENTER-AMT
058900        MOVE SAR-BATCH-ORIG-AMT    TO SCD1-ORIG-AMT
058910        MOVE SAR-BATCH-AMT         TO SCD1-BATCH-AMT
058920        MOVE SAR-IIIAAA-AMT        TO SCD1-SETTLE-AMT
058930        MOVE SPACE            TO SCD1-REJ.
058940     MOVE SAR-BATCH-FRST-2    TO SCD1-BATCH-FRST-2.
058950     MOVE SAR-BATCH-LAST-4    TO SCD1-BATCH-LAST-4.
           MOVE SAR-BATCH-NMBR           TO BUR-BATCH-NMBR.             02.87
           MOVE SAR-REF                  TO SCD1-REF                    02.87
                                            BUR-REF.                    02.87
           MOVE SAR-CNT                  TO SCD1-ITEM-CNT               02.87
                                            BUR-CNT.                    02.87
           PERFORM C-785-WRITE-BATCH-FILE                               02.87
              THRU C-785-EXIT.                                          02.87
058980     MOVE SAR-BANK-KEY-2      TO HLD-BANK-KEY.
059000     CALL BACONDEC USING  WS-BANK-999999
059010              C-TYPED  SB-BATCH-CURR-DEC
059020              C-TYPEA  SCD1-ORIG-AMT           C-LGTH24
059030                       SCD1-BATCH-AMT          C-LGTH24
059040              C-TYPEC  SCD1-ITEM-CNT           C-LGTH07
059050              C-TYPEEND.
059070     CALL BACONDEC USING  WS-BANK-999999
059080              C-TYPED  SB-IIIAAA-CURR-DEC
059090              C-TYPEA  SCD1-SETTLE-AMT         C-LGTH24
059100              C-TYPEEND.
059110     MOVE SCD1-DETAIL           TO RLW-DETAIL-LINE.
059120     PERFORM R-920-WRITE-REPORT-RECORD
059130        THRU R-920-EXIT.
059140     PERFORM R-900-WRITE-TOTAL-RECORD
059150        THRU R-900-EXIT.
059160     MOVE ' '            TO SCD1-CC.
059170 R-740-EXIT.
059180     EXIT.
059190*
059200 R-741-REJECT-DETAIL.
059210     ADD 1                 TO WS-BD-BATCH-CNT.
059220     ADD SAR-CNT           TO WS-BD-ITEM-CNT.
059230     MOVE SAR-REJ          TO SCD1-REJ.
059240     IF SAR-BATCH-ORIG-AMT NUMERIC
059250           MOVE SAR-BATCH-ORIG-AMT TO SCD1-ORIG-AMT
059260           ADD SAR-BATCH-ORIG-AMT  TO WS-BD-ORIG-AMT
059270     ELSE
059280           MOVE ZEROS            TO SCD1-ORIG-AMT.
059290     IF SAR-BATCH-AMT NUMERIC
059300           ADD SAR-BATCH-AMT       TO WS-BD-BATCH-AMT
059310           MOVE SAR-BATCH-AMT      TO SCD1-BATCH-AMT
059320     ELSE
059330           MOVE ZEROS            TO SCD1-BATCH-AMT.
059340     IF SAR-IIIAAA-AMT NUMERIC
059350        ADD SAR-IIIAAA-AMT      TO WS-BD-SETTLE-AMT
059360        MOVE SAR-IIIAAA-AMT     TO SCD1-SETTLE-AMT
059370     ELSE
059380        MOVE ZEROS            TO SCD1-SETTLE-AMT.
059390 R-741-EXIT.
059400     EXIT.
059410*
       R-790-ZERO-REPORT.
      *
      * WRITE NULL RECORDS FOR REPORTS
      *
           MOVE 999999                   TO HL1-INST-NBR.
           MOVE WS-REPORT-LIT            TO HL2-TITLE.
           MOVE 'TOTALS '                TO HLB-BATCH-NMBR.
           MOVE '      NO RECORDS THIS RUN     '
                                         TO HLB-LIT.
           MOVE 1                        TO WS-END-OF-ASSN.
           PERFORM W-600-BATCH-FINAL
              THRU W-600-EXIT.
       R-790-EXIT.
           EXIT.
      *
       R-795-NULL-REPORT.
      *
      * WRITE NULL RECORDS FOR REPORTS
      *
           MOVE '      NO RECORDS THIS RUN     '
                                         TO HLB-LIT.
           MOVE 'E'                      TO RAD-ED-LINE-TYPE.
           MOVE +0                       TO RAD-ED-TRAN-AMT.
           MOVE HEAD-LINE-BATCH          TO WS-RPT-REC-LINE.
           MOVE REPORT-SORT-KEY          TO WS-RPT-REC-KEY.
           PERFORM R-800-WRITE-REPORT-RECS
              THRU R-800-EXIT.
           MOVE '0'                      TO RAD-ED-LINE-TYPE.
           MOVE 0                        TO RAD-ED-REPORT-TYPE.
      *
       R-795-EXIT.
           EXIT.
      *
       R-800-WRITE-REPORT-RECS.
      *
           MOVE REPORT-EXTRA-DATA        TO WS-RPT-REC-EXTRA.
           IF RAD-REPORT-IS-PLAN-ADD
              IF NOT PARM-IS-1-SIDED                                    03.31
                 WRITE PASSTHRU-RPT-REC FROM WS-RPT-REC                 03.31
              END-IF                                                    03.31
           END-IF.
           IF RAD-REPORT-IS-DOWNGRADE
              IF NOT PARM-IS-1-SIDED                                    03.31
                 WRITE DOWNGRADE-RPT-REC FROM WS-RPT-REC                03.31
              END-IF                                                    03.31
           END-IF.
           IF RAD-REPORT-IS-PBD-EBT
              IF NOT PARM-IS-1-SIDED                                    03.31
                 WRITE PBD-EBT-RPT-REC FROM WS-RPT-REC                  03.31
              END-IF                                                    03.31
           END-IF.
           IF RAD-REPORT-IS-DEFAULT
              IF NOT PARM-IS-1-SIDED                                    03.31
                 WRITE DEFAULT-RPT-REC FROM WS-RPT-REC                  03.31
              END-IF                                                    03.31
           END-IF.
           IF RAD-REPORT-IS-REJECT
              IF PARM-IS-TEST AND
                 WS-RRK-INST-IS-DEFAULT
                    NEXT SENTENCE
              ELSE
                 WRITE REJECT-RPT-REC FROM WS-RPT-REC
              END-IF
           END-IF.
      *
       R-800-EXIT.
           EXIT.
      *
059650 R-811-WRITE-DETAIL-HEADERS.
059660     PERFORM R-815-WRITE-HEADERS
059670        THRU R-815-EXIT.
059680     MOVE HEAD-LINE-4           TO RLW-DETAIL-LINE.
059690     PERFORM R-920-WRITE-REPORT-RECORD
059700        THRU R-920-EXIT.
059710     PERFORM R-900-WRITE-TOTAL-RECORD
059720        THRU R-900-EXIT.
059730     MOVE HEAD-LINE-5           TO RLW-DETAIL-LINE.
059740     PERFORM R-920-WRITE-REPORT-RECORD
059750        THRU R-920-EXIT.
059760     PERFORM R-900-WRITE-TOTAL-RECORD
059770        THRU R-900-EXIT.
059780     MOVE HEAD-LINE-6           TO RLW-DETAIL-LINE.
059790     PERFORM R-920-WRITE-REPORT-RECORD
059800        THRU R-920-EXIT.
059810     PERFORM R-900-WRITE-TOTAL-RECORD
059820        THRU R-900-EXIT.
059830 R-811-EXIT.
059840     EXIT.
059850*
059860 R-815-WRITE-HEADERS.
059870     IF HL1-INST-NBR   NOT = WS-HOLD-BANK-NBR
059880        PERFORM T-775-GET-BANK-NAMES
059890           THRU T-775-EXIT.
059900     ADD 1 TO PGE-CTR
059910              TTL-PGE-CTR.
059920     MOVE PGE-CTR TO HL1-PAGE.
015630     MOVE HL1-INST-NBR             TO RAD-SK-INST.
015630     MOVE HL1-PAGE                 TO RAD-SK-PAGE.
015630     MOVE +0                       TO RAD-SK-LINE.
           MOVE REPORT-EXTRA-DATA        TO WS-SAVE-REPORT-EXTRA-DATA.
           MOVE SPACES                   TO RAD-ED-MRCH-NMBR
                                            RAD-ED-GROUP-REF-NO.
           MOVE 1                        TO WS-RPT-LINE-CNT.
059930     MOVE HEAD-LINE-1           TO RLW-DETAIL-LINE.
059940     PERFORM R-920-WRITE-REPORT-RECORD
059950        THRU R-920-EXIT.
008750     MOVE WS-RPT-LINE-CNT          TO RAD-SK-LINE.
059960     MOVE TTL-PGE-CTR TO HL1-PAGE.
059970     MOVE HEAD-LINE-1           TO RLW-DETAIL-LINE.
059980     PERFORM R-900-WRITE-TOTAL-RECORD
059990        THRU R-900-EXIT.
060000     MOVE HEAD-LINE-2           TO RLW-DETAIL-LINE.
060010     PERFORM R-920-WRITE-REPORT-RECORD
060020        THRU R-920-EXIT.
060030     PERFORM R-900-WRITE-TOTAL-RECORD
060040        THRU R-900-EXIT.
060050     MOVE HEAD-LINE-BATCH       TO RLW-DETAIL-LINE.
060060     PERFORM R-920-WRITE-REPORT-RECORD
060070        THRU R-920-EXIT.
060080     PERFORM R-900-WRITE-TOTAL-RECORD
060090        THRU R-900-EXIT.
           MOVE WS-SAVE-REPORT-EXTRA-DATA
                                         TO REPORT-EXTRA-DATA.
060100 R-815-EXIT.
060110     EXIT.
060120*
060130 R-900-WRITE-TOTAL-RECORD.
060140     WRITE TTL-REC FROM RLW-DETAIL-LINE.
060150     PERFORM R-910-DET-TTL-LINE-SPACING
060160        THRU R-910-EXIT.
060170 R-900-EXIT.
060180     EXIT.
060190*
060200 R-910-DET-TTL-LINE-SPACING.
060210     IF RLW-DL-CC = '1'
060220        MOVE 1                  TO WS-TTL-LINE-CNT
060230     ELSE IF RLW-DL-CC = ' '
060240        ADD 1                   TO WS-TTL-LINE-CNT
060250     ELSE IF RLW-DL-CC = '0'
060260        ADD 2                   TO WS-TTL-LINE-CNT
060270     ELSE IF RLW-DL-CC = '-'
060280        ADD 3                   TO WS-TTL-LINE-CNT.
060290 R-910-EXIT.
060300     EXIT.
060310*
060320 R-920-WRITE-REPORT-RECORD.
           IF WS-RPT-LINE-CNT > 54
              MOVE RLW-DETAIL-LINE       TO WS-SAVE-RLW-DETAIL-LINE
              MOVE REPORT-EXTRA-DATA     TO WS-SAVE-REPORT-EXTRA-DATA
              PERFORM S-100-PRINT-PAGE-HDR
                 THRU S-100-EXIT
              MOVE WS-SAVE-RLW-DETAIL-LINE
                                         TO RLW-DETAIL-LINE
              MOVE WS-SAVE-REPORT-EXTRA-DATA
                                         TO REPORT-EXTRA-DATA
              MOVE '0'                   TO RLW-DL-CC.
060360     PERFORM R-921-WRITE-REPORT-REC
060360        THRU R-921-EXIT.
060360 R-920-EXIT.
060370     EXIT.
060380*
060360 R-921-WRITE-REPORT-REC.
           MOVE REPORT-SORT-KEY          TO WS-RPT-REC-KEY.
           MOVE REPORT-EXTRA-DATA        TO WS-RPT-REC-EXTRA.
           MOVE RLW-DETAIL-LINE          TO WS-RPT-REC-LINE.
           IF PARM-IS-TEST AND
              WS-RRK-INST-IS-DEFAULT
                 NEXT SENTENCE
           ELSE
              WRITE RPT-REC FROM WS-RPT-REC
           END-IF.
060340     PERFORM R-930-DET-RPT-LINE-SPACING
060350        THRU R-930-EXIT.
008750     MOVE WS-RPT-LINE-CNT          TO RAD-SK-LINE.
060360 R-921-EXIT.
060370     EXIT.
      *
       R-922-WRITE-FORMAT-3-REC.
      *
           PERFORM S-110-LOAD-ERROR-CODES
              THRU S-110-EXIT.
      *
           COMPUTE SUB2 = +0.
           COMPUTE SUB3 = +0.
      *
           PERFORM R-926-SET-PGM-VERSIONS THRU R-926-EXIT.              03.51
      *                                                                 03.51
           PERFORM S-120-STACK-FORMAT-3-RECS
              THRU S-120-EXIT
                VARYING SUB1 FROM +1 BY +1
                UNTIL   SUB1 > +17.                                     03.42V
      *
           IF PET-SUS-FLAG = 'Y'
              MOVE 9                     TO RAD-ED-REPORT-TYPE
              MOVE 'Y'                   TO WS-REJECT-RPT-SW
                                            WS-RBS-REJECT-SW
                                            WS-RGS-REJECT-SW
                                            WS-RTS-REJECT-SW
              IF HLD-SUM-GROUP-TYPE = 'D'
                 MOVE 'Y'                TO RAD-ED-REJECT-IND
              END-IF
           ELSE
              MOVE 0                     TO RAD-ED-REPORT-TYPE
              IF WS-10-POST-PLAN-ADD-IND = 'A' OR 'T'                   02.95
                 ADD 1                   TO RAD-ED-REPORT-TYPE
                 MOVE 'Y'                TO WS-PASS-THRU-RPT-SW
                                            WS-RBS-PASSTHRU-SW
                                            WS-RGS-PASSTHRU-SW
                                            WS-RTS-PASSTHRU-SW
                 IF NOT WS-BATCH-TYPE-IS-PLAN-ADD
                    ADD 1                TO WS-SAVE-BATCH-TYPE
                 END-IF
                 IF NOT WS-GROUP-TYPE-IS-PLAN-ADD
                    ADD 1                TO WS-SAVE-GROUP-TYPE
                 END-IF
              END-IF
              IF RDL-PLAN-ERROR-DATA NOT = SPACES
                 ADD 2                   TO RAD-ED-REPORT-TYPE
                 MOVE 'Y'                TO WS-QUALIFICATION-RPT-SW
                                            WS-RBS-DOWNGRADE-SW
                                            WS-RGS-DOWNGRADE-SW
                                            WS-RTS-DOWNGRADE-SW
                 IF NOT WS-BATCH-TYPE-IS-DOWNGRADE
                    ADD 2                TO WS-SAVE-BATCH-TYPE
                 END-IF
                 IF NOT WS-GROUP-TYPE-IS-DOWNGRADE
                    ADD 2                TO WS-SAVE-GROUP-TYPE
                 END-IF
              END-IF
              IF HLD-SUM-GROUP-TYPE = 'D'
                 ADD 4                   TO RAD-ED-REPORT-TYPE
                 MOVE 'Y'                TO WS-PBD-EBT-RPT-SW
                                            WS-RBS-PBD-EBT-SW
                                            WS-RGS-PBD-EBT-SW
                                            WS-RTS-PBD-EBT-SW
                 IF NOT WS-BATCH-TYPE-IS-PBD-EBT
                    ADD 4                TO WS-SAVE-BATCH-TYPE
                 END-IF
                 IF NOT WS-GROUP-TYPE-IS-PBD-EBT
                    ADD 4                TO WS-SAVE-GROUP-TYPE
                 END-IF
              END-IF
              IF RCL-10-POST-PLAN = '0101' OR '0102' OR '0103' OR       02.95
                                    '0114' OR '0115' OR '0148' OR       03.16A
                                    '0154'                              03.16A
                 MOVE 'Y'                TO WS-DEFAULT-RPT-SW
                                            WS-RBS-DEFAULT-SW
                                            WS-RGS-DEFAULT-SW
                                            WS-RTS-DEFAULT-SW
              END-IF
           END-IF.
           MOVE RAD-ED-REPORT-TYPE       TO WS-SAVE-REPORT-TYPE.
      *
       R-922-WRITE-LINES.
      *
           IF PET-VALID-RETURN                                          03.31
              COMPUTE RAD-ED-TRAN-AMT = PET-ACQ-AMOUNT * -1
           ELSE
              MOVE PET-ACQ-AMOUNT        TO RAD-ED-TRAN-AMT
           END-IF.
      *
           PERFORM
             VARYING SUB1 FROM +1 BY +1
             UNTIL   SUB1 > +17                                         03.42V
               IF DEFER-RRS-LINE(SUB1) = SPACES
                  COMPUTE SUB1 = +17                                    03.42V
               ELSE
                  MOVE DEFER-RRS-KEY(SUB1)
                                         TO WS-RPT-REC-KEY
                  MOVE DEFER-RRS-LINE-TYPE(SUB1)
                                         TO RAD-ED-LINE-TYPE
                  IF DEFER-RRS-LINE-TYPE(SUB1) = ZERO
                     MOVE ZERO           TO RAD-ED-REPORT-TYPE
                  ELSE
                     MOVE WS-SAVE-REPORT-TYPE
                                         TO RAD-ED-REPORT-TYPE
                  END-IF
                  MOVE REPORT-EXTRA-DATA TO WS-RPT-REC-EXTRA
                  MOVE DEFER-RRS-LINE(SUB1)
                                         TO WS-RPT-REC-LINE
                  IF PET-SUS-FLAG = 'Y' AND
                     HLD-SUM-GROUP-TYPE = 'D'
                        MOVE 'Y'         TO WS-PBD-EBT-RPT-SW
                                            WS-RBS-PBD-EBT-SW
                                            WS-RGS-PBD-EBT-SW
                                            WS-RTS-PBD-EBT-SW
                        IF SUB1 = +1
                           IF NOT WS-BATCH-TYPE-IS-PBD-EBT
                              ADD 4      TO WS-SAVE-BATCH-TYPE
                           END-IF
                           IF NOT WS-GROUP-TYPE-IS-PBD-EBT
                              ADD 4      TO WS-SAVE-GROUP-TYPE
                           END-IF
                        END-IF
                  END-IF
                  IF PARM-IS-TEST AND
                     WS-RRK-INST-IS-DEFAULT
                        NEXT SENTENCE
                  ELSE
                     WRITE RPT-REC FROM WS-RPT-REC
                  END-IF
                  PERFORM R-924-WRITE-REPORT-LINES
                     THRU R-924-EXIT
                  MOVE +0                TO RAD-ED-TRAN-AMT
               END-IF
           END-PERFORM.
      *
           MOVE SPACE                    TO RAD-ED-REJECT-IND.
           MOVE RESET-RPT-COMMON-LINE-1  TO RPT-COMMON-LINE-1.
           MOVE RESET-RPT-COMMON-LINE-2  TO RPT-COMMON-LINE-2.
           MOVE RESET-RPT-COMMON-LINE-3  TO RPT-COMMON-LINE-3.
           MOVE RESET-RPT-COMMON-LINE-4  TO RPT-COMMON-LINE-4.
           MOVE RESET-RPT-COMMON-LINE-5  TO RPT-COMMON-LINE-5.
           MOVE RESET-RPT-COMMON-LINE-6  TO RPT-COMMON-LINE-6.
           MOVE RESET-RPT-COMMON-LINE-7  TO RPT-COMMON-LINE-7.
           MOVE RESET-RPT-COMMON-LINE-8  TO RPT-COMMON-LINE-8.
           MOVE RESET-RPT-COMMON-LINE-9  TO RPT-COMMON-LINE-9.
           MOVE RESET-RPT-COMMON-LINE-10 TO RPT-COMMON-LINE-10.         02.95
           MOVE RESET-RPT-INTCHG-LINE-1  TO RPT-INTCHG-LINE-1.
           MOVE RESET-RPT-VISA-LINE-1    TO RPT-VISA-LINE-1.
           MOVE RESET-RPT-VISA-LINE-2    TO RPT-VISA-LINE-2.
           MOVE RESET-RPT-VISA-LINE-3    TO RPT-VISA-LINE-3.
           MOVE RESET-RPT-VISA-LINE-4    TO RPT-VISA-LINE-4.            03.42V
           MOVE RESET-RPT-MC-LINE-1      TO RPT-MC-LINE-1.
           MOVE RESET-RPT-MC-LINE-2      TO RPT-MC-LINE-2.
           MOVE RESET-RPT-MC-LINE-3      TO RPT-MC-LINE-3.              03.16M
           MOVE RESET-RPT-AMEX-LINE-1    TO RPT-AMEX-LINE-1.
           MOVE RESET-RPT-AMEX-LINE-2    TO RPT-AMEX-LINE-2.
           MOVE RESET-RPT-AMEX-LINE-3    TO RPT-AMEX-LINE-3.            03.29
           MOVE RESET-RPT-DS-LINE-1      TO RPT-DS-LINE-1.
           MOVE RESET-RPT-DS-LINE-2      TO RPT-DS-LINE-2.
           MOVE RESET-RPT-DS-LINE-3      TO RPT-DS-LINE-3.              03.47
           MOVE RESET-RPT-DOWNGRADE-LINE TO RPT-DOWNGRADE-LINE.
           MOVE SPACES                   TO KDA-BAS110AR-VERSION        03.51
                                            KDA-QUAL-PGM-VERSION        03.51
                                            KDA-QUAL-PGM.               03.51
      *
       R-922-EXIT.
           EXIT.
      *
       R-923-PRINT-FORMAT-1-REC.
      *
           COMPUTE SUB2 = +1.
           COMPUTE SUB3 = +1.
      *                                                                 03.51
           PERFORM R-926-SET-PGM-VERSIONS THRU R-926-EXIT.              03.51
      *                                                                 03.51
           PERFORM
             VARYING SUB1 FROM +1 BY +1
             UNTIL   SUB1 > +9
               IF ER-CD-3-DIG(SUB1) > ZERO
                  IF SUB3 > +3
                     COMPUTE SUB2 = SUB2 + 1
                     COMPUTE SUB3 = +1
                  END-IF
                  MOVE ER-CD-3-DIG(SUB1) TO RF1-ERROR-CD(SUB2,SUB3)
                  COMPUTE SUB3 = SUB3 + 1
               ELSE
                  COMPUTE SUB1 = +9
               END-IF
           END-PERFORM.
      *
           IF PET-VALID-RETURN                                          03.31
              COMPUTE RAD-ED-TRAN-AMT = PET-ACQ-AMOUNT * -1
           ELSE
              MOVE PET-ACQ-AMOUNT        TO RAD-ED-TRAN-AMT
           END-IF.
      *
           IF PET-SUS-FLAG = 'Y'
              MOVE 9                     TO RAD-ED-REPORT-TYPE
              MOVE 'Y'                   TO WS-REJECT-RPT-SW
                                            WS-RBS-REJECT-SW
                                            WS-RGS-REJECT-SW
                                            WS-RTS-REJECT-SW
              IF HLD-SUM-GROUP-TYPE = 'D'
                 MOVE 4                  TO RAD-ED-REPORT-TYPE
                 MOVE 'Y'                TO WS-PBD-EBT-RPT-SW
                                            WS-RBS-PBD-EBT-SW
                                            WS-RGS-PBD-EBT-SW
                                            WS-RTS-PBD-EBT-SW
              END-IF
           ELSE
              MOVE 0                     TO RAD-ED-REPORT-TYPE
              IF WS-10-POST-PLAN-ADD-IND = 'A' OR 'T'                   02.95
                 ADD 1                   TO RAD-ED-REPORT-TYPE
                 MOVE 'Y'                TO WS-PASS-THRU-RPT-SW
                                            WS-RBS-PASSTHRU-SW
                                            WS-RGS-PASSTHRU-SW
                                            WS-RTS-PASSTHRU-SW
              END-IF
              IF RDL-PLAN-ERROR-DATA NOT = SPACES
                 ADD 2                   TO RAD-ED-REPORT-TYPE
                 MOVE 'Y'                TO WS-QUALIFICATION-RPT-SW
                                            WS-RBS-DOWNGRADE-SW
                                            WS-RGS-DOWNGRADE-SW
                                            WS-RTS-DOWNGRADE-SW
              END-IF
              IF HLD-SUM-GROUP-TYPE = 'D'
                 ADD 4                   TO RAD-ED-REPORT-TYPE
                 MOVE 'Y'                TO WS-PBD-EBT-RPT-SW
                                            WS-RBS-PBD-EBT-SW
                                            WS-RGS-PBD-EBT-SW
                                            WS-RTS-PBD-EBT-SW
              END-IF
              IF RCL-10-POST-PLAN = '0101' OR '0102' OR '0103' OR       02.95
                                    '0114' OR '0115' OR '0148' OR       03.16A
                                    '0154'                              03.16A
                 MOVE 'Y'                TO WS-DEFAULT-RPT-SW
                                            WS-RBS-DEFAULT-SW
                                            WS-RGS-DEFAULT-SW
                                            WS-RTS-DEFAULT-SW
              END-IF
           END-IF.
           MOVE '1'                      TO RAD-ED-LINE-TYPE.
      *
           IF PET-CARD-TYPE-MC OR
              PET-CARD-TYPE-VISA OR                                     03.27
              PET-CARD-TYPE-DISCOVER OR                                 03.47
              PET-CARD-TYPE-PAYPAL                                      03.47
                 COMPUTE SUB2 = +6
           ELSE
              COMPUTE SUB2 = +5.
           IF RDL-PLAN-ERROR-DATA NOT = SPACES
              COMPUTE SUB2 = SUB2 + 1.

           IF (WS-RPT-LINE-CNT + SUB2) > WS-RPT-MAX-CNT
              PERFORM S-100-PRINT-PAGE-HDR
                 THRU S-100-EXIT.
      *
           MOVE RPT-FORMAT-1-LINE-1      TO RLW-DETAIL-LINE.
           PERFORM R-921-WRITE-REPORT-REC
              THRU R-921-EXIT.
           MOVE REPORT-SORT-KEY          TO WS-RPT-REC-KEY.
           PERFORM R-924-WRITE-REPORT-LINES
              THRU R-924-EXIT.
           MOVE '9'                      TO RAD-ED-LINE-TYPE.
           MOVE RPT-FORMAT-1-LINE-2      TO RLW-DETAIL-LINE.
           PERFORM R-921-WRITE-REPORT-REC
              THRU R-921-EXIT.
           MOVE REPORT-SORT-KEY          TO WS-RPT-REC-KEY.
           PERFORM R-924-WRITE-REPORT-LINES
              THRU R-924-EXIT.
           MOVE RPT-FORMAT-1-LINE-7      TO RLW-DETAIL-LINE.
           PERFORM R-921-WRITE-REPORT-REC
              THRU R-921-EXIT.
           MOVE REPORT-SORT-KEY          TO WS-RPT-REC-KEY.
           PERFORM R-924-WRITE-REPORT-LINES
              THRU R-924-EXIT.
           MOVE RPT-COMMON-LINE-8        TO RLW-DETAIL-LINE.
           PERFORM R-921-WRITE-REPORT-REC
              THRU R-921-EXIT.
           MOVE REPORT-SORT-KEY          TO WS-RPT-REC-KEY.
           PERFORM R-924-WRITE-REPORT-LINES
              THRU R-924-EXIT.
      *
           IF PET-CARD-TYPE-MC OR
              PET-CARD-TYPE-VISA OR                                     03.27
             (PET-CARD-TYPE-DISCOVER AND
              PET-CARD-TYPE-DISCOVER-SETL) OR                           02.29
             (PET-CARD-TYPE-PAYPAL AND                                  03.47
              PET-CARD-TYPE-PAYPAL-SETL) OR                             03.47
             (PET-CARD-TYPE-AMEX AND                                    02.29
              PET-CARD-TYPE-AMEX-SETL) OR                               02.29
             (PET-CARD-TYPE-PL AND                                      02.29
              KDA-CHD-IS-VALID-PD)                                      02.29
                 MOVE RPT-INTCHG-LINE-1  TO RLW-DETAIL-LINE
                 PERFORM R-921-WRITE-REPORT-REC
                    THRU R-921-EXIT
                 MOVE REPORT-SORT-KEY    TO WS-RPT-REC-KEY
                 PERFORM R-924-WRITE-REPORT-LINES
                    THRU R-924-EXIT
                 MOVE RESET-RPT-INTCHG-LINE-1
                                         TO RPT-INTCHG-LINE-1.
      *
           MOVE RPT-COMMON-LINE-10       TO RLW-DETAIL-LINE.            02.95
           PERFORM R-921-WRITE-REPORT-REC
              THRU R-921-EXIT.
           MOVE REPORT-SORT-KEY          TO WS-RPT-REC-KEY.
           PERFORM R-924-WRITE-REPORT-LINES
              THRU R-924-EXIT.
      *
           IF RDL-PLAN-ERROR-DATA NOT = SPACES
              MOVE 'D'                   TO RAD-ED-LINE-TYPE
              MOVE RPT-DOWNGRADE-LINE    TO RLW-DETAIL-LINE
              PERFORM R-921-WRITE-REPORT-REC
                 THRU R-921-EXIT
              MOVE REPORT-SORT-KEY       TO WS-RPT-REC-KEY
              PERFORM R-924-WRITE-REPORT-LINES
                 THRU R-924-EXIT
              MOVE RESET-RPT-DOWNGRADE-LINE
                                         TO RPT-DOWNGRADE-LINE.
      *
           MOVE RESET-RPT-FORMAT-1-LINE-1
                                         TO RPT-FORMAT-1-LINE-1.
           MOVE RESET-RPT-FORMAT-1-LINE-2
                                         TO RPT-FORMAT-1-LINE-2.
           MOVE RESET-RPT-FORMAT-1-LINE-7
                                         TO RPT-FORMAT-1-LINE-7.
           MOVE RESET-RPT-COMMON-LINE-8  TO RPT-COMMON-LINE-8.
           MOVE RESET-RPT-COMMON-LINE-9  TO RPT-COMMON-LINE-9.
           MOVE RESET-RPT-COMMON-LINE-10 TO RPT-COMMON-LINE-10.         02.95
           MOVE SPACES                   TO KDA-BAS110AR-VERSION        03.51
                                            KDA-QUAL-PGM-VERSION        03.51
                                            KDA-QUAL-PGM.               03.51
      *
       R-923-EXIT.
           EXIT.
      *
       R-924-WRITE-REPORT-LINES.
      *
           IF WS-RTS-PASSTHRU
              MOVE 1                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           IF WS-RTS-DOWNGRADE
              MOVE 2                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           IF WS-RTS-PBD-EBT
              MOVE 4                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           IF WS-RTS-DEFAULT
              MOVE 8                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
           IF WS-RTS-REJECT
              MOVE 9                     TO RAD-ED-REPORT-TYPE
              PERFORM R-800-WRITE-REPORT-RECS
                 THRU R-800-EXIT
           END-IF.
      *
       R-924-EXIT.
           EXIT.
      *
       R-925-LOAD-FORMAT-3-REC.
      *
           IF PET-CARD-TYPE-MC
              COMPUTE SUB2 = WS-RPT-MC-LINE-CNT
           ELSE
           IF PET-CARD-TYPE-VISA                                        03.27
              IF WS-INSTALL-LINE
                 COMPUTE SUB2 = WS-RPT-VS-LINE-CNT + 1
              ELSE
                 COMPUTE SUB2 = WS-RPT-VS-LINE-CNT
              END-IF
           ELSE
           IF PET-CARD-TYPE-DISCOVER
           OR PET-CARD-TYPE-PAYPAL                                      03.47
              COMPUTE SUB2 = WS-RPT-DS-LINE-CNT
           ELSE
           IF PET-CARD-TYPE-AMEX
              COMPUTE SUB2 = WS-RPT-AX-LINE-CNT
           ELSE
           IF PET-CARD-TYPE-PL AND                                      02.29
              KDA-CHD-IS-VALID-PD                                       02.29
                 COMPUTE SUB2 = WS-RPT-PD-LINE-CNT                      02.29
           ELSE
              COMPUTE SUB2 = WS-RPT-OT-LINE-CNT.
      *
           IF (WS-RPT-LINE-CNT + SUB2) > WS-RPT-MAX-CNT
              PERFORM S-100-PRINT-PAGE-HDR
                 THRU S-100-EXIT.
      *
           MOVE SPACES                   TO DEFER-RPT-REC-STACK.
           MOVE 'Y'                      TO WS-WRITE-DEFER.
      *
           PERFORM
             VARYING SUB1 FROM +1 BY +1
             UNTIL   SUB1 > SUB2
               IF SUB1 = +1
                  MOVE '1'               TO DEFER-RRS-LINE-TYPE(SUB1)
                  MOVE '0'               TO DEFER-RRS-SAVE-CC(SUB1)
                  ADD 2                  TO WS-RPT-LINE-CNT
               ELSE
                  MOVE '9'               TO DEFER-RRS-LINE-TYPE(SUB1)
                  ADD 1                  TO WS-RPT-LINE-CNT
               END-IF
               MOVE REPORT-SORT-KEY      TO DEFER-RRS-KEY(SUB1)
               MOVE WS-RPT-LINE-CNT      TO RAD-SK-LINE
           END-PERFORM.
      *
           MOVE 'N'                      TO WS-WRITE-DEFER.
      *
       R-925-EXIT.
           EXIT.
      *
       R-926-SET-PGM-VERSIONS.                                          03.51
           IF KDA-BAS110AR-VERSION = SPACES                             03.51
              MOVE "---"                     TO RVL-BAS110AR-VERSION    03.51
           ELSE                                                         03.51
              MOVE KDA-BAS110AR-VERSION(4:3) TO RVL-BAS110AR-VERSION    03.51
           END-IF.                                                      03.51
           IF KDA-QUAL-PGM-VERSION = SPACES                             03.51
              MOVE "---"                     TO RVL-QUAL-PGM-VERSION    03.51
           ELSE                                                         03.51
              MOVE KDA-QUAL-PGM-VERSION(4:3) TO RVL-QUAL-PGM-VERSION    03.51
           END-IF.                                                      03.51
           IF KDA-QUAL-PGM = SPACES                                     03.51
              MOVE "--"                      TO RVL-QUAL-PGM            03.51
           ELSE                                                         03.51
              MOVE KDA-QUAL-PGM(1:2)         TO RVL-QUAL-PGM            03.51
           END-IF.                                                      03.51
      *                                                                 03.51
       R-926-EXIT.                                                      03.51
           EXIT.                                                        03.51
      *                                                                 03.51
060390 R-930-DET-RPT-LINE-SPACING.
060400     IF RLW-DL-CC = '1'
060410        MOVE 1                  TO WS-RPT-LINE-CNT
060420     ELSE IF RLW-DL-CC = ' '
060430        ADD 1                   TO WS-RPT-LINE-CNT
060440     ELSE IF RLW-DL-CC = '0'
060450        ADD 2                   TO WS-RPT-LINE-CNT
060460     ELSE IF RLW-DL-CC = '-'
060470        ADD 3                   TO WS-RPT-LINE-CNT.
060480 R-930-EXIT.
060490     EXIT.
060500*
060510 S-010-READ-TRANS-IN.
060520     MOVE SPACES                   TO MIR-LAYOUT.
           MOVE +100                     TO END-SUB.                    02.49
008420     IF END-OF-INPUT
060610        GO TO S-010-EXIT.
031090     IF WS-HELD-REC = 'N'
060530        READ DAILY-TRANS INTO MR5-FIRST-100
060540             AT END
060550             MOVE 'Y'             TO END-OF-INPUT-SW
060560             GO TO S-010-EXIT
031120     ELSE
031130        MOVE HOLD-TRANSACTION      TO MIR-LAYOUT
031150        MOVE SPACES                TO HOLD-TRANSACTION.
141390     IF MR1-TRANSCODE = 'NULL'
141970        PERFORM S-030-NO-INPUT
141970           THRU S-030-EXIT
141430        GO TO S-010-EXIT.
060570     IF MR1-TRANSCODE = 'RMOT'
060580        PERFORM S-020-PROCESS-REMOTE
060590           THRU S-020-EXIT
060600        IF END-OF-INPUT-SW = 'Y'
060610           GO TO S-010-EXIT
060620        ELSE
031140           MOVE 'N'                TO WS-HELD-REC
060630           GO TO S-010-READ-TRANS-IN.
060640     MOVE MR1-TRANSCODE            TO WS-TRANSCODE.
031090     IF WS-HELD-REC = 'Y'
031140        MOVE 'N'                   TO WS-HELD-REC
060610        GO TO S-010-EXIT.
      *                                                                 02.64
           IF MR1-VALID-MIS3-TRAN OR                                    03.31
              MR1-TC-PREF = '32' OR '58'                                03.31
                 MOVE WS-MIS3-CARD-TYPE  TO WS-SAVE-MIS3-TYPE           03.31
                 PERFORM C-750-TALLY-BAL-REC-INPUT                      03.31
                    THRU C-750-EXIT                                     03.31
                 MOVE WS-SAVE-MIS3-TYPE  TO WS-MIS3-CARD-TYPE           03.31
           END-IF.                                                      02.66
      *                                                                 02.64
060660     IF WS-QUAD-RECORD
              MOVE +400                  TO END-SUB                     02.49
              READ DAILY-TRANS INTO MR5-SECOND-100                      02.49
                 AT END                                                 02.49
                    MOVE 'Y'             TO END-OF-INPUT-SW             02.49
                    GO TO S-010-EXIT.                                   02.49
060710     IF WS-QUAD-RECORD
060720        READ DAILY-TRANS INTO MR5-THIRD-100
060730           AT END
060740              MOVE 'Y'             TO END-OF-INPUT-SW
060700              GO TO S-010-EXIT.
060710     IF WS-QUAD-RECORD
060720        READ DAILY-TRANS INTO MR5-FOURTH-100
060730           AT END
060740              MOVE 'Y'             TO END-OF-INPUT-SW.
           PERFORM S-505-CHECK-SPACE-FILL-TRAN                          02.49
              THRU S-505-EXIT.                                          02.49
060750 S-010-EXIT.
060760     EXIT.
060770*
060780 S-020-PROCESS-REMOTE.
060790     OPEN INPUT  REMOTE-ID-IN
060800          OUTPUT REMOTE-ID-OUT.
060810     MOVE MR5-FIRST-100            TO WS-REMOTE-TRANS.
060820 S-020-READ-REMOTE.
060830     READ REMOTE-ID-IN INTO WS-REMOTE-ID
060840        AT END
060850           MOVE 'Y'                TO WS-REMOTE-EOF
060860           GO TO S-020-REMOTE-EOF.
060870     IF WS-RI-ID = WS-RT-ID AND
060880        WS-RI-RUN = PSI-RUN
060890           DISPLAY '*** INPUT ID OF ' WS-RI-ID
060900                   ' PREVIOUSLY PROCESSED ON '
060910                    WS-RI-WAO ' ***'
060920           MOVE 'Y'                TO WS-REMOTE-MATCH
060930                                      END-OF-INPUT-SW.
060940     GO TO S-020-WRITE.
060950 S-020-REMOTE-EOF.
060960     IF WS-REMOTE-MATCH = 'N'
060970        MOVE PSI-RUN               TO WS-RI-RUN
060980        MOVE HLD-WORK-AS-OF-DATE   TO WS-RI-WAO
060990        MOVE WS-RT-ID              TO WS-RI-ID
061000        WRITE REMOTE-ID-OUT-REC FROM WS-REMOTE-ID
061010        GO TO S-020-CLOSE.
061020 S-020-WRITE.
061030     MOVE 'DAA'                    TO DC-OPERATION.
061040     MOVE WS-RI-WAO                TO DC-SEND-DATE.
061050     MOVE HLD-WORK-AS-OF-DATE      TO DC-SEND-NUM.
061060     PERFORM D-100-CALL-DATECONV
061070        THRU D-100-EXIT.
061080     IF DC-SUCCESSFUL
061090        IF DC-RETURN-NUM < 90
061100           WRITE REMOTE-ID-OUT-REC FROM WS-REMOTE-ID.
061110     IF WS-REMOTE-EOF = 'N'
061120        GO TO S-020-READ-REMOTE.
061130 S-020-CLOSE.
061140     CLOSE REMOTE-ID-IN
061150           REMOTE-ID-OUT.
061160 S-020-EXIT.
061170     EXIT.
141990*
141970 S-030-NO-INPUT.
141700     DISPLAY '**** NO INPUT FOR TODAY ****'.
141710     DISPLAY '  CREATING NULL OUTPUT FILE '.
141700     DISPLAY '**** NO INPUT FOR TODAY ****'.
141740     MOVE 'Y'                      TO END-OF-INPUT-SW.
141970 S-030-EXIT.
141980     EXIT.
061180*
061190 S-050-READ-MERCH-NAME.
061260     MOVE 'N'                      TO INVALID-MERCH-SW.
           MOVE 'N'                      TO WS-MRCH-REF-TYPE.           02.41
           MOVE SPACES                   TO INVALID-NAME-ADDR-SW.
           MOVE 'USA'                    TO KDA-BATCH-ICA-COUNTRY.      02.41
           MOVE '840'                    TO KDA-BATCH-ICA-COUNTRY-NUM-X.02.41
           MOVE '1 '                     TO WS-BATCH-ICA-REGN-SUBR.     02.41
           MOVE 01                       TO KDA-BATCH-ICA-CLEAR-REGN.   02.41
061290     MOVE ZEROS TO HOLD-MERCH-ID.
           MOVE MNK-BANK-KEY             TO MESNMERD-RK-INST-CODE.      02.77
           MOVE MNK-MERCH-NMBR           TO MESNMERD-RK-MERCH-NBR.      02.77
           PERFORM Z-910-CALL-MESNMERD                                  02.77
              THRU Z-910-EXIT.                                          02.77
           IF NOT MESNMERD-RC-NORMAL                                    02.77
              MOVE SNF-RECORD            TO NME-RECORD                  02.77
              MOVE 'Y'                   TO INVALID-MERCH-SW            02.77
              MOVE 47                    TO ER-CD(ER-INDX)              02.77
                                            HLD-MRCH-ER-CD              02.77
              SET ER-INDX UP BY 1                                       02.77
           ELSE                                                         02.77
              IF NME-MERCH-STATUS = 'C' OR 'I'                          02.77
                 MOVE 45                 TO ER-CD(ER-INDX)              02.77
                                            HLD-MRCH-ER-CD              02.77
                 SET ER-INDX UP BY 1                                    02.77
                 MOVE 'Z'                TO INVALID-MERCH-SW            02.77
              END-IF                                                    02.77
           END-IF.                                                      02.77
      *
           MOVE NME-NAME-ADDRESS(1)      TO WS-WED-NAME.                02.88
           MOVE NME-CITY                 TO HLD-DESCR-CITY.             02.77
           MOVE NME-STATE                TO HLD-DESCR-STATE.            02.77
           MOVE NME-COUNTRY              TO HLD-DESCR-COUNTRY.          02.77
      *
           IF INVALID-MERCH-SW = 'Y' OR 'Z'
              GO TO S-050-NAME-ADDR-DONE.
      *
046410     MOVE 'N'                      TO WS-MOVE-DONE-SW.
           MOVE SPACES                   TO HLD-DESCR-NAME.
047650     PERFORM VARYING SUB1 FROM +1 BY +1
                     UNTIL SUB1 > +25 OR MOVE-DONE
             IF NME-NAME-ADDRESS(1)(SUB1:1) NOT = SPACE                 02.77
047691         PERFORM VARYING SUB2 FROM +1 BY +1
                         UNTIL SUB1 > +25 OR SUB2 > +25
                 IF NME-NAME-ADDRESS(1)(SUB1:1) = '\'                   02.77
                   MOVE '/'              TO HLD-DESCR-NAME(SUB2:1)
                 ELSE
                   MOVE NME-NAME-ADDRESS(1)(SUB1:1)                     02.77
                                         TO HLD-DESCR-NAME(SUB2:1)
                 END-IF
047697           COMPUTE SUB1 = SUB1 + 1
047698         END-PERFORM
047699         MOVE 'Y'                  TO WS-MOVE-DONE-SW
047700       END-IF
047701     END-PERFORM.
           IF HLD-DESCR-NAME = SPACES
              MOVE 'Y'                   TO INVALID-NAME-SW.
      *
           MOVE SPACES                   TO HLD-DESCR-ADDR.             02.63
           MOVE 'N'                      TO WS-MOVE-DONE-SW.            02.63
           PERFORM                                                      02.63
             VARYING SUB1 FROM +1 BY +1                                 02.63
             UNTIL   SUB1 > +25 OR                                      02.63
                     MOVE-DONE                                          02.63
               IF NME-NAME-ADDRESS(2)(SUB1:1) NOT = SPACE               02.77
                  PERFORM                                               02.63
                    VARYING SUB2 FROM +1 BY +1                          02.63
                    UNTIL   SUB1 > +25 OR                               02.63
                            SUB2 > +25                                  02.63
                      MOVE NME-NAME-ADDRESS(2)(SUB1:1)                  02.77
                                         TO HLD-DESCR-ADDR(SUB2:1)      02.63
                      COMPUTE SUB1 = SUB1 + 1                           02.63
                  END-PERFORM                                           02.63
                  MOVE 'Y'               TO WS-MOVE-DONE-SW             02.63
               END-IF                                                   02.63
           END-PERFORM.                                                 02.63
      *                                                                 02.63
           MOVE 'N'                      TO WS-MOVE-DONE-SW.
           MOVE SPACES                   TO HLD-DESCR-CITY.
           PERFORM VARYING SUB1 FROM +1 BY +1
                     UNTIL SUB1 > +13 OR MOVE-DONE
             IF NME-CITY(SUB1:1) NOT = SPACE                            02.77
               PERFORM VARYING SUB2 FROM +1 BY +1
                         UNTIL SUB1 > +13 OR SUB2 > +13
                 IF NME-CITY(SUB1:1) = '\'                              02.77
                   MOVE '/'              TO HLD-DESCR-CITY(SUB2:1)
                 ELSE
                   MOVE NME-CITY(SUB1:1) TO HLD-DESCR-CITY(SUB2:1)      02.77
                 END-IF
                 COMPUTE SUB1 = SUB1 + 1
               END-PERFORM
               MOVE 'Y'                  TO WS-MOVE-DONE-SW
             END-IF
           END-PERFORM.
           IF HLD-DESCR-CITY = SPACES
              MOVE 'Y'                   TO INVALID-CITY-SW.
      *
           MOVE NME-COUNTRY              TO SRCH-COUNTRY.               02.77
           IF SRCH-COUNTRY = SPACES
              MOVE 'Y'                   TO INVALID-ST-CNTRY-SW
           ELSE
              PERFORM S-615-SRCH-CNTRY-CD THRU S-615-EXIT
              IF INVAL-CNTRY-SW = 'G'
                 MOVE CCE-COUNTRY-CODE-ALPH-2(CCE-IDX)                  02.39
                                         TO HLD-MRCH-VE-COUNTRY
                                            HLD-DESCR-COUNTRY
                 MOVE CCE-COUNTRY-CODE-NUM(CCE-IDX)                     02.39
                                         TO HLD-INET-COUNTRY-NUM-X
                                            KDA-BATCH-ICA-COUNTRY-NUM-X 02.41
                                            HOLD-DISCOVER-COUNTRY-N
                 MOVE CCE-COUNTRY-CODE-ALPH-3(CCE-IDX)                  02.39
                                         TO HLD-INET-COUNTRY
                                            KDA-BATCH-ICA-COUNTRY       02.41
                                            HOLD-DISCOVER-COUNTRY-A
              ELSE
                 MOVE 'Y'                TO INVALID-ST-CNTRY-SW
              END-IF
           END-IF.
           IF INVALID-ST-CNTRY-SW = 'Y'
              GO TO S-050-NAME-ADDR-ERROR.
      *
           IF NME-COUNTRY = 'US ' OR 'USA' OR 'CA ' OR 'CAN'            02.77
              MOVE SPACES                TO EDIT-FILE-REC               02.41
              MOVE 'T'                   TO EFR-REC-KEY-ID              02.41
              MOVE 'M'                   TO EFR-STATE-CARD-TYPE         02.41
              MOVE HLD-DESCR-STATE       TO EFR-STATE-CODE              02.41
              MOVE HLD-INET-COUNTRY      TO EFR-STATE-COUNTRY           02.41
              PERFORM Z-900-READ-EFR                                    02.41
                 THRU Z-900-EXIT                                        02.41
              IF NOT BAS10002-EFR-GOOD                                  02.41
                 MOVE 'Y'                TO INVALID-ST-CNTRY-SW         02.41
                 GO TO S-050-NAME-ADDR-ERROR                            02.41
              END-IF                                                    02.41
           END-IF.                                                      02.41
      *                                                                 02.41
           PERFORM                                                      02.41
             VARYING SUB1 FROM +1 BY +1                                 02.41
             UNTIL   SUB1 > +8                                          02.41
               IF KDA-BATCH-ICA-COUNTRY = WS-BATCH-ICA-COUNTRY(SUB1)    02.41
                  MOVE 'Y'               TO WS-MRCH-REF-TYPE            02.41
                  COMPUTE SUB1 = +8                                     02.41
               END-IF                                                   02.41
           END-PERFORM.                                                 02.41
           IF NOT WS-MRCH-REF-IS-VALID                                  02.41
              GO TO S-050-NAME-ADDR-DONE                                02.41
           END-IF.                                                      02.41
      *                                                                 02.41
           IF KDA-BATCH-ICA-COUNTRY = 'USA'                             02.41
              MOVE '1'                   TO WS-BATCH-ICA-REGN           02.41
           ELSE                                                         02.41
              MOVE SPACES                TO EDIT-FILE-REC               02.41
              MOVE 'N'                   TO EFR-REC-KEY-ID              02.41
              MOVE 'M'                   TO EFR-COUNTRY-CARD-TYPE       02.41
              MOVE KDA-BATCH-ICA-COUNTRY TO EFR-COUNTRY-CODE            02.41
              PERFORM Z-900-READ-EFR                                    02.41
                 THRU Z-900-EXIT                                        02.41
              IF BAS10002-EFR-GOOD                                      02.41
                 MOVE EFR-COUNTRY-REGION TO WS-BATCH-ICA-REGN           02.41
              ELSE                                                      02.41
                 MOVE 'N'                TO WS-MRCH-REF-TYPE            02.41
                 GO TO S-050-NAME-ADDR-DONE                             02.41
              END-IF                                                    02.41
           END-IF.                                                      02.41
      *                                                                 02.41
           MOVE 'N'                      TO WS-MRCH-REF-TYPE.           02.41
           PERFORM                                                      02.41
             VARYING SUB1 FROM +1 BY +1                                 02.41
             UNTIL   SUB1 > +6                                          02.41
               IF WS-BATCH-ICA-REGN = WS-BATCH-ICA-REGION(SUB1)         02.41
                  MOVE 'Y'               TO WS-MRCH-REF-TYPE            02.41
                  COMPUTE SUB1 = +6                                     02.41
               END-IF                                                   02.41
           END-PERFORM.                                                 02.41
           IF NOT WS-MRCH-REF-IS-VALID                                  02.41
              GO TO S-050-NAME-ADDR-DONE                                02.41
           END-IF.                                                      02.41
      *                                                                 02.41
           SET ACT-INDX TO +1.                                          02.41
           SEARCH WS-MC-ACT-ENTRY                                       02.41
             AT END                                                     02.41
                MOVE 01                  TO KDA-BATCH-ICA-CLEAR-REGN    02.41
             WHEN WS-BATCH-ICA-REGN = WS-MC-ACT-AMS-REGN(ACT-INDX)      02.41
                MOVE WS-MC-ACT-CLR-REGN(ACT-INDX)                       02.41
                                         TO KDA-BATCH-ICA-CLEAR-REGN    02.41
           END-SEARCH.                                                  02.41
      *                                                                 02.41
           GO TO S-050-NAME-ADDR-DONE.                                  02.41
      *                                                                 02.41
       S-050-NAME-ADDR-ERROR.
           MOVE 43                       TO ER-CD (ER-INDX)
                                            HLD-MRCH-ER-CD.
           SET ER-INDX UP BY 1.
      *
       S-050-NAME-ADDR-DONE.
           MOVE NME-MERCH-ID             TO HOLD-MERCH-ID.              02.77
061290     MOVE HLD-DESCR                TO HLD-RESET-DESCR.
           MOVE NME-ZIP-CODE             TO HLD-ZIP-WORK.               02.77
           IF NME-MC-CAT-CODE IS EQUAL TO ZERO                          02.77
              MOVE NME-CATEGORY-CODE     TO HOLD-VS-CAT-CODE            02.77
061520                                      HOLD-MC-CAT-CODE
061530     ELSE
              MOVE NME-CATEGORY-CODE     TO HOLD-VS-CAT-CODE            02.77
              MOVE NME-MC-CAT-CODE       TO HOLD-MC-CAT-CODE.           02.77
           IF NME-AMEX-CAT-CODE IS EQUAL TO ZERO                        02.77
              MOVE NME-CATEGORY-CODE     TO HOLD-AX-CAT-CODE            02.77
           ELSE                                                         02.29
              MOVE NME-AMEX-CAT-CODE     TO HOLD-AX-CAT-CODE.           02.77
           IF NME-DS-CAT-CODE = ZEROS                                   02.77
              MOVE NME-CATEGORY-CODE     TO HOLD-DS-CAT-CODE            02.77
           ELSE                                                         02.39
              MOVE NME-DS-CAT-CODE       TO HOLD-DS-CAT-CODE.           02.77
           MOVE NME-CALL-PHONE           TO KDA-TELE-NUM.               02.77
           MOVE NME-PROPERTY-PHONE       TO KDA-PROPERTY-PHONE.         02.77
           MOVE NME-VOLUME-TIER-IND      TO HLD-VOLUME-TIER-IND.        02.77
           MOVE NME-PASS-THRU-SWITCHES   TO KDA-PASS-THRU-SWITCHES.     02.77
           MOVE NME-AMEX-SE              TO HOLD-AMEX-SE.               02.77
           MOVE NME-AMEX-SE-FC           TO HOLD-AMEX-SE-FC.            02.77
           MOVE NME-DISCOVER-NO          TO HOLD-DISCOVER-NO.           02.77
           MOVE NME-DISCOVER-PREF        TO HOLD-DISCOVER-PREFIX.       02.77
           MOVE NME-CUST-ID-1            TO HOLD-CUST-ID-1.             02.77
           MOVE NME-CUST-ID-2            TO HOLD-CUST-ID-2.             02.77
           IF NME-TAX-ID-FED = ZERO                                     02.77
              IF NME-TAX-ID-ST > ZERO                                   02.77
                 MOVE NME-TAX-ID-TIN-ST  TO NME-TAX-ID-TIN-FED          02.77
                 MOVE NME-TAX-ID-ST      TO NME-TAX-ID-FED              02.77
              END-IF
           ELSE
              IF NME-TAX-ID-ST = ZERO                                   02.77
                 MOVE NME-TAX-ID-TIN-FED TO NME-TAX-ID-TIN-ST           02.77
                 MOVE NME-TAX-ID-FED     TO NME-TAX-ID-ST               02.77
              END-IF
           END-IF.
           MOVE NME-TAX-ID-FED           TO HOLD-MRCH-TAX-ID-FED        02.77
                                            KDA-TAX-ID-FED.
           MOVE NME-TAX-ID-ST            TO HOLD-MRCH-TAX-ID-ST         02.77
                                            KDA-TAX-ID-ST.
           MOVE NME-TAX-ID-TIN-FED       TO KDA-TAX-ID-TIN-FED.         02.77
           MOVE NME-TAX-ID-TIN-ST        TO KDA-TAX-ID-TIN-ST.          02.77
           MOVE NME-MVV                  TO HOLD-NAF-MVV                02.77
                                            HOLD-PET-MVV.
           MOVE NME-VISA-VPP-IND         TO KDA-MM-VS-VPP-IND.          03.63
           IF NME-MVV NOT = SPACES                                      02.77
             PERFORM VARYING WS-SUB1 FROM +1 BY +1
                       UNTIL WS-SUB1 > +10
               MOVE NME-MVV(WS-SUB1:1)   TO WS-MVV-BYTE                 02.77
               IF NOT VALID-MVV-BYTE
                 MOVE SPACES             TO HOLD-PET-MVV
                 MOVE +10                TO WS-SUB1
               END-IF
             END-PERFORM
           END-IF.
           MOVE NME-MC-TIER-LEVEL        TO KDA-MC-TIER-LEVEL.          02.77
           IF NME-MC-TIER-MRCH-ID = ZEROS                               02.77
              MOVE SPACES                TO NME-MC-TIER-MRCH-ID.        02.77
           MOVE NME-MC-TIER-MRCH-ID      TO HOLD-MC-ASSIGN-MRCH-ID.     02.77
           IF NME-MC-TIER-MRCH-ID NOT = SPACES                          02.77
             PERFORM VARYING WS-SUB1 FROM +1 BY +1
                       UNTIL WS-SUB1 > +6
               MOVE NME-MC-TIER-MRCH-ID(WS-SUB1:1)                      02.77
                                         TO WS-MVV-BYTE
               IF NOT VALID-MVV-BYTE
                 MOVE SPACES             TO HOLD-MC-ASSIGN-MRCH-ID      02.39
                 MOVE +6                 TO WS-SUB1
               END-IF
             END-PERFORM
           END-IF.
           MOVE NME-MC-PROG-REGIST-ID    TO HOLD-MC-PROG-REGIST-ID.     02.77
      * VISA PROG REGISTRATION FLAG IS USED FOR MORE THAN SUPERMARKET   03.42V
      *      AS OF 14.1.                                                03.42V
           MOVE NME-VISA-PROG-REGIST-FLAG                               02.77
                                         TO KDA-VISA-PROG-REGIST-FLAG.
           MOVE NME-MAX-PLAN-USE-IND     TO KDA-MAX-PLAN-USE-IND.       02.77
           MOVE SPACES                   TO HLD-RESET-CUST-SVC-PHONE.
           IF NME-CUST-SVC-PHONE NOT = SPACES                           02.77
             MOVE 'N'                    TO WS-MOVE-DONE-SW
             PERFORM VARYING SUB1 FROM +1 BY +1
                       UNTIL SUB1 > +10 OR MOVE-DONE
               IF NME-CUST-SVC-PHONE(SUB1:1) NOT = SPACE                02.77
                 PERFORM VARYING SUB2 FROM +1 BY +1
                           UNTIL SUB1 > +10 OR SUB2 > +10
                   MOVE NME-CUST-SVC-PHONE(SUB1:1)                      02.77
                                     TO HLD-RESET-CUST-SVC-PHONE(SUB2:1)
                   COMPUTE SUB1 = SUB1 + 1
                 END-PERFORM
                 MOVE 'Y'                TO WS-MOVE-DONE-SW
               END-IF
             END-PERFORM
           END-IF.
           IF HLD-INET-COUNTRY = 'CAN' OR 'USA'
              IF (HLD-RESET-CUST-SVC-PHONE(1:10) NUMERIC)     AND
                 (HLD-RESET-CUST-SVC-PHONE(1:6) NOT = ZEROS)  AND       1.93
                 (HLD-RESET-CUST-SVC-PHONE(11:4) = SPACES)
                    NEXT SENTENCE
               ELSE
                  MOVE SPACES            TO HLD-RESET-CUST-SVC-PHONE.
           IF HLD-RESET-CUST-SVC-PHONE = SPACES                         02.37
              MOVE SPACES                TO HLD-RESET-US-CAN-CS-PHONE   02.37
           ELSE                                                         02.37
              IF HLD-INET-COUNTRY = 'CAN' OR 'USA'                      02.37
                 IF (HLD-RESET-CUST-SVC-PHONE(1:10) NUMERIC)     AND    02.37
                    (HLD-RESET-CUST-SVC-PHONE(1:3) NOT = ZEROS)  AND    02.37
                    (HLD-RESET-CUST-SVC-PHONE(4:3) NOT = ZEROS)         02.37
                       MOVE '-'        TO HLD-RESET-US-CAN-CS-PHONE(4:1)02.37
                                          HLD-RESET-US-CAN-CS-PHONE(8:1)02.37
                       MOVE HLD-RESET-CUST-SVC-PHONE(1:3)               02.37
                                       TO HLD-RESET-US-CAN-CS-PHONE(1:3)02.37
                       MOVE HLD-RESET-CUST-SVC-PHONE(4:3)               02.37
                                       TO HLD-RESET-US-CAN-CS-PHONE(5:3)02.37
                       MOVE HLD-RESET-CUST-SVC-PHONE(7:4)               02.37
                                       TO HLD-RESET-US-CAN-CS-PHONE(9:4)02.37
                 END-IF                                                 02.37
              END-IF                                                    02.37
           END-IF.                                                      02.37
      *                                                                 02.41
           IF NME-URL (1:1) = SPACE                                     02.77
              MOVE SPACES                TO HOLD2-FIELD                 02.37
              MOVE +1                    TO START-SUB                   02.37
              MOVE +40                   TO END-SUB END2-SUB            02.37
              MOVE NME-URL               TO HOLD-FIELD                  02.77
              PERFORM C-381-EDIT-MA-FIELDS                              02.37
                 THRU C-381-EXIT                                        02.37
              MOVE HOLD2-FIELD           TO HLD-RESET-URL               02.37
           ELSE                                                         02.37
              MOVE NME-URL               TO HLD-RESET-URL               02.77
           END-IF.                                                      02.37
           COMPUTE WS-SUB1 = +40.                                       02.41
           MOVE HLD-RESET-URL            TO WK-ZERO-FIELD.              02.41
           PERFORM C-382-CHECK-ZERO-FILL                                02.41
              THRU C-382-EXIT.                                          02.41
           IF ERROR-FOUND                                               02.41
              MOVE SPACES                TO HLD-RESET-URL               02.41
           END-IF.                                                      02.41
      *                                                                 02.41
           IF NME-EMAIL-ADDR (1:1) = SPACE                              02.77
              MOVE SPACES                TO HOLD2-FIELD                 02.37
              MOVE +1                    TO START-SUB                   02.37
              MOVE +40                   TO END-SUB END2-SUB            02.37
              MOVE NME-EMAIL-ADDR        TO HOLD-FIELD                  02.77
              PERFORM C-381-EDIT-MA-FIELDS                              02.37
                 THRU C-381-EXIT                                        02.37
              MOVE HOLD2-FIELD           TO HLD-RESET-EMAIL             02.37
           ELSE                                                         02.37
              MOVE NME-EMAIL-ADDR        TO HLD-RESET-EMAIL             02.77
           END-IF.                                                      02.37
           COMPUTE WS-SUB1 = +40.                                       02.41
           MOVE HLD-RESET-EMAIL          TO WK-ZERO-FIELD.              02.41
           PERFORM C-382-CHECK-ZERO-FILL                                02.41
              THRU C-382-EXIT.                                          02.41
           IF ERROR-FOUND                                               02.41
              MOVE SPACES                TO HLD-RESET-EMAIL             02.41
           END-IF.                                                      02.41
      *                                                                 02.41
           MOVE NME-BUSN-TYPE            TO KDA-BUSN-TYPE.              02.77
           IF NOT KDA-VALID-BUSN-TYPE
              MOVE '2'                   TO KDA-BUSN-TYPE.
           MOVE NME-BUSN-OWNER-TYPE      TO KDA-BUSN-OWNER-TYPE.        02.77
           IF NOT KDA-VALID-OWNER-TYPE
              MOVE '0'                   TO KDA-BUSN-OWNER-TYPE.
           MOVE NME-BUSN-CERT-TYPE       TO KDA-BUSN-CERT-TYPE.         02.77
           IF NOT KDA-VALID-CERT-TYPE
              MOVE '0'                   TO KDA-BUSN-CERT-TYPE.
           MOVE NME-BUSN-ETHNIC-TYPE     TO KDA-BUSN-ETHNIC-TYPE.       02.77
           IF NOT KDA-VALID-ETHNIC-TYPE
              MOVE '0'                   TO KDA-BUSN-ETHNIC-TYPE.
           MOVE NME-INCORP-STATUS-CODE   TO KDA-INCORP-STATUS-CODE.     02.77
           MOVE NME-FX-BASE-TYPE-ID      TO BASCRATE-SD-BASE-TYPE-ID.   02.77
           MOVE NME-FX-BASE-SCHEME-ID    TO BASCRATE-SD-BASE-SCHEME-ID. 02.77
           MOVE NME-FX-DAYS-ID           TO BASCRATE-SD-DAYS-ID.        02.77
           MOVE NME-FX-PROFIT-ID         TO BASCRATE-SD-PROFIT-ID.      02.77
           MOVE NME-AX-VOL-DISC-CODE     TO KDA-AX-VOL-DISC-CODE.       02.77
062370     MOVE ZEROS                    TO KDA-PLAN-CODES.
           IF INVALID-MERCH-SW = 'Y' OR 'Z'
              GO TO S-050-EXIT.
           MOVE NME-PLAN-CODE-TABLE      TO KDA-PLAN-CODES.             02.77
           MOVE NME-PLAN-CODE-CNT        TO KDA-NO-PLAN-CODES.          02.77
           MOVE NME-CATCH-ALL-PLANS      TO KDA-CATCH-ALL-PLANS.        02.77
      *
       S-050-EXIT.
           EXIT.
      *
       S-090-LOAD-REJECT-ERRORS.
      *
           MOVE SPACES                   TO BASDTRAN-RC-REJECT-CODES.   02.88
      *
           COMPUTE SUB1 = +0.
           PERFORM
             VARYING SUB2 FROM +1 BY +1
             UNTIL   SUB2 > +10
                IF ER-CD-ENTRY(SUB2) = SPACES OR ZEROS
                   COMPUTE SUB2 = +10
                ELSE
                   COMPUTE SUB1 = SUB1 + 1
                   MOVE ER-CD-ENTRY(SUB2)
                                         TO BASDTRAN-RCE-FE(SUB1)
                END-IF
           END-PERFORM.
           MOVE SUB1                     TO BASDTRAN-RC-NO-REJECTS.
      *
       S-090-EXIT.
           EXIT.
      *
       S-095-MOVE-ERROR-CODES.
           IF ERR-CD-SUB < ERR-CD-SUB-MAX
              ADD +1                     TO ERR-CD-SUB
              MOVE WS-ERR-CD-X           TO ERR-CD-3-DIG-X(ERR-CD-SUB).
           MOVE 'Y'                      TO WS-ADD-SUS-FLAG.
       S-095-EXIT.
           EXIT.
062440*
063350 S-100-PRINT-PAGE-HDR.
063360     ADD 1 TO PGE-CTR.
063370     MOVE PGE-CTR TO HL1-PAGE.
063380     IF HL1-INST-NBR   NOT = WS-HOLD-BANK-NBR
063390        PERFORM T-775-GET-BANK-NAMES
063400           THRU T-775-EXIT.
015630     MOVE HL1-INST-NBR             TO RAD-SK-INST.
015630     MOVE HL1-PAGE                 TO RAD-SK-PAGE.
015630     MOVE +0                       TO RAD-SK-LINE.
           IF WRITE-DEFER
              GO TO S-100-EXIT.
           MOVE REPORT-EXTRA-DATA        TO WS-SAVE-REPORT-EXTRA-DATA.
           MOVE ZERO                     TO RAD-ED-LINE-TYPE
                                            RAD-ED-REPORT-TYPE.
           MOVE SPACES                   TO RAD-ED-MRCH-NMBR
                                            RAD-ED-GROUP-REF-NO.
           MOVE +0                       TO RAD-ED-TRAN-AMT.
063410     MOVE HEAD-LINE-1              TO RLW-DETAIL-LINE.
063420     PERFORM R-921-WRITE-REPORT-REC
063430        THRU R-921-EXIT.
063440     MOVE HEAD-LINE-2              TO RLW-DETAIL-LINE.
063450     PERFORM R-921-WRITE-REPORT-REC
063460        THRU R-921-EXIT.
063470     MOVE HEAD-LINE-BATCH          TO RLW-DETAIL-LINE.
063480     PERFORM R-921-WRITE-REPORT-REC
063490        THRU R-921-EXIT.
           MOVE WS-SAVE-REPORT-EXTRA-DATA
                                         TO REPORT-EXTRA-DATA.
063500 S-100-EXIT.
063510     EXIT.
      *
       S-110-LOAD-ERROR-CODES.
           COMPUTE SUB2 = +1.
           COMPUTE SUB3 = +1.
           PERFORM
             VARYING SUB1 FROM +1 BY +1
             UNTIL   SUB1 > +20
               IF ER-CD-3-DIG(SUB1) > ZERO
                  IF SUB3 > +3
                     COMPUTE SUB2 = SUB2 + 1
                     COMPUTE SUB3 = +1
                  END-IF
                  MOVE ER-CD-3-DIG(SUB1) TO RCL-ERROR-CD(SUB2,SUB3)
                  COMPUTE SUB3 = SUB3 + 1
               ELSE
                  COMPUTE SUB1 = +20
               END-IF
           END-PERFORM.
       S-110-EXIT.
           EXIT.
      *
       S-120-STACK-FORMAT-3-RECS.
      *
           IF DEFER-RRS-KEY(SUB1) = SPACES
              COMPUTE SUB1 = +17                                        03.42V
              GO TO S-120-EXIT.
      *
           IF DEFER-RRS-LINE(SUB1) = SPACES
              COMPUTE SUB2 = SUB2 + 1
              MOVE '9'                   TO DEFER-RRS-LINE-TYPE(SUB1)
              IF SUB2 < +10                                             02.95
                 MOVE RPT-COMMON-LINE(SUB2)
                                         TO DEFER-RRS-LINE(SUB1)
                 IF SUB2 = +1
                    MOVE '1'             TO DEFER-RRS-LINE-TYPE(SUB1)
                 END-IF
              ELSE
                 IF PET-CARD-TYPE-VISA                                  03.27
                    COMPUTE SUB3 = SUB3 + 1
                    IF SUB3 = +1
                       MOVE RPT-VISA-LINE-1
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +2
                       MOVE RPT-VISA-LINE-2
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +3                                        03.42V
                       MOVE RPT-VISA-LINE-4                             03.42V
                                         TO DEFER-RRS-LINE(SUB1)        03.42V
                    END-IF                                              03.42V
                    IF SUB3 = +4                                        03.42V
                       IF WS-INSTALL-LINE
                          MOVE RPT-VISA-LINE-3
                                         TO DEFER-RRS-LINE(SUB1)
                          COMPUTE SUB1 = SUB1 + 1
                       END-IF
                       MOVE RPT-INTCHG-LINE-1
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +5                                        03.42V
                       MOVE RPT-COMMON-LINE-10                          02.95
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +6                                        02.40V
                       IF RDL-PLAN-ERROR-DATA NOT = SPACES
                          MOVE 'D'       TO DEFER-RRS-LINE-TYPE(SUB1)
                          MOVE RPT-DOWNGRADE-LINE
                                         TO DEFER-RRS-LINE(SUB1)
                       END-IF
                       COMPUTE SUB1 = +17                               03.42V
                    END-IF
                 END-IF
                 IF PET-CARD-TYPE-MC
                    COMPUTE SUB3 = SUB3 + 1
                    IF SUB3 = +1
                       MOVE RPT-MC-LINE-1
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +2
                       MOVE RPT-MC-LINE-2
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +3                                        03.16M
                       MOVE RPT-MC-LINE-3                               03.16M
                                         TO DEFER-RRS-LINE(SUB1)        03.16M
                    END-IF                                              03.16M
                    IF SUB3 = +4                                        03.16M
                       MOVE RPT-INTCHG-LINE-1
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +5                                        03.16M
                       MOVE RPT-COMMON-LINE-10                          02.95
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +6                                        03.16M
                       IF RDL-PLAN-ERROR-DATA NOT = SPACES
                          MOVE 'D'       TO DEFER-RRS-LINE-TYPE(SUB1)
                          MOVE RPT-DOWNGRADE-LINE
                                         TO DEFER-RRS-LINE(SUB1)
                       END-IF
                       COMPUTE SUB1 = +17                               03.42V
                    END-IF
                 END-IF
                 IF PET-CARD-TYPE-AMEX
                    COMPUTE SUB3 = SUB3 + 1
                    IF SUB3 = +1
                       MOVE RPT-AMEX-LINE-1
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +2
                       MOVE RPT-AMEX-LINE-2
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +3                                        03.29
                       MOVE RPT-AMEX-LINE-3                             03.29
                                         TO DEFER-RRS-LINE(SUB1)        03.29
                    END-IF                                              03.29
                    IF SUB3 = +4                                        03.29
                       IF PET-CARD-TYPE-AMEX-SETL                       02.29
                          MOVE RPT-INTCHG-LINE-1                        02.29
                                         TO DEFER-RRS-LINE(SUB1)        02.29
                       ELSE                                             02.29
                          COMPUTE SUB3 = SUB3 + 1                       02.29
                       END-IF                                           02.29
                    END-IF                                              02.29
                    IF SUB3 = +5                                        03.29
                       MOVE RPT-COMMON-LINE-10                          02.95
                                         TO DEFER-RRS-LINE(SUB1)
                       COMPUTE SUB1 = +17                               03.42V
                    END-IF
                 END-IF
                 IF PET-CARD-TYPE-PL AND                                02.29
                    KDA-CHD-IS-VALID-PD                                 02.29
                       COMPUTE SUB3 = SUB3 + 1                          02.29
                       IF SUB3 = +1                                     02.29
                          MOVE RPT-INTCHG-LINE-1                        02.29
                                         TO DEFER-RRS-LINE(SUB1)        02.29
                       END-IF                                           02.29
                       IF SUB3 = +2                                     02.29
                          MOVE RPT-COMMON-LINE-10                       02.95
                                         TO DEFER-RRS-LINE(SUB1)        02.29
                       END-IF                                           02.29
                       IF SUB3 = +3                                     02.29
                          IF RDL-PLAN-ERROR-DATA NOT = SPACES           02.29
                             MOVE 'D'    TO DEFER-RRS-LINE-TYPE(SUB1)   02.29
                             MOVE RPT-DOWNGRADE-LINE                    02.29
                                         TO DEFER-RRS-LINE(SUB1)        02.29
                          END-IF                                        02.29
                          COMPUTE SUB1 = +17                            03.42V
                       END-IF                                           02.29
                 END-IF                                                 02.29
                 IF PET-CARD-TYPE-DISCOVER
                    COMPUTE SUB3 = SUB3 + 1
                    IF SUB3 = +1
                       MOVE RPT-DS-LINE-1
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +2
                       MOVE RPT-DS-LINE-2
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +3                                        03.47
                       MOVE RPT-DS-LINE-3                               03.47
                                         TO DEFER-RRS-LINE(SUB1)        03.47
                    END-IF                                              03.47
                    IF SUB3 = +4                                        03.47
                       IF PET-CARD-TYPE-DISCOVER-SETL
                          MOVE RPT-INTCHG-LINE-1
                                         TO DEFER-RRS-LINE(SUB1)
                       ELSE
                          COMPUTE SUB3 = SUB3 + 1
                       END-IF
                    END-IF
                    IF SUB3 = +5                                        03.47
                       MOVE RPT-COMMON-LINE-10                          02.95
                                         TO DEFER-RRS-LINE(SUB1)
                    END-IF
                    IF SUB3 = +6                                        03.47
                       IF RDL-PLAN-ERROR-DATA NOT = SPACES
                          MOVE 'D'       TO DEFER-RRS-LINE-TYPE(SUB1)
                          MOVE RPT-DOWNGRADE-LINE
                                         TO DEFER-RRS-LINE(SUB1)
                       END-IF
                       COMPUTE SUB1 = +17                               03.42V
                    END-IF
                 END-IF
                 IF PET-CARD-TYPE-PAYPAL                                03.47
                    COMPUTE SUB3 = SUB3 + 1                             03.47
                    IF SUB3 = +1                                        03.47
                       MOVE RPT-DS-LINE-1                               03.47
                                         TO DEFER-RRS-LINE(SUB1)        03.47
                    END-IF                                              03.47
                    IF SUB3 = +2                                        03.47
                       MOVE RPT-DS-LINE-2                               03.47
                                         TO DEFER-RRS-LINE(SUB1)        03.47
                    END-IF                                              03.47
                    IF SUB3 = +3                                        03.47
                       MOVE RPT-DS-LINE-3                               03.47
                                         TO DEFER-RRS-LINE(SUB1)        03.47
                    END-IF                                              03.47
                    IF SUB3 = +4                                        03.47
                       IF PET-CARD-TYPE-PAYPAL-SETL                     03.47
                          MOVE RPT-INTCHG-LINE-1                        03.47
                                         TO DEFER-RRS-LINE(SUB1)        03.47
                       ELSE                                             03.47
                          COMPUTE SUB3 = SUB3 + 1                       03.47
                       END-IF                                           03.47
                    END-IF                                              03.47
                    IF SUB3 = +5                                        03.47
                       MOVE RPT-COMMON-LINE-10                          03.47
                                         TO DEFER-RRS-LINE(SUB1)        03.47
                    END-IF                                              03.47
                    IF SUB3 = +6                                        03.47
                       IF RDL-PLAN-ERROR-DATA NOT = SPACES              03.47
                          MOVE 'D'       TO DEFER-RRS-LINE-TYPE(SUB1)   03.47
                          MOVE RPT-DOWNGRADE-LINE                       03.47
                                         TO DEFER-RRS-LINE(SUB1)        03.47
                       END-IF                                           03.47
                       COMPUTE SUB1 = +17                               03.47
                    END-IF                                              03.47
                 END-IF                                                 03.47
                 IF PET-CARD-TYPE-VISA OR                               03.27
                    PET-CARD-TYPE-MC OR
                    PET-CARD-TYPE-DISCOVER OR
                    PET-CARD-TYPE-PAYPAL OR                             03.47
                    PET-CARD-TYPE-AMEX OR                               02.29
                   (PET-CARD-TYPE-PL AND                                02.29
                    KDA-CHD-IS-VALID-PD)                                02.29
                       CONTINUE
                 ELSE
                    MOVE RPT-COMMON-LINE-10                             02.95
                                         TO DEFER-RRS-LINE(SUB1)
                    COMPUTE SUB1 = +17                                  03.42V
                 END-IF
              END-IF
              MOVE DEFER-RRS-SAVE-CC(SUB1)
                                         TO DEFER-RRS-LINE-CC(SUB1)
           END-IF.
      *
       S-120-EXIT.
           EXIT.
      *
065380 S-200-PRINT-NON-MON-DET-1.
065390     MOVE RPT-NON-MON-DETAIL-1  TO RLW-DETAIL-LINE.
065400     PERFORM R-920-WRITE-REPORT-RECORD
065410        THRU R-920-EXIT.
065420     MOVE SPACES                   TO RPT-NON-MON-DETAIL-1.
065430 S-200-EXIT.
065440     EXIT.
      *
066420 S-300-WRITE-PET-WORK-REC.
060360     MOVE WS-SAVE-WORK-SEQ-NO      TO WORK-SEQ-NO.
066490     WRITE WORK-REC.
060360     ADD +1                        TO WS-SAVE-WORK-SEQ-NO.
066500 S-300-EXIT.
066510     EXIT.
066590*
       S-400-PROCESS-REJECT.
      *
           MOVE WS-OTR-KEY               TO RTR-KEY.
           MOVE WORK-IIIAAA-AMT          TO RTR-IIIAAA-AMT
           MOVE WORK-III999-AMT          TO RTR-III999-AMT.
           MOVE WORK-CENTER-AMT          TO RTR-CENTER-AMT.
           MOVE POST-EDIT-TRANS          TO RTR-DATA.
           WRITE REJECT-TRAN-REC.
      *
       S-400-EXIT.
           EXIT.
      *
       S-450-WRITE-RECN-FH.
      *
           DISPLAY "DD_INTRANS" UPON ENVIRONMENT-NAME.
           ACCEPT HOLD-FILE-NAME FROM ENVIRONMENT-VALUE.
           MOVE HOLD-FILE-NAME(1:50)     TO RCN-FL-NAME.
           MOVE PSI-RUN                  TO RCN-FL-TYPE.
           MOVE HLD-WORK-AS-OF-DATE      TO RCN-FL-DT.
           PERFORM S-453-WRITE-FILE-HEADING
              THRU S-453-EXIT.
           MOVE RECN-FL-1                TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE RECN-FL-2                TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE RECN-FL-3                TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           PERFORM S-454-WRITE-DATA-HEADING
              THRU S-454-EXIT.
      *
       S-450-EXIT.
           EXIT.
      *
       S-451-WRITE-RECN-REC.
      *
           IF WS-RCN-LINE-CNT > 56
              PERFORM S-453-WRITE-FILE-HEADING
                 THRU S-453-EXIT
              PERFORM S-454-WRITE-DATA-HEADING
                 THRU S-454-EXIT.
           MOVE WS-RECN-RECORD           TO RECN-RECORD.
           PERFORM S-455-WRITE-RECN-REC
              THRU S-455-EXIT.
      *
       S-451-EXIT.
           EXIT.
      *
       S-452-WRITE-RECN-FILE-SUMM.
      *
           IF PARM-CREATE-TT-SETL
              PERFORM S-460-WRITE-TT-SETL-FILE
                 THRU S-460-EXIT
           ELSE
              DISPLAY '**** NO SETTLE FILE CREATED ****'
           END-IF.
      *
           MOVE '2'                      TO WS-RCN-HEADER-SW.
           MOVE 99                       TO WS-RCN-LINE-CNT.
      *
           MOVE SPACES                   TO RCU-UPDATE-RECORD.          02.87
           INITIALIZE RCU-UPDATE-RECORD.                                02.87
           MOVE BASCRATE-SD-CENTER-CURR-CD                              02.87
                                         TO RCU-CURR-CODE.              02.87
           MOVE PSI-RUN                  TO RCU-SOURCE-ID.              02.87
           MOVE WS-DATE-WORK             TO RCU-WAO-DATE.               02.87
      *
           MOVE '   MASTERCARD:           '
                                         TO RCN-STL-H2-DESCR.
           MOVE RECN-STL-HEADER-2        TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '0'                      TO RCN-STL-CC.
           MOVE '                  SALES: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-MC-06-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-MC-06-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE SPACE                    TO RCN-STL-CC.
           MOVE '                RETURNS: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-MC-07-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-MC-07-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                   CASH: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-MC-0O-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-MC-0O-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '        NET TO MERCHANT: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-MC-06-AMT
                               + WS-CBT-MC-07-AMT
                               + WS-CBT-MC-0O-AMT.
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.
           COMPUTE WK-SETL-CNT = WS-CBT-MC-06-CNT
                               + WS-CBT-MC-07-CNT
                               + WS-CBT-MC-0O-CNT.
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                REJECTS: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-MC-RJ-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-MC-RJ-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                DELETES: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-MC-DE-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-MC-DE-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
      *
           MOVE WS-CBT-MC-06-AMT         TO RCU-TDYD-TTE(SUB-MC,SUB-06).02.87
           IF WS-CBT-MC-06-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-MC,SUB-06) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-MC,SUB-06) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-MC-06-CNT         TO RCU-TDYU-TTE(SUB-MC,SUB-06).02.87
           MOVE WS-CBT-MC-07-AMT         TO RCU-TDYD-TTE(SUB-MC,SUB-07).02.87
           IF WS-CBT-MC-07-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-MC,SUB-07) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-MC,SUB-07) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-MC-07-CNT         TO RCU-TDYU-TTE(SUB-MC,SUB-07).02.87
           MOVE WS-CBT-MC-0O-AMT         TO RCU-TDYD-TTE(SUB-MC,SUB-0O).02.87
           IF WS-CBT-MC-0O-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-MC,SUB-0O) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-MC,SUB-0O) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-MC-0O-CNT         TO RCU-TDYU-TTE(SUB-MC,SUB-0O).02.87
           MOVE WS-CBT-MC-RJ-AMT         TO RCU-TDYD-TTE(SUB-MC,SUB-RJ).02.87
           IF WS-CBT-MC-RJ-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-MC,SUB-RJ) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-MC,SUB-RJ) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-MC-RJ-CNT         TO RCU-TDYU-TTE(SUB-MC,SUB-RJ).02.87
           MOVE WS-CBT-MC-DE-AMT         TO RCU-TDYD-TTE(SUB-MC,SUB-DE).02.87
           IF WS-CBT-MC-DE-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-MC,SUB-DE) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-MC,SUB-DE) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-MC-DE-CNT         TO RCU-TDYU-TTE(SUB-MC,SUB-DE).02.87
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-MC,SUB-NM).02.87
           IF WK-SETL-AMT < +0                                          02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-MC,SUB-NM) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-MC,SUB-NM) 02.87
           END-IF.                                                      02.87
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-MC,SUB-NM).02.87
      *                                                                 02.87
           MOVE '   VISA:                 '
                                         TO RCN-STL-H2-DESCR.
           MOVE RECN-STL-HEADER-2        TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '0'                      TO RCN-STL-CC.
           MOVE '                  SALES: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-VS-06-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-VS-06-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE SPACE                    TO RCN-STL-CC.
           MOVE '                RETURNS: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-VS-07-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-VS-07-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                   CASH: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-VS-0O-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-VS-0O-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '        NET TO MERCHANT: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-VS-06-AMT
                               + WS-CBT-VS-07-AMT
                               + WS-CBT-VS-0O-AMT.
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.
           COMPUTE WK-SETL-CNT = WS-CBT-VS-06-CNT
                               + WS-CBT-VS-07-CNT
                               + WS-CBT-VS-0O-CNT.
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                REJECTS: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-VS-RJ-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-VS-RJ-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                DELETES: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-VS-DE-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-VS-DE-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
      *
           MOVE WS-CBT-VS-06-AMT         TO RCU-TDYD-TTE(SUB-VS,SUB-06).02.87
           IF WS-CBT-VS-06-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-VS,SUB-06) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-VS,SUB-06) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-VS-06-CNT         TO RCU-TDYU-TTE(SUB-VS,SUB-06).02.87
           MOVE WS-CBT-VS-07-AMT         TO RCU-TDYD-TTE(SUB-VS,SUB-07).02.87
           IF WS-CBT-VS-07-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-VS,SUB-07) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-VS,SUB-07) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-VS-07-CNT         TO RCU-TDYU-TTE(SUB-VS,SUB-07).02.87
           MOVE WS-CBT-VS-0O-AMT         TO RCU-TDYD-TTE(SUB-VS,SUB-0O).02.87
           IF WS-CBT-VS-0O-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-VS,SUB-0O) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-VS,SUB-0O) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-VS-0O-CNT         TO RCU-TDYU-TTE(SUB-VS,SUB-0O).02.87
           MOVE WS-CBT-VS-RJ-AMT         TO RCU-TDYD-TTE(SUB-VS,SUB-RJ).02.87
           IF WS-CBT-VS-RJ-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-VS,SUB-RJ) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-VS,SUB-RJ) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-VS-RJ-CNT         TO RCU-TDYU-TTE(SUB-VS,SUB-RJ).02.87
           MOVE WS-CBT-VS-DE-AMT         TO RCU-TDYD-TTE(SUB-VS,SUB-DE).02.87
           IF WS-CBT-VS-DE-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-VS,SUB-DE) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-VS,SUB-DE) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-VS-DE-CNT         TO RCU-TDYU-TTE(SUB-VS,SUB-DE).02.87
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-VS,SUB-NM).02.87
           IF WK-SETL-AMT < +0                                          02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-VS,SUB-NM) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-VS,SUB-NM) 02.87
           END-IF.                                                      02.87
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-VS,SUB-NM).02.87
      *                                                                 02.87
           MOVE '   DISCOVER:             '
                                         TO RCN-STL-H2-DESCR.
           MOVE RECN-STL-HEADER-2        TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '0'                      TO RCN-STL-CC.
           MOVE '                  SALES: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-DS-06-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-DS-06-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE SPACE                    TO RCN-STL-CC.
           MOVE '                RETURNS: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-DS-07-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-DS-07-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                   CASH: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-DS-0O-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-DS-0O-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '        NET TO MERCHANT: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-DS-06-AMT
                               + WS-CBT-DS-07-AMT
                               + WS-CBT-DS-0O-AMT.
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.
           COMPUTE WK-SETL-CNT = WS-CBT-DS-06-CNT
                               + WS-CBT-DS-07-CNT
                               + WS-CBT-DS-0O-CNT.
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                REJECTS: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-DS-RJ-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-DS-RJ-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                DELETES: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-DS-DE-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-DS-DE-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
      *
           MOVE WS-CBT-DS-06-AMT         TO RCU-TDYD-TTE(SUB-DS,SUB-06).02.87
           IF WS-CBT-DS-06-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-DS,SUB-06) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-DS,SUB-06) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-DS-06-CNT         TO RCU-TDYU-TTE(SUB-DS,SUB-06).02.87
           MOVE WS-CBT-DS-07-AMT         TO RCU-TDYD-TTE(SUB-DS,SUB-07).02.87
           IF WS-CBT-DS-07-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-DS,SUB-07) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-DS,SUB-07) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-DS-07-CNT         TO RCU-TDYU-TTE(SUB-DS,SUB-07).02.87
           MOVE WS-CBT-DS-0O-AMT         TO RCU-TDYD-TTE(SUB-DS,SUB-0O).02.87
           IF WS-CBT-DS-0O-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-DS,SUB-0O) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-DS,SUB-0O) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-DS-0O-CNT         TO RCU-TDYU-TTE(SUB-DS,SUB-0O).02.87
           MOVE WS-CBT-DS-RJ-AMT         TO RCU-TDYD-TTE(SUB-DS,SUB-RJ).02.87
           IF WS-CBT-DS-RJ-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-DS,SUB-RJ) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-DS,SUB-RJ) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-DS-RJ-CNT         TO RCU-TDYU-TTE(SUB-DS,SUB-RJ).02.87
           MOVE WS-CBT-DS-DE-AMT         TO RCU-TDYD-TTE(SUB-DS,SUB-DE).02.87
           IF WS-CBT-DS-DE-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-DS,SUB-DE) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-DS,SUB-DE) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-DS-DE-CNT         TO RCU-TDYU-TTE(SUB-DS,SUB-DE).02.87
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-DS,SUB-NM).02.87
           IF WK-SETL-AMT < +0                                          02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-DS,SUB-NM) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-DS,SUB-NM) 02.87
           END-IF.                                                      02.87
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-DS,SUB-NM).02.87
      *                                                                 02.87
           MOVE '     PAYPAL:             '                             03.47
                                         TO RCN-STL-H2-DESCR.           03.47
           MOVE RECN-STL-HEADER-2        TO WS-RECN-RECORD.             03.47
           PERFORM S-451-WRITE-RECN-REC                                 03.47
              THRU S-451-EXIT.                                          03.47
           MOVE '0'                      TO RCN-STL-CC.                 03.47
           MOVE '                  SALES: '                             03.47
                                         TO RCN-STL-DL-HEADING.         03.47
           MOVE WS-CBT-PP-06-AMT         TO RCN-STL-DL-AMT.             03.47
           MOVE WS-CBT-PP-06-CNT         TO RCN-STL-DL-ITMS.            03.47
           CALL BACONDEC USING WS-BANK-999999                           03.47
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              03.47
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                03.47
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                03.47
                    C-TYPEEND.                                          03.47
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             03.47
           PERFORM S-451-WRITE-RECN-REC                                 03.47
              THRU S-451-EXIT.                                          03.47
           MOVE SPACE                    TO RCN-STL-CC.                 03.47
           MOVE '                RETURNS: '                             03.47
                                         TO RCN-STL-DL-HEADING.         03.47
           MOVE WS-CBT-PP-07-AMT         TO RCN-STL-DL-AMT.             03.47
           MOVE WS-CBT-PP-07-CNT         TO RCN-STL-DL-ITMS.            03.47
           CALL BACONDEC USING WS-BANK-999999                           03.47
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              03.47
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                03.47
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                03.47
                    C-TYPEEND.                                          03.47
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             03.47
           PERFORM S-451-WRITE-RECN-REC                                 03.47
              THRU S-451-EXIT.                                          03.47
           MOVE '                   CASH: '                             03.47
                                         TO RCN-STL-DL-HEADING.         03.47
           MOVE WS-CBT-PP-0O-AMT         TO RCN-STL-DL-AMT.             03.47
           MOVE WS-CBT-PP-0O-CNT         TO RCN-STL-DL-ITMS.            03.47
           CALL BACONDEC USING WS-BANK-999999                           03.47
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              03.47
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                03.47
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                03.47
                    C-TYPEEND.                                          03.47
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             03.47
           PERFORM S-451-WRITE-RECN-REC                                 03.47
              THRU S-451-EXIT.                                          03.47
           MOVE '        NET TO MERCHANT: '                             03.47
                                         TO RCN-STL-DL-HEADING.         03.47
           COMPUTE WK-SETL-AMT = WS-CBT-PP-06-AMT                       03.47
                               + WS-CBT-PP-07-AMT                       03.47
                               + WS-CBT-PP-0O-AMT.                      03.47
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             03.47
           COMPUTE WK-SETL-CNT = WS-CBT-PP-06-CNT                       03.47
                               + WS-CBT-PP-07-CNT                       03.47
                               + WS-CBT-PP-0O-CNT.                      03.47
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            03.47
           CALL BACONDEC USING WS-BANK-999999                           03.47
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              03.47
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                03.47
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                03.47
                    C-TYPEEND.                                          03.47
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             03.47
           PERFORM S-451-WRITE-RECN-REC                                 03.47
              THRU S-451-EXIT.                                          03.47
           MOVE '                REJECTS: '                             03.47
                                         TO RCN-STL-DL-HEADING.         03.47
           MOVE WS-CBT-PP-RJ-AMT         TO RCN-STL-DL-AMT.             03.47
           MOVE WS-CBT-PP-RJ-CNT         TO RCN-STL-DL-ITMS.            03.47
           CALL BACONDEC USING WS-BANK-999999                           03.47
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              03.47
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                03.47
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                03.47
                    C-TYPEEND.                                          03.47
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             03.47
           PERFORM S-451-WRITE-RECN-REC                                 03.47
              THRU S-451-EXIT.                                          03.47
           MOVE '                DELETES: '                             03.47
                                         TO RCN-STL-DL-HEADING.         03.47
           MOVE WS-CBT-PP-DE-AMT         TO RCN-STL-DL-AMT.             03.47
           MOVE WS-CBT-PP-DE-CNT         TO RCN-STL-DL-ITMS.            03.47
           CALL BACONDEC USING WS-BANK-999999                           03.47
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              03.47
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                03.47
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                03.47
                    C-TYPEEND.                                          03.47
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             03.47
           PERFORM S-451-WRITE-RECN-REC                                 03.47
              THRU S-451-EXIT.                                          03.47
      *                                                                 03.47
           MOVE WS-CBT-PP-06-AMT         TO RCU-TDYD-TTE(SUB-PP,SUB-06).03.47
           IF WS-CBT-PP-06-AMT < +0                                     03.47
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PP,SUB-06) 03.47
           ELSE                                                         03.47
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PP,SUB-06) 03.47
           END-IF.                                                      03.47
           MOVE WS-CBT-PP-06-CNT         TO RCU-TDYU-TTE(SUB-PP,SUB-06).03.47
           MOVE WS-CBT-PP-07-AMT         TO RCU-TDYD-TTE(SUB-PP,SUB-07).03.47
           IF WS-CBT-PP-07-AMT < +0                                     03.47
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PP,SUB-07) 03.47
           ELSE                                                         03.47
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PP,SUB-07) 03.47
           END-IF.                                                      03.47
           MOVE WS-CBT-PP-07-CNT         TO RCU-TDYU-TTE(SUB-PP,SUB-07).03.47
           MOVE WS-CBT-PP-0O-AMT         TO RCU-TDYD-TTE(SUB-PP,SUB-0O).03.47
           IF WS-CBT-PP-0O-AMT < +0                                     03.47
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PP,SUB-0O) 03.47
           ELSE                                                         03.47
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PP,SUB-0O) 03.47
           END-IF.                                                      03.47
           MOVE WS-CBT-PP-0O-CNT         TO RCU-TDYU-TTE(SUB-PP,SUB-0O).03.47
           MOVE WS-CBT-PP-RJ-AMT         TO RCU-TDYD-TTE(SUB-PP,SUB-RJ).03.47
           IF WS-CBT-PP-RJ-AMT < +0                                     03.47
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PP,SUB-RJ) 03.47
           ELSE                                                         03.47
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PP,SUB-RJ) 03.47
           END-IF.                                                      03.47
           MOVE WS-CBT-PP-RJ-CNT         TO RCU-TDYU-TTE(SUB-PP,SUB-RJ).03.47
           MOVE WS-CBT-PP-DE-AMT         TO RCU-TDYD-TTE(SUB-PP,SUB-DE).03.47
           IF WS-CBT-PP-DE-AMT < +0                                     03.47
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PP,SUB-DE) 03.47
           ELSE                                                         03.47
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PP,SUB-DE) 03.47
           END-IF.                                                      03.47
           MOVE WS-CBT-PP-DE-CNT         TO RCU-TDYU-TTE(SUB-PP,SUB-DE).03.47
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-PP,SUB-NM).03.47
           IF WK-SETL-AMT < +0                                          03.47
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PP,SUB-NM) 03.47
           ELSE                                                         03.47
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PP,SUB-NM) 03.47
           END-IF.                                                      03.47
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-PP,SUB-NM).03.47
      *                                                                 03.47
           MOVE '   AMEX:                 '                             02.31
                                         TO RCN-STL-H2-DESCR.           02.31
           MOVE RECN-STL-HEADER-2        TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '0'                      TO RCN-STL-CC.                 02.31
           MOVE '                  SALES: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-AX-06-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-AX-06-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE SPACE                    TO RCN-STL-CC.                 02.31
           MOVE '                RETURNS: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-AX-07-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-AX-07-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '                   CASH: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-AX-0O-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-AX-0O-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '        NET TO MERCHANT: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           COMPUTE WK-SETL-AMT = WS-CBT-AX-06-AMT                       02.31
                               + WS-CBT-AX-07-AMT                       02.31
                               + WS-CBT-AX-0O-AMT.                      02.31
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.31
           COMPUTE WK-SETL-CNT = WS-CBT-AX-06-CNT                       02.31
                               + WS-CBT-AX-07-CNT                       02.31
                               + WS-CBT-AX-0O-CNT.                      02.31
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '                REJECTS: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-AX-RJ-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-AX-RJ-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '                DELETES: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-AX-DE-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-AX-DE-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
      *                                                                 02.31
           MOVE WS-CBT-AX-06-AMT         TO RCU-TDYD-TTE(SUB-AX,SUB-06).02.87
           IF WS-CBT-AX-06-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-AX,SUB-06) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-AX,SUB-06) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-AX-06-CNT         TO RCU-TDYU-TTE(SUB-AX,SUB-06).02.87
           MOVE WS-CBT-AX-07-AMT         TO RCU-TDYD-TTE(SUB-AX,SUB-07).02.87
           IF WS-CBT-AX-07-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-AX,SUB-07) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-AX,SUB-07) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-AX-07-CNT         TO RCU-TDYU-TTE(SUB-AX,SUB-07).02.87
           MOVE WS-CBT-AX-0O-AMT         TO RCU-TDYD-TTE(SUB-AX,SUB-0O).02.87
           IF WS-CBT-AX-0O-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-AX,SUB-0O) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-AX,SUB-0O) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-AX-0O-CNT         TO RCU-TDYU-TTE(SUB-AX,SUB-0O).02.87
           MOVE WS-CBT-AX-RJ-AMT         TO RCU-TDYD-TTE(SUB-AX,SUB-RJ).02.87
           IF WS-CBT-AX-RJ-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-AX,SUB-RJ) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-AX,SUB-RJ) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-AX-RJ-CNT         TO RCU-TDYU-TTE(SUB-AX,SUB-RJ).02.87
           MOVE WS-CBT-AX-DE-AMT         TO RCU-TDYD-TTE(SUB-AX,SUB-DE).02.87
           IF WS-CBT-AX-DE-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-AX,SUB-DE) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-AX,SUB-DE) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-AX-DE-CNT         TO RCU-TDYU-TTE(SUB-AX,SUB-DE).02.87
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-AX,SUB-NM).02.87
           IF WK-SETL-AMT < +0                                          02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-AX,SUB-NM) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-AX,SUB-NM) 02.87
           END-IF.                                                      02.87
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-AX,SUB-NM).02.87
      *                                                                 02.87
           MOVE '   PIN DEBIT:            '                             02.31
                                         TO RCN-STL-H2-DESCR.           02.31
           MOVE RECN-STL-HEADER-2        TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '0'                      TO RCN-STL-CC.                 02.31
           MOVE '                  SALES: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-DB-06-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-DB-06-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE SPACE                    TO RCN-STL-CC.                 02.31
           MOVE '                RETURNS: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-DB-07-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-DB-07-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '                   CASH: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-DB-0O-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-DB-0O-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '        NET TO MERCHANT: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           COMPUTE WK-SETL-AMT = WS-CBT-DB-06-AMT                       02.31
                               + WS-CBT-DB-07-AMT                       02.31
                               + WS-CBT-DB-0O-AMT.                      02.31
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.31
           COMPUTE WK-SETL-CNT = WS-CBT-DB-06-CNT                       02.31
                               + WS-CBT-DB-07-CNT                       02.31
                               + WS-CBT-DB-0O-CNT.                      02.31
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '                REJECTS: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-DB-RJ-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-DB-RJ-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '                DELETES: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-DB-DE-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-DB-DE-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
      *                                                                 02.31
           MOVE WS-CBT-DB-06-AMT         TO RCU-TDYD-TTE(SUB-DB,SUB-06).02.87
           IF WS-CBT-DB-06-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-DB,SUB-06) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-DB,SUB-06) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-DB-06-CNT         TO RCU-TDYU-TTE(SUB-DB,SUB-06).02.87
           MOVE WS-CBT-DB-07-AMT         TO RCU-TDYD-TTE(SUB-DB,SUB-07).02.87
           IF WS-CBT-DB-07-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-DB,SUB-07) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-DB,SUB-07) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-DB-07-CNT         TO RCU-TDYU-TTE(SUB-DB,SUB-07).02.87
           MOVE WS-CBT-DB-0O-AMT         TO RCU-TDYD-TTE(SUB-DB,SUB-0O).02.87
           IF WS-CBT-DB-0O-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-DB,SUB-0O) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-DB,SUB-0O) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-DB-0O-CNT         TO RCU-TDYU-TTE(SUB-DB,SUB-0O).02.87
           MOVE WS-CBT-DB-RJ-AMT         TO RCU-TDYD-TTE(SUB-DB,SUB-RJ).02.87
           IF WS-CBT-DB-RJ-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-DB,SUB-RJ) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-DB,SUB-RJ) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-DB-RJ-CNT         TO RCU-TDYU-TTE(SUB-DB,SUB-RJ).02.87
           MOVE WS-CBT-DB-DE-AMT         TO RCU-TDYD-TTE(SUB-DB,SUB-DE).02.87
           IF WS-CBT-DB-DE-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-DB,SUB-DE) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-DB,SUB-DE) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-DB-DE-CNT         TO RCU-TDYU-TTE(SUB-DB,SUB-DE).02.87
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-DB,SUB-NM).02.87
           IF WK-SETL-AMT < +0                                          02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-DB,SUB-NM) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-DB,SUB-NM) 02.87
           END-IF.                                                      02.87
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-DB,SUB-NM).02.87
      *                                                                 02.87
           MOVE '   DEBIT NETWORKS:       '                             02.31
                                         TO RCN-STL-H2-DESCR.           02.31
           MOVE RECN-STL-HEADER-2        TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '0'                      TO RCN-STL-CC.                 02.31
           MOVE '                  SALES: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-PD-06-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-PD-06-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE SPACE                    TO RCN-STL-CC.                 02.31
           MOVE '                RETURNS: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-PD-07-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-PD-07-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '                   CASH: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-PD-0O-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-PD-0O-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '        NET TO MERCHANT: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           COMPUTE WK-SETL-AMT = WS-CBT-PD-06-AMT                       02.31
                               + WS-CBT-PD-07-AMT                       02.31
                               + WS-CBT-PD-0O-AMT.                      02.31
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.31
           COMPUTE WK-SETL-CNT = WS-CBT-PD-06-CNT                       02.31
                               + WS-CBT-PD-07-CNT                       02.31
                               + WS-CBT-PD-0O-CNT.                      02.31
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '                REJECTS: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-PD-RJ-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-PD-RJ-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
           MOVE '                DELETES: '                             02.31
                                         TO RCN-STL-DL-HEADING.         02.31
           MOVE WS-CBT-PD-DE-AMT         TO RCN-STL-DL-AMT.             02.31
           MOVE WS-CBT-PD-DE-CNT         TO RCN-STL-DL-ITMS.            02.31
           CALL BACONDEC USING WS-BANK-999999                           02.31
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC              02.31
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24                02.31
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09                02.31
                    C-TYPEEND.                                          02.31
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.             02.31
           PERFORM S-451-WRITE-RECN-REC                                 02.31
              THRU S-451-EXIT.                                          02.31
      *                                                                 02.31
           MOVE WS-CBT-PD-06-AMT         TO RCU-TDYD-TTE(SUB-PD,SUB-06).02.87
           IF WS-CBT-PD-06-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PD,SUB-06) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PD,SUB-06) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-PD-06-CNT         TO RCU-TDYU-TTE(SUB-PD,SUB-06).02.87
           MOVE WS-CBT-PD-07-AMT         TO RCU-TDYD-TTE(SUB-PD,SUB-07).02.87
           IF WS-CBT-PD-07-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PD,SUB-07) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PD,SUB-07) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-PD-07-CNT         TO RCU-TDYU-TTE(SUB-PD,SUB-07).02.87
           MOVE WS-CBT-PD-0O-AMT         TO RCU-TDYD-TTE(SUB-PD,SUB-0O).02.87
           IF WS-CBT-PD-0O-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PD,SUB-0O) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PD,SUB-0O) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-PD-0O-CNT         TO RCU-TDYU-TTE(SUB-PD,SUB-0O).02.87
           MOVE WS-CBT-PD-RJ-AMT         TO RCU-TDYD-TTE(SUB-PD,SUB-RJ).02.87
           IF WS-CBT-PD-RJ-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PD,SUB-RJ) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PD,SUB-RJ) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-PD-RJ-CNT         TO RCU-TDYU-TTE(SUB-PD,SUB-RJ).02.87
           MOVE WS-CBT-PD-DE-AMT         TO RCU-TDYD-TTE(SUB-PD,SUB-DE).02.87
           IF WS-CBT-PD-DE-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PD,SUB-DE) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PD,SUB-DE) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-PD-DE-CNT         TO RCU-TDYU-TTE(SUB-PD,SUB-DE).02.87
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-PD,SUB-NM).02.87
           IF WK-SETL-AMT < +0                                          02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PD,SUB-NM) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PD,SUB-NM) 02.87
           END-IF.                                                      02.87
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-PD,SUB-NM).02.87
      *                                                                 02.87
           MOVE '   OTHER:                '
                                         TO RCN-STL-H2-DESCR.
           MOVE RECN-STL-HEADER-2        TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '0'                      TO RCN-STL-CC.
           MOVE '                  SALES: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-OT-06-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-OT-06-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE SPACE                    TO RCN-STL-CC.
           MOVE '                RETURNS: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-OT-07-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-OT-07-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                   CASH: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-OT-0O-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-OT-0O-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '        NET TO MERCHANT: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-OT-06-AMT
                               + WS-CBT-OT-07-AMT
                               + WS-CBT-OT-0O-AMT.
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.
           COMPUTE WK-SETL-CNT = WS-CBT-OT-06-CNT
                               + WS-CBT-OT-07-CNT
                               + WS-CBT-OT-0O-CNT.
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                REJECTS: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-OT-RJ-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-OT-RJ-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                DELETES: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-OT-DE-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-OT-DE-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
      *
           MOVE WS-CBT-OT-06-AMT         TO RCU-TDYD-TTE(SUB-OT,SUB-06).02.87
           IF WS-CBT-OT-06-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-OT,SUB-06) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-OT,SUB-06) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-OT-06-CNT         TO RCU-TDYU-TTE(SUB-OT,SUB-06).02.87
           MOVE WS-CBT-OT-07-AMT         TO RCU-TDYD-TTE(SUB-OT,SUB-07).02.87
           IF WS-CBT-OT-07-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-OT,SUB-07) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-OT,SUB-07) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-OT-07-CNT         TO RCU-TDYU-TTE(SUB-OT,SUB-07).02.87
           MOVE WS-CBT-OT-0O-AMT         TO RCU-TDYD-TTE(SUB-OT,SUB-0O).02.87
           IF WS-CBT-OT-0O-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-OT,SUB-0O) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-OT,SUB-0O) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-OT-0O-CNT         TO RCU-TDYU-TTE(SUB-OT,SUB-0O).02.87
           MOVE WS-CBT-OT-RJ-AMT         TO RCU-TDYD-TTE(SUB-OT,SUB-RJ).02.87
           IF WS-CBT-OT-RJ-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-OT,SUB-RJ) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-OT,SUB-RJ) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-OT-RJ-CNT         TO RCU-TDYU-TTE(SUB-OT,SUB-RJ).02.87
           MOVE WS-CBT-OT-DE-AMT         TO RCU-TDYD-TTE(SUB-OT,SUB-DE).02.87
           IF WS-CBT-OT-DE-AMT < +0                                     02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-OT,SUB-DE) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-OT,SUB-DE) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-OT-DE-CNT         TO RCU-TDYU-TTE(SUB-OT,SUB-DE).02.87
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-OT,SUB-NM).02.87
           IF WK-SETL-AMT < +0                                          02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-OT,SUB-NM) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-OT,SUB-NM) 02.87
           END-IF.                                                      02.87
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-OT,SUB-NM).02.87
      *                                                                 02.87
           MOVE '   NET SETTLEMENT:       '
                                         TO RCN-STL-H2-DESCR.
           MOVE RECN-STL-HEADER-2        TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '0'                      TO RCN-STL-CC.
           MOVE '                  SALES: '
                                         TO RCN-STL-DL-HEADING.
           MOVE +0                       TO WK-SETL-TOT-AMT             02.94
                                            WK-SETL-TOT-CNT.            02.94
           COMPUTE WK-SETL-AMT = WS-CBT-OT-06-AMT                       02.94
                               + WS-CBT-VS-06-AMT                       02.94
                               + WS-CBT-DS-06-AMT                       02.94
                               + WS-CBT-PP-06-AMT                       03.47
                               + WS-CBT-AX-06-AMT                       02.94
                               + WS-CBT-DB-06-AMT                       02.94
                               + WS-CBT-PD-06-AMT                       02.94
                               + WS-CBT-MC-06-AMT.                      02.94
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.94
           COMPUTE WK-SETL-CNT = WS-CBT-OT-06-CNT                       02.94
                               + WS-CBT-VS-06-CNT                       02.94
                               + WS-CBT-DS-06-CNT                       02.94
                               + WS-CBT-PP-06-CNT                       03.47
                               + WS-CBT-AX-06-CNT                       02.94
                               + WS-CBT-DB-06-CNT                       02.94
                               + WS-CBT-PD-06-CNT                       02.94
                               + WS-CBT-MC-06-CNT.                      02.94
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.94
           COMPUTE WK-SETL-TOT-AMT = WK-SETL-TOT-AMT                    02.94
                                   + WK-SETL-AMT.                       02.94
           COMPUTE WK-SETL-TOT-CNT = WK-SETL-TOT-CNT                    02.94
                                   + WK-SETL-CNT.                       02.94
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-NT,SUB-06).02.94
           IF WK-SETL-AMT < +0                                          02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-NT,SUB-06) 02.94
           ELSE                                                         02.94
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-NT,SUB-06) 02.94
           END-IF.                                                      02.94
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-NT,SUB-06).02.94
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE SPACE                    TO RCN-STL-CC.
           MOVE '                RETURNS: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-OT-07-AMT                       02.94
                               + WS-CBT-VS-07-AMT                       02.94
                               + WS-CBT-DS-07-AMT                       02.94
                               + WS-CBT-PP-07-AMT                       03.47
                               + WS-CBT-AX-07-AMT                       02.94
                               + WS-CBT-DB-07-AMT                       02.94
                               + WS-CBT-PD-07-AMT                       02.94
                               + WS-CBT-MC-07-AMT.                      02.94
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.94
           COMPUTE WK-SETL-CNT = WS-CBT-OT-07-CNT                       02.94
                               + WS-CBT-VS-07-CNT                       02.94
                               + WS-CBT-DS-07-CNT                       02.94
                               + WS-CBT-PP-07-CNT                       03.47
                               + WS-CBT-AX-07-CNT                       02.94
                               + WS-CBT-DB-07-CNT                       02.94
                               + WS-CBT-PD-07-CNT                       02.94
                               + WS-CBT-MC-07-CNT.                      02.94
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.94
           COMPUTE WK-SETL-TOT-AMT = WK-SETL-TOT-AMT                    02.94
                                   + WK-SETL-AMT.                       02.94
           COMPUTE WK-SETL-TOT-CNT = WK-SETL-TOT-CNT                    02.94
                                   + WK-SETL-CNT.                       02.94
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-NT,SUB-07).02.94
           IF WK-SETL-AMT < +0                                          02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-NT,SUB-07) 02.94
           ELSE                                                         02.94
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-NT,SUB-07) 02.94
           END-IF.                                                      02.94
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-NT,SUB-07).02.94
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                   CASH: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-OT-0O-AMT                       02.94
                               + WS-CBT-VS-0O-AMT                       02.94
                               + WS-CBT-DS-0O-AMT                       02.94
                               + WS-CBT-PP-0O-AMT                       03.47
                               + WS-CBT-AX-0O-AMT                       02.94
                               + WS-CBT-DB-0O-AMT                       02.94
                               + WS-CBT-PD-0O-AMT                       02.94
                               + WS-CBT-MC-0O-AMT.                      02.94
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.94
           COMPUTE WK-SETL-CNT = WS-CBT-OT-0O-CNT                       02.94
                               + WS-CBT-VS-0O-CNT                       02.94
                               + WS-CBT-DS-0O-CNT                       02.94
                               + WS-CBT-PP-0O-CNT                       03.47
                               + WS-CBT-AX-0O-CNT                       02.94
                               + WS-CBT-DB-0O-CNT                       02.94
                               + WS-CBT-PD-0O-CNT                       02.94
                               + WS-CBT-MC-0O-CNT.                      02.94
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.94
           COMPUTE WK-SETL-TOT-AMT = WK-SETL-TOT-AMT                    02.94
                                   + WK-SETL-AMT.                       02.94
           COMPUTE WK-SETL-TOT-CNT = WK-SETL-TOT-CNT                    02.94
                                   + WK-SETL-CNT.                       02.94
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-NT,SUB-0O).02.94
           IF WK-SETL-AMT < +0                                          02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-NT,SUB-0O) 02.94
           ELSE                                                         02.94
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-NT,SUB-0O) 02.94
           END-IF.                                                      02.94
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-NT,SUB-0O).02.94
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '        NET TO MERCHANT: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WK-SETL-TOT-AMT          TO RCN-STL-DL-AMT.             02.94
           MOVE WK-SETL-TOT-CNT          TO RCN-STL-DL-ITMS.            02.94
           MOVE WK-SETL-TOT-AMT          TO RCU-TDYD-TTE(SUB-NT,SUB-NM).02.94
           IF WK-SETL-TOT-AMT < +0                                      02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-NT,SUB-NM) 02.94
           ELSE                                                         02.94
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-NT,SUB-NM) 02.94
           END-IF.                                                      02.94
           MOVE WK-SETL-TOT-CNT          TO RCU-TDYU-TTE(SUB-NT,SUB-NM).02.94
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                REJECTS: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-OT-RJ-AMT                       02.94
                               + WS-CBT-VS-RJ-AMT                       02.94
                               + WS-CBT-DS-RJ-AMT                       02.94
                               + WS-CBT-PP-RJ-AMT                       03.47
                               + WS-CBT-AX-RJ-AMT                       02.94
                               + WS-CBT-DB-RJ-AMT                       02.94
                               + WS-CBT-PD-RJ-AMT                       02.94
                               + WS-CBT-MC-RJ-AMT.                      02.94
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.94
           COMPUTE WK-SETL-CNT = WS-CBT-OT-RJ-CNT                       02.94
                               + WS-CBT-VS-RJ-CNT                       02.94
                               + WS-CBT-DS-RJ-CNT                       02.94
                               + WS-CBT-PP-RJ-CNT                       03.47
                               + WS-CBT-AX-RJ-CNT                       02.94
                               + WS-CBT-DB-RJ-CNT                       02.94
                               + WS-CBT-PD-RJ-CNT                       02.94
                               + WS-CBT-MC-RJ-CNT.                      02.94
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.94
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-NT,SUB-RJ).02.94
           IF WK-SETL-AMT < +0                                          02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-NT,SUB-RJ) 02.94
           ELSE                                                         02.94
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-NT,SUB-RJ) 02.94
           END-IF.                                                      02.94
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-NT,SUB-RJ).02.94
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                DELETES: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-OT-DE-AMT                       02.94
                               + WS-CBT-VS-DE-AMT                       02.94
                               + WS-CBT-DS-DE-AMT                       02.94
                               + WS-CBT-PP-DE-AMT                       03.47
                               + WS-CBT-AX-DE-AMT                       02.94
                               + WS-CBT-DB-DE-AMT                       02.94
                               + WS-CBT-PD-DE-AMT                       02.94
                               + WS-CBT-MC-DE-AMT.                      02.94
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.94
           COMPUTE WK-SETL-CNT = WS-CBT-OT-DE-CNT                       02.94
                               + WS-CBT-VS-DE-CNT                       02.94
                               + WS-CBT-DS-DE-CNT                       02.94
                               + WS-CBT-PP-DE-CNT                       03.47
                               + WS-CBT-AX-DE-CNT                       02.94
                               + WS-CBT-DB-DE-CNT                       02.94
                               + WS-CBT-PD-DE-CNT                       02.94
                               + WS-CBT-MC-DE-CNT.                      02.94
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.94
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-NT,SUB-DE).02.94
           IF WK-SETL-AMT < +0                                          02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-NT,SUB-DE) 02.94
           ELSE                                                         02.94
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-NT,SUB-DE) 02.94
           END-IF.                                                      02.94
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-NT,SUB-DE).02.94
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
      *
           MOVE '   NON-SETTLE TOTALS:    '
                                         TO RCN-STL-H2-DESCR.
           MOVE RECN-STL-HEADER-2        TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '0'                      TO RCN-STL-CC.
           MOVE '                  SALES: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-NS-06-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-NS-06-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE SPACE                    TO RCN-STL-CC.
           MOVE '                RETURNS: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-NS-07-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-NS-07-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                   CASH: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-NS-0O-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-NS-0O-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '        NET TO MERCHANT: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-NS-06-AMT
                               + WS-CBT-NS-07-AMT
                               + WS-CBT-NS-0O-AMT.
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.
           COMPUTE WK-SETL-CNT = WS-CBT-NS-06-CNT
                               + WS-CBT-NS-07-CNT
                               + WS-CBT-NS-0O-CNT.
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                REJECTS: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-NS-RJ-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-NS-RJ-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                DELETES: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WS-CBT-NS-DE-AMT         TO RCN-STL-DL-AMT.
           MOVE WS-CBT-NS-DE-CNT         TO RCN-STL-DL-ITMS.
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
      *
           MOVE WS-CBT-NS-06-AMT         TO RCU-TDYD-TTE(SUB-NS,SUB-06).02.94
           IF WS-CBT-NS-06-AMT < +0                                     02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-NS,SUB-06) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-NS,SUB-06) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-NS-06-CNT         TO RCU-TDYU-TTE(SUB-NS,SUB-06).02.94
           MOVE WS-CBT-NS-07-AMT         TO RCU-TDYD-TTE(SUB-NS,SUB-07).02.94
           IF WS-CBT-NS-07-AMT < +0                                     02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-NS,SUB-07) 02.94
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-NS,SUB-07) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-NS-07-CNT         TO RCU-TDYU-TTE(SUB-NS,SUB-07).02.94
           MOVE WS-CBT-NS-0O-AMT         TO RCU-TDYD-TTE(SUB-NS,SUB-0O).02.94
           IF WS-CBT-NS-0O-AMT < +0                                     02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-NS,SUB-0O) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-NS,SUB-0O) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-NS-0O-CNT         TO RCU-TDYU-TTE(SUB-NS,SUB-0O).02.94
           MOVE WS-CBT-NS-RJ-AMT         TO RCU-TDYD-TTE(SUB-NS,SUB-RJ).02.94
           IF WS-CBT-NS-RJ-AMT < +0                                     02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-NS,SUB-RJ) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-NS,SUB-RJ) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-NS-RJ-CNT         TO RCU-TDYU-TTE(SUB-NS,SUB-RJ).02.94
           MOVE WS-CBT-NS-DE-AMT         TO RCU-TDYD-TTE(SUB-NS,SUB-DE).02.94
           IF WS-CBT-NS-DE-AMT < +0                                     02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-NS,SUB-DE) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-NS,SUB-DE) 02.87
           END-IF.                                                      02.87
           MOVE WS-CBT-NS-DE-CNT         TO RCU-TDYU-TTE(SUB-NS,SUB-DE).02.94
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-NS,SUB-NM).02.87
           IF WK-SETL-AMT < +0                                          02.87
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-NS,SUB-NM) 02.87
           ELSE                                                         02.87
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-NS,SUB-NM) 02.87
           END-IF.                                                      02.87
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-NS,SUB-NM).02.87
      *                                                                 02.87
           MOVE '   TOTAL PROCESSED:      '
                                         TO RCN-STL-H2-DESCR.
           MOVE RECN-STL-HEADER-2        TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '0'                      TO RCN-STL-CC.
           MOVE '                  SALES: '
                                         TO RCN-STL-DL-HEADING.
           MOVE +0                       TO WK-SETL-TOT-AMT             02.94
                                            WK-SETL-TOT-CNT.            02.94
           COMPUTE WK-SETL-AMT = WS-CBT-NS-06-AMT                       02.94
                               + WS-CBT-OT-06-AMT                       02.94
                               + WS-CBT-VS-06-AMT                       02.94
                               + WS-CBT-DS-06-AMT                       02.94
                               + WS-CBT-PP-06-AMT                       03.47
                               + WS-CBT-AX-06-AMT                       02.94
                               + WS-CBT-DB-06-AMT                       02.94
                               + WS-CBT-PD-06-AMT                       02.94
                               + WS-CBT-MC-06-AMT.                      02.94
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.94
           COMPUTE WK-SETL-CNT = WS-CBT-NS-06-CNT                       02.94
                               + WS-CBT-OT-06-CNT                       02.94
                               + WS-CBT-VS-06-CNT                       02.94
                               + WS-CBT-DS-06-CNT                       02.94
                               + WS-CBT-PP-06-CNT                       03.47
                               + WS-CBT-AX-06-CNT                       02.94
                               + WS-CBT-DB-06-CNT                       02.94
                               + WS-CBT-PD-06-CNT                       02.94
                               + WS-CBT-MC-06-CNT.                      02.94
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.94
           COMPUTE WK-SETL-TOT-AMT = WK-SETL-TOT-AMT                    02.94
                                   + WK-SETL-AMT.                       02.94
           COMPUTE WK-SETL-TOT-CNT = WK-SETL-TOT-CNT                    02.94
                                   + WK-SETL-CNT.                       02.94
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-PT,SUB-06).02.94
           IF WK-SETL-AMT < +0                                          02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PT,SUB-06) 02.94
           ELSE                                                         02.94
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PT,SUB-06) 02.94
           END-IF.                                                      02.94
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-PT,SUB-06).02.94
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE SPACE                    TO RCN-STL-CC.
           MOVE '                RETURNS: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-NS-07-AMT                       02.94
                               + WS-CBT-OT-07-AMT                       02.94
                               + WS-CBT-VS-07-AMT                       02.94
                               + WS-CBT-DS-07-AMT                       02.94
                               + WS-CBT-PP-07-AMT                       03.47
                               + WS-CBT-AX-07-AMT                       02.94
                               + WS-CBT-DB-07-AMT                       02.94
                               + WS-CBT-PD-07-AMT                       02.94
                               + WS-CBT-MC-07-AMT.                      02.94
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.94
           COMPUTE WK-SETL-CNT = WS-CBT-NS-07-CNT                       02.94
                               + WS-CBT-OT-07-CNT                       02.94
                               + WS-CBT-VS-07-CNT                       02.94
                               + WS-CBT-DS-07-CNT                       02.94
                               + WS-CBT-PP-07-CNT                       03.47
                               + WS-CBT-AX-07-CNT                       02.94
                               + WS-CBT-DB-07-CNT                       02.94
                               + WS-CBT-PD-07-CNT                       02.94
                               + WS-CBT-MC-07-CNT.                      02.94
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.94
           COMPUTE WK-SETL-TOT-AMT = WK-SETL-TOT-AMT                    02.94
                                   + WK-SETL-AMT.                       02.94
           COMPUTE WK-SETL-TOT-CNT = WK-SETL-TOT-CNT                    02.94
                                   + WK-SETL-CNT.                       02.94
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-PT,SUB-07).02.94
           IF WK-SETL-AMT < +0                                          02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PT,SUB-07) 02.94
           ELSE                                                         02.94
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PT,SUB-07) 02.94
           END-IF.                                                      02.94
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-PT,SUB-07).02.94
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                   CASH: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-NS-0O-AMT                       02.94
                               + WS-CBT-OT-0O-AMT                       02.94
                               + WS-CBT-VS-0O-AMT                       02.94
                               + WS-CBT-DS-0O-AMT                       02.94
                               + WS-CBT-PP-0O-AMT                       03.47
                               + WS-CBT-AX-0O-AMT                       02.94
                               + WS-CBT-DB-0O-AMT                       02.94
                               + WS-CBT-PD-0O-AMT                       02.94
                               + WS-CBT-MC-0O-AMT.                      02.94
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.94
           COMPUTE WK-SETL-CNT = WS-CBT-NS-0O-CNT                       02.94
                               + WS-CBT-OT-0O-CNT                       02.94
                               + WS-CBT-VS-0O-CNT                       02.94
                               + WS-CBT-DS-0O-CNT                       02.94
                               + WS-CBT-PP-0O-CNT                       03.47
                               + WS-CBT-AX-0O-CNT                       02.94
                               + WS-CBT-DB-0O-CNT                       02.94
                               + WS-CBT-PD-0O-CNT                       02.94
                               + WS-CBT-MC-0O-CNT.                      02.94
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.94
           COMPUTE WK-SETL-TOT-AMT = WK-SETL-TOT-AMT                    02.94
                                   + WK-SETL-AMT.                       02.94
           COMPUTE WK-SETL-TOT-CNT = WK-SETL-TOT-CNT                    02.94
                                   + WK-SETL-CNT.                       02.94
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-PT,SUB-0O).02.94
           IF WK-SETL-AMT < +0                                          02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PT,SUB-0O) 02.94
           ELSE                                                         02.94
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PT,SUB-0O) 02.94
           END-IF.                                                      02.94
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-PT,SUB-0O).02.94
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '        NET TO MERCHANT: '
                                         TO RCN-STL-DL-HEADING.
           MOVE WK-SETL-TOT-AMT          TO RCN-STL-DL-AMT.             02.94
           MOVE WK-SETL-TOT-CNT          TO RCN-STL-DL-ITMS.            02.94
           MOVE WK-SETL-TOT-AMT          TO RCU-TDYD-TTE(SUB-PT,SUB-NM).02.94
           IF WK-SETL-TOT-AMT < +0                                      02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PT,SUB-NM) 02.94
           ELSE                                                         02.94
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PT,SUB-NM) 02.94
           END-IF.                                                      02.94
           MOVE WK-SETL-TOT-CNT          TO RCU-TDYU-TTE(SUB-PT,SUB-NM).02.94
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                REJECTS: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-NS-RJ-AMT                       02.94
                               + WS-CBT-OT-RJ-AMT                       02.94
                               + WS-CBT-VS-RJ-AMT                       02.94
                               + WS-CBT-DS-RJ-AMT                       02.94
                               + WS-CBT-PP-RJ-AMT                       03.47
                               + WS-CBT-AX-RJ-AMT                       02.94
                               + WS-CBT-DB-RJ-AMT                       02.94
                               + WS-CBT-PD-RJ-AMT                       02.94
                               + WS-CBT-MC-RJ-AMT.                      02.94
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.94
           COMPUTE WK-SETL-CNT = WS-CBT-NS-RJ-CNT                       02.94
                               + WS-CBT-OT-RJ-CNT                       02.94
                               + WS-CBT-VS-RJ-CNT                       02.94
                               + WS-CBT-DS-RJ-CNT                       02.94
                               + WS-CBT-PP-RJ-CNT                       03.47
                               + WS-CBT-AX-RJ-CNT                       02.94
                               + WS-CBT-DB-RJ-CNT                       02.94
                               + WS-CBT-PD-RJ-CNT                       02.94
                               + WS-CBT-MC-RJ-CNT.                      02.94
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.94
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-PT,SUB-RJ).02.94
           IF WK-SETL-AMT < +0                                          02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PT,SUB-RJ) 02.94
           ELSE                                                         02.94
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PT,SUB-RJ) 02.94
           END-IF.                                                      02.94
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-PT,SUB-RJ).02.94
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE '                DELETES: '
                                         TO RCN-STL-DL-HEADING.
           COMPUTE WK-SETL-AMT = WS-CBT-NS-DE-AMT                       02.94
                               + WS-CBT-OT-DE-AMT                       02.94
                               + WS-CBT-VS-DE-AMT                       02.94
                               + WS-CBT-DS-DE-AMT                       02.94
                               + WS-CBT-PP-DE-AMT                       03.47
                               + WS-CBT-AX-DE-AMT                       02.94
                               + WS-CBT-DB-DE-AMT                       02.94
                               + WS-CBT-PD-DE-AMT                       02.94
                               + WS-CBT-MC-DE-AMT.                      02.94
           MOVE WK-SETL-AMT              TO RCN-STL-DL-AMT.             02.94
           COMPUTE WK-SETL-CNT = WS-CBT-NS-DE-CNT                       02.94
                               + WS-CBT-OT-DE-CNT                       02.94
                               + WS-CBT-VS-DE-CNT                       02.94
                               + WS-CBT-DS-DE-CNT                       02.94
                               + WS-CBT-PP-DE-CNT                       03.47
                               + WS-CBT-AX-DE-CNT                       02.94
                               + WS-CBT-DB-DE-CNT                       02.94
                               + WS-CBT-PD-DE-CNT                       02.94
                               + WS-CBT-MC-DE-CNT.                      02.94
           MOVE WK-SETL-CNT              TO RCN-STL-DL-ITMS.            02.94
           MOVE WK-SETL-AMT              TO RCU-TDYD-TTE(SUB-PT,SUB-DE).02.94
           IF WK-SETL-AMT < +0                                          02.94
              MOVE '-'               TO RCU-TDYD-TTE-SGN(SUB-PT,SUB-DE) 02.94
           ELSE                                                         02.94
              MOVE '+'               TO RCU-TDYD-TTE-SGN(SUB-PT,SUB-DE) 02.94
           END-IF.                                                      02.94
           MOVE WK-SETL-CNT              TO RCU-TDYU-TTE(SUB-PT,SUB-DE).02.94
           CALL BACONDEC USING WS-BANK-999999
                    C-TYPED    BASCRATE-SD-CENTER-CURR-DEC
                    C-TYPEA    RCN-STL-DL-AMT   C-LGTH24
                    C-TYPEC    RCN-STL-DL-ITMS  C-LGTH09
                    C-TYPEEND.
           MOVE RECN-STL-DETAIL-LINE     TO WS-RECN-RECORD.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
      *
           PERFORM C-790-WRITE-RECON-DATA-FILE                          02.87
              THRU C-790-EXIT.                                          02.87
      *                                                                 02.87
       S-452-EXIT.
           EXIT.
      *
       S-453-WRITE-FILE-HEADING.
      *
           MOVE RECN-HEADER              TO RECN-RECORD.
           PERFORM S-455-WRITE-RECN-REC
              THRU S-455-EXIT.
      *
       S-453-EXIT.
           EXIT.
      *
       S-454-WRITE-DATA-HEADING.
      *
           IF WS-RCN-HEADER-1
              MOVE RECN-BATCH-HEADER     TO RECN-RECORD
              PERFORM S-455-WRITE-RECN-REC
                 THRU S-455-EXIT
              MOVE RECN-BATCH-TITLE-LINE-1
                                         TO RECN-RECORD
              PERFORM S-455-WRITE-RECN-REC
                 THRU S-455-EXIT
              MOVE RECN-BATCH-TITLE-LINE-2
                                         TO RECN-RECORD
              PERFORM S-455-WRITE-RECN-REC
                 THRU S-455-EXIT
              MOVE '0'                   TO RCN-BDL-CC
           ELSE
              MOVE RECN-STL-HEADER       TO RECN-RECORD
              PERFORM S-455-WRITE-RECN-REC
                 THRU S-455-EXIT
              MOVE RECN-STL-HEADER-1     TO RECN-RECORD
              PERFORM S-455-WRITE-RECN-REC
                 THRU S-455-EXIT.
      *
       S-454-EXIT.
           EXIT.
      *
       S-455-WRITE-RECN-REC.
      *
           IF RECN-REC-CC = '1'
              MOVE 1                  TO WS-RCN-LINE-CNT
           ELSE
           IF RECN-REC-CC = ' '
              ADD 1                   TO WS-RCN-LINE-CNT
           ELSE
           IF RECN-REC-CC = '0'
              ADD 2                   TO WS-RCN-LINE-CNT
           ELSE
           IF RECN-REC-CC = '-'
              ADD 3                   TO WS-RCN-LINE-CNT.
      *
           WRITE RECN-RECORD.
      *
       S-455-EXIT.
           EXIT.
      *
       S-460-WRITE-TT-SETL-FILE.
      *
           OPEN INPUT TT-SETL-FILE.
           READ TT-SETL-FILE INTO SETL-TOT-DBLOAD-REC
             AT END
                DISPLAY '***** TT-SETL-FILE EMPTY *****'
                MOVE 55                  TO HLD-RETURN-CD
           END-READ.
           CLOSE TT-SETL-FILE.
           IF HLD-RETURN-CD = 55
              GO TO S-460-EXIT.
           COMPUTE WS-TSF-TRN-ACCEPT = WS-CBT-MC-06-CNT
                                     + WS-CBT-MC-07-CNT
                                     + WS-CBT-MC-0O-CNT
                                     + WS-CBT-VS-06-CNT
                                     + WS-CBT-VS-07-CNT
                                     + WS-CBT-VS-0O-CNT
                                     + WS-CBT-DS-06-CNT
                                     + WS-CBT-DS-07-CNT
                                     + WS-CBT-DS-0O-CNT
                                     + WS-CBT-PP-06-CNT                 03.47
                                     + WS-CBT-PP-07-CNT                 03.47
                                     + WS-CBT-PP-0O-CNT                 03.47
                                     + WS-CBT-AX-06-CNT
                                     + WS-CBT-AX-07-CNT
                                     + WS-CBT-AX-0O-CNT
                                     + WS-CBT-DB-06-CNT
                                     + WS-CBT-DB-07-CNT
                                     + WS-CBT-DB-0O-CNT
                                     + WS-CBT-PD-06-CNT
                                     + WS-CBT-PD-07-CNT
                                     + WS-CBT-PD-0O-CNT
                                     + WS-CBT-OT-06-CNT
                                     + WS-CBT-OT-06-CNT
                                     + WS-CBT-OT-07-CNT
                                     + WS-CBT-OT-0O-CNT
                                     + WS-CBT-NS-06-CNT
                                     + WS-CBT-NS-07-CNT
                                     + WS-CBT-NS-0O-CNT.
           COMPUTE WS-TSF-TRN-REJECT = WS-CBT-MC-RJ-CNT
                                     + WS-CBT-VS-RJ-CNT
                                     + WS-CBT-DS-RJ-CNT
                                     + WS-CBT-PP-RJ-CNT                 03.47
                                     + WS-CBT-AX-RJ-CNT
                                     + WS-CBT-DB-RJ-CNT
                                     + WS-CBT-PD-RJ-CNT
                                     + WS-CBT-OT-RJ-CNT
                                     + WS-CBT-NS-RJ-CNT
                                     + WS-CBT-MC-DE-CNT
                                     + WS-CBT-VS-DE-CNT
                                     + WS-CBT-OT-DE-CNT
                                     + WS-CBT-NS-DE-CNT.
           COMPUTE WS-TSF-AMT-ACCEPT = WS-CBT-MC-06-AMT
                                     + WS-CBT-MC-07-AMT
                                     + WS-CBT-MC-0O-AMT
                                     + WS-CBT-VS-06-AMT
                                     + WS-CBT-VS-07-AMT
                                     + WS-CBT-VS-0O-AMT
                                     + WS-CBT-DS-06-AMT
                                     + WS-CBT-DS-07-AMT
                                     + WS-CBT-DS-0O-AMT
                                     + WS-CBT-PP-06-AMT                 03.47
                                     + WS-CBT-PP-07-AMT                 03.47
                                     + WS-CBT-PP-0O-AMT                 03.47
                                     + WS-CBT-AX-06-AMT
                                     + WS-CBT-AX-07-AMT
                                     + WS-CBT-AX-0O-AMT
                                     + WS-CBT-DB-06-AMT
                                     + WS-CBT-DB-07-AMT
                                     + WS-CBT-DB-0O-AMT
                                     + WS-CBT-PD-06-AMT
                                     + WS-CBT-PD-07-AMT
                                     + WS-CBT-PD-0O-AMT
                                     + WS-CBT-OT-06-AMT
                                     + WS-CBT-OT-07-AMT
                                     + WS-CBT-OT-0O-AMT
                                     + WS-CBT-NS-06-AMT
                                     + WS-CBT-NS-07-AMT
                                     + WS-CBT-NS-0O-AMT.
           COMPUTE WS-TSF-AMT-REJECT = WS-CBT-MC-RJ-AMT
                                     + WS-CBT-VS-RJ-AMT
                                     + WS-CBT-OT-RJ-AMT
                                     + WS-CBT-DS-RJ-AMT
                                     + WS-CBT-PP-RJ-AMT                 03.47
                                     + WS-CBT-AX-RJ-AMT
                                     + WS-CBT-DB-RJ-AMT
                                     + WS-CBT-PD-RJ-AMT
                                     + WS-CBT-NS-RJ-AMT
                                     + WS-CBT-MC-DE-AMT
                                     + WS-CBT-VS-DE-AMT
                                     + WS-CBT-OT-DE-AMT
                                     + WS-CBT-NS-DE-AMT.
           MOVE WS-TSF-TRN-ACCEPT        TO SETL-TRN-ACCEPT.
           MOVE WS-TSF-AMT-ACCEPT        TO SETL-AMT-ACCEPT.
           MOVE WS-TSF-TRN-REJECT        TO SETL-TRN-REJECT.
           MOVE WS-TSF-AMT-REJECT        TO SETL-AMT-REJECT.
           DISPLAY '**** SETTLE FILE CREATED FOR VENDOR '
                    SETL-VENDOR ' ****'.
           OPEN OUTPUT TT-SETL-FILE.
           WRITE TT-SETL-REC FROM SETL-TOT-DBLOAD-REC.
           CLOSE TT-SETL-FILE.
      *
       S-460-EXIT.
           EXIT.
      *
       S-500-AUTO-GEN-PLAN.                                             02.38
      *                                                                 02.38
           MOVE PET-ORIG-BANK-KEY        TO GPR-MRCH-INST.              02.38
           MOVE PET-MERCH-NMBR           TO GPR-MRCH-NMBR.              02.38
           MOVE NME-CHAIN                TO GPR-CHAIN-CODE.             02.77
           MOVE NME-CHAIN-PROP-FLAG      TO GPR-CHAIN-PROP-FLAG.        02.77
      *                                                                 02.38
           SET APT-INDX TO 1.                                           02.38
           SEARCH WS-APT-ENTRY                                          02.38
             VARYING APT-INDX                                           02.38
               AT END                                                   02.38
                 MOVE 'N'                TO WS-PLAN-CODE-FOUND-SW       02.38
               WHEN WS-APT-BASE-PLAN(APT-INDX) = GPR-NEW-PLAN           02.38
                 MOVE 'Y'                TO WS-PLAN-CODE-FOUND-SW       02.38
                 MOVE WS-APT-ENTRY(APT-INDX)                            02.38
                                         TO GPR-PLAN-ENTRIES            02.38
           END-SEARCH.                                                  02.38
      *                                                                 02.38
           IF WS-PLAN-CODE-FOUND                                        02.38
              PERFORM                                                   02.38
                VARYING WS-APW-SUB FROM +1 BY +1                        02.38
                UNTIL   WS-APW-SUB > WS-APW-MAX-PLANS                   02.38
                  IF GPR-GEN-PLAN-ENTRY(WS-APW-SUB) = HIGH-VALUES       02.38
                     COMPUTE WS-APW-SUB = WS-APW-MAX-PLANS              02.38
                  ELSE                                                  02.38
                     SET KDA-PC-INDX TO 1                               02.38
                     SEARCH KDA-PLAN-CODE-ENTRY                         02.38
                       VARYING KDA-PC-INDX                              02.38
                         AT END                                         02.38
                            CONTINUE                                    02.38
                         WHEN KDA-PLAN-CODE(KDA-PC-INDX) =              02.38
                                            GPR-GPE-PLAN(WS-APW-SUB)    02.38
                            MOVE GPR-GPE-PLAN(WS-APW-SUB)               02.38
                                         TO GPR-FROM-PLAN               02.38
                            COMPUTE WS-APW-SUB = WS-APW-MAX-PLANS       02.38
                     END-SEARCH                                         02.38
                  END-IF                                                02.38
              END-PERFORM                                               02.38
           END-IF.                                                      02.38
      *                                                                 02.38
           WRITE GEN-PLAN-REC FROM GPR-GEN-PLAN-RECORD.                 02.38
      *                                                                 02.38
       S-500-EXIT.                                                      02.38
           EXIT.                                                        02.38
      *                                                                 02.38
       S-505-CHECK-SPACE-FILL-TRAN.                                     02.49
      *                                                                 02.49
           PERFORM                                                      02.49
             VARYING START-SUB FROM +1 BY +1                            02.49
             UNTIL   START-SUB > END-SUB                                02.49
               IF MIR-LAYOUT(START-SUB:1) = LOW-VALUES                  02.49
                  MOVE SPACE             TO MIR-LAYOUT(START-SUB:1)     02.49
               END-IF                                                   02.49
           END-PERFORM.                                                 02.49
      *                                                                 02.49
       S-505-EXIT.                                                      02.49
           EXIT.                                                        02.49
      *                                                                 02.49
       S-510-CHECK-SPACE-FILL-HOLD.                                     02.49
      *                                                                 02.49
           PERFORM                                                      02.49
             VARYING START-SUB FROM +1 BY +1                            02.49
             UNTIL   START-SUB > END-SUB                                02.49
               IF HOLD-TRANSACTION(START-SUB:1) = LOW-VALUES            02.49
                  MOVE SPACE           TO HOLD-TRANSACTION(START-SUB:1) 02.49
               END-IF                                                   02.49
           END-PERFORM.                                                 02.49
      *                                                                 02.49
       S-510-EXIT.                                                      02.49
           EXIT.                                                        02.49
      *                                                                 02.49
       S-515-CHECK-SPACE-FILL-ADDM.                                     02.49
      *                                                                 02.49
           PERFORM                                                      02.49
             VARYING START-SUB FROM +1 BY +1                            02.49
             UNTIL   START-SUB > END-SUB                                02.49
               IF MERCHANT-INPUT-ADDENDUM(START-SUB:1) = LOW-VALUES     02.49
                  MOVE SPACE    TO MERCHANT-INPUT-ADDENDUM(START-SUB:1) 02.49
               END-IF                                                   02.49
           END-PERFORM.                                                 02.49
      *                                                                 02.49
       S-515-EXIT.                                                      02.49
           EXIT.                                                        02.49
      *                                                                 02.49
       S-520-VISA-MRCH-NME-CHKS.
           MOVE 'N'                      TO KDA-MRCH-NAME-ERR-SW.
076810     IF KDA-MERCAT-AIR OR
076810        KDA-MRCH-TYP-PSNGR-RAIL
                 NEXT SENTENCE
           ELSE
              GO TO S-520-VNMC-VISA-CHK-US.
076810*
076810*    FOR PASSENGER TRANSPORT POSITIONS 1 THRU 11 MUST HAVE        03.02
076810*    THE FIRST 11 BYTES OF THE DBA NAME, POSITION 12 MUST         03.02
076810*    HAVE AN '*' AND POSITIONS 13-25 MUST HAVE TICKET NBR.        03.02
      *    DBA NAME MUST NOT HAVE A SPACE IN POSITION 1.'               03.02
      *    TICKET NUMBER MUST NOT HAVE A SPACE IN POSITION 13.          03.02
076810*                                                                 03.02
      *    CUST SVC TELE, URL OR EML MUST BE IN MERCHANT CITY           03.02
      *    FOR E-COMMERCE/PASSENGER TRANSPORT TRANSACTIONS.             03.02
076810*                                                                 03.02
076810     IF MIS3-MRCH-NAME (1:1) NOT = SPACES AND                     03.02
              MIS3-MRCH-NAME (12:1) = '*'       AND                     03.02
              MIS3-MRCH-NAME (13:1) NOT = SPACES                        03.02
076810        MOVE 'Y'                   TO PET-DESCR-FLAG              03.02
076810        MOVE MIS3-MRCH-NAME (1:11) TO HLD-DESCR-NAME(1:11)        03.02
076810        MOVE '*'                   TO HLD-DESCR-NAME(12:1)        03.02
076810        MOVE MIS3-MRCH-NAME (13:13) TO HLD-DESCR-NAME(13:13)      03.02
                                                                        03.02
076810     IF PET-DESCR-FLAG NOT = 'Y'
076810        GO TO S-520-EXIT.                                         03.02
                                                                        03.02
           IF KDA-VC-AUTH-CHAR-PT-ECP                                   03.02
              MOVE 'N'           TO PET-DESCR-FLAG.                     03.02
      *
       S-520-VNMC-VISA-CHK-US.
           IF KDA-BATCH-BIN-REGION NOT = '1'
              GO TO S-520-EXIT.
076810* THE FOLLOWING ARE ONLY FOR US REGULATIONS
076810     IF MIS3-MRCH-NAME(1:1) NOT = SPACE
076810        IF MIS3-MRCH-NAME(13:1) = '*' AND
076810           MIS3-MRCH-NAME(14:12) = SPACES AND
076810           KDA-VC-PHONE-ORD-5-9
076810*          INDICATES AN IPSP NAME WAS SUPPLIED AND
076810*          SHOULD NOT BE CHANGED
                    GO TO S-520-EXIT.
           IF KDA-VC-AUTH-CHAR-CNP OR
              KDA-VC-AUTH-CHAR-ECB OR
              KDA-VC-AUTH-CHAR-ECP OR
              KDA-VC-AUTH-CHAR-CAR-CNP OR
              KDA-VC-AUTH-CHAR-CAR-ECP OR
              KDA-VC-AUTH-CHAR-HOT-CNP OR
              KDA-VC-AUTH-CHAR-HOT-ECP OR                               03.62V
              KDA-VC-AUTH-CHAR-RECUR                                    03.62V
                 GO TO S-520-VMNC-CARD-NOT-PRESENT.
           GO TO S-520-EXIT.
      *
       S-520-VMNC-CARD-NOT-PRESENT.
           IF MIS3-VS-DESCR-FORMAT-IND = '1'                            02.36
              MOVE 'Y'                   TO PET-DESCR-FLAG              02.36
              GO TO S-520-EXIT.                                         02.36
      *                                                                 02.36
           IF HLD-DESCR-CITY(1:3) NUMERIC AND
              HLD-DESCR-CITY(4:1) = '-' AND
              HLD-DESCR-CITY(5:7) NUMERIC
                 MOVE 'Y'                TO PET-DESCR-FLAG
                 GO TO S-520-EXIT.
           IF KDA-CUST-SVC-PHONE(1:10) NOT NUMERIC
              IF KDA-MRCH-MOTO AND
                (KDA-VC-POS-ENV-RECUR OR
                 KDA-VC-PHONE-ORD-US-RECUR)
                    MOVE 'Y'             TO PET-DESCR-FLAG
              ELSE
                 MOVE 'N'                TO PET-DESCR-FLAG
              END-IF
              GO TO S-520-EXIT
           END-IF.
           MOVE SPACES                   TO HLD-DESCR-CITY.
           MOVE KDA-CUST-SVC-PHONE(1:3)  TO HLD-DESCR-CITY(1:3).
           MOVE '-'                      TO HLD-DESCR-CITY(4:1).
           MOVE KDA-CUST-SVC-PHONE(4:7)  TO HLD-DESCR-CITY(5:7).
           MOVE 'Y'                      TO PET-DESCR-FLAG.
076810*
076810 S-520-EXIT.
076810     EXIT.
076880*
076810 S-530-CHECK-VISA-AUTH.
           IF PET-VALID-RETURN                                          03.31
              MOVE 'N'                   TO KDA-AUTH-ERR-SW
              GO TO S-530-EXIT.
           MOVE PET-AUTH-CD              TO AUTH-SPACE-WORK.
           IF AUTH-SPACE-WORK(1:3) = 'SVC' OR
              ASW-SW-POS(6) = 'X' OR
              ASW-SW-BAD-AUTH-LAST5
                 MOVE 'Y'                TO KDA-AUTH-ERR-SW
           ELSE
              MOVE 'N'                   TO KDA-AUTH-ERR-SW.
076810 S-530-EXIT.
076810     EXIT.
      *
       S-540-LOAD-MC-ACQ-TABLE.
      *
      *    THIS SECTION LOADS THE ACQUIRER CAB PROGRAM WORK AREAS FOR
      *    BOTH DEBIT AND CREDIT ACCEPTANCE BRANDS.
      *
           IF WS-MC-LAST-BIN-ID = WS-WRK-AA-BIN-ID
              GO TO S-540-EXIT.
      *
           MOVE WS-MC-LAST-BIN-ID        TO WS-WRK-AA-BIN-ID.
      *
       S-540-READ-MCC-REC.
      *
           MOVE 'R'                      TO BAS10004-CALL-TYPE.
           MOVE SPACES                   TO MC-AB-KEY.
           MOVE 'A'                      TO MC-REC-KEY-ID.
           MOVE WS-WRK-AA-BIN-ID         TO MC-AB-BIN-ID.
           MOVE 'C'                      TO MC-AB-ACCEPT-BRAND.
           MOVE MC-AB-KEY                TO BAS10004-MCEDFILE-READ-KEY.
           PERFORM Z9996-CALL-BAS10004 THRU Z9996-EXIT.
           IF BAS10004-RC-NORMAL
              MOVE MC-AB-DATA            TO WS-MCC-ACQ-WORK-AREA
           ELSE
           IF BAS10004-RC-ERROR
              MOVE 99                    TO HLD-RETURN-CD
              GO TO A-100-FINISHUP
           ELSE
              MOVE +0                    TO WS-MCC-ACQ-CNT.
      *
           MOVE 'R'                      TO BAS10004-CALL-TYPE.
           MOVE SPACES                   TO MC-AB-KEY.
           MOVE 'A'                      TO MC-REC-KEY-ID.
           MOVE WS-WRK-AA-BIN-ID         TO MC-AB-BIN-ID.
           MOVE 'D'                      TO MC-AB-ACCEPT-BRAND.
           MOVE MC-AB-KEY                TO BAS10004-MCEDFILE-READ-KEY.
           PERFORM Z9996-CALL-BAS10004 THRU Z9996-EXIT.
           IF BAS10004-RC-NORMAL
              MOVE MC-AB-DATA            TO WS-DMC-ACQ-WORK-AREA
           ELSE
           IF BAS10004-RC-ERROR
              MOVE 99                    TO HLD-RETURN-CD
              GO TO A-100-FINISHUP
           ELSE
              MOVE +0                    TO WS-DMC-ACQ-CNT.
      *
       S-540-EXIT.
           EXIT.
      *
       S-550-LOAD-CAB-PROG-WORK.
      *
      *    THIS SECTION LOADS WORK AREAS FOR BOTH THE DEBIT AND CREDIT
      *    CAB PROGRAMS FOR THE MERCHANT CATEGORY CODE.
      *
           IF KDA-MCC-CAB-PROGRAMS = WS-MC-LAST-CAB-PROGRAMS
              GO TO S-550-LOAD-ACCEPT-BRAND.
      *
           MOVE KDA-MCC-CAB-PROGRAMS     TO WS-MC-LAST-CAB-PROGRAMS.
           INITIALIZE WS-MCC-CAB-PROG-DATA.                             02.29
           INITIALIZE WS-DMC-CAB-PROG-DATA.                             02.29
           COMPUTE WS-SUB2 = +0.
           COMPUTE WS-SUB3 = +0.
      *
           MOVE SPACE                    TO INVALID-MCEDFILE-SW.
           MOVE 'R'                      TO BAS10004-CALL-TYPE.
           MOVE SPACES                   TO MC-CR-KEY.
           MOVE 'C'                      TO MC-REC-KEY-ID.
      *
           PERFORM
              VARYING WS-SUB1 FROM +1 BY +1
              UNTIL   WS-SUB1 > KDA-MCC-CAB-PROG-CNT
                 MOVE KDA-MCC-CAB-PROG(WS-SUB1)
                                         TO MC-CR-CAB-PROGRAM
                 MOVE 'C'                TO MC-CR-ACCEPT-BRAND
                 MOVE MC-CR-KEY          TO BAS10004-MCEDFILE-READ-KEY
                 PERFORM Z9996-CALL-BAS10004 THRU Z9996-EXIT
                 IF BAS10004-RC-ERROR
                   MOVE 99               TO HLD-RETURN-CD
                   GO TO A-100-FINISHUP
                 END-IF
                 IF BAS10004-RC-NORMAL
                    COMPUTE WS-SUB2 = WS-SUB2 + 1
                    COMPUTE WS-MCC-CAB-CNT = WS-SUB2
                    MOVE MC-CR-CAB-PROGRAM
                                         TO WS-MCC-CAB-PROG(WS-SUB2)
                    MOVE MC-CR-DATA      TO WS-MCC-CAB-DATA(WS-SUB2)
                 END-IF
                 MOVE 'D'                TO MC-CR-ACCEPT-BRAND
                 MOVE MC-CR-KEY          TO BAS10004-MCEDFILE-READ-KEY
                 PERFORM Z9996-CALL-BAS10004 THRU Z9996-EXIT
                 IF BAS10004-RC-ERROR
                   MOVE 99               TO HLD-RETURN-CD
                   GO TO A-100-FINISHUP
                 END-IF
                 IF BAS10004-RC-NORMAL
                    COMPUTE WS-SUB3 = WS-SUB3 + 1
                    COMPUTE WS-DMC-CAB-CNT = WS-SUB3
                    MOVE MC-CR-CAB-PROGRAM
                                         TO WS-DMC-CAB-PROG(WS-SUB3)
                    MOVE MC-CR-DATA      TO WS-DMC-CAB-DATA(WS-SUB3)
                 END-IF
           END-PERFORM.
      *
       S-550-LOAD-ACCEPT-BRAND.
      *
           EVALUATE KDA-CHD-ICA-ACCEPT-BRAND
             WHEN 'DMC'
               MOVE WS-DMC-CAB-PROG-DATA TO WS-WRK-CAB-PROG-DATA
             WHEN OTHER
               MOVE WS-MCC-CAB-PROG-DATA TO WS-WRK-CAB-PROG-DATA
           END-EVALUATE.
      *
       S-550-LOAD-KMCMCCPW-TABLE.
      *
      *    THIS SECTION EXPANDS THE ACQUIRER CAB PROGRAM TABLE TO
      *    INCLUDE ALL OF THE AVAILABLE IRD'S IN THE KMCMCCPW
      *    CALL PARAMETERS.
      *
           COMPUTE WS-SUB6 = +1.
           COMPUTE CPW-CAB-CNT = +0.
           COMPUTE CPW-CAB-BSA-CNT(1) = +0.
           PERFORM
             VARYING WS-SUB1 FROM +1 BY +1
             UNTIL   WS-SUB1 > WS-WRK-CAB-CNT OR
                     WS-SUB6 > CPW-MAX-CAB-ENTRIES
               IF CPW-CAB-BSA-CNT(WS-SUB6) NOT = +0
                  COMPUTE WS-SUB6 = WS-SUB6 + 1
               END-IF
               IF WS-SUB6 > WS-MC-MAX-CAB-CNT
                  MOVE WS-SUB6           TO WS-MC-MAX-CAB-CNT
               END-IF
               IF WS-SUB6 > CPW-MAX-CAB-ENTRIES
                  DISPLAY 'MAX NUMBER OF KMCMCCPW ENTRIES REACHED'
                  COMPUTE WS-SUB4 = +99
               ELSE
                  MOVE WS-WRK-CAB-PROG(WS-SUB1)
                    TO CPW-CAB-PROG(WS-SUB6)
                  COMPUTE CPW-CAB-CNT = WS-SUB6
                  COMPUTE CPW-CAB-BSA-CNT(WS-SUB6) = +0
                  COMPUTE WS-SUB3 = +0
               END-IF
               PERFORM
                 VARYING WS-SUB4 FROM +1 BY +1
                 UNTIL   WS-SUB4 > WS-WRK-CBIA-CNT
                   PERFORM
                     VARYING WS-SUB2 FROM +1 BY +1
                     UNTIL   WS-SUB2 > WS-WRK-CAB-BSA-CNT(WS-SUB1)
                       IF WS-WRK-CBIA-BSA(WS-SUB4) =
                          WS-WRK-CAB-BSA(WS-SUB1,WS-SUB2)
                           PERFORM
                             VARYING WS-SUB5 FROM +1 BY +1
                             UNTIL   WS-SUB5 >
                                     WS-WRK-CAB-IRD-CNT(WS-SUB1,WS-SUB2)
                             IF WS-WRK-CBIA-IRD(WS-SUB4) =
                                WS-WRK-CAB-IRD(WS-SUB1,WS-SUB2,WS-SUB5)
                                COMPUTE WS-SUB3 = WS-SUB3 + 1
                                COMPUTE CPW-CAB-BSA-CNT(WS-SUB6) =
                                                       WS-SUB3
                                IF WS-SUB3 > WS-MC-MAX-CAB-BSA-CNT      02.29
                                   MOVE WS-SUB3                         02.29
                                         TO WS-MC-MAX-CAB-BSA-CNT       02.29
                                END-IF                                  02.29
                                MOVE WS-WRK-CBIA-BSA(WS-SUB4)
                                  TO CPW-CPE-BSA(WS-SUB6,WS-SUB3)
                                MOVE WS-WRK-CBIA-BSA-ENF-IND(WS-SUB4)
                                 TO CPW-CPE-BSA-ENF-IND(WS-SUB6,WS-SUB3)
                                MOVE WS-WRK-CBIA-IRD(WS-SUB4)
                                  TO CPW-CPE-IRD(WS-SUB6,WS-SUB3)
                                COMPUTE WS-SUB5 =
                                     WS-WRK-CAB-IRD-CNT(WS-SUB1,WS-SUB2)
                             END-IF
                           END-PERFORM
                          COMPUTE WS-SUB2 = WS-WRK-CAB-BSA-CNT(WS-SUB1)
                       END-IF
                   END-PERFORM
               END-PERFORM
           END-PERFORM.
      *
       S-550-EXIT.
           EXIT.
      *
       S-600-LOAD-BANK-TABLE.
      *
           IF FE-DELETE-BYTE = HIGH-VALUES OR
              FE-DELETE-BYTE = '0'
                 GO TO S-600-EXIT.
      *
           MOVE FE-KEY                   TO BE-BCTRL-KEY.
           MOVE FE-BANK-NUMBER-2         TO WORK-BANK-NUMBER-2.
           MOVE WRK-MC-PREFIX            TO BE-MC-REF-PREFIX.
           MOVE FE-DATE-FORMAT           TO BE-DATE-FORMAT.
           MOVE FE-MC-BIN                TO BE-ICA-NMBR.
           MOVE FE-REF-NUM-PREFIX        TO BE-REF-NMBR-PREFIX.
           MOVE FE-ACQ-MEMBER-ID         TO BE-ACQ-MEMBER-ID.
           MOVE FE-INTRA-SETTLE-GROUP    TO BE-INT-SETL-GRP.
           MOVE FE-PREFIX-OWNER-IND      TO BE-OWNER-IND.
           MOVE FE-DISCOVER-OWNER-IND    TO BE-DISCOVER-OWNER-IND.
           MOVE FE-DISCOVER-ID           TO BE-DISCOVER-CLIENT-ID.
           MOVE FE-DISCOVER-ACQUIRER-ID  TO BE-DISCOVER-ACQUIRER-ID.
           MOVE FE-AMEX-OWNER-IND        TO BE-AMEX-OWNER-IND.          02.29
           MOVE FE-AMEX-SUBMITTER-ID     TO BE-AMEX-ESA-SUBMITTER-ID.   03.16A
           MOVE FE-AMEX-1PT-SUBMITTER-ID TO BE-AMEX-1PT-SUBMITTER-ID.   02.29
           MOVE FE-AMEX-EAP-SUBMITTER-ID TO BE-AMEX-EAP-SUBMITTER-ID.   03.16A
           IF FE-CF-VS-SETL
              MOVE 'Y'                   TO BE-CF-VS-SETL
           ELSE
              MOVE 'N'                   TO BE-CF-VS-SETL.
           IF FE-CF-MC-SETL
              MOVE 'Y'                   TO BE-CF-MC-SETL
           ELSE
              MOVE 'N'                   TO BE-CF-MC-SETL.
           IF FE-CF-AX-SETL
              MOVE 'Y'                   TO BE-CF-AX-SETL
           ELSE
              MOVE 'N'                   TO BE-CF-AX-SETL.
           IF FE-CF-DS-SETL
              MOVE 'Y'                   TO BE-CF-DS-SETL
           ELSE
              MOVE 'N'                   TO BE-CF-DS-SETL.
           MOVE FE-CF-VS                 TO BE-CF-VS.
           MOVE FE-CF-MC                 TO BE-CF-MC.
           MOVE FE-CF-AX                 TO BE-CF-AX.
           MOVE FE-CF-DS                 TO BE-CF-DS.
           MOVE FE-MULTI-CURRENCY-FLAG   TO BE-MULTI-CURRENCY-FLAG.
           MOVE FE-CUST-BANK-ID          TO BE-CUST-BANK-ID.
           MOVE FE-SETTL-PARTIC          TO BE-SETTL-PARTIC.
           MOVE FE-BANK-COUNTRY-CODE     TO SRCH-COUNTRY.               02.39
           PERFORM S-615-SRCH-CNTRY-CD                                  02.39
              THRU S-615-EXIT.                                          02.39
           IF INVAL-CNTRY-SW = 'G'                                      02.39
              MOVE CCE-COUNTRY-CODE-ALPH-3(CCE-IDX)                     02.39
                                         TO BE-COUNTRY                  02.39
                                            WS-BATCH-DIS-COUNTRY        02.39
           END-IF.                                                      02.39
           IF FE-BILLING-CURR-FLAG = 'P'
              MOVE FE-PRIMARY-CURR-CODE  TO BE-BILL-CURR-CODE
              MOVE FE-SCND-CURR-CODE     TO BE-ALT-CURR-CODE
           ELSE
              MOVE FE-PRIMARY-CURR-CODE  TO BE-ALT-CURR-CODE
              MOVE FE-SCND-CURR-CODE     TO BE-BILL-CURR-CODE.
           MOVE FE-SETTLEMENT-CURR-CODE  TO BE-SETTLEMENT-CURR-CODE.
           MOVE FE-PAY-SVCS-PROVIDER-IND TO KDA-PAY-SVCS-PROVIDER-IND.  02.95
           MOVE FE-BANK-NAME-1           TO KDA-FE-BANK-NAME-1.         02.95
           MOVE FRONT-END-CONTROL-RECORD (400:1)                        03.47
                                         TO WS-FE-PP-SW.                03.47
           MOVE FRONT-END-CONTROL-RECORD (399:1)                        03.62A
                                         TO KDA-AX-FE-SELLER-SW.        03.62A
      *
       S-600-EXIT.
           EXIT.
      *
066920 S-605-SRCH-NUM-CNTRY-CD.
066930     MOVE 'N'                      TO INVAL-CNTRY-SW.
           SET CCE-IDX TO 1.                                            02.39
           SEARCH COUNTRY-CODE-ENTRY VARYING CCE-IDX                    02.39
066960        AT END
066970           MOVE 'Y'                TO INVAL-CNTRY-SW
              WHEN CCE-COUNTRY-CODE-ALPH-3(CCE-IDX) = SRCH-COUNTRY      02.39
067010           MOVE 'G'                TO INVAL-CNTRY-SW.
           MOVE 'Y'                      TO ANMTR-SRCH-SW.              03.16B
067020 S-605-EXIT.
067030     EXIT.
066700*
066710 S-610-SRCH-CURR-CD.
066720     MOVE 'N'                      TO INVAL-CURR-SW.
066730     IF  SRCH-CURR-CODE-X NOT NUMERIC
066740         MOVE 'Y'               TO INVAL-CURR-SW
066750         MOVE '000'             TO SRCH-CURR-CODE-X
066760         GO  TO S-610-EXIT.
066770     IF  SRCH-CURR-CODE  > ZEROS
066780         NEXT SENTENCE
066790     ELSE
066800         MOVE 'Y'               TO INVAL-CURR-SW
066810         MOVE '000'             TO SRCH-CURR-CODE-X
066820         GO  TO S-610-EXIT.
           SET CRE-IDX TO 1.                                            02.39
           SEARCH CURRENCY-CODE-ENTRY VARYING CRE-IDX                   02.39
             AT END                                                     02.39
                MOVE 'Y'                 TO INVAL-CURR-SW               02.39
             WHEN CRE-CURRENCY-CODE-NUM(CRE-IDX) = SRCH-CURR-CODE-X     02.39
               MOVE 'G'                  TO INVAL-CURR-SW               02.39
           END-SEARCH.                                                  02.39
           MOVE 'Y'                      TO ANMTR-SRCH-SW.              03.16B
066890 S-610-EXIT.
066900     EXIT.
066910*
066920 S-615-SRCH-CNTRY-CD.
066930     MOVE 'N'           TO  INVAL-CNTRY-SW.
           SET CCE-IDX TO 1.                                            02.39
           SEARCH COUNTRY-CODE-ENTRY VARYING CCE-IDX                    02.39
             AT END                                                     02.39
                MOVE 'Y'                 TO INVAL-CNTRY-SW              02.39
             WHEN CCE-COUNTRY-CODE-ALPH-23(CCE-IDX) = SRCH-COUNTRY      02.39
               MOVE 'G'                  TO INVAL-CNTRY-SW              02.39
             WHEN CCE-COUNTRY-CODE-ALPH-3(CCE-IDX) = SRCH-COUNTRY       02.39
               MOVE 'G'                  TO INVAL-CNTRY-SW              02.39
           END-SEARCH.                                                  02.39
           MOVE 'Y'                      TO ANMTR-SRCH-SW.              03.16B
067020 S-615-EXIT.
067030     EXIT.
067040*
067050 S-620-READ-BIN.
067060     MOVE SPACES                   TO EDIT-FILE-REC.
067070     MOVE 'B'                      TO EFR-REC-KEY-ID.
067080     MOVE '5'                      TO EFR-BR-RECID.
067090     MOVE WSBK-BIN                 TO EFR-BR-BIN.
067100     PERFORM Z-900-READ-EFR
067110        THRU Z-900-EXIT.
           IF BAS10002-EFR-GOOD                                         02.23
067130        MOVE EFR-BR-BIN            TO WS-BATCH-BIN
067140        MOVE EFR-BR-BIN-COUNTRY    TO WS-BATCH-BIN-COUNTRY
067150        MOVE EFR-BR-BIN-REGION     TO KDA-BATCH-BIN-REGION
              MOVE 'V'                   TO WS-BATCH-BIN-TYPE           03.27
           END-IF.                                                      03.27
067160 S-620-EXIT.
067170     EXIT.
067180*
067190 S-640-CALCULATE-NEW-REFERENCE.
067200     MOVE '70000000000000000000000'
067200                                   TO KDA-VISA-REF.
067210     IF PET-CARD-TYPE-MC
067230        MOVE BE-MC-REF-PREFIX      TO KDA-VR-BIN-9
067240     ELSE
067260        MOVE BE-REF-NMBR-PREFIX    TO KDA-VR-BIN-9
              IF BE-CF-VS-SETL = 'N'
                 NEXT SENTENCE
              ELSE
              IF PET-CARD-TYPE-VISA                                     03.27
                 IF MR1-VALID-SALE OR                                   03.31
003230              KDA-MRCH-TYP-ATM
067290                 MOVE WS-BATCH-BIN-COUNTRY
067290                                   TO KDA-PS2000-COUNTRY
067290                 IF KDA-VC-PS2000-COUNTRY
067310                    MOVE '2'       TO KDA-VISA-REF(1:1).
067320     MOVE WS-REF-NO-11-DIGITS      TO KDA-VR-11-DIGITS.
067330*
067340* THE DATE WITHIN THE REFERENCE NUMBER SHOULD
067350* "ALWAYS" BE THE PROCESSING DATE (WORK-AS-OF-DATE).  THERE
067360* SHOULD BE NO ALTERING OF THE REFERENCE NUMBER DATE.
067370*
067380     MOVE HLD-REF-DATE             TO KDA-VR-JUL.
067460 S-640-EXIT.
067470     EXIT.
067480*
067490* THE FOLLOWING ROUTINE RECALCULATES THE CHECK DIGIT ON
067500* THE NEW REFORMATTED REFERENCE NUMBER.
067510*
067520 S-642-CALCULATE-CHK-DIGIT.
067530*
067540     MOVE 23                       TO CDA-CALL-LENGTH
067550     MOVE KDA-VISA-REF             TO CDA-ORG-ACCOUNT-NO
067560     MOVE '5'                      TO CDA-CALL-TYPE.
067570     MOVE ZEROS                    TO CDA-INSTITUTION.
067580*
067590     CALL CALL-BASCKDGT USING CHECK-DIGIT-AREA.
067600*
067610     IF CDA-ERROR-CODE NOT = ZERO
067620        DISPLAY 'BASCKDGT ERROR CODE = ' CDA-ERROR-CODE
067630        DISPLAY '   REASON FOR ERROR = ' CDA-ERROR-MSG
067640        MOVE ZERO                  TO KDA-VR-CK-DGT
067650     ELSE
067660        MOVE CDA-RET-BASE-ACCOUNT-NO
067670                                   TO KDA-VISA-REF.
067680*
067690 S-642-EXIT.
067700     EXIT.
076880*
085480 S-760-SET-INT-SETL-GRP.
           IF WS-CARD-TYPE = 'V'                                        03.27
085500        MOVE HOLD-GRP-SUM-SPEC-COND-IND  TO PET-SPEC-COND
085520        MOVE HOLD-GRP-SUM-MAIL-PHONE-IND TO PET-MAIL-PHONE-IND
                                                  RF1-2-MOTO-ECOM
085540        MOVE HOLD-VISA-INT-SETL-GRP TO PET-ORIG-INT-SETL-GRP
           ELSE                                                         02.29
           IF PET-INCOMING-FORMAT = 'A'                                 02.29
              IF WS-MRCH-IS-AMX-SETL OR WS-MRCH-IS-AMX-EAP              03.61
                 MOVE HOLD-AX-INT-SETL-GRP  TO PET-ORIG-INT-SETL-GRP    03.61
              ELSE                                                      03.61
                 MOVE HOLD-AX-INT-SETL-GRP-NS                           03.61
                                            TO PET-ORIG-INT-SETL-GRP    03.61
              END-IF                                                    03.61
           ELSE                                                         02.29
           IF PET-INCOMING-FORMAT = 'D'                                 02.29
              MOVE HOLD-DS-INT-SETL-GRP  TO PET-ORIG-INT-SETL-GRP       02.29
085550     ELSE
085560     IF WS-CARD-TYPE = 'M'
085570         MOVE HOLD-MC-INT-SETL-GRP TO PET-ORIG-INT-SETL-GRP
048520     ELSE
048540        MOVE HOLD-MRCH-INT-SETL-GRP TO PET-ORIG-INT-SETL-GRP.
085580     IF  PET-ORIG-INT-SETL-GRP EQUAL +0
085590         MOVE 46 TO ER-CD (ER-INDX)
085600         SET ER-INDX UP BY 1
085610         MOVE 'Y' TO PET-SUS-FLAG.
085620 S-760-EXIT.
085630     EXIT.
085470*
       S-790-VALIDATE-MC-ZIP.                                           02.48
           MOVE 'N'                      TO WS-ERROR-SW.                02.48
           IF PET-INET-COUNTRY NOT = 'USA'                              02.48
              GO TO S-790-EXIT.                                         02.48
           IF KDA-MMERCAT-MC-ATM                                        02.48
              GO TO S-790-EXIT.                                         02.48
           IF HLD-ZIP-WORK = SPACES OR                                  02.48
              HLD-ZIP-WORK(1:5) = '00000' OR                            02.48
              HLD-ZIP-WORK(1:5) = '99999'                               02.48
                 GO TO S-790-ERROR-EXIT                                 02.48
           END-IF.                                                      02.48
           IF HLD-ZIP-WORK(1:5) NOT NUMERIC                             02.48
              GO TO S-790-ERROR-EXIT                                    02.48
           END-IF.                                                      02.48
           IF HLD-ZIP-WORK(6:4) NUMERIC OR                              02.48
              HLD-ZIP-WORK(6:4) = SPACES                                02.48
              GO TO S-790-EXIT                                          02.48
           END-IF.                                                      02.48
       S-790-ERROR-EXIT.                                                02.48
           MOVE 'Y'                      TO WS-ERROR-SW.                02.48
       S-790-EXIT.                                                      02.48
           EXIT.                                                        02.48
      *                                                                 02.48
085650 S-800-VALID-DATE.
085660     MOVE SPACE                    TO INVALID-DATE-SW.
085670     IF VD-MM-DD NOT NUMERIC
085680        MOVE 'Y'                   TO INVALID-DATE-SW
085690        MOVE ZEROES                TO VALIDATE-DATE
085700        MOVE 13                    TO ER-CD (ER-INDX)
PROMST        SET WS-ARC-SET-E10 TO TRUE
085710        GO TO S-800-EXIT.
085720     IF VD-MM-DD = ZEROES
085730        GO TO S-800-SET-TO-WAO.
085740     COMPUTE VD-YY = HLD-WAO-YY.
085750     IF VD-MM < HLD-WAO-MM
085760        GO TO S-800-VALIDATE-MMDDYY.
085770     IF VD-MM > HLD-WAO-MM
085780        PERFORM S-802-SUBTRACT-1-YEAR
085790           THRU S-802-EXIT
085800        GO TO S-800-VALIDATE-MMDDYY.
085810     IF VD-DD > HLD-WAO-DD
085820        PERFORM S-802-SUBTRACT-1-YEAR
085830           THRU S-802-EXIT.
085840 S-800-VALIDATE-MMDDYY.
085850     PERFORM S-801-VALIDATE-MMDDYY-DATE
085860        THRU S-801-EXIT.
085870     IF INVALID-DATE-SW = SPACE
085880        GO TO S-800-EXIT.
085890 S-800-SET-TO-WAO.
085900     MOVE 'Y'                      TO INVALID-DATE-SW.
085910     MOVE 14                       TO ER-CD (ER-INDX).
PROMST     SET WS-ARC-SET-E10 TO TRUE.
085920     MOVE HLD-WORK-AS-OF-DATE      TO VALIDATE-DATE.
085930 S-800-EXIT.
085940     EXIT.
085950*
085960 S-801-VALIDATE-MMDDYY-DATE.
085970     IF VALID-DATE = ZEROS
085980        MOVE 'Y'                   TO INVALID-DATE-SW
085990        GO TO S-801-EXIT.
086000     MOVE 'CAG'                    TO DC-OPERATION.
086010     MOVE VALID-DATE               TO DC-SEND-DATE.
           MOVE ZEROS                    TO DC-SEND-NUM.                02.90
086020     PERFORM D-100-CALL-DATECONV
086030        THRU D-100-EXIT.
086040     IF DC-SUCCESSFUL
086050        MOVE SPACE                 TO INVALID-DATE-SW
086060     ELSE
086070        MOVE 'Y'                   TO INVALID-DATE-SW.
086080 S-801-EXIT.
086090     EXIT.
086100*
086110 S-802-SUBTRACT-1-YEAR.
086120     IF VD-YY = 00
086130         MOVE 99                   TO VD-YY
086140     ELSE
086150         COMPUTE VD-YY = HLD-WAO-YY - 1.
086160 S-802-EXIT.
086170     EXIT.
086180*
       S-807-CHECK-ALM.                                                 02.25
      *                                                                 02.25
           MOVE 'Y'                      TO WS-ERROR-SW.                02.25
      *                                                                 02.25
           MOVE 'DAJ'                    TO DC-OPERATION.               02.90
           MOVE HLD-WORK-AS-OF-DATE      TO DC-SEND-DATE.               02.25
           MOVE WS-MC-ACCT-LVL-DATE      TO DC-SEND-NUM.                02.25
           PERFORM D-100-CALL-DATECONV                                  02.25
              THRU D-100-EXIT.                                          02.25
           IF DC-RESULT = 00 OR 01                                      02.25
              NEXT SENTENCE                                             02.25
           ELSE                                                         02.25
              GO TO S-807-EXIT                                          02.25
           END-IF.                                                      02.25
      *                                                                 02.25
           MOVE WS-MC-BANKNET-DATE-X     TO VD-MM-DD.                   02.25
           PERFORM S-800-VALID-DATE                                     02.25
              THRU S-800-EXIT.                                          02.25
           IF INVALID-DATE-SW = 'Y'                                     02.25
              GO TO S-807-EXIT.                                         02.25
      *                                                                 02.25
           MOVE 'DAJ'                    TO DC-OPERATION.               02.90
           MOVE VALID-DATE               TO DC-SEND-DATE                02.25
                                            WS-CHD-ICA-BANKNET-DATE.    02.25
           MOVE WS-MC-ACCT-LVL-DATE      TO DC-SEND-NUM.                02.25
           PERFORM D-100-CALL-DATECONV                                  02.25
              THRU D-100-EXIT.                                          02.25
           IF DC-RESULT = 00 OR 01                                      02.25
              NEXT SENTENCE                                             02.25
           ELSE                                                         02.25
              GO TO S-807-EXIT                                          02.25
           END-IF.                                                      02.25
      *                                                                 02.25
           MOVE WS-TRAN-DATE-X           TO VD-MM-DD.                   02.25
           PERFORM S-815-SET-DATES                                      02.25
              THRU S-815-EXIT.                                          02.25
           IF INVALID-DATE-SW = 'Y'                                     02.25
              GO TO S-807-EXIT.                                         02.25
      *                                                                 02.25
           MOVE 'DAJ'                    TO DC-OPERATION.               02.90
           MOVE VALID-DATE               TO DC-SEND-DATE.               02.25
           MOVE WS-MC-ACCT-LVL-DATE      TO DC-SEND-NUM.                02.25
           PERFORM D-100-CALL-DATECONV                                  02.25
              THRU D-100-EXIT.                                          02.25
           IF DC-RESULT = 00 OR 01                                      02.25
              MOVE 'N'                   TO WS-ERROR-SW                 02.25
           END-IF.                                                      02.25
      *                                                                 02.25
       S-807-EXIT.                                                      02.25
           EXIT.                                                        02.25
      *                                                                 02.25
086190 S-810-MERCH-TOTS.
086200*
086280      PERFORM S-830-MERCH-NOTONUS                                 03.47
086290         THRU S-830-EXIT.                                         03.47
086300 S-810-EXIT.
086310     EXIT.
      *
       S-815-SET-DATES.
      *
           PERFORM S-800-VALID-DATE
              THRU S-800-EXIT.
           PERFORM U-150-CH-INVAL-DT-CHK
              THRU U-150-EXIT.
           IF INVALID-DATE-SW = SPACE
              MOVE VALID-DATE            TO PET-DATE
              IF PET-CARD-TYPE-DISCOVER
              OR PET-CARD-TYPE-PAYPAL                                   03.47
                 MOVE PET-DATE           TO DC-SEND-DATE
                 MOVE 'CAD'              TO DC-OPERATION
                 PERFORM D-100-CALL-DATECONV
                    THRU D-100-EXIT
                 IF DC-SUCCESSFUL
                    MOVE DC-RETURN-DATE  TO PET-DS-TRAN-DATE
                 END-IF
              END-IF
           END-IF.
      *
       S-815-EXIT.
           EXIT.
      *
086550 S-830-MERCH-NOTONUS.
086320*
           IF MR1-VALID-RETURN                                          03.31
086360        ADD 1                      TO PEM-BATCH-CR-ITEMS
              SUBTRACT PET-REIMB-AMT   FROM PEM-BATCH-CR-AMT            03.00
              IF PET-SUS-FLAG = 'Y'                                     02.58
                 ADD 1                   TO PEM-BATCH-CR-ITEMS-REJ      02.58
                 SUBTRACT PET-REIMB-AMT                                 03.00
                                       FROM PEM-BATCH-CR-AMT-REJ        02.58
              END-IF                                                    02.58
086340     ELSE
086360        ADD 1                      TO PEM-BATCH-DR-ITEMS
              ADD PET-REIMB-AMT          TO PEM-BATCH-DR-AMT            03.00
              IF PET-SUS-FLAG = 'Y'                                     02.58
                 ADD 1                   TO PEM-BATCH-DR-ITEMS-REJ      02.58
                 ADD PET-REIMB-AMT       TO PEM-BATCH-DR-AMT-REJ        03.00
              END-IF                                                    02.58
           END-IF.                                                      02.58
086890*
086350     IF WS-CARD-TYPE = 'V'
086360        ADD 1                      TO PEM-VISA-NOTONUS-ITMS
                                            WORK-NON-SETL-CNT           02.86
              IF MR1-VALID-RETURN                                       03.31
                 SUBTRACT PET-REIMB-AMT                                 03.00
                                       FROM PEM-VISA-NOTONUS-AMT        03.00
                 IF PEM-NF-VISA NOT = 'S'
                    SUBTRACT PET-REIMB-AMT                              03.00
                                       FROM WORK-NON-SETL-AMT           03.00
                                            WORK-NON-SETL-REIMB-AMT     03.00
                                            PEM-BATCH-CR-AMT-NS         03.00
                    ADD +1               TO PEM-BATCH-CR-ITEMS-NS       03.00
                    IF PET-SUS-FLAG = 'Y'                               03.10
                       SUBTRACT PET-REIMB-AMT                           03.10
                                       FROM PEM-BATCH-CR-AMT-REJ-NS     03.10
                       ADD +1            TO PEM-BATCH-CR-ITEMS-REJ-NS   03.10
                    END-IF                                              03.10
086460           END-IF
086340        ELSE
                 ADD PET-REIMB-AMT       TO PEM-VISA-NOTONUS-AMT        03.00
                 IF PEM-NF-VISA NOT = 'S'
                    ADD PET-REIMB-AMT    TO WORK-NON-SETL-AMT           03.00
                                            WORK-NON-SETL-REIMB-AMT     03.00
                                            PEM-BATCH-DR-AMT-NS         03.00
                    ADD +1               TO PEM-BATCH-DR-ITEMS-NS       03.00
                    IF PET-SUS-FLAG = 'Y'                               03.10
                       ADD PET-REIMB-AMT TO PEM-BATCH-DR-AMT-REJ-NS     03.10
                       ADD +1            TO PEM-BATCH-DR-ITEMS-REJ-NS   03.10
                    END-IF                                              03.10
086460           END-IF
086340        END-IF
086380        GO TO S-830-EXIT.
086890*
086350     IF WS-CARD-TYPE = 'M'
086360        ADD 1                      TO PEM-MC-NOTONUS-ITMS
                                            WORK-NON-SETL-CNT           02.86
              IF MR1-VALID-RETURN                                       03.31
                 SUBTRACT PET-REIMB-AMT                                 03.00
                                       FROM PEM-MC-NOTONUS-AMT          03.00
                 IF PEM-NF-MC NOT = 'S'
                    SUBTRACT PET-REIMB-AMT                              03.00
                                       FROM WORK-NON-SETL-AMT           03.00
                                            WORK-NON-SETL-REIMB-AMT     03.00
                                            PEM-BATCH-CR-AMT-NS         03.00
                    ADD +1               TO PEM-BATCH-CR-ITEMS-NS       03.00
                    IF PET-SUS-FLAG = 'Y'                               03.10
                       SUBTRACT PET-REIMB-AMT                           03.10
                                       FROM PEM-BATCH-CR-AMT-REJ-NS     03.10
                       ADD +1            TO PEM-BATCH-CR-ITEMS-REJ-NS   03.10
                    END-IF                                              03.10
086460           END-IF
086340        ELSE
                 ADD PET-REIMB-AMT       TO PEM-MC-NOTONUS-AMT          03.00
                 IF PEM-NF-MC NOT = 'S'
                    ADD PET-REIMB-AMT    TO WORK-NON-SETL-AMT           03.00
                                            WORK-NON-SETL-REIMB-AMT     03.00
                                            PEM-BATCH-DR-AMT-NS         03.00
                    ADD +1               TO PEM-BATCH-DR-ITEMS-NS       03.00
                    IF PET-SUS-FLAG = 'Y'                               03.10
                       ADD PET-REIMB-AMT TO PEM-BATCH-DR-AMT-REJ-NS     03.10
                       ADD +1            TO PEM-BATCH-DR-ITEMS-REJ-NS   03.10
                    END-IF                                              03.10
086460           END-IF
086340        END-IF
086380        GO TO S-830-EXIT.
086910*
086350     IF WS-CARD-TYPE = 'A'
086360        ADD 1                      TO PEM-AMEX-NOTONUS-ITMS
                                            WORK-NON-SETL-CNT           02.86
              IF MR1-VALID-RETURN                                       03.31
                 SUBTRACT PET-REIMB-AMT                                 03.00
                                       FROM PEM-AMEX-NOTONUS-AMT        03.00
                 IF PET-CARD-TYPE-AMEX-NSETL                            03.34F
                    SUBTRACT PET-REIMB-AMT                              03.00
                                       FROM WORK-NON-SETL-AMT           03.00
                                            WORK-NON-SETL-REIMB-AMT     03.00
                                            PEM-BATCH-CR-AMT-NS         03.00
                    ADD +1               TO PEM-BATCH-CR-ITEMS-NS       03.00
                    IF PET-SUS-FLAG = 'Y'                               03.10
                       SUBTRACT PET-REIMB-AMT                           03.10
                                       FROM PEM-BATCH-CR-AMT-REJ-NS     03.10
                       ADD +1            TO PEM-BATCH-CR-ITEMS-REJ-NS   03.10
                    END-IF                                              03.10
                 END-IF                                                 03.00
086340        ELSE
                 ADD PET-REIMB-AMT       TO PEM-AMEX-NOTONUS-AMT        03.00
                 IF PET-CARD-TYPE-AMEX-NSETL                            03.34F
                    ADD PET-REIMB-AMT    TO WORK-NON-SETL-AMT           03.00
                                            WORK-NON-SETL-REIMB-AMT     03.00
                                            PEM-BATCH-DR-AMT-NS         03.00
                    ADD +1               TO PEM-BATCH-DR-ITEMS-NS       03.00
                    IF PET-SUS-FLAG = 'Y'                               03.10
                       ADD PET-REIMB-AMT TO PEM-BATCH-DR-AMT-REJ-NS     03.10
                       ADD +1            TO PEM-BATCH-DR-ITEMS-REJ-NS   03.10
                    END-IF                                              03.10
                 END-IF                                                 03.00
086340        END-IF
086380        GO TO S-830-EXIT.
086910*
086350     IF WS-CARD-TYPE = 'D'
086360        ADD 1                      TO PEM-DISC-NOTONUS-ITMS
                                            WORK-NON-SETL-CNT           02.86
              IF MR1-VALID-RETURN                                       03.31
                 SUBTRACT PET-REIMB-AMT                                 03.00
                                       FROM PEM-DISC-NOTONUS-AMT        03.00
                 IF PET-CARD-TYPE-DISCOVER-NSETL                        03.34F
                    SUBTRACT PET-REIMB-AMT                              03.00
                                       FROM WORK-NON-SETL-AMT           03.00
                                            WORK-NON-SETL-REIMB-AMT     03.00
                                            PEM-BATCH-CR-AMT-NS         03.00
                    ADD +1               TO PEM-BATCH-CR-ITEMS-NS       03.00
                    IF PET-SUS-FLAG = 'Y'                               03.10
                       SUBTRACT PET-REIMB-AMT                           03.10
                                       FROM PEM-BATCH-CR-AMT-REJ-NS     03.10
                       ADD +1            TO PEM-BATCH-CR-ITEMS-REJ-NS   03.10
                    END-IF                                              03.10
                 END-IF                                                 03.00
086340        ELSE
                 ADD PET-REIMB-AMT       TO PEM-DISC-NOTONUS-AMT        03.00
                 IF PET-CARD-TYPE-DISCOVER-NSETL                        03.34F
                    ADD PET-REIMB-AMT    TO WORK-NON-SETL-AMT           03.00
                                            WORK-NON-SETL-REIMB-AMT     03.00
                                            PEM-BATCH-DR-AMT-NS         03.00
                    ADD +1               TO PEM-BATCH-DR-ITEMS-NS       03.00
                    IF PET-SUS-FLAG = 'Y'                               03.10
                       ADD PET-REIMB-AMT TO PEM-BATCH-DR-AMT-REJ-NS     03.10
                       ADD +1            TO PEM-BATCH-DR-ITEMS-REJ-NS   03.10
                    END-IF                                              03.10
                 END-IF                                                 03.00
086340     END-IF.
086910*
086350     IF WS-CARD-TYPE = 'Y'                                        03.47
086360        ADD 1                      TO PEM-PP-NOTONUS-ITMS         03.47
                                            WORK-NON-SETL-CNT           03.47
              IF MR1-VALID-RETURN                                       03.47
                 SUBTRACT PET-REIMB-AMT                                 03.47
                                       FROM PEM-PP-NOTONUS-AMT          03.47
                 IF PET-CARD-TYPE-PAYPAL-NSETL                          03.47
                    SUBTRACT PET-REIMB-AMT                              03.47
                                       FROM WORK-NON-SETL-AMT           03.47
                                            WORK-NON-SETL-REIMB-AMT     03.47
                                            PEM-BATCH-CR-AMT-NS         03.47
                    ADD +1               TO PEM-BATCH-CR-ITEMS-NS       03.47
                    IF PET-SUS-FLAG = 'Y'                               03.47
                       SUBTRACT PET-REIMB-AMT                           03.47
                                       FROM PEM-BATCH-CR-AMT-REJ-NS     03.47
                       ADD +1            TO PEM-BATCH-CR-ITEMS-REJ-NS   03.47
                    END-IF                                              03.47
                 END-IF                                                 03.47
086340        ELSE                                                      03.47
                 ADD PET-REIMB-AMT       TO PEM-PP-NOTONUS-AMT          03.47
                 IF PET-CARD-TYPE-PAYPAL-NSETL                          03.47
                    ADD PET-REIMB-AMT    TO WORK-NON-SETL-AMT           03.47
                                            WORK-NON-SETL-REIMB-AMT     03.47
                                            PEM-BATCH-DR-AMT-NS         03.47
                    ADD +1               TO PEM-BATCH-DR-ITEMS-NS       03.47
                    IF PET-SUS-FLAG = 'Y'                               03.47
                       ADD PET-REIMB-AMT TO PEM-BATCH-DR-AMT-REJ-NS     03.47
                       ADD +1            TO PEM-BATCH-DR-ITEMS-REJ-NS   03.47
                    END-IF                                              03.47
                 END-IF                                                 03.47
086340     END-IF.                                                      03.47
086910*                                                                 03.47
086830 S-830-EXIT.
086840     EXIT.
086850*
086860 S-840-NOTONUS-TOTS.
           IF MR1-VALID-CASH                                            03.31
045320        MOVE +1                    TO SUB1
045320     ELSE
           IF MR1-VALID-RETURN                                          03.31
045320        MOVE +3                    TO SUB1
045320     ELSE
045320        MOVE +2                    TO SUB1.
086890*
087100 S-840-OUTGOING.
086890*
087120     IF WS-CARD-TYPE = 'V'
087410        ADD 1                      TO PEN-VISA-ITMS
087430                                      VISA-NOU-ITMS(SUB1)
087440        ADD PET-ACQ-AMOUNT         TO VISA-NOU-AMOUNT(SUB1)
086920        IF SUB1 = +3
087420           SUBTRACT PET-ACQ-AMOUNT FROM PEN-VISA-AMOUNT
086920        ELSE
087140           ADD PET-ACQ-AMOUNT      TO PEN-VISA-AMOUNT
086920        END-IF
087170        GO TO S-840-EXIT.
086890*
087120     IF WS-CARD-TYPE = 'M'
087410        ADD 1                      TO PEN-MC-ITMS
087430                                      MC-NOU-ITMS(SUB1)
087440        ADD PET-ACQ-AMOUNT         TO MC-NOU-AMOUNT(SUB1)
086920        IF SUB1 = +3
087420           SUBTRACT PET-ACQ-AMOUNT FROM PEN-MC-AMOUNT
086920        ELSE
087140           ADD PET-ACQ-AMOUNT      TO PEN-MC-AMOUNT
086920        END-IF
087170        GO TO S-840-EXIT.
086890*
087120     IF WS-CARD-TYPE = 'A'
087410        ADD 1                      TO PEN-AMEX-ITMS
087430                                      AMEX-NOU-ITMS(SUB1)
087440        ADD PET-ACQ-AMOUNT         TO AMEX-NOU-AMOUNT(SUB1)
086920        IF SUB1 = +3
087420           SUBTRACT PET-ACQ-AMOUNT FROM PEN-AMEX-AMOUNT
086920        ELSE
087140           ADD PET-ACQ-AMOUNT      TO PEN-AMEX-AMOUNT
086920        END-IF
087170        GO TO S-840-EXIT.
086890*
087120     IF WS-CARD-TYPE = 'D'
087410        ADD 1                      TO PEN-DISC-ITMS
087430                                      DISC-NOU-ITMS(SUB1)
087440        ADD PET-ACQ-AMOUNT         TO DISC-NOU-AMOUNT(SUB1)
086920        IF SUB1 = +3
087420           SUBTRACT PET-ACQ-AMOUNT FROM PEN-DISC-AMOUNT
086920        ELSE
087140           ADD PET-ACQ-AMOUNT      TO PEN-DISC-AMOUNT
086920        END-IF
087170        GO TO S-840-EXIT.
086890*
087120     IF WS-CARD-TYPE = 'Y'                                        03.47
087410        ADD 1                      TO PEN-PAYPAL-ITMS             03.47
087430                                      PP-NOU-ITMS(SUB1)           03.47
087440        ADD PET-ACQ-AMOUNT         TO PP-NOU-AMOUNT(SUB1)         03.47
086920        IF SUB1 = +3                                              03.47
087420           SUBTRACT PET-ACQ-AMOUNT FROM PEN-PAYPAL-AMOUNT         03.47
086920        ELSE                                                      03.47
087140           ADD PET-ACQ-AMOUNT      TO PEN-PAYPAL-AMOUNT           03.47
086920        END-IF                                                    03.47
087170        GO TO S-840-EXIT.                                         03.47
086890*                                                                 03.47
087410     ADD 1                         TO PEN-PL-ITMS
087430                                      PL-NOU-ITMS(SUB1)
087440     ADD PET-ACQ-AMOUNT            TO PL-NOU-AMOUNT(SUB1)
086920     IF SUB1 = +3
087420        SUBTRACT PET-ACQ-AMOUNT    FROM PEN-PL-AMOUNT
086920     ELSE
087140        ADD PET-ACQ-AMOUNT         TO PEN-PL-AMOUNT
086920     END-IF.
087550*
087530 S-840-EXIT.
087540     EXIT.
087550*
087560 S-850-VALID-GRP-TC.
087570     MOVE SPACE TO INV-GRP-TC-SW.
038400     IF HLD-SUM-GROUP-TYPE = 'D'
              IF NOT MR1-VALID-SALE                                     03.31
087610           MOVE 'Y'                TO INV-GRP-TC-SW
087610        END-IF
087640        GO TO S-850-EXIT.
087580     IF MR1-TC-SUF EQUAL HLD-SUM-TC-SUF
087590         NEXT SENTENCE
087600     ELSE
087610         MOVE 'Y' TO INV-GRP-TC-SW
087620         GO TO S-850-EXIT.
087630     IF MR1-TC-PREF EQUAL '32' OR '58'
087640         GO TO S-850-EXIT.
           IF MR1-VALID-MONETARY                                        03.31
087660         GO TO S-850-SALES-TC.
087670     GO TO S-850-EXIT.
087680 S-850-SALES-TC.
087690*
087700*   0603, 0703, AND 0O03 TRANS CAN FOLLOW EITHER A
087710*       29, 30, OR 31 GROUP SUMMARY TRANS
087720*
087730     IF HLD-SUM-TC-PREF EQUAL '30' OR '31'
087740         NEXT SENTENCE
087750     ELSE
087760         MOVE 'Y' TO INV-GRP-TC-SW.
087840 S-850-EXIT.
087850     EXIT.
087860*
087870 S-860-ZERO-TC-TABLES.
087920     PERFORM S-862-ZERO-MRCH-NOU
087930        THRU S-862-EXIT
087940         VARYING SUB-Z FROM 1 BY 1
087950             UNTIL SUB-Z IS GREATER THAN 10.
087960 S-860-EXIT.
087970     EXIT.
087980*
088080 S-862-ZERO-MRCH-NOU.
088090     IF SUB-Z < 4
088100        MOVE ZERO             TO VISA-NOU-ITMS (SUB-Z)
000000                                 VISA-NOU-AMOUNT (SUB-Z)
088120                                 MC-NOU-ITMS (SUB-Z)
088130                                 MC-NOU-AMOUNT (SUB-Z)
088120                                 AMEX-NOU-ITMS (SUB-Z)
088130                                 AMEX-NOU-AMOUNT (SUB-Z)
088120                                 DISC-NOU-ITMS (SUB-Z)
088130                                 DISC-NOU-AMOUNT (SUB-Z)
088120                                 PP-NOU-ITMS (SUB-Z)              03.47
088130                                 PP-NOU-AMOUNT (SUB-Z)            03.47
088120                                 PL-NOU-ITMS (SUB-Z)
088130                                 PL-NOU-AMOUNT (SUB-Z).           03.47
088160     IF SUB-Z < 5
088170        MOVE ZERO             TO TC-MRCH-ITMS (SUB-Z)
088180                                 TC-MRCH-AMOUNT (SUB-Z).
088190 S-862-EXIT.
088200     EXIT.
088210*
088490 S-870-VALID-ICA.
           MOVE SPACES                   TO EDIT-FILE-REC               02.23
                                            BAS10002-CALL-PARAMETERS.   02.23
088530     MOVE 'C'                      TO EFR-REC-KEY-ID.
088540     MOVE HLD-ICA-NMBR             TO EFR-ICA-CD.
088750     PERFORM Z-900-READ-EFR
088760        THRU Z-900-EXIT.
           IF BAS10002-EFR-GOOD                                         02.23
              MOVE 'N'                   TO BAS10002-INVALID-ICA-SW     02.23
           ELSE                                                         02.23
              MOVE 'Y'                   TO BAS10002-INVALID-ICA-SW     02.23
           END-IF.                                                      02.23
088640 S-870-EXIT.
088650     EXIT.
088660*
088670 S-875-VALID-PREFIX.
           MOVE 'N'                      TO KDA-CHD-ICA-RATE-IND        02.68
                                            KDA-CHD-ICA-PWCB.           02.68
           MOVE SPACES                   TO KDA-CHD-ICA-CARD-TYPE
                                            WS-CHD-ICA-MPE-CARD-TYPE    02.39
                                            WS-CHD-ICA-REF-CARD-TYPE    02.39
                                            WS-CHD-ICA-PROC-CARD-TYPE   02.39
                                            KDA-CHD-MAP-SVC-IND         03.50
                                            KDA-CHD-ICA-HEALTH-CARE.    02.23
           MOVE ZERO                     TO KDA-CHD-BUS-LVL-SW.         03.11F
088700     MOVE SPACES                   TO KDA-CHD-ICA-ACCEPT-BRAND.
           MOVE SPACE                    TO WS-CHD-ICA-MPE-ACCEPT-BRAND 02.81
                                            WS-CHD-ICA-MPE-PREPAID      02.81
                                            WS-CHD-ICA-PROC-PREPAID     02.81
                                            KDA-CHD-ICA-PREPAID.        02.81
088710     MOVE ZEROS                    TO WS-CHD-ICA.
           MOVE +0                       TO KDA-MC-ACCT-LVL-DATE.
088720     MOVE SPACES                   TO EDIT-FILE-REC.
088730     MOVE 'D'                      TO EFR-REC-KEY-ID.
088740     MOVE WS-MC-PREFIX-HIGH-BIN    TO EFR-PREFIX-HIGH-BIN.
           MOVE EFR-REC-KEY              TO BAS10002-PASSED-KEY.        02.23
           MOVE 'S'                      TO BAS10002-CALL-TYPE.         02.23
           MOVE 'N'                      TO BAS10002-INVALID-ICA-SW.    02.23
088580     PERFORM Z9998-CALL-BAS10002
088590        THRU Z9998-EXIT.
           IF BAS10002-INVALID-ICA-SW = 'Y'                             02.23
              MOVE 'Y'                   TO BAS10002-INVALID-PRE-SW     02.23
088890        GO TO S-875-EXIT.
           MOVE BAS10002-EDDATA-AREA     TO EDIT-FILE-REC.              02.23
088600     IF WS-MC-PREFIX-HIGH-BIN < EFR-PREFIX-LOW-BIN
              MOVE 'Y'                   TO BAS10002-INVALID-PRE-SW     02.23
                                            BAS10002-INVALID-ICA-SW     02.23
088890        GO TO S-875-EXIT.
088600     MOVE EFR-PREFIX-HIGH-BIN      TO WS-MC-LAST-PREFIX-HIGH-BIN.
088570     MOVE 'N'                      TO BAS10002-INVALID-PRE-SW.    02.23
           MOVE EFR-PREFIX-REGION        TO WS-CHD-ICA-REGN-SUBR.       02.41
045760     SET ACT-INDX TO +1.
045770     SEARCH WS-MC-ACT-ENTRY
045780        AT END
045830           MOVE 01                 TO KDA-CHD-ICA-CLEAR-REGN
045820        WHEN WS-CHD-ICA-REGN = WS-MC-ACT-AMS-REGN(ACT-INDX)
045830           MOVE WS-MC-ACT-CLR-REGN(ACT-INDX)
045830                                   TO KDA-CHD-ICA-CLEAR-REGN.
           MOVE EFR-PREFIX-COUNTRY       TO KDA-CHD-ICA-COUNTRY.        02.41
088840     MOVE EFR-PREFIX-ICA           TO WS-CHD-ICA.
088890 S-875-EXIT.
088900     EXIT.
088910*
       S-880-VALID-MC-REF-PREFIX.                                       02.41
           MOVE SPACES                   TO EDIT-FILE-REC               02.41
           MOVE 'Q'                      TO EFR-REC-KEY-ID.             02.41
           MOVE WS-MC-REF-NO-PREFIX      TO EFR-MC-BIN(1:6).            02.41
           PERFORM Z-900-READ-EFR                                       02.41
              THRU Z-900-EXIT.                                          02.41
       S-880-EXIT.                                                      02.41
           EXIT.                                                        02.41
      *
       S-890-VALID-DS-PREFIX.
           MOVE SPACES                   TO EDIT-FILE-REC               03.47
                                            BAS10002-CALL-PARAMETERS.   03.47
           MOVE 'K'                      TO EFR-REC-KEY-ID.
           MOVE WS-CHD-DIS-ACCT-NO-RANGE TO EFR-DS-HIGH-PREFIX.
           MOVE EFR-REC-KEY              TO BAS10002-PASSED-KEY.        02.23
           MOVE 'S'                      TO BAS10002-CALL-TYPE.         02.23
           MOVE 'N'                      TO BAS10002-INVALID-ICA-SW.    02.23
           PERFORM Z9998-CALL-BAS10002
              THRU Z9998-EXIT.
           IF BAS10002-INVALID-ICA-SW = 'Y'                             02.23
              MOVE 'Y'                   TO BAS10002-INVALID-PRE-SW     02.23
              GO TO S-890-EXIT.
           MOVE BAS10002-EDDATA-AREA     TO EDIT-FILE-REC.              02.23
           IF WS-CHD-DIS-ACCT-NO-RANGE < EFR-DS-LOW-PREFIX
              MOVE 'Y'                   TO BAS10002-INVALID-PRE-SW     02.23
              GO TO S-890-EXIT.
           MOVE 'N'                      TO BAS10002-INVALID-PRE-SW.    02.23
           MOVE EFR-DS-CARD-PRODUCT      TO KDA-CHD-DS-PRODUCT-TYPE-X.
           MOVE EFR-DS-ISS-NETWORK       TO KDA-CHD-DS-ISS-NET.         02.39
           MOVE EFR-DS-ISS-CNTRY-IND     TO KDA-CHD-DS-ISS-CNTRY-IND.   02.39
           MOVE EFR-DS-REGULATION-IND    TO KDA-CHD-DS-REGULATION-IND.  02.68
           MOVE EFR-DS-REAL-TIME-PRICE-IND                              03.42D
                                         TO KDA-DS-REAL-TIME-PRC-IND.   03.42D
       S-890-EXIT.
           EXIT.
088910*
       S-895-VALID-AX-PREFIX.                                           02.72
           MOVE SPACES                   TO EDIT-FILE-REC.              02.72
           SET EFR-REC-IS-AX-PREFIX      TO TRUE.                       02.72
           MOVE WS-CHD-AMEX-ACCT-NO-RANGE TO EFR-AX-PREFIX.             02.72
           MOVE EFR-REC-KEY              TO BAS10002-PASSED-KEY.        02.72
           MOVE 'R'                      TO BAS10002-CALL-TYPE.         02.72
           SET BAS10002-EFR-GOOD         TO TRUE.                       02.72
           PERFORM Z9998-CALL-BAS10002                                  02.72
              THRU Z9998-EXIT.                                          02.72
           IF NOT BAS10002-EFR-GOOD                                     02.72
              MOVE SPACES                TO KDA-AX-ROC-FEE-CODE         02.72
           ELSE                                                         02.72
              MOVE BAS10002-EDDATA-AREA  TO EDIT-FILE-REC               02.72
              MOVE EFR-AX-CARD-PRODUCT   TO KDA-AX-ROC-FEE-CODE         02.72
           END-IF.                                                      02.72
       S-895-EXIT.                                                      02.72
           EXIT.                                                        02.72
088910*
088920 S-900-BYPASS-BATCH.
088930     MOVE '        BATCH BYPASSED        ' TO HLB-LIT.
088940     MOVE SPACES TO RNH1-DROP.
065300     PERFORM S-100-PRINT-PAGE-HDR
065310        THRU S-100-EXIT.
065320     MOVE RPT-NON-MON-HDR-1     TO RLW-DETAIL-LINE.
065330     PERFORM R-920-WRITE-REPORT-RECORD
065340        THRU R-920-EXIT.
088970     MOVE '0' TO RND1-CC.
088980     MOVE MRCH-RECORD-100 TO RND1-DATA.
051000     MOVE '*' TO RND1-SUS-FLAG
051000                 RND1-FATAL-FLAG.
089000     IF ER-CD-3-DIG (1) IS GREATER THAN ZERO
089010         MOVE ER-CD-3-DIG (1) TO RND1-ERROR-CD-1.
089020     IF ER-CD-3-DIG (2) IS GREATER THAN ZERO
089030         MOVE ER-CD-3-DIG (2) TO RND1-ERROR-CD-2.
089040     IF ER-CD-3-DIG (3) IS GREATER THAN ZERO
089050         MOVE ER-CD-3-DIG (3) TO RND1-ERROR-CD-3.
089060     IF ER-CD-3-DIG (4) IS GREATER THAN ZERO
089070         MOVE ER-CD-3-DIG (4) TO RND1-ERROR-CD-4.
089080     IF ER-CD-3-DIG (5) IS GREATER THAN ZERO
089090         MOVE ER-CD-3-DIG (5) TO RND1-ERROR-CD-5.
089100     PERFORM S-200-PRINT-NON-MON-DET-1
089110        THRU S-200-EXIT.
089120     MOVE 'Y' TO BATCH-REJ-SW.
089130     IF MON-BATCH
089140         MOVE '**' TO SB-REJ
089150         MOVE SPACES TO HLD-SUM-TC
089160     ELSE
089170         MOVE 'Y' TO BATCH-HDR-MISSING-SW.
089180     MOVE SPACES TO MR1-TRANSCODE.
           PERFORM                                                      02.73
             UNTIL MR1-VALID-BATCH                                      03.31
             OR END-OF-INPUT                                            02.73
               PERFORM S-010-READ-TRANS-IN THRU S-010-EXIT              02.73
               IF MR1-VALID-BATCH                                       03.31
               OR END-OF-INPUT                                          02.73
                  CONTINUE                                              02.73
               ELSE                                                     02.73
                  IF MR1-VALID-MONETARY                                 03.31
                     ADD +1              TO SB-CNT                      03.31
                  END-IF                                                03.31
               END-IF                                                   02.73
           END-PERFORM.                                                 02.73
089230     MOVE 'Y' TO BATCH-BYPASSED-SW.
089240 S-900-EXIT.
089250     EXIT.
089400*
089270 S-990-PRINT-INVALID-TRANS.
089280     MOVE '0' TO RND1-CC.
051000     MOVE '*' TO RND1-SUS-FLAG
051000                 RND1-FATAL-FLAG.
089300     MOVE MRCH-RECORD-100 TO RND1-DATA.
089310     MOVE ER-CD-3-DIG (1) TO RND1-ERROR-CD-2.
089320     PERFORM S-200-PRINT-NON-MON-DET-1
089330        THRU S-200-EXIT.
089340     IF INVALID-TRANS-CTR EQUAL 3
089350         MOVE 95 TO ER-CD (1)
089360         PERFORM S-900-BYPASS-BATCH
089370            THRU S-900-EXIT.
089380 S-990-EXIT.
089390     EXIT.
089260*
009410 S-995-FIND-CURR-RATE.
091870*
091880     CALL BASCRATE
091880          USING BASCRATE-CALL-PARAMETERS.
091890*
089610 S-995-EXIT.
089620     EXIT.
089630*
089640 T-100-EDIT-ACCOUNT.
089650*
089660*   ACCOUNT NUMBER EDITS FOR ALL CARDHOLDER TRANSACTIONS --
089670*     ACCOUNT NUMBER SHOULD COME INTO EDIT NUMERIC,
089680*     RIGHT-SHIFTED WITH LEADING ZEROS IN A 16-BYTE FIELD
089690*
089700     MOVE SPACES TO WS-CARD-TYPE.
089730     MOVE 16                       TO WSAK-ACCT-LEN.
089730     MOVE SPACE                    TO INVALID-ACCT-SW.            03.47
           MOVE 'N'                      TO KDA-CHD-ENHANCED
                                            KDA-CHD-HIGH-VALUE          02.29
                                            WS-BANKNET-REF-FLAG         02.39
                                            WS-MC-PROD-GRAD-SW.
089770     MOVE 'USA'                    TO KDA-CHD-ICA-COUNTRY.
089780     MOVE '1 '                     TO WS-CHD-ICA-REGN-SUBR.
006340     MOVE 01                       TO KDA-CHD-ICA-CLEAR-REGN.
089790     MOVE '1'                      TO KDA-CHD-AR-BIN-REGION.
089800     MOVE 'US'                     TO WS-CHD-AR-BIN-COUNTRY.
089810     MOVE ZEROS                    TO WS-CHD-AR-REPORT-BIN.
           MOVE SPACE                    TO KDA-CHD-STANDARD-ONLY.      02.81
           MOVE 'N'                      TO KDA-CHD-ICA-RATE-IND        02.68
                                            KDA-CHD-ICA-PWCB.           02.68
           MOVE +0                       TO KDA-MC-ACCT-LVL-DATE.
           MOVE SPACES                   TO KDA-CHD-ICA-CARD-TYPE
                                            WS-CHD-ICA-MPE-CARD-TYPE    02.39
                                            WS-CHD-ICA-REF-CARD-TYPE    02.39
                                            WS-CHD-ICA-PROC-CARD-TYPE   02.39
                                            KDA-CHD-MAP-SVC-IND         03.50
                                            KDA-CHD-ICA-HEALTH-CARE.    02.23
           MOVE ZERO                     TO KDA-CHD-BUS-LVL-SW.         03.11F
089830     MOVE SPACES                   TO KDA-CHD-ICA-ACCEPT-BRAND.
           MOVE SPACE                    TO WS-MC-ACCEPT-BRAND          02.39
                                            WS-MC-LP2P-ACCEPT-BRAND     02.69
                                            WS-CHD-ICA-MPE-PREPAID      02.81
                                            WS-CHD-ICA-PROC-PREPAID     02.81
                                            KDA-CHD-ICA-PREPAID         02.81
                                            WS-CHD-ICA-MPE-ACCEPT-BRAND.02.39
           MOVE ZEROS                    TO WS-MC-BANKNET-DATE.
           MOVE WS-BANKNET-REF-ALL-9S    TO WS-MC-BANKNET-REF-NO.       02.39
089840     MOVE '1 '                     TO WS-CHD-AR-CHECK-DIG-ALGO.
           MOVE ZEROS                    TO KDA-CHD-DS-PRODUCT-TYPE-X.
           MOVE SPACES                   TO WS-CHD-AR-PRODUCT-ID.
089890*
089900 T-100-SHIFT-ACCOUNT.
089910*
089920     PERFORM T-300-ACCT-LEFT-SHIFT
089930        THRU T-300-EXIT.
089940     IF INVALID-ACCT-SW EQUAL 'Y'
089950         GO TO T-100-EXIT.
089970     IF WSL-HOLD-ZERO-16 NUMERIC AND
089980        WSL-HOLD-ZERO-16 > ZERO
089990           NEXT SENTENCE
090000     ELSE
090010        MOVE 36                    TO ER-CD (ER-INDX)
090020        MOVE 'Y'                   TO INVALID-ACCT-SW
090030                                      PET-SUS-FLAG
PROMST        SET  WS-ARC-SET-E07        TO TRUE
090040        SET ER-INDX UP BY 1
090050        GO TO T-100-EXIT.
090060*
090170     PERFORM T-400-ACCT-CHK                                       03.47
090180        THRU T-400-EXIT.
090190     IF INVALID-ACCT-SW = 'Y'
090200        MOVE 'Y'                   TO PET-SUS-FLAG
090210        GO TO T-100-EXIT.
           IF WS-MIS3-CARD-TYPE = 'DB' OR 'EB'
              NEXT SENTENCE
           ELSE
           IF PET-CARD-USED = 'A' OR
              PET-CARD-USED = 'D' OR
              PET-CARD-USED = 'Y' OR                                    03.47
             (PET-CARD-USED = 'P' AND
             (NOT KDA-CHD-IS-VALID-PD)) OR                              02.29
             (PET-CARD-TYPE-VISA AND                                    03.27
160350        WS-CHD-AR-MOD10) OR
160360        PET-CARD-TYPE-MC
090270           MOVE HLD-ACCT-LGTH      TO CDA-CALL-LENGTH
090280           MOVE WS-LEFT-ZERO-NUM   TO CDA-ORG-ACCOUNT-NO
090290           PERFORM T-250-COMP-CK-DGT
090300              THRU T-250-EXIT
090310           IF INVALID-ACCT-SW = 'Y'
090320              MOVE 37              TO ER-CD (ER-INDX)
090330              MOVE 'Y'             TO PET-SUS-FLAG
090340              SET ER-INDX UP BY 1
090350              GO TO T-100-EXIT.
090360*
090370     MOVE HLD-ACCT-LGTH            TO PET-LENGTH-ORIG-ACCT.
090390     MOVE WSL-HOLD-ZERO-16-NUM     TO PET-ACCOUNT.
090400     MOVE WSL-HOLD-ZERO-LAST-3     TO PET-ACCT-NO-EXT-3.
090410*
090420     IF PET-CARD-TYPE-MC AND BE-CF-MC-SETL = 'Y'
090430        MOVE WS-CHD-ICA-REGN-SUBR  TO PET-ISS-REGN-SUBR
090440        MOVE KDA-CHD-ICA-COUNTRY   TO PET-ISS-COUNTRY
                                            WS-X-BORDER-COUNTRY
090460        MOVE WS-CHD-ICA            TO PET-RECEIVING-ICA.
090550*
090680 T-100-EXIT.
090690     EXIT.
090700*
090710 T-200-ACCT-VERIFY.
090720*
090750     IF INVALID-BIN-SW = 'M'
090760        GO TO T-200-CHECK-MC.
090730     IF INVALID-BIN-SW = 'V'
090830        NEXT SENTENCE
090830     ELSE
090740        GO TO T-200-CHECK-ACCT.
           IF NOT MR1-VALID-MIS3-TRAN                                   03.31
              GO TO T-200-IS-VISA-TRAN-ERROR.
           IF NOT KDA-CHD-AR-IS-RSTRCT-USE-ATM                          02.81
090930        GO TO T-200-IS-VISA-TRAN-ERROR.
           IF NOT MR1-VALID-CASH                                        03.31
090910        GO TO T-200-IS-VISA-TRAN-ERROR.
090940     IF KDA-MRCH-TYP-ATM
090930        GO TO T-200-IS-VISA.
090930     GO TO T-200-IS-VISA-TRAN-ERROR.
090910 T-200-CHECK-ACCT.
003390     IF VALID-MIS3-MC-CARD-TYPE
090810        GO TO T-200-CHECK-MC.
003390     IF VALID-MIS3-DS-CARD-TYPE
003390     OR VALID-MIS3-PP-CARD-TYPE                                   03.47
090810        GO TO T-200-CHECK-DS.
           IF VALID-MIS3-AX-CARD-TYPE                                   02.29
              GO TO T-200-CHECK-AMEX.                                   02.29
003390     IF VALID-MIS3-VISA-CARD-TYPE
090910        GO TO T-200-CHECK-VISA.
003390     IF NOT VALID-MIS3-SPACE
090810        GO TO T-200-CHECK-OTHER.
           IF WS-LEFT-ACCT(1:1) = '5'
              GO TO T-200-CHECK-MC.
           IF KDA-BATCH-ICA-CLEAR-REGN-X = '01' AND
              WS-LEFT-ACCT(1:2) = '36'
                 GO TO T-200-CHECK-MC.
091390     IF WS-LEFT-ACCT(1:1) = '4'
090910        GO TO T-200-CHECK-VISA.
090810     GO TO T-200-CHECK-OTHER.
090910 T-200-CHECK-VISA.
           MOVE WSL-HOLD-ACCT-16         TO HOLD-WSAK-HI-ACCT-X.        02.68
090780     PERFORM T-710-VISA-ARD-CHECK
090790        THRU T-710-EXIT.
090800     IF INVALID-BIN-SW = 'Y'
              MOVE 33                    TO ER-CD(ER-INDX)
090960        GO TO T-200-IS-VISA-ERROR-2.
           IF NOT KDA-CHD-AR-IS-RSTRCT-USE-ATM                          02.81
              GO TO T-200-IS-VISA.                                      02.81
           IF NOT MR1-VALID-MIS3-TRAN                                   03.31
              GO TO T-200-IS-VISA-TRAN-ERROR.                           03.31
           IF NOT MR1-VALID-CASH                                        03.31
090910        GO TO T-200-IS-VISA-TRAN-ERROR.
090940     IF KDA-MRCH-TYP-ATM
090840        GO TO T-200-IS-VISA.
090910 T-200-IS-VISA-TRAN-ERROR.
           MOVE 34                       TO ER-CD(ER-INDX).
       T-200-IS-VISA-ERROR-2.
           MOVE 'V'                   TO WS-CARD-TYPE                   03.27
           MOVE 01                    TO PET-CARD-TYPE                  03.27
090960     GO TO T-200-ERROR-EXIT.
090970 T-200-IS-VISA.
005270     IF WS-MIS3-CARD-TYPE = SPACES
              MOVE 'V '                  TO WS-MIS3-CARD-TYPE           03.31
              IF MR1-VALID-MIS3-TRAN                                    03.31
                 MOVE WS-MIS3-CARD-TYPE  TO MIS3-CARD-TYPE              03.31
                                            RCL-1-CARD-TYPE             03.31
                 MOVE '?'                TO RCL-1-CARD-TYPE-ERR-IND     03.31
              ELSE                                                      03.31
                 MOVE WS-MIS3-CARD-TYPE  TO MIS1-CARD-TYPE              03.31
                                            RF1-1-CARD-TYPE             03.31
                 MOVE '?'                TO RF1-1-CARD-TYPE-ERR-IND     03.31
              END-IF                                                    03.31
           END-IF.                                                      03.31
161090     IF PET-CARD-TYPE NOT = ZERO
161080        GO TO T-200-IS-VISA-CHK-LGTH.
           IF KDA-VS-PID-IS-COMMERCIAL                                  03.27
              MOVE 21                    TO PET-CARD-TYPE               03.27
           ELSE                                                         03.27
              MOVE 01                    TO PET-CARD-TYPE               03.31
           END-IF.                                                      03.31
161080 T-200-IS-VISA-CHK-LGTH.
090990     IF INVALID-BIN-SW = 'V'
091000        IF (WSAK-ACCT-LEN = 00) AND
091010           (HLD-ACCT-LGTH = 13 OR 16)
091020              GO TO T-200-CK-13-OR-16
091030        ELSE
091040           IF WSAK-ACCT-LEN = HLD-ACCT-LGTH
                    GO TO T-200-CHECK-PRODUCT-ID                        02.81
091050**
091050**  ADDED AS TEMP FIX FOR CNB
091050**  THIS IS FOR PLUS BINS BECAUSE THE LENGTH ON THE EDIT FILE FOR
091050**  PLUS BINS IS THE MAX LENGTH INSTEAD OF AN ABSOLUTE LENGTH
091050**  LIKE REGULAR VISA BINS
091050**
091060           ELSE
091000              IF  (WSAK-ACCT-LEN = 19)
091010              AND (HLD-ACCT-LGTH < 19)
091050                 GO TO T-200-EXIT
091050** END ADD
091060              ELSE
091070                 MOVE 32              TO ER-CD (ER-INDX)
091080                 GO TO T-200-ERROR-EXIT.
091090     IF WSAK-ACCT-LEN = 16
091100        IF HLD-ACCT-LGTH = 16
                 GO TO T-200-CHECK-PRODUCT-ID                           02.81
091120        ELSE
091130           MOVE 32                 TO ER-CD (ER-INDX)
091140           GO TO T-200-ERROR-EXIT.
091150     IF WSAK-ACCT-LEN = 13
091160        IF WSL-HOLD-ZERO-POS-14-16 NOT = '000'
091170           MOVE 32                 TO ER-CD (ER-INDX)
091180           GO TO T-200-ERROR-EXIT
091190        ELSE
091200           MOVE 13                 TO HLD-ACCT-LGTH
                 GO TO T-200-CHECK-PRODUCT-ID.                          02.81
091150     IF WSAK-ACCT-LEN NOT = 19
091220        GO TO T-200-CK-13-OR-16.
091100     IF HLD-ACCT-LGTH NOT = 19
091220        GO TO T-200-CK-19-ERROR.
012240     IF WS-LEFT-ZERO-FILL-ACCT NOT NUMERIC
091220        GO TO T-200-CK-19-ERROR.
091250     IF WS-CHD-AR-MOD00
              GO TO T-200-CHECK-PRODUCT-ID.                             02.81
091270     MOVE +19                      TO CDA-CALL-LENGTH.
091280     MOVE WS-LEFT-ZERO-FILL-ACCT   TO CDA-ORG-ACCOUNT-NO.
091290     PERFORM T-250-COMP-CK-DGT
091300        THRU T-250-EXIT.
091310     IF INVALID-ACCT-SW = SPACE
              GO TO T-200-CHECK-PRODUCT-ID.                             02.81
091220 T-200-CK-19-ERROR.
091170     MOVE 32                       TO ER-CD (ER-INDX).
091180     GO TO T-200-ERROR-EXIT.
091220 T-200-CK-13-OR-16.
091230     IF WSAK-ACCT-LEN NOT = 00
091170        MOVE 32                    TO ER-CD (ER-INDX)
091240        GO TO T-200-ERROR-EXIT.
091250     IF NOT WS-CHD-AR-MOD-VALID
              MOVE 31                    TO ER-CD (ER-INDX)             02.60
091260        GO TO T-200-ERROR-EXIT.
091250     IF WS-CHD-AR-MOD00
              GO TO T-200-CHECK-PRODUCT-ID.                             02.81
091270     MOVE +16                      TO CDA-CALL-LENGTH.
091280     MOVE WSL-HOLD-ZERO-16         TO CDA-ORG-ACCOUNT-NO.
091290     PERFORM T-250-COMP-CK-DGT
091300        THRU T-250-EXIT.
091310     IF INVALID-ACCT-SW = SPACE
091320        MOVE 16                    TO HLD-ACCT-LGTH
              GO TO T-200-CHECK-PRODUCT-ID.                             02.81
091340     IF WSL-HOLD-ZERO-POS-14-16 NOT = '000'
091350        MOVE 32                    TO ER-CD (ER-INDX)
091360        GO TO T-200-ERROR-EXIT.
091380 T-200-CK-DGT-13.
091390     IF WSL-HOLD-ZERO-POS-14-16 = ZEROS
091400        MOVE +13                   TO CDA-CALL-LENGTH
091410        MOVE WSL-HOLD-ZERO-16      TO CDA-ORG-ACCOUNT-NO
091420        PERFORM T-250-COMP-CK-DGT
091430           THRU T-250-EXIT
              IF INVALID-ACCT-SW = 'Y'
                 MOVE 37                 TO ER-CD (ER-INDX)
                 GO TO T-200-ERROR-EXIT
              END-IF
           ELSE
              MOVE 'Y'                   TO INVALID-ACCT-SW
              MOVE 32                    TO ER-CD (ER-INDX)
              GO TO T-200-ERROR-EXIT
           END-IF.
091490     MOVE 13                       TO HLD-ACCT-LGTH.
      *
       T-200-CHECK-PRODUCT-ID.                                          02.81
      *
           MOVE KDA-VS-PRODUCT-ID        TO RVS-1-PROD-ID               03.04A
                                            RVS-1-PROD-ID-OUT.          03.04A
           IF NOT KDA-VS-VALID-PROD-ID                                  02.85
              MOVE WS-CHD-AR-PRODUCT-ID  TO KDA-VS-PRODUCT-ID           02.81
              MOVE '?'                   TO RVS-1-PROD-ID-ERR-IND       02.81
           END-IF.                                                      02.81
           MOVE KDA-VS-PRODUCT-ID        TO RVS-1-PROD-ID-OUT           03.04A
                                            PET-VS-PRODUCT-ID.          03.04A
      *
           IF MR1-VALID-RETURN                                          03.31
              GO TO T-200-EXIT.
      *
           IF NOT KDA-VS-VALID-PROD-ID
              MOVE ONE-AST               TO RVS-1-PROD-ID-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 225                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1
           END-IF.                                                      02.81
      *
           GO TO T-200-EXIT.
      *
091520 T-200-CHECK-MC.
089730     MOVE 16                       TO WSAK-ACCT-LEN.
033000     MOVE WSL-HOLD-ACCT-16         TO WS-MC-PREFIX-HIGH-BIN.
033000     MOVE '999'                    TO WS-MC-PREFIX-HIGH-BIN(17:3).
091540     PERFORM S-875-VALID-PREFIX
091550        THRU S-875-EXIT.
           IF BAS10002-INVALID-PRE-SW = 'Y'                             02.23
              IF VALID-MIS3-MC-CARD-TYPE
                 GO TO T-200-IS-MC-ERROR
              ELSE
                 GO TO T-200-CHECK-OTHER.
      *
           IF VALID-MIS3-SPACE                                          03.31
              SET VALID-MIS3-MC-CARD-TYPE                               03.31
                                         TO TRUE                        03.31
              IF MR1-VALID-MIS3-TRAN                                    03.31
                 MOVE WS-MIS3-CARD-TYPE  TO MIS3-CARD-TYPE              03.31
                                            RCL-1-CARD-TYPE             03.31
                 MOVE '?'                TO RCL-1-CARD-TYPE-ERR-IND     03.31
              ELSE                                                      03.31
                 MOVE WS-MIS3-CARD-TYPE  TO MIS1-CARD-TYPE              03.31
                                            RF1-1-CARD-TYPE             03.31
                 MOVE '?'                TO RF1-1-CARD-TYPE-ERR-IND     03.31
              END-IF                                                    03.31
           END-IF.                                                      03.31
           IF MR1-VALID-MIS3-TRAN                                       03.31
              MOVE MIS3-DATE             TO VD-MM-DD
                                            WS-MC-BANKNET-DATE          02.39
           ELSE
              MOVE MIS1-DATE-X           TO VD-MM-DD                    02.61
                                            WS-MC-BANKNET-DATE
           END-IF.
           IF MR1-VALID-MIS3-TRAN                                       03.31
              MOVE MIS3-MC-BANKNET-REF-NO                               02.53
                                         TO RMC-1-BANKNET-REF-IN        02.53
              IF MIS3-MC-BANKNET-REF-NO = ZEROS OR SPACES               02.53
                 MOVE '?'                TO RMC-1-BANKNET-REF-ERR-IND   02.39
              ELSE
                 MOVE MIS3-MC-BANKNET-REF-NO                            02.53
                                         TO WS-MC-BANKNET-REF-NO
              END-IF
              IF MIS3-MC-BANKNET-DATE = SPACES OR ZEROS                 02.53
                 MOVE VD-MM-DD           TO WS-MC-BANKNET-DATE
                 MOVE '?'                TO RMC-1-BANKNET-DT-ERR-IND
              ELSE
                 IF MIS3-MC-BANKNET-DATE NOT NUMERIC                    02.53
                    MOVE ONE-AST         TO RMC-1-BANKNET-DT-ERR-IND
                    MOVE 'Y'             TO PET-SUS-FLAG
                    MOVE 470             TO ER-CD-3-DIG (ER-INDX)
                    SET ER-INDX UP BY 1
                 ELSE
                    MOVE MIS3-MC-BANKNET-DATE                           02.53
                                         TO VD-MM-DD
                    PERFORM S-800-VALID-DATE
                       THRU S-800-EXIT
                    IF INVALID-DATE-SW = 'Y'
                       MOVE ONE-AST      TO RMC-1-BANKNET-DT-ERR-IND
                       SET WS-ARC-SET-E27 TO TRUE
                       MOVE 'Y'          TO PET-SUS-FLAG
                       MOVE 471          TO ER-CD-3-DIG (ER-INDX)
                       SET ER-INDX UP BY 1
                    ELSE
                       MOVE MIS3-MC-BANKNET-DATE                        02.53
                                         TO WS-MC-BANKNET-DATE-X
                    END-IF
                 END-IF
              END-IF
           END-IF.
      *                                                                 02.39
           IF WS-MC-BANKNET-REF-NO(1:1) = SPACE OR                      02.39
              WS-MC-BANKNET-REF-NO(2:1) = SPACE OR                      02.39
              WS-MC-BANKNET-REF-NO(3:1) = SPACE OR                      02.39
              WS-MC-BANKNET-REF-NO(4:1) = SPACE OR                      02.39
              WS-MC-BANKNET-REF-NO(5:1) = SPACE OR                      02.39
              WS-MC-BANKNET-REF-NO(6:1) = SPACE OR                      02.39
              WS-MC-BANKNET-REF-NO(7:1) = SPACE OR                      02.39
              WS-MC-BANKNET-REF-NO(8:1) = SPACE OR                      02.39
              WS-MC-BANKNET-REF-NO(9:1) = SPACE                         02.39
                 MOVE SPACES             TO WS-MC-BANKNET-REF-NO        02.39
                 MOVE ONE-AST            TO RMC-1-BANKNET-REF-ERR-IND   02.39
                 MOVE 469                TO ER-CD-3-DIG(ER-INDX)        02.39
                 GO TO T-200-IS-MC-ERROR-2                              02.39
           ELSE                                                         02.39
              MOVE WS-MC-BANKNET-REF-NO(1:3)                            02.39
                                         TO WS-CHD-ICA-REF-CARD-TYPE    02.39
           END-IF.                                                      02.39
      *                                                                 02.39
           IF WS-MC-BANKNET-DATE-X = ZEROS                              02.69
              MOVE HLD-WAO-MM-DD         TO WS-MC-BANKNET-DATE-X        02.69
              MOVE WS-BANKNET-REF-ALL-9S TO WS-MC-BANKNET-REF-NO        02.69
           END-IF.                                                      02.69
      *                                                                 02.69
           MOVE WS-CHD-ICA-REF-CARD-TYPE TO KDA-CHD-ICA-CARD-TYPE.      03.42M
      *                                                                 03.42M
           SET LP2P-INDX TO +1.                                         03.42M
           SEARCH WS-MC-LP2P-ENTRY                                      03.42M
             AT END                                                     03.42M
                MOVE 'N'                 TO WS-BANKNET-REF-FLAG         03.42M
             WHEN WS-MC-LP2P-PROD(LP2P-INDX) = SPACES                   03.42M
                MOVE 'N'                 TO WS-BANKNET-REF-FLAG         03.42M
             WHEN WS-MC-LP2P-PROD(LP2P-INDX) = KDA-CHD-ICA-CARD-TYPE    03.42M
                MOVE KDA-CHD-ICA-CARD-TYPE                              03.42M
                                         TO WS-CHD-ICA-PROC-CARD-TYPE   03.42M
                                            KDA-CHD-ICA-HEALTH-CARE     03.42M
                MOVE KDA-CHD-ICA-PREPAID TO WS-CHD-ICA-PROC-PREPAID     03.42M
                MOVE 'Y'                 TO WS-BANKNET-REF-FLAG         03.42M
                IF WS-MC-LP2P-CAT(LP2P-INDX) = 'D' OR 'P'               03.42M
                   MOVE 'D'              TO WS-MC-LP2P-ACCEPT-BRAND     03.42M
                ELSE                                                    03.42M
                   MOVE 'C'              TO WS-MC-LP2P-ACCEPT-BRAND     03.42M
                END-IF                                                  03.42M
           END-SEARCH.                                                  03.42M
      *                                                                 03.42M
      * IS BANKNET REF NO A VALID LICENSE PRODUCT?                      03.42M
      * IF NOT, ONLY VALID FOR STANDARD.                                03.42M
      *                                                                 03.42M
           IF NOT VALID-BANKNET-REF-CRD-TYP                             03.42M
              SET LP2P-INDX TO +1                                       03.42M
              SEARCH WS-MC-LP2P-ENTRY                                   03.42M
                AT END                                                  03.42M
                MOVE 'N'                 TO WS-BANKNET-REF-FLAG         03.42M
                WHEN WS-MC-LP2P-LIC(LP2P-INDX) = SPACES                 03.42M
                MOVE 'N'                 TO WS-BANKNET-REF-FLAG         03.42M
                WHEN WS-MC-LP2P-LIC(LP2P-INDX) =                        03.42M
                                            KDA-CHD-ICA-CARD-TYPE       03.42M
                   MOVE WS-MC-LP2P-PROD(LP2P-INDX)                      03.42M
                                         TO WS-CHD-ICA-PROC-CARD-TYPE   03.42M
                   MOVE KDA-CHD-ICA-CARD-TYPE                           03.42M
                                         TO KDA-CHD-ICA-HEALTH-CARE     03.42M
                   MOVE 'Y'              TO WS-BANKNET-REF-FLAG         03.42M
                   IF WS-MC-LP2P-CAT(LP2P-INDX) = 'D' OR 'P'            03.42M
                      MOVE 'D'           TO WS-MC-LP2P-ACCEPT-BRAND     03.42M
                   ELSE                                                 03.42M
                      MOVE 'C'           TO WS-MC-LP2P-ACCEPT-BRAND     03.42M
                   END-IF                                               03.42M
              END-SEARCH                                                03.42M
           END-IF.                                                      03.42M
      *                                                                 02.69
      * BANKNET REF NO HAS NO PRODUCT ID, ONLY VALID FOR STANDARD.      02.69
      *                                                                 02.69
           IF WS-MC-BANKNET-REF-NO = WS-BANKNET-REF-ALL-9S              02.69
              MOVE 'Y'                   TO KDA-CHD-STANDARD-ONLY       02.69
              IF MR1-VALID-CASH OR                                      03.31
                 MR1-VALID-RETURN                                       03.31
                    MOVE 'Y'             TO WS-BANKNET-REF-FLAG         03.31
              ELSE                                                      02.69
                 MOVE SPACES             TO WS-MC-BANKNET-REF-NO        02.69
              END-IF                                                    02.69
              COMPUTE SUB= +1                                           03.62M
              MOVE EFR-PRFX-ACC-BR(SUB)  TO WS-CHD-ICA-MPE-ACCEPT-BRAND 02.79
                                            WS-MC-ACCEPT-BRAND          03.62M
              MOVE EFR-PRFX-CARD-TYPE(SUB)                              02.79
                                         TO WS-CHD-ICA-MPE-CARD-TYPE    02.79
                                            WS-CHD-ICA-PROC-CARD-TYPE   02.69
                                            KDA-CHD-ICA-CARD-TYPE       02.69
                                            KDA-CHD-ICA-HEALTH-CARE     02.69
                                            ROD-MC-PRODUCT-ID-IN        02.69
              MOVE EFR-PRFX-ALM-DATE(SUB)                               02.79
                                         TO WS-MC-ACCT-LVL-DATE         02.79
              MOVE EFR-PRFX-PWCB-IND(SUB)                               02.79
                                         TO KDA-CHD-ICA-PWCB            02.79
              MOVE EFR-PRFX-PREPAID-IND(SUB)                            02.81
                                         TO KDA-CHD-ICA-PREPAID         02.81
                                            WS-CHD-ICA-MPE-PREPAID      02.81
                                            WS-CHD-ICA-PROC-PREPAID     02.81
                                            ROD-MC-PREPAID-IND          02.81
              MOVE EFR-PRFX-RATE-IND(SUB)                               02.79
                                         TO KDA-CHD-ICA-RATE-IND        02.79
              MOVE EFR-PRFX-PRODUCT-TYPE(SUB)                           02.79
                                         TO KDA-CHD-ICA-PRODUCT-TYPE    02.69
              MOVE EFR-PRFX-MAP-SVC-IND(SUB) TO RMC-3-MAP-SVC-IND       03.42M
                                                KDA-CHD-MAP-SVC-IND     03.50
              IF WS-MC-ACCT-LVL-DATE = +0                               02.69
                 MOVE '0'                TO ROD-MC-ALM-IND              02.69
              ELSE                                                      02.69
                 MOVE 'N'                TO ROD-MC-ALM-IND              02.69
                 MOVE '0'                TO WS-CHD-ICA-ACCT-CAT-TYP-VAL 03.11F
              END-IF                                                    02.69
              GO TO T-200-IS-MC                                         02.69
           END-IF.                                                      02.69
      *                                                                 02.69
           IF NOT VALID-BANKNET-REF-CRD-TYP                             02.69
              MOVE 'Y'                   TO KDA-CHD-STANDARD-ONLY       02.69
              IF MR1-VALID-CASH OR                                      03.31
                 MR1-VALID-RETURN                                       03.31
                    MOVE 'Y'             TO WS-BANKNET-REF-FLAG         03.31
              ELSE                                                      02.69
                 MOVE SPACES             TO WS-MC-BANKNET-REF-NO        02.69
              END-IF                                                    02.69
              MOVE EFR-PRFX-ACC-BR(1)    TO WS-CHD-ICA-MPE-ACCEPT-BRAND 02.69
                                            WS-MC-ACCEPT-BRAND          02.69
              MOVE EFR-PRFX-CARD-TYPE(1) TO WS-CHD-ICA-MPE-CARD-TYPE    02.69
                                            WS-CHD-ICA-PROC-CARD-TYPE   02.69
                                            KDA-CHD-ICA-CARD-TYPE       02.69
                                            KDA-CHD-ICA-HEALTH-CARE     02.69
                                            ROD-MC-PRODUCT-ID-IN        02.69
              MOVE EFR-PRFX-ALM-DATE(1)  TO WS-MC-ACCT-LVL-DATE         02.69
              MOVE EFR-PRFX-PWCB-IND(1)  TO KDA-CHD-ICA-PWCB            02.69
              MOVE EFR-PRFX-PREPAID-IND(1)                              02.81
                                         TO KDA-CHD-ICA-PREPAID         02.81
                                            WS-CHD-ICA-MPE-PREPAID      02.81
                                            WS-CHD-ICA-PROC-PREPAID     02.81
              MOVE EFR-PRFX-RATE-IND(1)  TO KDA-CHD-ICA-RATE-IND        02.69
              MOVE EFR-PRFX-PRODUCT-TYPE(1)                             02.69
                                         TO KDA-CHD-ICA-PRODUCT-TYPE    02.69
              MOVE EFR-PRFX-MAP-SVC-IND(1) TO RMC-3-MAP-SVC-IND         03.42M
                                              KDA-CHD-MAP-SVC-IND       03.50
              IF WS-MC-ACCT-LVL-DATE = +0                               02.69
                 MOVE '0'                TO ROD-MC-ALM-IND              02.69
              ELSE                                                      02.69
                 MOVE 'N'                TO ROD-MC-ALM-IND              02.69
                 MOVE '0'                TO WS-CHD-ICA-ACCT-CAT-TYP-VAL 03.11F
              END-IF                                                    02.69
              IF MR1-VALID-CASH                                         03.31
                 MOVE WS-BANKNET-REF-ALL-9S                             02.69
                                         TO WS-MC-BANKNET-REF-NO        02.69
                 MOVE HLD-WAO-MM-DD      TO WS-MC-BANKNET-DATE-X        02.69
                 IF MR1-VALID-MIS3-TRAN                                 03.31
                    MOVE '?'             TO RMC-1-BANKNET-REF-ERR-IND   02.69
                                            RMC-1-BANKNET-DT-ERR-IND    02.69
                 END-IF                                                 02.69
              ELSE                                                      02.69
                 MOVE SPACES             TO WS-MC-BANKNET-REF-NO        02.69
                 IF VALID-CHD-ICA-ACCT-CAT                              02.69
                    MOVE ONE-AST         TO RMC-1-BANKNET-REF-ERR-IND   02.69
                                            RCL-2-AUTH-CODE-ERR-IND     02.69
                    MOVE 463             TO ER-CD-3-DIG(ER-INDX)        02.69
                    GO TO T-200-IS-MC-ERROR-2                           02.69
                 END-IF                                                 02.69
              END-IF                                                    02.69
              GO TO T-200-IS-MC                                         02.69
           END-IF.                                                      02.69
      *                                                                 02.69
           MOVE +1                       TO EFR-SUB.                    02.71
      *    CHECK IF CARD TYPE IS DEFINED                                02.69
           IF EFR-PRFX-CARD-TYPE(1) = KDA-CHD-ICA-CARD-TYPE             02.69
              MOVE +1                    TO EFR-SUB                     02.69
              GO TO T-200-PREFIX-SET                                    02.69
           END-IF.                                                      02.69
           IF EFR-PRFX-CARD-TYPE(2) = KDA-CHD-ICA-CARD-TYPE             02.69
              MOVE +2                    TO EFR-SUB                     02.69
              GO TO T-200-PREFIX-SET                                    02.69
           END-IF.                                                      02.69
      *    CHECK IF ACCEPT BRAND IS DEFINED                             02.69
           IF WS-MC-LP2P-ACCEPT-BRAND NOT = SPACE                       02.69
              IF EFR-PRFX-ACC-BR(1) = WS-MC-LP2P-ACCEPT-BRAND           02.69
                 MOVE EFR-PRFX-CARD-TYPE(1)                             02.69
                                         TO KDA-CHD-ICA-CARD-TYPE       02.69
                 MOVE EFR-PRFX-PREPAID-IND(1)                           02.81
                                         TO KDA-CHD-ICA-PREPAID         02.81
                 MOVE +1                 TO EFR-SUB                     02.69
                 GO TO T-200-PREFIX-SET                                 02.69
              END-IF                                                    02.69
              IF EFR-PRFX-ACC-BR(2) = WS-MC-LP2P-ACCEPT-BRAND           02.69
                 MOVE EFR-PRFX-CARD-TYPE(2)                             02.69
                                         TO KDA-CHD-ICA-CARD-TYPE       02.69
                 MOVE EFR-PRFX-PREPAID-IND(2)                           02.81
                                         TO KDA-CHD-ICA-PREPAID         02.81
                 MOVE +2                 TO EFR-SUB                     02.69
                 GO TO T-200-PREFIX-SET                                 02.69
              END-IF                                                    02.69
           END-IF.                                                      02.69
      *                                                                 02.69
       T-200-PREFIX-SET.                                                02.69
      *                                                                 02.69
           MOVE EFR-PRFX-ACC-BR(EFR-SUB) TO WS-CHD-ICA-MPE-ACCEPT-BRAND 02.69
                                            WS-MC-ACCEPT-BRAND.         02.69
           MOVE EFR-PRFX-CARD-TYPE(EFR-SUB)                             02.69
                                         TO WS-CHD-ICA-MPE-CARD-TYPE.   02.69
           MOVE EFR-PRFX-ALM-DATE(EFR-SUB)                              02.69
                                         TO WS-MC-ACCT-LVL-DATE.        02.69
           MOVE EFR-PRFX-PWCB-IND(EFR-SUB)                              02.69
                                         TO KDA-CHD-ICA-PWCB.           02.69
           MOVE EFR-PRFX-PREPAID-IND(EFR-SUB)                           02.81
                                         TO WS-CHD-ICA-MPE-PREPAID.     02.81
           MOVE EFR-PRFX-RATE-IND(EFR-SUB)                              02.69
                                         TO KDA-CHD-ICA-RATE-IND.       02.69
           MOVE EFR-PRFX-PRODUCT-TYPE(EFR-SUB)                          02.69
                                         TO KDA-CHD-ICA-PRODUCT-TYPE.   02.69
           MOVE EFR-PRFX-MAP-SVC-IND(EFR-SUB) TO RMC-3-MAP-SVC-IND      03.50
                                                 KDA-CHD-MAP-SVC-IND.   03.50
      *                                                                 02.39
           IF WS-MC-ACCT-LVL-DATE = +0                                  02.39
              MOVE '0'                   TO ROD-MC-ALM-IND              02.39
                                            WS-CHD-ICA-ACCT-CAT-TYP-VAL 03.11F
              MOVE WS-CHD-ICA-MPE-CARD-TYPE                             02.39
                                         TO ROD-MC-PRODUCT-ID-IN        02.39
                                            WS-CHD-ICA-PROC-CARD-TYPE   02.39
                                            KDA-CHD-ICA-CARD-TYPE       02.39
                                            KDA-CHD-ICA-HEALTH-CARE     02.39
              MOVE WS-CHD-ICA-MPE-PREPAID                               02.81
                                         TO ROD-MC-PREPAID-IND          02.81
                                            KDA-CHD-ICA-PREPAID         02.81
                                            WS-CHD-ICA-PROC-PREPAID     02.81
              MOVE WS-CHD-ICA-MPE-ACCEPT-BRAND                          02.39
                                         TO WS-MC-ACCEPT-BRAND          02.39
              GO TO T-200-IS-MC                                         02.40
           END-IF.                                                      02.39
      *                                                                 02.39
           MOVE WS-MC-ACCT-LVL-DATE      TO KDA-MC-ACCT-LVL-DATE.       02.39
           PERFORM S-807-CHECK-ALM                                      02.39
              THRU S-807-EXIT.                                          02.39
           IF ERROR-FOUND                                               02.39
              MOVE 'N'                   TO ROD-MC-ALM-IND              02.39
              MOVE WS-CHD-ICA-MPE-CARD-TYPE                             02.39
                                         TO WS-CHD-ICA-PROC-CARD-TYPE   02.39
                                            KDA-CHD-ICA-HEALTH-CARE     02.39
              MOVE WS-CHD-ICA-MPE-PREPAID                               02.81
                                         TO WS-CHD-ICA-PROC-PREPAID     02.81
                                            ROD-MC-PREPAID-IND          02.81
              MOVE WS-CHD-ICA-MPE-ACCEPT-BRAND                          02.39
                                         TO WS-MC-ACCEPT-BRAND          02.39
              MOVE '0'                   TO WS-CHD-ICA-ACCT-CAT-TYP-VAL 03.11F
           ELSE                                                         02.39
              MOVE 'Y'                   TO ROD-MC-ALM-IND              02.39
              MOVE WS-CHD-ICA-PROC-PREPAID                              02.81
                                         TO ROD-MC-PREPAID-IND          02.81
           END-IF.                                                      02.39
      *                                                                 02.39
           MOVE WS-CHD-ICA-MPE-CARD-TYPE TO ROD-MC-PRODUCT-ID-IN.       02.39
           MOVE WS-CHD-ICA-PROC-CARD-TYPE                               02.39
                                         TO KDA-CHD-ICA-CARD-TYPE.      02.39
      *                                                                 02.39
           IF ROD-MC-ALM-IND NOT = 'Y'                                  02.39
              MOVE WS-CHD-ICA-MPE-CARD-TYPE                             02.39
                                         TO WS-CHD-ICA-PROC-CARD-TYPE   02.39
                                            KDA-CHD-ICA-HEALTH-CARE     02.39
              MOVE WS-CHD-ICA-MPE-PREPAID                               02.81
                                         TO WS-CHD-ICA-PROC-PREPAID     02.81
              MOVE WS-CHD-ICA-MPE-ACCEPT-BRAND                          02.39
                                         TO WS-MC-ACCEPT-BRAND          02.39
              GO TO T-200-IS-MC.                                        02.39
      *                                                                 02.39
           IF NOT VALID-CHD-ICA-ACCT-CAT-TYP                            02.39
              IF VALID-CHD-ICA-ACCT-BUS-LVL                             03.11F
                 MOVE WS-CHD-ICA-ACCT-CAT-TYP-VAL                       03.11F
                                         TO KDA-CHD-BUS-LVL-SW          03.11F
              END-IF                                                    03.11F
              MOVE WS-CHD-ICA-MPE-CARD-TYPE                             02.39
                                         TO WS-CHD-ICA-PROC-CARD-TYPE   02.39
                                            KDA-CHD-ICA-HEALTH-CARE     02.39
              MOVE WS-CHD-ICA-MPE-PREPAID                               02.81
                                         TO WS-CHD-ICA-PROC-PREPAID     02.81
              MOVE WS-CHD-ICA-MPE-ACCEPT-BRAND                          02.39
                                         TO WS-MC-ACCEPT-BRAND          02.39
              GO TO T-200-IS-MC.                                        02.39
      *                                                                 02.39
           MOVE WS-CHD-ICA-ACCT-CAT-TYP-VAL                             02.39
                                         TO WS-MC-PGT-SEARCH(1:1).      02.39
           MOVE WS-CHD-ICA-PROC-CARD-TYPE                               02.39
                                         TO WS-MC-PGT-SEARCH(2:3).      02.39
      *                                                                 02.39
           IF KDA-CHD-ICA-IS-MC-BCFPCARD                                02.95
              IF WS-BATCH-ICA-REGN = '1'  AND                           02.95
                 WS-CHD-ICA-REGN = '1' AND                              02.95
                 VALID-CHD-ICA-ACCT-BUS-LVL                             02.95
                 IF NOT WS-CHD-ICA-IS-MC-BUS-LVL                        02.95
                    MOVE 465             TO ER-CD-3-DIG(ER-INDX)        02.95
                    MOVE ONE-AST         TO RMC-2-ACCEPT-BRND-ERR-IND   02.95
                    GO TO T-200-IS-MC-ERROR-2                           02.95
                 ELSE                                                   02.95
                    IF VALID-CHD-ICA-ACCT-CAT-GRD                       02.95
                       SET PGT-INDX TO +1                               02.95
                       SEARCH WS-MC-PGT-ENTRY                           02.95
                         AT END                                         02.95
                            MOVE WS-CHD-ICA-MPE-CARD-TYPE               02.95
                                         TO WS-CHD-ICA-PROC-CARD-TYPE   02.95
                            MOVE WS-CHD-ICA-MPE-PREPAID                 02.95
                                         TO WS-CHD-ICA-PROC-PREPAID     02.95
                         WHEN WS-MC-PGT-CAT-LIC(PGT-INDX) = SPACES      02.95
                            MOVE WS-CHD-ICA-MPE-CARD-TYPE               02.95
                                         TO WS-CHD-ICA-PROC-CARD-TYPE   02.95
                            MOVE WS-CHD-ICA-MPE-PREPAID                 02.95
                                         TO WS-CHD-ICA-PROC-PREPAID     02.95
                         WHEN WS-MC-PGT-CAT-LIC(PGT-INDX) =             02.95
                                            WS-MC-PGT-SEARCH            02.95
                            MOVE WS-CHD-ICA-ACCT-CAT-TYP-VAL            02.95
                                         TO KDA-CHD-BUS-LVL-SW          02.95
                       END-SEARCH                                       02.95
                    ELSE                                                02.95
                       IF WS-CHD-ICA-MPE-CARD-TYPE =                    02.95
                                            WS-CHD-ICA-PROC-CARD-TYPE   02.95
                          MOVE WS-CHD-ICA-ACCT-CAT-TYP-VAL              02.95
                                         TO KDA-CHD-BUS-LVL-SW          02.95
                       ELSE                                             02.95
                          MOVE 467       TO ER-CD-3-DIG(ER-INDX)        02.95
                          MOVE ONE-AST   TO ROD-MC-PRODUCT-ID-ERR-IND   02.95
                          GO TO T-200-IS-MC-ERROR-2                     02.95
                       END-IF                                           02.95
                    END-IF                                              02.95
                    GO TO T-200-IS-MC                                   02.95
                 END-IF                                                 02.95
              END-IF                                                    02.95
           END-IF.                                                      02.95
      *                                                                 02.48
           IF WS-BATCH-ICA-REGN = '1'  AND                              02.41
              WS-CHD-ICA-REGN = '1' AND                                 02.41
              VALID-CHD-ICA-ACCT-CAT-ENH                                02.41
              IF NOT WS-CHD-ICA-IS-MC-ENHANCED                          02.39
                 MOVE 465                TO ER-CD-3-DIG(ER-INDX)        02.39
                 MOVE ONE-AST            TO RMC-2-ACCEPT-BRND-ERR-IND   02.39
                 GO TO T-200-IS-MC-ERROR-2                              02.39
              ELSE                                                      02.39
                 MOVE 'Y'                TO KDA-CHD-ENHANCED            02.39
                 SET PGT-INDX TO +1                                     02.39
                 SEARCH WS-MC-PGT-ENTRY                                 02.39
                   AT END                                               02.39
                      MOVE WS-CHD-ICA-MPE-CARD-TYPE                     02.39
                                         TO WS-CHD-ICA-PROC-CARD-TYPE   02.39
                      MOVE WS-CHD-ICA-MPE-PREPAID                       02.81
                                         TO WS-CHD-ICA-PROC-PREPAID     02.81
                   WHEN WS-MC-PGT-CAT-LIC(PGT-INDX) = SPACES            02.39
                      MOVE WS-CHD-ICA-MPE-CARD-TYPE                     02.39
                                         TO WS-CHD-ICA-PROC-CARD-TYPE   02.39
                      MOVE WS-CHD-ICA-MPE-PREPAID                       02.81
                                         TO WS-CHD-ICA-PROC-PREPAID     02.81
                   WHEN WS-MC-PGT-CAT-LIC(PGT-INDX) =                   02.39
                                            WS-MC-PGT-SEARCH            02.39
                      NEXT SENTENCE                                     02.39
                 END-SEARCH                                             02.39
              END-IF                                                    02.39
           END-IF.                                                      02.39
      *                                                                 02.39
           IF WS-BATCH-ICA-REGN = '1'  AND                              02.41
              WS-CHD-ICA-REGN = '1' AND                                 02.41
              VALID-CHD-ICA-ACCT-CAT-HGH                                02.41
              IF NOT WS-CHD-ICA-IS-MC-HIGH-VALUE                        02.39
                 MOVE 464                TO ER-CD-3-DIG(ER-INDX)        02.39
                 MOVE ONE-AST            TO RMC-2-ACCEPT-BRND-ERR-IND   02.39
                 GO TO T-200-IS-MC-ERROR-2                              02.39
              ELSE                                                      02.39
                 IF VALID-CHD-ICA-ACCT-CAT-GRD                          02.39
                    SET PGT-INDX TO +1                                  02.39
                    SEARCH WS-MC-PGT-ENTRY                              02.39
                      AT END                                            02.39
                         MOVE WS-CHD-ICA-MPE-CARD-TYPE                  02.39
                                         TO WS-CHD-ICA-PROC-CARD-TYPE   02.39
                         MOVE WS-CHD-ICA-MPE-PREPAID                    02.81
                                         TO WS-CHD-ICA-PROC-PREPAID     02.81
                      WHEN WS-MC-PGT-CAT-LIC(PGT-INDX) = SPACES         02.39
                         MOVE WS-CHD-ICA-MPE-CARD-TYPE                  02.39
                                         TO WS-CHD-ICA-PROC-CARD-TYPE   02.39
                         MOVE WS-CHD-ICA-MPE-PREPAID                    02.81
                                         TO WS-CHD-ICA-PROC-PREPAID     02.81
                      WHEN WS-MC-PGT-CAT-LIC(PGT-INDX) =                02.39
                                            WS-MC-PGT-SEARCH            02.39
                         MOVE 'Y'        TO KDA-CHD-HIGH-VALUE          02.39
                    END-SEARCH                                          02.39
                 ELSE                                                   02.39
                    IF WS-CHD-ICA-MPE-CARD-TYPE =                       02.39
                                            WS-CHD-ICA-PROC-CARD-TYPE   02.39
                       MOVE 'Y'          TO KDA-CHD-HIGH-VALUE          02.39
                    ELSE                                                02.39
                       MOVE 467          TO ER-CD-3-DIG(ER-INDX)        02.39
                       MOVE ONE-AST      TO ROD-MC-PRODUCT-ID-ERR-IND   02.95
                       GO TO T-200-IS-MC-ERROR-2                        02.39
                    END-IF                                              02.39
                 END-IF                                                 02.39
              END-IF                                                    02.39
           END-IF.                                                      02.39
      *                                                                 02.39
           IF WS-BATCH-ICA-REGN = '1'  AND                              02.61
              WS-CHD-ICA-REGN = '1' AND                                 02.61
              VALID-CHD-ICA-ACCT-WEL-RED                                02.61
              IF KDA-CHD-ICA-CARD-TYPE = 'MCW'                          03.43
      *          TRAN NEED TO QUAL AS ENHANCED (NOT WORLD)              03.43
                 MOVE 'Y'                TO KDA-CHD-ENHANCED            03.43
                 MOVE 'MCC'              TO WS-CHD-ICA-PROC-CARD-TYPE   03.43
                 GO TO T-200-IS-MC                                      03.43
              END-IF                                                    03.43
              IF KDA-CHD-ICA-CARD-TYPE = 'MWE'                          02.65
                 MOVE 'MCW'              TO WS-CHD-ICA-PROC-CARD-TYPE   02.65
              ELSE                                                      02.62
                 MOVE 472                TO ER-CD-3-DIG(ER-INDX)        02.61
                 MOVE ONE-AST            TO RMC-2-ACCEPT-BRND-ERR-IND   02.61
                 GO TO T-200-IS-MC-ERROR-2                              02.61
              END-IF                                                    02.61
           END-IF.                                                      02.61
      *                                                                 02.61
           GO TO T-200-IS-MC.
      *
091600 T-200-IS-MC-ERROR.
           MOVE 33                       TO ER-CD(ER-INDX).
       T-200-IS-MC-ERROR-2.
           MOVE 'M'                      TO WS-CARD-TYPE.
           MOVE 02                       TO PET-CARD-TYPE.
           MOVE 'Y'                      TO PET-SUS-FLAG.               02.39
091480     GO TO T-200-ERROR-EXIT.
091600 T-200-IS-MC.
           IF WS-MC-ACCEPT-BRAND = 'D'                                  02.39
              MOVE 'DMC'                 TO KDA-CHD-ICA-ACCEPT-BRAND    02.39
           ELSE                                                         02.39
              MOVE 'MCC'                 TO KDA-CHD-ICA-ACCEPT-BRAND    02.39
           END-IF.                                                      02.39
           MOVE WS-CHD-ICA-PROC-CARD-TYPE                               02.39
                                         TO KDA-CHD-ICA-CARD-TYPE.      02.39
           MOVE WS-CHD-ICA-PROC-PREPAID  TO KDA-CHD-ICA-PREPAID.        02.81
           IF PET-CARD-TYPE = ZERO
              MOVE 02                    TO PET-CARD-TYPE.
005270     IF WS-MIS3-CARD-TYPE = SPACES
005270        MOVE 'M '                  TO WS-MIS3-CARD-TYPE.
           IF HLD-ACCT-LGTH = 14
              IF KDA-BATCH-ICA-CLEAR-REGN-X = '01' AND
                 WSL-HOLD-ACCT-16(1:2) = '36'
                    NEXT SENTENCE
              ELSE
                 MOVE 32                 TO ER-CD (ER-INDX)
                 GO TO T-200-ERROR-EXIT
              END-IF
           ELSE
           IF HLD-ACCT-LGTH NOT = 16
              MOVE 32                    TO ER-CD (ER-INDX)
              GO TO T-200-ERROR-EXIT.
091650     GO TO T-200-EXIT.
091510*
091660 T-200-CHECK-DS.
005880     MOVE WSL-HOLD-ZERO-16(1:8)    TO WS-CHD-DIS-ACCT-NO-RANGE-X.
           PERFORM S-890-VALID-DS-PREFIX
              THRU S-890-EXIT.
           IF BAS10002-INVALID-PRE-SW = 'Y'                             02.23
              GO TO T-200-IS-DS-ERROR.
       T-200-VALID-DS-PREFIX.                                           03.31
           IF HLD-ACCT-LGTH < EFR-DS-PAN-LNGTH-MIN OR                   02.39
              HLD-ACCT-LGTH > EFR-DS-PAN-LNGTH-MAX                      02.39
                 MOVE 32                 TO ER-CD(ER-INDX)              02.39
                 MOVE 'Y'                TO PET-SUS-FLAG                03.14
                 GO TO T-200-ERROR-EXIT                                 02.39
           END-IF.                                                      02.39
           MOVE HLD-ACCT-LGTH            TO CDA-CALL-LENGTH.            02.39
           MOVE WSL-HOLD-ZERO-16         TO CDA-ORG-ACCOUNT-NO.         02.39
           PERFORM T-250-COMP-CK-DGT                                    02.39
              THRU T-250-EXIT.                                          02.39
           IF INVALID-ACCT-SW = 'Y'                                     02.39
              MOVE 37                    TO ER-CD(ER-INDX)              02.39
              MOVE 'Y'                   TO PET-SUS-FLAG                03.14
              GO TO T-200-ERROR-EXIT                                    02.39
           END-IF.                                                      02.39
           MOVE EFR-DS-CARD-PRODUCT      TO KDA-CHD-DS-PRODUCT-TYPE-X.  02.61
           MOVE KDA-CHD-DS-PRODUCT-TYPE-X                               02.61
                                         TO ROD-DS-PRODUCT-TYP-IN.      02.61
           MOVE EFR-DS-ALP-ENABLED       TO ROD-DS-ALP-IND.             02.48
                                                                        02.95
      * IF CARD TYPE OF 'PP' SENT IN FROM FRONT END THEN PREFIX ON IIN  03.47
      * MUST BE TAGGED AS A PAYPAL ACCT RANGE.                          03.47
           IF WS-MIS3-CARD-TYPE = 'PP' AND                              03.47
           NOT KDA-CHD-IS-DS-NET-PAYPAL                                 03.47
               MOVE 34                 TO ER-CD(ER-INDX)                03.47
               SET ER-INDX UP BY 1                                      03.47
               GO TO T-200-EXIT.                                        03.47
                                                                        03.47
           IF KDA-CHD-IS-DS-NET-PAYPAL                                  03.47
              IF WS-FE-PP-SW = 'Y'                                      03.47
                 IF MR1-VALID-MIS3-TRAN                                 03.47
                    MOVE 'PP'        TO MIS3-CARD-TYPE                  03.47
                 ELSE                                                   03.47
                    MOVE 'PP'        TO MIS1-CARD-TYPE                  03.47
                 END-IF                                                 03.47
                 MOVE 'PP'           TO WS-MIS3-CARD-TYPE               03.47
                                        PET-MIS3-CARD-TYPE              03.47
                 IF WS-MRCH-IS-DIS-SETL                                 03.47
                    MOVE 48          TO PET-CARD-TYPE                   03.47
                 ELSE                                                   03.47
                    MOVE 08          TO PET-CARD-TYPE                   03.47
                 END-IF                                                 03.47
              END-IF                                                    03.47
              GO TO T-200-IS-DISCOVER.                                  03.47
                                                                        03.47
           IF EFR-DS-ALP-ENABLED NOT = 'Y'                              02.48
              GO TO T-200-IS-DISCOVER                                   02.48
           END-IF.                                                      02.48
           EVALUATE WS-CHD-DS-ACCT-PROD-TYP-VAL                         02.48
              WHEN 'C'                                                  02.48
                 MOVE '008'              TO KDA-CHD-DS-PRODUCT-TYPE-X   02.48
              WHEN 'R'                                                  02.48
                 MOVE '001'              TO KDA-CHD-DS-PRODUCT-TYPE-X   02.48
              WHEN 'P'                                                  02.48
                 MOVE '007'              TO KDA-CHD-DS-PRODUCT-TYPE-X   02.48
              WHEN 'B'                                                  02.48
                 MOVE '002'              TO KDA-CHD-DS-PRODUCT-TYPE-X   02.48
              WHEN 'E'                                                  02.52
                 MOVE '010'              TO KDA-CHD-DS-PRODUCT-TYPE-X   02.52
              WHEN 'Q'                                                  02.52
                 MOVE '011'              TO KDA-CHD-DS-PRODUCT-TYPE-X   02.52
              WHEN OTHER                                                02.48
                 MOVE '0'                TO ROD-DS-ALP-IND              02.48
           END-EVALUATE.                                                02.48
       T-200-IS-DISCOVER.
           MOVE KDA-CHD-DS-PRODUCT-TYPE-X                               02.61
                                         TO ROD-DS-PRODUCT-TYP-OUT.     02.61
           IF PET-CARD-TYPE = ZERO
              IF KDA-CHD-IS-DS-NET-PAYPAL                               03.47
                 MOVE 08                 TO PET-CARD-TYPE               03.47
              ELSE                                                      03.47
                 MOVE 05                 TO PET-CARD-TYPE               03.47
              END-IF                                                    03.47
           END-IF.
           GO TO T-200-EXIT.
       T-200-IS-DS-ERROR.
           MOVE 33                       TO ER-CD(ER-INDX).
           GO TO T-200-ERROR-EXIT.
091510*
091660 T-200-CHECK-OTHER.
005270     IF WS-MIS3-CARD-TYPE = SPACES
              MOVE 33                    TO ER-CD(ER-INDX)
091700        GO TO T-200-ERROR-EXIT.
003390     IF VALID-MIS3-VISA-MC-CARD-TYPE
              MOVE 35                    TO ER-CD(ER-INDX)              02.60
091700        GO TO T-200-ERROR-EXIT.
           IF VALID-MIS3-DB-CARD-TYPE OR                                02.64
              VALID-MIS3-EB-CARD-TYPE                                   02.64
                 GO TO T-200-EXIT.                                      02.64
           GO TO T-200-CHECK-PD-NET.                                    03.00
       T-200-CHECK-AMEX.
           IF NOT PET-CARD-TYPE-AMEX
              GO TO T-200-EXIT.
           MOVE WSL-HOLD-ZERO-16(1:6)    TO WS-CHD-AMEX-ACCT-NO-RANGE-X.
           IF NOT VALID-CHD-AMEX-ACCT-NO-RANGE
              MOVE 33                    TO ER-CD(ER-INDX)
              GO TO T-200-ERROR-EXIT.                                   03.65
       T-200-VALID-AMEX-RANGE.                                          03.31
           IF HLD-ACCT-LGTH = 15
              IF PET-CARD-TYPE = ZERO
                 MOVE 04                 TO PET-CARD-TYPE
              END-IF
              PERFORM S-895-VALID-AX-PREFIX                             02.72
                 THRU S-895-EXIT                                        02.72
              GO TO T-200-EXIT.
           MOVE 32                       TO ER-CD (ER-INDX).
           GO TO T-200-ERROR-EXIT.
       T-200-CHECK-PD-NET.
           IF (PET-CARD-TYPE-PL AND                                     02.29
               KDA-CHD-IS-VALID-PD)                                     02.29
                 IF PET-CARD-TYPE = ZERO                                02.29
                    MOVE 03              TO PET-CARD-TYPE               02.29
                 END-IF                                                 02.29
                 GO TO T-200-EXIT                                       02.29
           END-IF.                                                      02.29
           MOVE 35                       TO ER-CD (ER-INDX).            02.50
091740 T-200-ERROR-EXIT.
091750     MOVE 'Y'                      TO INVALID-ACCT-SW.
PROMST     SET  WS-ARC-SET-E07           TO TRUE.
091760     SET ER-INDX UP BY 1.
091770*
091780 T-200-EXIT.
091790     EXIT.
091800*
091810 T-250-COMP-CK-DGT.
091820*
091830*  CHECK DIGIT ACCT NUMBERS
091840*
089730     MOVE SPACE                    TO INVALID-ACCT-SW.
091850     MOVE '4'                 TO CDA-CALL-TYPE.
091860     MOVE ZEROS               TO CDA-INSTITUTION.
091870*
091880     CALL CALL-BASCKDGT USING CHECK-DIGIT-AREA.
091890*
091900     IF CDA-ERROR-CODE NOT = ZERO
PROMST        SET  WS-ARC-SET-E07        TO TRUE
091910        MOVE 'Y'                   TO INVALID-ACCT-SW.
091920 T-250-EXIT.
091930     EXIT.
091940*
091950 T-300-ACCT-LEFT-SHIFT.
091960*
091970*     LEFT-SHIFT ACCOUNT NUMBER, CHECK FOR FIRST NON-ZERO
091980*     POSITION AND SET THE ACCOUNT LENGTH. IF ACCOUNT
091990*     NUMBER IS VALID, ROUTINE WILL RETURN LEFT-SHIFTED NUMBER
092000*     IN WS-LEFT-SHIFT-NUM; IF INVALID, THE NUMBER AS INPUT WILL
092010*     BE RETURNED IN WS-LEFT-SHIFT-NUM
092020*
092030     MOVE SPACE                    TO INVALID-BIN-SW.
092040     MOVE SPACES                   TO WS-LEFT-SHIFT-NUM.
092050     MOVE ZEROS                    TO WS-LEFT-ZERO-NUM.
092060     MOVE HLD-ACCOUNT-IN           TO WCA-ACCT-16.
092070     MOVE HLD-ACCOUNT-IN-EXT-3-X   TO WCA-ACCT-17-19.
092090     MOVE +0                       TO SUB.
092100     MOVE ZEROS                    TO HLD-ACCT-LGTH.
092110     IF KDA-BATCH-ATM-SETTLE-MC
092210        MOVE 'M'                   TO INVALID-BIN-SW
092120        GO TO T-300-DROP-LEAD-ZEROS.
092110     IF KDA-BATCH-ATM-SETTLE-PLUS
092110     OR KDA-BATCH-ATM-SETTLE-VISA
092110     OR KDA-BATCH-ATM-SETTLE-VISA-ONLY
092110        NEXT SENTENCE
092110     ELSE
092120        GO TO T-300-DROP-LEAD-ZEROS.
           MOVE WCA-ACCT-16              TO HOLD-WSAK-HI-ACCT-X.        02.68
           PERFORM                                                      02.68
             VARYING SUB FROM +1 BY +1                                  02.68
             UNTIL   SUB > +16                                          02.68
               IF HOLD-WSAK-HI-ACCT(SUB:1) = SPACE                      02.68
                  MOVE ZERO              TO HOLD-WSAK-HI-ACCT-X(SUB:1)  02.68
               END-IF                                                   02.68
           END-PERFORM.                                                 02.68
092140     PERFORM T-710-VISA-ARD-CHECK
092150        THRU T-710-EXIT.
092160     IF INVALID-BIN-SW = 'Y' AND
092110        KDA-BATCH-ATM-SETTLE-VISA-ONLY
              MOVE 33                    TO ER-CD(ER-INDX)
092450        GO TO T-300-ACCT-ERROR.
092160     IF INVALID-BIN-SW = 'Y'
092170        MOVE 'P'                   TO KDA-BATCH-ATM-SETTLE-NET
092180        MOVE '1 '                  TO WS-CHD-AR-CHECK-DIG-ALGO
           END-IF.                                                      02.81
092210     MOVE 'V'                      TO INVALID-BIN-SW.
092220     MOVE +1                       TO SUB
092230                                      SUB1.
092240     GO TO T-300-MOVE-AS-IS-LOOP.
092250 T-300-DROP-LEAD-ZEROS.
092260     ADD +1                        TO SUB.
092270     IF SUB > +19
              MOVE 32                    TO ER-CD (ER-INDX)
092280        GO TO T-300-ACCT-ERROR.
092290     IF WS-CK-ACCNUM (SUB) = '0'
092300        GO TO T-300-DROP-LEAD-ZEROS.
092310     MOVE +1                       TO SUB1.
092320 T-300-MOVE-AS-IS-LOOP.
092330     IF SUB > +19
092340        GO TO T-300-EXIT.
092350     IF WS-CK-ACCNUM (SUB) NOT NUMERIC
092360        GO TO T-300-EXIT.
092370     MOVE SUB1                     TO HLD-ACCT-LGTH.
           IF KDA-BATCH-ATM-SETTLE-PLUS                                 02.81
092390        MOVE SUB1                  TO WSAK-ACCT-LEN.
092400     MOVE WS-CK-ACCNUM (SUB)       TO WS-LSHIFT-ACCNUM (SUB1)
092410                                      WS-LZERO-ACCNUM (SUB1).
092420     ADD +1                        TO SUB
092430                                      SUB1.
092440     GO TO T-300-MOVE-AS-IS-LOOP.
092450 T-300-ACCT-ERROR.
092460     MOVE WS-CHECK-ACCOUNT         TO WS-LEFT-ACCT.
092470     MOVE 'Y'                      TO INVALID-ACCT-SW.
PROMST     SET  WS-ARC-SET-E07           TO TRUE.
092490     SET ER-INDX UP BY 1.
092500 T-300-EXIT.
092510     EXIT.
092520*
092530 T-400-ACCT-CHK.                                                  03.47
092540*
           IF NOT MR1-VALID-MIS3-TRAN                                   03.31
              IF VALID-MIS3-SPACE                                       02.42
                 MOVE WSL-HOLD-ZERO-16(1:8)                             02.42
                                         TO WS-CHD-DIS-ACCT-NO-RANGE-X  02.42
                 PERFORM S-890-VALID-DS-PREFIX                          02.42
                    THRU S-890-EXIT                                     02.42
                 IF BAS10002-INVALID-PRE-SW NOT = 'Y'                   02.42
                    IF KDA-CHD-IS-DS-NET-PAYPAL AND                     03.47
                       WS-FE-PP-SW = 'Y'                                03.47
                       IF MR1-VALID-MIS3-TRAN                           03.47
                          MOVE 'PP'      TO MIS3-CARD-TYPE              03.47
                       ELSE                                             03.47
                          MOVE 'PP'      TO MIS1-CARD-TYPE              03.47
                       END-IF                                           03.47
                       MOVE 'PP'         TO WS-MIS3-CARD-TYPE           03.47
                                            PET-MIS3-CARD-TYPE          03.47
                    ELSE                                                03.47
                       MOVE 'DS'         TO WS-MIS3-CARD-TYPE           03.47
                                            PET-MIS3-CARD-TYPE          03.47
                    END-IF                                              03.47
                 ELSE                                                   02.42
                    MOVE WSL-HOLD-ZERO-16(1:6)                          02.42
                                         TO WS-CHD-AMEX-ACCT-NO-RANGE-X 02.42
                       IF VALID-CHD-AMEX-ACCT-NO-RANGE                  02.42
                          MOVE 'AX'      TO WS-MIS3-CARD-TYPE.          02.42
      *
           IF VALID-MIS3-SPACE
              GO TO T-400-CONT.                                         03.47
      *
           IF WS-MIS3-CARD-TYPE = 'V '
           AND BE-CF-VS-SETL = 'N'
              MOVE '11'                  TO PET-CARD-TYPE
              GO TO T-400-CONT.                                         03.47
           IF WS-MIS3-CARD-TYPE = 'M '
           AND BE-CF-MC-SETL = 'N'
              MOVE '12'                  TO PET-CARD-TYPE
              GO TO T-400-CONT.                                         03.47
           IF WS-MIS3-CARD-TYPE = 'AX'
              IF WS-MRCH-IS-AMX-EAP                                     03.16A
                 MOVE '54'               TO PET-CARD-TYPE               03.16A
              ELSE                                                      03.16A
              IF WS-MRCH-IS-AMX-SETL                                    02.29
                 MOVE '14'               TO PET-CARD-TYPE               CPS
              ELSE                                                      CPS
                 MOVE '04'               TO PET-CARD-TYPE               CPS
              END-IF                                                    03.16A
              END-IF                                                    CPS
              GO TO T-400-CONT.                                         03.47
           IF WS-MIS3-CARD-TYPE = 'DS'
              IF WS-MRCH-IS-DIS-SETL
                 MOVE '15'               TO PET-CARD-TYPE
              ELSE
                 MOVE '05'               TO PET-CARD-TYPE
              END-IF
              GO TO T-400-CONT.                                         03.47
           IF WS-MIS3-CARD-TYPE = 'PP'                                  03.47
              IF WS-FE-PP-SW = 'Y'                                      03.47
                 IF WS-MRCH-IS-DIS-SETL                                 03.47
                    MOVE '48'            TO PET-CARD-TYPE               03.47
                 ELSE                                                   03.47
                    MOVE '08'            TO PET-CARD-TYPE               03.47
                 END-IF                                                 03.47
              ELSE                                                      03.47
                 MOVE 'DS'               TO MIS3-CARD-TYPE              03.47
                                            WS-MIS3-CARD-TYPE           03.47
                                            PET-MIS3-CARD-TYPE          03.47
                 IF WS-MRCH-IS-DIS-SETL                                 03.47
                    MOVE '15'            TO PET-CARD-TYPE               03.47
                 ELSE                                                   03.47
                    MOVE '05'            TO PET-CARD-TYPE               03.47
                 END-IF                                                 03.47
              END-IF                                                    03.47
              GO TO T-400-CONT.                                         03.47
           IF VALID-MIS3-PD-NET AND                                     02.29
              KDA-CHD-IS-VALID-PD                                       02.29
                 MOVE '03'               TO PET-CARD-TYPE               02.29
                 GO TO T-400-CONT.                                      03.47
           IF WS-MIS3-CARD-TYPE = 'DB' OR 'EB'
              MOVE '03'                  TO PET-CARD-TYPE
              GO TO T-400-CONT.                                         03.47
           IF WS-MIS3-CARD-TYPE = SPACES
              MOVE 'P '                  TO WS-MIS3-CARD-TYPE
              MOVE '03'                  TO PET-CARD-TYPE
           ELSE
           IF NOT VALID-MIS3-VISA-MC-CARD-TYPE
              MOVE 35                    TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1
              MOVE 'Y'                   TO INVALID-ACCT-SW
              SET  WS-ARC-SET-E07        TO TRUE
              GO TO T-400-EXIT.
      *
092530 T-400-CONT.                                                      03.47
092770*
      *   CHECK FOR VALID MASTERCARD AND VISA BIN                       01.61
092790*
092800     PERFORM T-200-ACCT-VERIFY
092810        THRU T-200-EXIT.
093110 T-400-SET-CARD-USED.
093120     IF PET-CARD-TYPE-VISA
093130        MOVE 'V'                   TO PET-CARD-USED
093140                                      WS-CARD-TYPE
093150                                      PET-INCOMING-FORMAT
093160        PERFORM T-970-INIT-VISA
093170           THRU T-970-EXIT
093120     ELSE
093200     IF PET-CARD-TYPE-MC
093210        MOVE 'M'                   TO PET-CARD-USED
093220                                      WS-CARD-TYPE
093230                                      PET-INCOMING-FORMAT
093240        PERFORM T-980-INIT-INET
093250           THRU T-980-EXIT
093260     ELSE
093200     IF PET-CARD-TYPE-AMEX
093210        MOVE 'A'                   TO PET-CARD-USED
093220                                      WS-CARD-TYPE
093230                                      PET-INCOMING-FORMAT
              PERFORM T-975-INIT-AMEX
                 THRU T-975-EXIT
093260     ELSE
093200     IF PET-CARD-TYPE-DISCOVER
093210        MOVE 'D'                   TO PET-CARD-USED
093220                                      WS-CARD-TYPE
093230                                      PET-INCOMING-FORMAT
              PERFORM T-985-INIT-DISC
                 THRU T-985-EXIT
093260     ELSE                                                         03.47
093200     IF PET-CARD-TYPE-PAYPAL                                      03.47
093210        MOVE 'Y'                   TO PET-CARD-USED               03.47
093220                                      WS-CARD-TYPE                03.47
093230        MOVE 'D'                   TO PET-INCOMING-FORMAT         03.47
              PERFORM T-985-INIT-DISC                                   03.47
                 THRU T-985-EXIT                                        03.47
093260     ELSE
093270        MOVE 03                    TO PET-CARD-TYPE
093270        MOVE 'P'                   TO PET-CARD-USED
093280                                      WS-CARD-TYPE
093290        MOVE 'M'                   TO PET-INCOMING-FORMAT
093300        PERFORM T-980-INIT-INET
093310           THRU T-980-EXIT.
      *
093870 T-400-EXIT.
093880     EXIT.
093890*
094100 T-710-VISA-ARD-CHECK.
094110     MOVE SPACE TO INVALID-BIN-SW.
094120     MOVE '1 '                     TO WS-CHD-AR-CHECK-DIG-ALGO.
           MOVE SPACES                   TO WS-CHD-AR-PRODUCT-ID.       02.81
           MOVE SPACES                   TO EDIT-FILE-REC               02.23
                                            BAS10002-CALL-PARAMETERS.   02.23
094210     MOVE 'A'               TO  EFR-REC-KEY-ID.
094220     MOVE '5'               TO  EFR-AR-RECID.
094230     MOVE HOLD-WSAK-HI-ACCT TO  EFR-AR-HIGH-ACCT-PREFIX.
           MOVE EFR-REC-KEY              TO BAS10002-PASSED-KEY.        02.23
           MOVE 'S'                      TO BAS10002-CALL-TYPE.         02.23
094260     PERFORM Z9998-CALL-BAS10002
094270        THRU Z9998-EXIT.
           IF BAS10002-INVALID-ICA-SW = 'Y'                             02.23
094290        MOVE 'Y'                   TO INVALID-BIN-SW
094300        GO TO T-710-EXIT.
           MOVE BAS10002-EDDATA-AREA     TO EDIT-FILE-REC.              02.23
094320     IF HOLD-WSAK-HI-ACCT < EFR-AR-LOW-ACCT-PREFIX
094330        MOVE 'Y'                   TO INVALID-BIN-SW
094340        GO TO T-710-EXIT.
094350     MOVE EFR-AR-CHECK-DIG-ALGO    TO WS-CHD-AR-CHECK-DIG-ALGO.
094370     MOVE EFR-AR-ACCT-LENGTH       TO WSAK-ACCT-LEN-X.
094380     MOVE EFR-AR-BIN-REGION        TO KDA-CHD-AR-BIN-REGION.
094390     MOVE EFR-AR-BIN-COUNTRY       TO WS-CHD-AR-BIN-COUNTRY.
094400     MOVE EFR-AR-BIN-CARD-USAGE    TO KDA-CHD-AR-CARD-USAGE.
094410     MOVE EFR-AR-REPORT-BIN        TO WS-CHD-AR-REPORT-BIN.
           MOVE EFR-AR-LARGE-TICKET-IND  TO KDA-CHD-AR-LRG-TKT-IND.     02.81
           MOVE EFR-AR-TECH-IND          TO KDA-CHD-AR-TECH-IND.
           MOVE EFR-AR-ACCT-LVL-PROC-IND                                02.81
                                       TO KDA-CHD-AR-ACCT-LVL-PROC-IND. 02.81
           MOVE EFR-AR-PRODUCT-ID        TO WS-CHD-AR-PRODUCT-ID.
           MOVE EFR-AR-PROD-SUBTYPE      TO KDA-CHD-AR-PROD-SUBTYPE.    02.81
           MOVE EFR-AR-REGULATED-IND     TO KDA-CHD-AR-REGULATED-IND.   02.68
           MOVE EFR-AR-ACCT-FUND-SOURCE  TO KDA-CHD-AR-ACCT-FUND-SRC.   02.81
           MOVE EFR-AR-ACCT-RESTRICT-USE TO KDA-CHD-AR-ACCT-RSTRCT-USE. 02.81
           MOVE EFR-AR-TOKEN-IND         TO KDA-CHD-AR-TOKEN-IND.       03.46
      *
094420 T-710-EXIT.
094430     EXIT.
094440*
094450 T-760-BANK-999999-INFO.
      *
           MOVE +999999                  TO FEICF-KEY.
           PERFORM Z-800-READ-FEICF
              THRU Z-800-EXIT.
           IF FEICF-BYTES = '00'
              NEXT SENTENCE
           ELSE
              DISPLAY 'NO 999999 RECORD ON FEICF'
              MOVE 44                    TO HLD-RETURN-CD.
      *
094460     MOVE FE-BANK-NAME-1           TO WS-CENTER-NAME-1.
094470     MOVE FE-BANK-NAME-2           TO WS-CENTER-NAME-2.
094480     MOVE FE-DATE-FORMAT           TO WS-CENTER-DATE-FORMAT.
094490     MOVE FE-WORK-AS-OF-DATE       TO WS-CENTER-DATE.
094500     MOVE FE-SETTLEMENT-CURR-CODE-NU
094520                                   TO BASCRATE-SD-CENTER-CURR-CD
111480                                      SRCH-CURR-CODE.
111490     PERFORM S-610-SRCH-CURR-CD
111500        THRU S-610-EXIT.
111510     IF INVAL-CURR-SW = 'Y' OR 'N'
111520        MOVE WS-UNKNOWN-CURRENCY   TO WS-CENTER-CURRENCY-NAME
111530        MOVE 2                     TO BASCRATE-SD-CENTER-CURR-DEC
094520        MOVE +840                  TO BASCRATE-SD-CENTER-CURR-CD
111550     ELSE
              MOVE CRE-NUM-DECINALS(CRE-IDX)                            02.39
111570                                   TO BASCRATE-SD-CENTER-CURR-DEC
              MOVE CRE-CURRENCY-NAME(CRE-IDX)                           02.39
111600                                   TO WS-CENTER-CURRENCY-NAME.
094570*
094580 T-760-EXIT.
094590     EXIT.
094600*
165820 T-764-SET-WORK-AMT.
165940
165960     MOVE PET-ACQ-AMOUNT           TO WORK-BATCH-AMT.
      *
           EVALUATE PET-CARD-USED                                       02.24
             WHEN 'V'                                                   02.24
               COMPUTE PET-REIMB-RATE = BASCRATE-RD-REIMB-RATE-VS       02.24
             WHEN OTHER                                                 02.24
               COMPUTE PET-REIMB-RATE = BASCRATE-RD-REIMB-RATE-MC       02.24
           END-EVALUATE.                                                02.24
      *                                                                 02.24
           IF PET-ACQ-CURR-CODE = BASCRATE-SD-REIMB-CURR-CD             02.24
              MOVE PET-ACQ-AMOUNT        TO WORK-REIMB-AMT              02.24
              GO TO T-764-SET-IIIAAA-WORK-AMT.                          02.24
           IF PET-ISS-CURR-CODE = BASCRATE-SD-REIMB-CURR-CD             02.24
              MOVE PET-ISS-AMOUNT        TO WORK-REIMB-AMT              02.24
              GO TO T-764-SET-IIIAAA-WORK-AMT.                          02.24
      *                                                                 02.24
096170     COMPUTE WORK-REIMB-AMT = PET-ACQ-AMOUNT
096180                            * PET-REIMB-RATE.
165910     CALL BACONDEC USING BASCRATE-SD-BANK-KEY
165920           C-TYPED  BASCRATE-SD-REIMB-CURR-DEC
165930           C-TYPER  WORK-REIMB-AMT
165940           C-TYPEEND.
165940
      *                                                                 02.24
       T-764-SET-IIIAAA-WORK-AMT.                                       02.24
      *                                                                 02.24
           MOVE WORK-REIMB-AMT           TO PET-REIMB-AMT.              02.24
      *                                                                 02.24
165830     IF PET-ACQ-CURR-CODE = BASCRATE-SD-IIIAAA-CURR-CD
165960        MOVE PET-ACQ-AMOUNT        TO WORK-IIIAAA-AMT
165820        GO TO T-764-SET-III999-WORK-AMT.
165840     IF PET-ISS-CURR-CODE = BASCRATE-SD-IIIAAA-CURR-CD
165960        MOVE PET-ISS-AMOUNT        TO WORK-IIIAAA-AMT
165820        GO TO T-764-SET-III999-WORK-AMT.
      *
           EVALUATE PET-CARD-USED
             WHEN 'M'
               EVALUATE TRUE                                            03.31
                 WHEN MR1-VALID-RETURN                                  03.31
                   COMPUTE WORK-IIIAAA-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-IIIAAA-MCSB-RATE
                 WHEN OTHER
                   COMPUTE WORK-IIIAAA-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-IIIAAA-MCBS-RATE
               END-EVALUATE
             WHEN 'P'
               COMPUTE WORK-IIIAAA-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-IIIAAA-MCBS-RATE
             WHEN 'V'
               EVALUATE TRUE                                            03.31
                 WHEN MR1-VALID-RETURN                                  03.31
                   COMPUTE WORK-IIIAAA-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-IIIAAA-VSSB-RATE
                 WHEN OTHER
                   COMPUTE WORK-IIIAAA-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-IIIAAA-VSBS-RATE
               END-EVALUATE
             WHEN OTHER
               COMPUTE WORK-IIIAAA-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-IIIAAA-VSBS-RATE
           END-EVALUATE.
      *
165910     CALL BACONDEC USING BASCRATE-SD-BANK-KEY
165920           C-TYPED  BASCRATE-SD-IIIAAA-CURR-DEC
165930           C-TYPER  WORK-IIIAAA-AMT
165940           C-TYPEEND.
165940
165820 T-764-SET-III999-WORK-AMT.
165940
096170     COMPUTE PET-IIIAAA-AMT = WORK-IIIAAA-AMT.
165940
165830     IF PET-ACQ-CURR-CODE = BASCRATE-SD-III999-CURR-CD
165960        MOVE PET-ACQ-AMOUNT        TO WORK-III999-AMT
165820        GO TO T-764-SET-CENTER-WORK-AMT.
165840     IF PET-ISS-CURR-CODE = BASCRATE-SD-III999-CURR-CD
165960        MOVE PET-ISS-AMOUNT        TO WORK-III999-AMT
165820        GO TO T-764-SET-CENTER-WORK-AMT.
      *
           EVALUATE PET-CARD-USED
             WHEN 'M'
               EVALUATE TRUE                                            03.31
                 WHEN MR1-VALID-RETURN                                  03.31
                   COMPUTE WORK-III999-AMT =
                      PET-ACQ-AMOUNT * BASCRATE-RD-III999-MCSB-RATE
                 WHEN OTHER
                   COMPUTE WORK-III999-AMT =
                      PET-ACQ-AMOUNT * BASCRATE-RD-III999-MCBS-RATE
               END-EVALUATE
             WHEN 'P'
               COMPUTE WORK-III999-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-III999-MCBS-RATE
             WHEN 'V'
               EVALUATE TRUE                                            03.31
                 WHEN MR1-VALID-RETURN                                  03.31
                   COMPUTE WORK-III999-AMT =
                      PET-ACQ-AMOUNT * BASCRATE-RD-III999-VSSB-RATE
                 WHEN OTHER
                   COMPUTE WORK-III999-AMT =
                      PET-ACQ-AMOUNT * BASCRATE-RD-III999-VSBS-RATE
               END-EVALUATE
             WHEN OTHER
               COMPUTE WORK-III999-AMT =
                      PET-ACQ-AMOUNT * BASCRATE-RD-III999-VSBS-RATE
           END-EVALUATE.
      *
165910     CALL BACONDEC USING BASCRATE-SD-BANK-KEY
165920           C-TYPED  BASCRATE-SD-III999-CURR-DEC
165930           C-TYPER  WORK-III999-AMT
165940           C-TYPEEND.
165940
165820 T-764-SET-CENTER-WORK-AMT.
165940
165830     IF PET-ACQ-CURR-CODE = BASCRATE-SD-CENTER-CURR-CD
165960        MOVE PET-ACQ-AMOUNT        TO WORK-CENTER-AMT
165820        GO TO T-764-WORK-AMTS-SET.
165840     IF PET-ISS-CURR-CODE = BASCRATE-SD-CENTER-CURR-CD
165960        MOVE PET-ISS-AMOUNT        TO WORK-CENTER-AMT
165820        GO TO T-764-WORK-AMTS-SET.
      *
           EVALUATE PET-CARD-USED
             WHEN 'M'
               EVALUATE TRUE                                            03.31
                 WHEN MR1-VALID-RETURN                                  03.31
                   COMPUTE WORK-CENTER-AMT =
                      PET-ACQ-AMOUNT * BASCRATE-RD-CENTER-MCSB-RATE
                 WHEN OTHER
                   COMPUTE WORK-CENTER-AMT =
                      PET-ACQ-AMOUNT * BASCRATE-RD-CENTER-MCBS-RATE
               END-EVALUATE
             WHEN 'P'
               COMPUTE WORK-CENTER-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-CENTER-MCBS-RATE
             WHEN 'V'
               EVALUATE TRUE                                            03.31
                 WHEN MR1-VALID-RETURN                                  03.31
                   COMPUTE WORK-CENTER-AMT =
                      PET-ACQ-AMOUNT * BASCRATE-RD-CENTER-VSSB-RATE
                 WHEN OTHER
                   COMPUTE WORK-CENTER-AMT =
                      PET-ACQ-AMOUNT * BASCRATE-RD-CENTER-VSBS-RATE
               END-EVALUATE
             WHEN OTHER
               COMPUTE WORK-CENTER-AMT =
                      PET-ACQ-AMOUNT * BASCRATE-RD-CENTER-VSBS-RATE
           END-EVALUATE.
      *
165910     CALL BACONDEC USING BASCRATE-SD-BANK-KEY
165920           C-TYPED  BASCRATE-SD-CENTER-CURR-DEC
165930           C-TYPER  WORK-CENTER-AMT
165940           C-TYPEEND.
165940
165820 T-764-WORK-AMTS-SET.
165940
166470     IF WS-DEBIT
166480        ADD WORK-BATCH-AMT         TO WS-BATCH-AMT
166480        ADD WORK-REIMB-AMT         TO WS-REIMB-AMT
166480        ADD WORK-IIIAAA-AMT        TO WS-IIIAAA-AMT
166490        ADD WORK-III999-AMT        TO WS-III999-AMT
166500        ADD WORK-CENTER-AMT        TO WS-CENTER-AMT
166510     ELSE
166520     IF WS-CREDIT
166530        SUBTRACT WORK-BATCH-AMT    FROM WS-BATCH-AMT
166530        SUBTRACT WORK-REIMB-AMT    FROM WS-REIMB-AMT
166530        SUBTRACT WORK-IIIAAA-AMT   FROM WS-IIIAAA-AMT
166540        SUBTRACT WORK-III999-AMT   FROM WS-III999-AMT
166550        SUBTRACT WORK-CENTER-AMT   FROM WS-CENTER-AMT
166560     ELSE
166570      DISPLAY '*** ERROR WS-CREDIT-OR-DEBIT NOT SET. WORK FIELDS'
166580      DISPLAY '***       FOR TOTAL REPORT NOT INCREMENTED.'.
166590 T-764-EXIT.
166600     EXIT.
095400*
095410 T-765-BANK-III999-INFO.
095420     MOVE BASCRATE-SD-BANK-KEY     TO WS-BANK-2.
095430     MOVE 999                      TO WS-BANK-ASSN.
           MOVE WS-BANK-2                TO FEICF-KEY.
           PERFORM Z-800-READ-FEICF
              THRU Z-800-EXIT.
           IF FEICF-BYTES NOT = '00'
              MOVE 93                    TO ER-CD(ER-INDX)
              SET ER-INDX UP BY 1                                       02.73
              DISPLAY 'T-765 BANK NOT ON BANKCTRL '
                             WS-BANK
              MOVE BASCRATE-SD-BANK-KEY  TO HL1-INST-NBR
              MOVE ZEROS                 TO SRCH-CURR-CODE
              MOVE 'Y'                   TO CRITICAL-BATCH-REJ-SW       02.73
           ELSE
              MOVE FE-SETTLEMENT-CURR-CODE-NU
                                         TO BASCRATE-SD-III999-CURR-CD
                                            SRCH-CURR-CODE.
111490     PERFORM S-610-SRCH-CURR-CD
111500        THRU S-610-EXIT.
111510     IF INVAL-CURR-SW = 'Y' OR 'N'
111520        MOVE WS-UNKNOWN-CURRENCY   TO WS-III999-CURRENCY-NAME
111530        MOVE 2                     TO BASCRATE-SD-III999-CURR-DEC
094520        MOVE +840                  TO BASCRATE-SD-III999-CURR-CD
111550     ELSE
              MOVE CRE-NUM-DECINALS(CRE-IDX)                            02.39
111570                                   TO BASCRATE-SD-III999-CURR-DEC
              MOVE CRE-CURRENCY-NAME(CRE-IDX)                           02.39
111600                                   TO WS-III999-CURRENCY-NAME.
095740 T-765-EXIT.
095750     EXIT.
096300*
096310 T-775-GET-BANK-NAMES.
096320     MOVE HL1-INST-NBR    TO FEICF-KEY.
           PERFORM Z-800-READ-FEICF
              THRU Z-800-EXIT.
096340     IF FEICF-BYTES = '00'
096350        NEXT SENTENCE
096360     ELSE
096400        MOVE 'UNKNOWN BANK'   TO HL1-INST-NAME
096410                                 HL2-INST-NAME
096420        GO TO T-775-EXIT.
096440     MOVE HL1-INST-NBR             TO WS-HOLD-BANK-NBR.
096450     MOVE FE-BANK-NAME-1           TO HL1-INST-NAME.
096460     MOVE FE-BANK-NAME-2           TO HL2-INST-NAME.
096470     MOVE 'C'                      TO DC-OPCODE-O.
096480     MOVE 'A'                      TO DC-OPCODE-S.
096490     IF FE-DATE-FORMAT = 'I'
096500        MOVE 'W'                   TO DC-OPCODE-R
096510     ELSE
096520        MOVE 'E'                   TO DC-OPCODE-R.
096530     MOVE FE-WORK-AS-OF-DATE       TO DC-SEND-DATE.
096540     PERFORM D-100-CALL-DATECONV
096550        THRU D-100-EXIT.
096560     IF DC-NOT-SUCCESSFUL
096570        DISPLAY 'T-775-GET-BANK-NAMES'
096580        DISPLAY DATECONV-PASSAREA
096590        MOVE '??/??/??'            TO DC-RETURN-DATEX.
096600     MOVE DC-RETURN-DATEX          TO HL2-DATE.
096610 T-775-EXIT.
096620     EXIT.
096630*
096640 T-950-INIT-PET-RECORD.
096650     MOVE SPACES TO        POST-EDIT-TRANS
096660                           WORK-DATA.
096710     MOVE +0           TO WORK-BATCH-AMT
096710                          WORK-REIMB-AMT
096710                          WORK-IIIAAA-AMT
096720                          WORK-III999-AMT
096730                          WORK-CENTER-AMT
096810                          PET-DEST-BANK-KEY
096820                          PET-ACCOUNT
EURO                            PET-EXP-DATE
096830                          PET-CUST-ID-1
096830                          PET-CUST-ID-2
096830                          PET-MRCH-TAX-ID-FED
096830                          PET-MRCH-TAX-ID-ST
096830                          PET-CUST-BANK-ID
096830                          PET-DATE
096840                          PET-AMOUNT
096850                          PET-ISS-CURR-CODE
096860                          PET-ACQ-CURR-CODE
096870                          PET-ORIG-INT-SETL-CURR-CODE
096880                          PET-DEST-INT-SETL-CURR-CODE
096890                          PET-MERCH-NMBR
096900                          PET-SUS-NMBR
096910                          PET-ORIG-BANK-KEY
096930                          PET-ACQUIRER-ID
096940                          PET-DEST-INT-SETL-GRP
096950                          PET-ORIG-INT-SETL-GRP
096960                          PET-ORIG-CURR-AMT
097010                          PET-TOTAL-AUTH-AMT
097020                          PET-CASH-BACK-AMT
                                PET-SURCHARGE-AMT                       02.95
097030                          PET-TRANS-IDNTFIER
097040                          PET-AUTHORIZ-AMT
097050                          PET-TIMESTAMP
045720                          PET-REIMB-CURR-CODE
045720                          PET-IIIAAA-CURR-CODE
096840                          PET-REIMB-AMT
096840                          PET-IIIAAA-AMT
                                PET-REIMB-INT-FEE-AMT
                                PET-IIIAAA-INT-FEE-AMT
                                PET-REIMB-INT-FEE-ITEM
                                PET-IIIAAA-INT-FEE-ITEM
096840                          PET-CB-AMT
096840                          PET-MRCH-FX-AMT.
045720     MOVE 1.0000000    TO PET-REIMB-RATE.
           MOVE 'C'                      TO PET-DR-CR-CARD.             02.77
097060     MOVE 'N'          TO PET-MERCH-SEL-TRANS
                                PET-ADD-SUS-FLAG                        02.63
097090                          PET-INFO-IND.
097100     MOVE ZEROS        TO PET-ACCT-NO-EXT-X
097110                          PET-MC-CHD-SERVICE-CD                   02.74
097110                          PET-BATCH-NMBR
097120                          PET-CARD-TYPE
097130                          PET-PLAN-TYPE
097140                          PET-ORIG-PLAN-TYPE
097150                          PET-AUTH-CD
097160                          PET-ERROR-CD
097170                          PET-LENGTH-ORIG-ACCT
097180                          PET-MERCH-TYPE
097200                          PET-CURR-CONV-DATE
097240                          PET-NATL-PROC-DATE
097250                          PET-MULT-CLEARING-SEQ-NUM
097250                          PET-MULT-CLEARING-SEQ-CNT               03.42V
097270                          PET-CB-REASON-CD.
097280 T-950-EXIT.
097290     EXIT.
097300*
097310 T-960-INIT-PET-HDR-REC.
097320     MOVE SPACES          TO PET-BTCH-HDR
097330                             PET-HDR-REIMB-CURR-CODE
097330                             PET-HDR-IIIAAA-CURR-CODE
097330                             PET-HDR-CURR-CODE.
097340     COMPUTE  PET-HDR-BANK-KEY          = 0.
097350     COMPUTE  PET-HDR-AMOUNT            = 0.
097360     COMPUTE  PET-HDR-ORIG-AMOUNT       = 0.
097370     COMPUTE  PET-HDR-BATCH-NMBR        = 0.
097380     COMPUTE  PET-HDR-REF-NMBR          = 0.
097390     COMPUTE  PET-HDR-ITEMS-ACC         = 0.
097400     COMPUTE  PET-HDR-ITEMS-REJ         = 0.
097410     COMPUTE  PET-HDR-BANK-NMBR         = 0.
097410     COMPUTE  PET-HDR-REIMB-AMT         = 0.
097410     COMPUTE  PET-HDR-IIIAAA-AMT        = 0.
097420 T-960-EXIT.
097430     EXIT.
097440*
097450 T-970-INIT-VISA.
097460     MOVE ZERO                     TO PET-REIMB-IND.
097460     MOVE HOLD-PET-MVV             TO PET-VISA-MVV.
097070     MOVE 'N'                      TO PET-AUTH-CHAR-IND.
097460     COMPUTE  PET-TRAN-CODE-QUAL         = 0.
097460     COMPUTE  PET-TMP-MERCH-ZIP          = 0.
097480     COMPUTE  PET-BASE-SETTL-FLG         = 0.
097500     COMPUTE  PET-TMP-USAGE-CD           = 1.
097510     COMPUTE  PET-TMP-CHGBK-REFNO        = 0.
097530     COMPUTE  PET-TMP-ISS-CNTLNO         = 0.
097540     COMPUTE  PET-TMP-DESTIN-BIN         = 0.
097550     COMPUTE  PET-TMP-SOURCE-BIN         = 0.
           MOVE +0                       TO PET-VS-INSTL-NO             02.23
                                            PET-VS-INSTL-TOTAL-NO       02.23
                                            PET-VS-INSTL-TOTAL-AMT.     02.23
097580 T-970-EXIT.
097590     EXIT.
097440*
097450 T-975-INIT-AMEX.
           MOVE 02                       TO PET-AMEX-SE-FC.             02.63
097460     MOVE 01                       TO PET-AMEX-EXTEND-PAY.
097550     MOVE ZEROS                    TO PET-AMEX-SE.
097620     MOVE '000010000000'           TO PET-AMEX-POS-DTA-CODE.
097580 T-975-EXIT.
097590     EXIT.
097600*
097610 T-980-INIT-INET.
097620     COMPUTE  PET-SENDING-ICA            = 0.
097630     COMPUTE  PET-RECEIVING-ICA          = 0.
170050     COMPUTE  PET-MC-FUNC-CODE           = 200.                   03.47
170050     MOVE '000000'                 TO PET-MC-PROC-CD.
170070     MOVE 'M'                      TO PET-MC-SETTLEMENT-IND.
           MOVE 'N'                      TO PET-US-ACQUIRED.            03.48
097670     COMPUTE  PET-CHGEBACK-REF-NMBR      = 0.
097620     MOVE '099999099001'           TO PET-MC-POS-DTA-CODE.
           MOVE ZEROS                    TO PET-MC-INSTL-OPTION         01.23
                                            PET-MC-INSTL-BONUS-CD       01.23
                                            PET-MC-INSTL-BONUS-NO-PER-YR01.23
                                            PET-MC-INSTL-BONUS-1ST-MO.  01.23
           MOVE +0                       TO PET-MC-INSTL-NO             01.23
                                            PET-MC-INSTL-TOTAL-NO       01.23
                                            PET-MC-INSTL-BONUS-AMT.     01.23
097710 T-980-EXIT.
097720     EXIT.
      *
       T-985-INIT-DISC.
           INITIALIZE PET-DISC-MISC-DATA.
           MOVE 'N'                      TO PET-DS-PART-SHIP-IND.
           MOVE '9099990900000'          TO PET-DS-POS-DATA.
       T-985-EXIT.
           EXIT.
      *
097740 T-990-READ-BIN-DATE.
097750     MOVE SPACES                   TO EDIT-FILE-REC.
097760     MOVE 'B'                      TO EFR-REC-KEY-ID.
097770     MOVE '1'                      TO EFR-BR-RECID.
097780     MOVE ZEROS                    TO EFR-BR-BIN.
097790     PERFORM Z-900-READ-EFR
097800        THRU Z-900-EXIT.
           IF BAS10002-EFR-GOOD                                         02.23
097820        DISPLAY 'BIN DATE     '  EFR-BR-CONTROL-DATE-GREG
097830     ELSE
097840        DISPLAY 'ERROR IN READING EDIT FILE'.
097850 T-990-EXIT.
097860     EXIT.
097870*
097880 T-995-READ-ARD-DATE.
097890     MOVE SPACES                   TO EDIT-FILE-REC.
097900     MOVE 'A'                      TO EFR-REC-KEY-ID.
097910     MOVE '1'                      TO EFR-AR-RECID.
097920     MOVE ZEROS                    TO EFR-AR-HIGH-ACCT-PREFIX.
097930     PERFORM Z-900-READ-EFR
097940        THRU Z-900-EXIT.
           IF BAS10002-EFR-GOOD                                         02.23
097960        DISPLAY 'ARD DATE     '  EFR-AR-CONTROL-DATE-GREG
097970     ELSE
097980        DISPLAY 'ERROR IN READING EDIT ARD FILE   '.
097990 T-995-EXIT.
098000     EXIT.
098010*
098020 U-100-OUT-WORK-REC.
           IF ER-CD-3-DIG(1) > ZERO
              MOVE ER-CD-3-DIG(1)        TO PET-ERROR-CD
           ELSE
              IF ER-CD-3-DIG(2) > ZERO
                 MOVE ER-CD-3-DIG(2)     TO PET-ERROR-CD.
PROMST     IF  PET-SUS-FLAG EQUAL 'Y' AND
               MR1-VALID-MONETARY                                       03.31
PROMST         IF  WS-ARC-SET-E07
PROMST             MOVE 'E07'            TO PET-USER-ADJ-REASON
PROMST         ELSE
PROMST         IF  WS-ARC-SET-E10
PROMST             MOVE 'E10'            TO PET-USER-ADJ-REASON
PROMST         ELSE
PROMST         IF  WS-ARC-SET-E27
PROMST             MOVE 'E27'            TO PET-USER-ADJ-REASON
PROMST         ELSE
PROMST         IF  WS-ARC-SET-E36
PROMST             MOVE 'E36'            TO PET-USER-ADJ-REASON
PROMST         ELSE
PROMST         IF  WS-ARC-SET-E37
PROMST             MOVE 'E37'            TO PET-USER-ADJ-REASON
PROMST         ELSE
PROMST         IF  WS-ARC-SET-E38
PROMST             MOVE 'E38'            TO PET-USER-ADJ-REASON
PROMST         ELSE
PROMST             MOVE 'E86'            TO PET-USER-ADJ-REASON
PROMST         END-IF
PROMST     END-IF.
           IF PET-SUS-FLAG = 'Y'
              MOVE ERROR-CODE-HOLD-TABLE TO WORK-ERROR-CODES
           ELSE
              MOVE SPACES                TO WORK-ERROR-CODES
           END-IF.
           MOVE POST-EDIT-TRANS          TO WORK-DATA.
           MOVE WS-WORK-EXTRA-DATA       TO WORK-EXTRA-DATA.            02.88
098170     PERFORM S-300-WRITE-PET-WORK-REC
098180        THRU S-300-EXIT.
098290 U-100-EXIT.
098300     EXIT.
098310*
098320 U-110-VALIDATE-AUTH.
098330     MOVE 'N'                      TO AUTH-ERR-SW.
           IF AUTH-SPACE-WORK = SPACES
              GO TO U-110-EXIT.
EURO       IF PET-CARD-TYPE-MC                                          02.41
              IF AUTH-SPACE-WORK(1:1) = SPACE
                 MOVE 'Y'                TO AUTH-ERR-SW
              ELSE
098350           PERFORM X-120-CHECK-IMBED-SPACE
098360              THRU X-120-EXIT
098370        END-IF
098370     ELSE
              IF PET-CARD-TYPE-VISA                                     03.27
098350           PERFORM X-130-CHECK-VISA-AUTH-CODE
098360              THRU X-130-EXIT.
098400 U-110-EXIT.
098410     EXIT.
098420*
098430 U-150-CH-INVAL-DT-CHK.
098440     IF INVALID-DATE-SW EQUAL 'Y'
098450         MOVE ZEROES TO VALIDATE-DATE
PROMST         SET WS-ARC-SET-E10 TO TRUE.
098490 U-150-EXIT.
098500     EXIT.
098510*
098600 U-175-CH-SLS-AMNT-ERR.
098610     MOVE AMT-ERR-CD TO ER-CD (ER-INDX).
098620     SET ER-INDX UP BY 1.
098640     MOVE 'Y' TO PET-SUS-FLAG.
098660 U-175-EXIT.
098670     EXIT.
098680*
099050 U-195-CHECK-MERCH-TYPE.
099060     MOVE 'N'                      TO INVALID-MERCH-TYPE.
           IF PET-CARD-TYPE-VISA OR                                     03.27
              PET-CARD-TYPE-MC OR                                       03.27
              PET-CARD-TYPE-DISCOVER OR                                 02.41
              PET-CARD-TYPE-PAYPAL   OR                                 03.47
              PET-CARD-TYPE-AMEX OR                                     02.29
             (PET-CARD-TYPE-PL AND                                      02.29
              KDA-CHD-IS-VALID-PD)                                      02.29
099080           NEXT SENTENCE
099090     ELSE
099100        GO TO U-195-EXIT.
           IF PET-CARD-TYPE-VISA AND                                    03.27
              KDA-VS-PID-IS-TRAV-MONEY AND                              02.81
099160        NOT KDA-MRCH-TYP-ATM
099170           GO TO U-195-INVALID.
           IF MR1-VALID-SALE OR                                         03.31
              MR1-VALID-RETURN                                          03.31
              IF (PET-CARD-TYPE-VISA OR                                 03.27
099070            PET-CARD-TYPE-DISCOVER OR                             03.47
099070            PET-CARD-TYPE-PAYPAL) AND                             03.47
099120                 KDA-MERCAT-BANK
099130                 GO TO U-195-INVALID
099130        END-IF
              IF (PET-CARD-TYPE-MC OR                                   02.29
                 (PET-CARD-TYPE-PL AND                                  02.29
                  KDA-CHD-IS-VALID-PD)) AND                             02.29
                 (KDA-MC-MRCH-TYP-CASH OR                               02.29
                  KDA-MC-MRCH-TYP-ATM)                                  02.29
                    GO TO U-195-INVALID                                 02.29
099130        END-IF
099130     END-IF.
099110     IF MR1-TRANSCODE = '0O10'
              IF (PET-CARD-TYPE-PL AND                                  02.29
                  KDA-CHD-IS-VALID-PD)                                  02.29
                    GO TO U-195-INVALID                                 02.29
              END-IF                                                    02.29
              IF PET-CARD-TYPE-VISA                                     03.27
099120           IF NOT KDA-MRCH-TYP-ATM
099130              GO TO U-195-INVALID
099130           END-IF
099130        END-IF
099070        IF PET-CARD-TYPE-DISCOVER                                 03.06
099070        OR PET-CARD-TYPE-PAYPAL                                   03.47
099120           IF NOT KDA-MRCH-TYP-ATM                                03.06
                 OR KDA-CHD-IS-DS-NET-PAYPAL                            03.06
099130              GO TO U-195-INVALID                                 03.06
099130           END-IF                                                 03.06
099130        END-IF                                                    03.06
099070        IF PET-CARD-TYPE-MC
099120           IF KDA-MC-MRCH-TYP-ATM AND
091580              KDA-VALID-MC-ATM-ACQ
099130                 NEXT SENTENCE
099130           ELSE
099130              GO TO U-195-INVALID
099130           END-IF
099130        END-IF
099360        GO TO U-195-CHECK-CONT.
099110     IF MR1-TRANSCODE = '0O06'
              IF PET-CARD-TYPE-VISA                                     03.27
099120           IF NOT KDA-MRCH-TYP-CASH
099130              GO TO U-195-INVALID
099130           END-IF
099130        END-IF
099070        IF PET-CARD-TYPE-DISCOVER                                 03.06
099070        OR PET-CARD-TYPE-PAYPAL                                   03.47
099120           IF NOT KDA-MRCH-TYP-CASH                               03.06
                 OR KDA-CHD-IS-DS-NET-PAYPAL                            03.06
099130              GO TO U-195-INVALID                                 03.06
099130           END-IF                                                 03.06
099130        END-IF                                                    03.06
099070        IF PET-CARD-TYPE-MC
099120           IF NOT KDA-MC-MRCH-TYP-CASH
099130              GO TO U-195-INVALID
099130           END-IF
099130        END-IF
099360        GO TO U-195-CHECK-CONT.
           IF MR1-VALID-CASH AND                                        03.31
              MR1-VALID-MIS3-TRAN                                       03.31
              IF PET-CARD-TYPE-VISA                                     03.27
099120           IF NOT KDA-MERCAT-BANK
099130              GO TO U-195-INVALID
099130           END-IF
099130        END-IF
099070        IF PET-CARD-TYPE-MC
099120           IF KDA-MC-MRCH-TYP-CASH OR
099120             (KDA-MC-MRCH-TYP-ATM AND
091580              KDA-VALID-MC-ATM-ACQ)
099130                 NEXT SENTENCE
099130           ELSE
099130              GO TO U-195-INVALID
099130           END-IF
099130        END-IF                                                    03.06
              IF KDA-CHD-IS-DS-NET-PAYPAL                               03.06
099130           GO TO U-195-INVALID                                    03.06
              END-IF.                                                   03.06
099360 U-195-CHECK-CONT.
           IF PET-CARD-TYPE-VISA                                        03.27
099250        IF WS-BATCH-BIN = ZEROS
099260           GO TO U-195B-INVALID.
099270     IF PET-CARD-TYPE-MC
099280        IF WS-BATCH-ICA = ZEROS
099290           GO TO U-195B-INVALID.
           IF PET-CARD-TYPE-DISCOVER
           OR PET-CARD-TYPE-PAYPAL                                      03.47
              IF BE-DISCOVER-ACQUIRER-ID = ZEROS AND
                 BE-DISCOVER-CLIENT-ID = ZEROS
                    GO TO U-195B-INVALID                                02.39
              END-IF                                                    02.39
              IF CAT-CODE-DVAL = 'Y'                                    02.39
                 GO TO U-195-EXIT                                       02.39
              END-IF                                                    02.39
           END-IF.                                                      02.39
           IF PET-CARD-TYPE-VISA                                        03.27
099310        IF CAT-CODE-VVAL = 'Y'
099320           GO TO U-195-EXIT.
           IF PET-CARD-TYPE-MC OR
              (PET-CARD-TYPE-PL AND                                     02.29
              KDA-CHD-IS-VALID-PD)                                      02.29
                 IF CAT-CODE-MVAL = 'Y'                                 02.29
                    GO TO U-195-EXIT                                    02.29
                 END-IF                                                 02.29
           END-IF.                                                      02.29
           IF PET-CARD-TYPE-AMEX                                        02.29
              IF CAT-CODE-AVAL = 'Y'                                    02.29
                 IF WS-MRCH-IS-AMX-SETL                                 02.39
                 OR WS-MRCH-IS-AMX-EAP                                  03.16A
                    IF WS-VALID-AMERCAT-1PT-EAP                         03.16A
                       GO TO U-195-EXIT                                 02.29
                    ELSE                                                02.39
                       GO TO U-195B-INVALID                             02.39
                    END-IF                                              02.39
                 ELSE                                                   02.39
                    GO TO U-195-EXIT                                    02.39
                 END-IF                                                 02.39
              END-IF                                                    02.39
           END-IF.                                                      02.39
      *                                                                 02.39
099360 U-195-INVALID.
099370     MOVE 'Y'                      TO INVALID-MERCH-TYPE
099380                                      PET-SUS-FLAG.
099390     MOVE 07                       TO ER-CD (ER-INDX).
099400     SET ER-INDX UP BY 1.
099410     GO TO U-195-EXIT.
099420 U-195B-INVALID.
099430     MOVE 'Y'                      TO INVALID-MERCH-TYPE
099440                                      PET-SUS-FLAG.
099450     MOVE 89                       TO ER-CD (ER-INDX).
099460     SET ER-INDX UP BY 1.
099470 U-195-EXIT.
099480     EXIT.
099490*
099500 U-200-SLS-AMT-EDIT.
           MOVE 00                       TO AMT-ERR-CD.                 02.88
           IF AMOUNT-CHK NUMERIC                                        02.88
              COMPUTE PET-ACQ-AMOUNT = AMOUNT-CHK                       02.88
              IF AMOUNT-CHK > ZERO                                      02.88
                 NEXT SENTENCE                                          02.88
              ELSE                                                      02.88
                 MOVE 40                 TO AMT-ERR-CD                  02.88
                 PERFORM U-175-CH-SLS-AMNT-ERR                          02.88
                    THRU U-175-EXIT                                     02.88
                 GO TO U-200-SET-WORK-AMOUNT                            02.88
              END-IF                                                    02.88
           ELSE                                                         02.88
              COMPUTE PET-ACQ-AMOUNT = +0                               02.88
              MOVE 41                    TO AMT-ERR-CD                  02.88
              PERFORM U-175-CH-SLS-AMNT-ERR                             02.88
                 THRU U-175-EXIT                                        02.88
              GO TO U-200-SET-WORK-AMOUNT                               02.88
           END-IF.                                                      02.88
034740*
           IF MR1-VALID-RETURN                                          03.31
034680        COMPUTE KDA-TRAN-MC-USD-AMT = PET-ACQ-AMOUNT
034680                              * BASCRATE-RD-MCSB-USD-RATE
044920     ELSE
034680        COMPUTE KDA-TRAN-MC-USD-AMT = PET-ACQ-AMOUNT
034680                              * BASCRATE-RD-MCBS-USD-RATE.
034700     CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
034710                 C-TYPED  C-DECI02
034720                 C-TYPER  KDA-TRAN-MC-USD-AMT
034730                 C-TYPEEND.
034740*
           IF MR1-VALID-RETURN                                          03.31
034680        COMPUTE KDA-TRAN-USD-AMT = PET-ACQ-AMOUNT
034680                              * BASCRATE-RD-VSSB-USD-RATE
044920     ELSE
034680        COMPUTE KDA-TRAN-USD-AMT = PET-ACQ-AMOUNT
034680                              * BASCRATE-RD-VSBS-USD-RATE.
034700     CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
034710                 C-TYPED  C-DECI02
034720                 C-TYPER  KDA-TRAN-USD-AMT
034730                 C-TYPEEND.
034740*
           IF MR1-VALID-RETURN                                          03.31
034680        COMPUTE KDA-TRAN-GBP-AMT = PET-ACQ-AMOUNT
034680                              * BASCRATE-RD-VSSB-GBP-RATE
044920     ELSE
034680        COMPUTE KDA-TRAN-GBP-AMT = PET-ACQ-AMOUNT
034680                              * BASCRATE-RD-VSBS-GBP-RATE.
034700     CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
034710                 C-TYPED  C-DECI02
034720                 C-TYPER  KDA-TRAN-GBP-AMT
034730                 C-TYPEEND.
034740*
099750     IF PET-DEST-INT-SETL-GRP = ZEROS
              IF WS-CARD-TYPE = 'V'                                     03.27
                 IF KDA-TRAN-USD-AMT < VMA-MIN-AMOUNT                   02.81
                    MOVE 40              TO AMT-ERR-CD                  02.35
                    PERFORM U-175-CH-SLS-AMNT-ERR                       02.35
                       THRU U-175-EXIT                                  02.35
                    GO TO U-200-SLS-SET-ISS-AMT                         02.83
                 END-IF                                                 02.35
                 IF KDA-CHD-IS-VLPA OR KDA-CHD-IS-LRG-TKT               03.57
                       MOVE VMA-MAX-LRG-TKT                             02.81
                                         TO VMA-MAX-AMOUNT              02.81
                 ELSE                                                   02.81
                    COMPUTE VMA-ROW = +0                                02.81
                    PERFORM                                             02.81
                      VARYING SUB FROM +1 BY +1                         02.81
                      UNTIL   SUB > VMA-MAX-ENTRIES                     02.81
                        IF VMA-PRODUCT-ID(SUB) = KDA-VS-PRODUCT-ID      02.81
                           COMPUTE VMA-ROW = SUB                        02.81
                           COMPUTE SUB = VMA-MAX-ENTRIES                02.81
                        END-IF                                          02.81
                    END-PERFORM                                         02.81
                    IF VMA-ROW = +0                                     02.81
                       MOVE 99999999.999 TO VMA-MAX-AMOUNT              03.19
                    ELSE                                                02.81
                       EVALUATE TRUE                                    02.81
                         WHEN KDA-VS-PID-IS-INFIN-PRIV                  03.16V
                         WHEN KDA-VS-PID-IS-INFIN-BUS-PRI               03.16V
                           COMPUTE VMA-COL = +1                         03.16V
                         WHEN KDA-MRCH-TYP-TAX-PAY AND                  02.81
                              KDA-CHD-AR-IS-FND-SRC-PREPAID             02.81
                                COMPUTE VMA-COL = +5                    02.81
                         WHEN KDA-MRCH-TYP-TAX-PAY                      02.81
                           COMPUTE VMA-COL = +4                         02.81
                         WHEN KDA-PC-TRAN-IS-ACCT-FUND                  02.81
                           COMPUTE VMA-COL = +3                         02.81
                         WHEN KDA-CHD-AR-IS-FND-SRC-PREPAID             02.81
                           COMPUTE VMA-COL = +2                         02.81
                         WHEN OTHER                                     02.81
                           COMPUTE VMA-COL = +1                         02.81
                       END-EVALUATE                                     02.81
                       MOVE VMA-MAX-AMT(VMA-ROW,VMA-COL)                02.81
                                         TO VMA-MAX-AMOUNT              02.81
                    END-IF                                              02.81
                 END-IF                                                 02.81
                 IF KDA-TRAN-USD-AMT > VMA-MAX-AMOUNT                   02.81
                    MOVE 42              TO AMT-ERR-CD                  02.83
                    PERFORM U-175-CH-SLS-AMNT-ERR                       02.81
                       THRU U-175-EXIT                                  02.81
                    GO TO U-200-SLS-SET-ISS-AMT                         02.83
                 END-IF                                                 02.81
              ELSE                                                      02.81
                 IF WS-CARD-TYPE = 'M'                                  02.81
                    IF AMOUNT-CHK > MC-AMOUNT-MAX                       02.81
                       MOVE 42           TO AMT-ERR-CD                  02.81
                       PERFORM U-175-CH-SLS-AMNT-ERR                    02.81
                          THRU U-175-EXIT                               02.81
                       GO TO U-200-SLS-SET-ISS-AMT                      02.83
                    END-IF                                              02.81
                 END-IF                                                 02.81
              END-IF                                                    02.81
           END-IF.                                                      02.81
      *
       U-200-SLS-SET-ISS-AMT.                                           02.83
      *                                                                 02.83
           EVALUATE PET-CARD-USED
             WHEN 'M'
               MOVE +2                   TO WS-BAC-DEC
               EVALUATE TRUE                                            03.31
                 WHEN MR1-VALID-RETURN                                  03.31
                   COMPUTE PET-ISS-AMOUNT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-MCSB-USD-RATE
                 WHEN OTHER
                   COMPUTE PET-ISS-AMOUNT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-MCBS-USD-RATE
               END-EVALUATE
             WHEN 'P'
               MOVE BASCRATE-SD-REIMB-CURR-DEC
                                         TO WS-BAC-DEC
               COMPUTE PET-ISS-AMOUNT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-REIMB-MCBS-RATE
             WHEN 'V'
               MOVE BASCRATE-SD-REIMB-CURR-DEC
                                         TO WS-BAC-DEC
               EVALUATE TRUE                                            03.31
                 WHEN MR1-VALID-RETURN                                  03.31
                   COMPUTE PET-ISS-AMOUNT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-REIMB-VSSB-RATE
                 WHEN OTHER
                   COMPUTE PET-ISS-AMOUNT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-REIMB-VSBS-RATE
               END-EVALUATE
             WHEN OTHER
               MOVE BASCRATE-SD-REIMB-CURR-DEC
                                         TO WS-BAC-DEC
               COMPUTE PET-ISS-AMOUNT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-REIMB-VSBS-RATE
           END-EVALUATE.
      *
           CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                C-TYPED  WS-BAC-DEC
                C-TYPER  PET-ISS-AMOUNT
                C-TYPEEND.
      *
099910 U-200-SET-WORK-AMOUNT.
095990     PERFORM T-764-SET-WORK-AMT
096000        THRU T-764-EXIT.
096140     IF BASCRATE-SD-BATCH-CURR-CD = BASCRATE-SD-REIMB-CURR-CD
096140        GO TO U-200-EXIT.
096140     IF PET-REIMB-CURR-CODE = BASCRATE-SD-IIIAAA-CURR-CD
096130        COMPUTE PET-MRCH-FX-AMT = WORK-IIIAAA-AMT
096150                                - PET-REIMB-AMT
096140        GO TO U-200-EXIT.
096140     IF PET-REIMB-CURR-CODE = BASCRATE-SD-III999-CURR-CD
096130        COMPUTE PET-MRCH-FX-AMT = WORK-III999-AMT
096150                                - PET-REIMB-AMT
096140        GO TO U-200-EXIT.
096140     IF PET-REIMB-CURR-CODE = BASCRATE-SD-CENTER-CURR-CD
096130        COMPUTE PET-MRCH-FX-AMT = WORK-CENTER-AMT
096150                                - PET-REIMB-AMT
096140        GO TO U-200-EXIT.
      *
           EVALUATE PET-CARD-USED
             WHEN 'M'
               EVALUATE TRUE                                            03.31
                 WHEN MR1-VALID-RETURN                                  03.31
                   COMPUTE PET-MRCH-FX-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-REIMB-MCSB-RATE
                 WHEN OTHER
                   COMPUTE PET-MRCH-FX-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-REIMB-MCBS-RATE
               END-EVALUATE
             WHEN 'P'
               COMPUTE PET-MRCH-FX-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-REIMB-MCBS-RATE
             WHEN 'V'
               EVALUATE TRUE                                            03.31
                 WHEN MR1-VALID-RETURN                                  03.31
                   COMPUTE PET-MRCH-FX-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-REIMB-VSSB-RATE
                 WHEN OTHER
                   COMPUTE PET-MRCH-FX-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-REIMB-VSBS-RATE
               END-EVALUATE
             WHEN OTHER
               COMPUTE PET-MRCH-FX-AMT =
                       PET-ACQ-AMOUNT * BASCRATE-RD-REIMB-VSBS-RATE
           END-EVALUATE.
      *
096130     IF PET-MRCH-FX-AMT NOT = +0
095950        CALL BACONDEC USING BASCRATE-SD-BANK-KEY
095960             C-TYPED  BASCRATE-SD-REIMB-CURR-DEC
095970             C-TYPER  PET-MRCH-FX-AMT
095980             C-TYPEEND.
      *
099910 U-200-EXIT.
099920     EXIT.
100000*
100230 U-300-SPCL-VISA-EDIT.
076810     IF MIS3-MRCH-NAME(1:1) NOT = SPACE
076810        IF MIS3-MRCH-NAME(13:1) = '*' AND
076810           MIS3-MRCH-NAME(14:12) = SPACES AND
076810           KDA-VC-PHONE-ORD-5-9
076810              MOVE HLD-DESCR-NAME(1:12)
076810                                   TO MIS3-MRCH-NAME(14:12).
           MOVE KDA-CUST-SVC-PHONE       TO PET-TELE-NUM.
           MOVE KDA-PROPERTY-PHONE       TO PET-PROPERTY-PHONE.
           MOVE PET-ACQ-CURR-CODE        TO SRCH-CURR-CODE.
           MOVE SRCH-CURR-CODE-X         TO PET-AUTHORIZ-CURR-CD.
           IF NOT KDA-VC-PROG-REGIST-FLAG
              MOVE 'N'                   TO KDA-VISA-PROG-REGIST-FLAG.
           MOVE HOLD-MERCH-ID            TO PET-TMP-CARD-ACCEPTOR.
100290     MOVE HLD-VOLUME-TIER-IND      TO PET-VOLUME-TIER-IND.
           MOVE MIS3-VS-DYNAM-CURR-CONV  TO WS-VALID-VS-DYNAM-CURR-CONV.02.61
           IF VALID-VS-DYNAM-CURR-CONV                                  02.61
              MOVE MIS3-VS-DYNAM-CURR-CONV                              02.61
                                         TO PET-VS-DYNAM-CURR-CONV      02.61
           END-IF.                                                      02.61
           MOVE MIS3-VS-NO-PYMT-FORMS    TO WS-VALID-VS-NBR-PAY-FORMS.  03.16V
           IF VALID-VS-NBR-PAY-FORMS                                    03.16V
              MOVE MIS3-VS-NO-PYMT-FORMS                                03.16V
                                         TO PET-NO-PYMT-FORMS           03.16V
           END-IF.                                                      03.16V
      *                                                                 02.61
           MOVE MIS3-VS-SPEC-COND-IND    TO KDA-SPEC-COND-IND           02.53
                                            RCL-5-SPC-COND.
      *
           IF NOT KDA-VC-SPEC-COND-IND-1
              GO TO U-300-SPEC-COND-ERROR.
           IF KDA-MERCAT-LODGING
              IF KDA-BATCH-BIN-REGION = '1'
                 IF KDA-VC-SPEC-COND-IND-2-US-LDG
                    MOVE MIS3-VS-SPEC-COND-IND                          02.53
                                         TO PET-SPEC-COND
                    GO TO U-300-SPEC-COND-DONE
                 ELSE
                    GO TO U-300-SPEC-COND-ERROR
              ELSE
                 IF KDA-VC-SPEC-COND-IND-2-LDG
                    MOVE MIS3-VS-SPEC-COND-IND                          02.53
                                         TO PET-SPEC-COND
                    GO TO U-300-SPEC-COND-DONE
                 ELSE
                    GO TO U-300-SPEC-COND-ERROR
           ELSE
              IF KDA-VC-SPEC-COND-IND-2
                 MOVE MIS3-VS-SPEC-COND-IND                             02.53
                                         TO PET-SPEC-COND               02.53
                 GO TO U-300-SPEC-COND-DONE.
      *
       U-300-SPEC-COND-ERROR.
      *
           MOVE ONE-AST                  TO RCL-5-SPC-COND-ERR-IND.
           MOVE 'Y'                      TO PET-SUS-FLAG.               02.29
           MOVE 99                       TO ER-CD(ER-INDX).             02.29
           SET ER-INDX UP BY 1.                                         02.29
      *
       U-300-SPEC-COND-DONE.
      *
           MOVE MIS3-VS-POS-ENVIRONMENT  TO KDA-POS-ENV                 02.53
                                            RVS-2-POS-ENV.
           MOVE MIS3-PHONE-ORD           TO KDA-PHONE-ORD
                                            RCL-2-MOTO-ECOM.
           IF MR1-VALID-RETURN                                          03.31
              IF KDA-MERCAT-DIRECT-MKT                                  02.32
                 IF KDA-VC-PHONE-ORD-SPACE AND                          02.32
                    KDA-BATCH-BIN-REGION = '1'                          02.32
                       MOVE '4'          TO KDA-PHONE-ORD               02.32
                       MOVE '?'          TO RCL-2-MOTO-ECOM-ERR-IND     02.32
                 END-IF                                                 02.32
              END-IF                                                    02.32
              GO TO U-300-POS-ENV-DONE                                  02.32
           END-IF.                                                      02.32
068290     IF KDA-PHONE-ORD = '2'
              IF KDA-BATCH-BIN-REGION NOT = '1'
068290           MOVE SPACE              TO KDA-PHONE-ORD
068290        END-IF
068290        IF KDA-POS-ENV = SPACE
068290           MOVE 'R'                TO KDA-POS-ENV
                 MOVE '?'                TO RVS-2-POS-ENV-ERR-IND
              END-IF
           END-IF.
           IF KDA-PHONE-ORD = '3'                                       02.29
              IF KDA-POS-ENV = SPACE                                    02.29
                 MOVE 'I'                TO KDA-POS-ENV                 02.29
                 MOVE '?'                TO RVS-2-POS-ENV-ERR-IND       02.29
              END-IF                                                    02.29
           END-IF.                                                      02.29
           IF NOT KDA-VC-POS-ENV                                        02.29
              GO TO U-300-POS-ENV-ERROR                                 02.29
           END-IF.                                                      02.29
           MOVE KDA-POS-ENV              TO PET-POS-ENVIRONMENT.        02.29
      *
           IF KDA-MERCAT-DIRECT-MKT AND
              KDA-VC-PHONE-ORD-SPACE
              IF PET-POS-ENVIRONMENT = SPACE                            02.29
                 GO TO U-300-POS-ENV-ERROR                              02.29
              ELSE                                                      02.29
                 IF KDA-VC-POS-ENV-RECUR                                02.29
                    IF KDA-BATCH-BIN-REGION = '1'                       02.29
                       MOVE '4'          TO KDA-PHONE-ORD               02.29
                    END-IF                                              02.29
                 ELSE                                                   02.29
                    IF KDA-VC-POS-ENV-INSTALL                           02.29
                       MOVE '3'          TO KDA-PHONE-ORD               02.29
                    END-IF                                              02.29
                 END-IF                                                 02.29
              END-IF                                                    02.29
           END-IF.                                                      02.29
      *                                                                 02.29
           GO TO U-300-POS-ENV-DONE.                                    02.29
      *                                                                 02.29
       U-300-POS-ENV-ERROR.                                             02.29
      *                                                                 02.29
           MOVE ONE-AST               TO RVS-2-POS-ENV-ERR-IND.         02.29
           MOVE 'Y'                   TO PET-SUS-FLAG.                  02.29
           MOVE 256                   TO ER-CD-3-DIG(ER-INDX).          02.29
           SET ER-INDX UP BY 1.                                         02.29
      *                                                                 02.29
       U-300-POS-ENV-DONE.                                              02.29
      *                                                                 02.29
100440     IF KDA-VC-PHONE-ORD
100450        MOVE KDA-PHONE-ORD         TO PET-MAIL-PHONE-IND
              GO TO U-300-PHONE-ORD-DONE                                02.29
           END-IF.                                                      02.29
      *                                                                 02.29
       U-300-PHONE-ORD-ERROR.                                           02.29
      *                                                                 02.29
           MOVE ONE-AST                  TO RCL-2-MOTO-ECOM-ERR-IND.    02.29
           MOVE 'Y'                      TO PET-SUS-FLAG.               02.29
           MOVE 257                      TO ER-CD-3-DIG(ER-INDX).       02.29
           SET ER-INDX UP BY 1.                                         02.29
      *                                                                 02.29
       U-300-PHONE-ORD-DONE.                                            02.29
      *
           MOVE MIS3-VS-MKT-SPC-AUTH-DATA                               02.53
                                         TO KDA-MARKET-SPC-AUTH-DATA-IND
                                            RVS-1-MKT-SPC-DAT.
101520     IF KDA-VC-MARKET-SPC-AUTH-DATA-ID
              MOVE MIS3-VS-MKT-SPC-AUTH-DATA                            02.53
101540                                   TO PET-SPC-AUTH-DATA-IND
101550     ELSE
              MOVE ONE-AST               TO RVS-1-MKT-SPC-DAT-ERR-IND
101570        MOVE 'Y'                   TO PET-SUS-FLAG
101580        MOVE 224                   TO ER-CD-3-DIG (ER-INDX)
101590        SET ER-INDX UP BY 1.
      *
           IF KDA-VC-MKT-SPC-AUTH-BILL-PAY                              02.23
              IF NOT KDA-VC-PHONE-ORD-BILL-PAY                          02.23
                 MOVE ONE-AST            TO RVS-1-MKT-SPC-DAT-ERR-IND   02.23
                                            RCL-2-MOTO-ECOM-ERR-IND     02.23
                 MOVE 'Y'                TO PET-SUS-FLAG                02.23
                 MOVE 228                TO ER-CD-3-DIG (ER-INDX)       02.23
                 SET ER-INDX UP BY 1                                    02.23
              END-IF                                                    02.23
           END-IF.                                                      02.23
      *
           MOVE MIS3-AUTHORIZE-SRCE      TO KDA-AUTH-SRCE
                                            RCL-3-AUTH-SRC.
           IF KDA-VC-AUTH-SRCE OR
              KDA-VC-AUTH-SRCE-07
                 MOVE MIS3-AUTHORIZE-SRCE
                                         TO PET-TMP-AUTHOR-SRCE
           ELSE
              MOVE ONE-AST               TO RCL-3-AUTH-SRC-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 205                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
           MOVE MIS3-POS-TERM            TO KDA-POS-TERM
                                            RCL-3-POS-TRM-CAP.
           IF KDA-VC-POS-TERM                                           02.24
              MOVE MIS3-POS-TERM         TO PET-TMP-POS-TERM-CAP        02.24
           ELSE                                                         02.24
              MOVE ONE-AST               TO RCL-3-POS-TRM-CAP-ERR-IND   02.24
              MOVE 'Y'                   TO PET-SUS-FLAG                02.24
              MOVE 206                   TO ER-CD-3-DIG (ER-INDX)       02.24
              SET ER-INDX UP BY 1                                       02.24
           END-IF.                                                      02.24
           MOVE MIS3-POS-ENTRY-MODE      TO KDA-POS-ENTRY-MODE
                                            RCL-3-POS-E-MOD.
      *                                                                 03.46
           IF KDA-CHD-AR-IS-TOKEN                                       03.46
              MOVE 'Y'                   TO PET-VS-A360-TOKEN-IND       03.46
                                            RVS-4-TOKEN-IND             03.46
              IF NOT KDA-VC-POS-ENTRY-NON-F2F                           03.46
                 MOVE ONE-AST            TO RCL-3-POS-E-MOD-ERR-IND     03.46
                                            RVS-4-TOKEN-IND-ERR-IND     03.46
                 MOVE 'Y'                TO PET-SUS-FLAG                03.46
                 MOVE 207                TO ER-CD-3-DIG (ER-INDX)       03.46
                 SET ER-INDX UP BY 1                                    03.46
              END-IF                                                    03.46
           ELSE                                                         03.46
           IF KDA-VS-PID-IS-ELECTRON                                    03.46
100850        IF KDA-VC-POS-ENTRY-MODE
100860           MOVE MIS3-POS-ENTRY-MODE
100870                                   TO PET-TMP-POS-ENTRY-MOD
100880        ELSE
                 MOVE ONE-AST            TO RCL-3-POS-E-MOD-ERR-IND
100900           MOVE 'Y'                TO PET-SUS-FLAG
100910           MOVE 207                TO ER-CD-3-DIG (ER-INDX)
 00920           SET ER-INDX UP BY 1
              END-IF                                                    03.46
101340     ELSE
           IF MR1-VALID-CASH AND                                        03.31
              MR1-VALID-MIS3-TRAN                                       03.31
100850        IF KDA-VC-POS-ENTRY-MODE-REST
100860           MOVE MIS3-POS-ENTRY-MODE
100870                                   TO PET-TMP-POS-ENTRY-MOD
100880        ELSE
                 MOVE ONE-AST            TO RCL-3-POS-E-MOD-ERR-IND
100900           MOVE 'Y'                TO PET-SUS-FLAG
100910           MOVE 207                TO ER-CD-3-DIG (ER-INDX)
100920           SET ER-INDX UP BY 1
              END-IF                                                    03.46
100930     ELSE
100940        IF KDA-VC-POS-ENTRY-MODE-ANY
100950           MOVE MIS3-POS-ENTRY-MODE
100960                                   TO PET-TMP-POS-ENTRY-MOD
100970        ELSE
                 MOVE ONE-AST            TO RCL-3-POS-E-MOD-ERR-IND
100990           MOVE 'Y'                TO PET-SUS-FLAG
101000           MOVE 207                TO ER-CD-3-DIG (ER-INDX)
101010           SET ER-INDX UP BY 1                                    03.46
              END-IF                                                    03.46
           END-IF                                                       03.46
           END-IF                                                       03.46
           END-IF.                                                      03.46
           MOVE MIS3-CARDHLDR-ID         TO KDA-CARDHLDR-ID
                                            RCL-4-CRD-ID-MTHD.
101040     IF KDA-VC-CARDHLDR-ID
101050        MOVE MIS3-CARDHLDR-ID      TO PET-TMP-CARDHLDR-ID
101060     ELSE
              MOVE ONE-AST               TO RCL-4-CRD-ID-MTHD-ERR-IND
101080        MOVE 'Y'                   TO PET-SUS-FLAG
101090        MOVE 208                   TO ER-CD-3-DIG (ER-INDX)
101100        SET ER-INDX UP BY 1.
           MOVE SPACE                    TO KDA-PAY-SVC-IND.
           MOVE MIS3-VS-AUTH-CHAR-IND    TO KDA-AUTH-CHAR-IND           02.53
                                            RCL-4-AUTH-CHAR.
101190     IF KDA-AUTH-CHAR-IND = SPACE
101190        MOVE 'N'                   TO KDA-AUTH-CHAR-IND
           END-IF.
101190     IF NOT KDA-VC-AUTH-CHAR-IND
              MOVE ONE-AST               TO RCL-4-AUTH-CHAR-ERR-IND
101270        MOVE 'Y'                   TO PET-SUS-FLAG
101280        MOVE 210                   TO ER-CD-3-DIG(ER-INDX)
101290        SET ER-INDX UP BY 1.
      *    CHECK FOR VALID AUTH CHAR / MOTO-ECOM COMBINATIONS           03.40
      *    PER BASEII CLEARING EP RLSE 4 MESSAGES MANUAL, V1089 ERROR   03.40
      *    LOOSENED UP EDITS TO ONLY CHECK ON MOTO FIRST, AS VISA EDITS 03.59
      *    ARE NOT AS TIGHT AS V1089 ERROR DESCRIBES IN MANUAL          03.59
           MOVE SPACES                      TO WS-ACI-PH-ORD-CMB-ERR    03.40
           IF KDA-VC-PHONE-ORD-5                                        03.59
              IF KDA-VC-AUTH-CHAR-U OR                                  03.62V
                 KDA-VC-AUTH-CHAR-B                                     03.62V
      *          OK COMBINATION, DO NOT ERROR                           03.40
                 GO TO U-300-ACI-PH-ORD-CMB-CHK-DONE                    03.40
              ELSE                                                      03.40
                 MOVE 'Y'                   TO WS-ACI-PH-ORD-CMB-ERR    03.40
              END-IF                                                    03.40
           END-IF.                                                      03.40
           IF KDA-VC-PHONE-ORD-6                                        03.59
              IF KDA-VC-AUTH-CHAR-S                                     03.59
      *          OK COMBINATION, DO NOT ERROR                           03.40
                 GO TO U-300-ACI-PH-ORD-CMB-CHK-DONE                    03.40
              ELSE                                                      03.40
                 MOVE 'Y'                   TO WS-ACI-PH-ORD-CMB-ERR    03.40
              END-IF                                                    03.40
           END-IF.                                                      03.40
           IF KDA-VC-PHONE-ORD-7 AND KDA-VC-MKT-SPC-AUTH-BILL-PAY       03.40
              IF KDA-VC-AUTH-CHAR-A   OR                                03.40
                 KDA-VC-AUTH-CHAR-E   OR                                03.40
                 KDA-VC-AUTH-CHAR-K                                     03.40
                    MOVE 'Y'                TO WS-ACI-PH-ORD-CMB-ERR    03.40
              ELSE                                                      03.40
      *          OK COMBINATION, DO NOT ERROR                           03.40
                 GO TO U-300-ACI-PH-ORD-CMB-CHK-DONE                    03.40
              END-IF                                                    03.40
           END-IF.                                                      03.40
           IF WS-ACI-PH-ORD-CMB-ERR = 'Y'                               03.40
              MOVE ONE-AST                  TO RCL-4-AUTH-CHAR-ERR-IND  03.40
                                               RCL-2-MOTO-ECOM-ERR-IND  03.40
              MOVE 'Y'                      TO PET-SUS-FLAG             03.40
              MOVE 201                      TO ER-CD-3-DIG(ER-INDX)     03.40
              SET ER-INDX UP BY 1                                       03.40
           END-IF.                                                      03.40
      *                                                                 03.40
       U-300-ACI-PH-ORD-CMB-CHK-DONE.                                   03.40
      *                                                                 03.40
           MOVE MIS3-VS-TRAN-CD-QUAL-X   TO RVS-2-TRAN-QUAL.            02.53
           MOVE MIS3-CAT-TERM-LVL        TO KDA-CAT-TERM-LVL
                                            RCL-5-CAT-TRM.
           IF KDA-VC-CAT-TERM-LVL-VS
              MOVE MIS3-CAT-TERM-LVL     TO PET-CATM-IND
           ELSE
              MOVE ONE-AST               TO RCL-5-CAT-TRM-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 211                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
      *
           IF KDA-CHD-AR-BIN-REGION = '1'
              IF KDA-VC-AVS-RESPONSE-CODE-US OR
                 KDA-VC-AVS-RESPONSE-CODE-SPACE
                    NEXT SENTENCE                                       02.23
              ELSE
                 MOVE ONE-AST            TO RCL-6-AVS-RESP-ERR-IND
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 212                TO ER-CD-3-DIG (ER-INDX)
                 SET ER-INDX UP BY 1
              END-IF
           ELSE
           IF KDA-VC-AVS-RESP-CD-INT OR
              KDA-VC-AVS-RESPONSE-CODE-SPACE
                 NEXT SENTENCE                                          02.23
           ELSE
           IF KDA-CHD-AR-BIN-REGION = '3' AND
              WS-CHD-AR-BIN-COUNTRY = 'GB' AND
              KDA-VC-AVS-RESP-CD-GB-ONLY
                 NEXT SENTENCE                                          02.23
           ELSE
              MOVE ONE-AST               TO RCL-6-AVS-RESP-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 212                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
      *
           MOVE MIS3-VS-SERV-DEVELOP     TO KDA-SERV-DEVELOP            02.53
                                            RVS-2-SVC-DEVEL.
101410     IF KDA-VC-SERV-DEVELOP
101430        MOVE MIS3-VS-SERV-DEVELOP  TO PET-SERV-DEVELOP            02.53
101440     ELSE
              MOVE ONE-AST               TO RVS-2-SVC-DEVEL-ERR-IND
101460        MOVE 'Y'                   TO PET-SUS-FLAG
101470        MOVE 204                   TO ER-CD-3-DIG (ER-INDX)
101480        SET ER-INDX UP BY 1.
      *
           MOVE MIS3-VS-CRD-VER-RESULT   TO KDA-CVV2-RESULT             02.53
                                            RVS-2-CRD-VER-RES.
101410     IF KDA-VC-CVV2-RESULT
              MOVE MIS3-VS-CRD-VER-RESULT                               02.53
                                         TO PET-CVV2-RESULT-CODE        02.53
101440     ELSE
              MOVE MIS3-VS-CRD-VER-RESULT                               02.53
                                         TO PET-CVV-RESULT-CODE         02.53
           END-IF.                                                      02.53
      *
           MOVE MIS3-VS-CHIP-COND-CD     TO KDA-CHIP-COND-CODE          02.53
                                            RVS-2-CHIP-COND.
101410     IF KDA-VC-CHIP-COND-CODE
              MOVE MIS3-VS-CHIP-COND-CD  TO PET-CHIP-COND-CODE          02.53
101440     ELSE
              MOVE ONE-AST               TO RVS-2-CHIP-COND-ERR-IND
101460        MOVE 'Y'                   TO PET-SUS-FLAG
101470        MOVE 203                   TO ER-CD-3-DIG (ER-INDX)
101480        SET ER-INDX UP BY 1.
      *
           MOVE MIS3-VS-ECGI             TO KDA-ELEC-COMM-GOODS-IND     02.53
                                            RVS-2-ECGI.
101410     IF KDA-VC-ECGI
101420        MOVE MIS3-VS-ECGI          TO PET-VISA-ECGI               02.53
101440     ELSE
              MOVE ONE-AST               TO RVS-2-ECGI-ERR-IND
101460        MOVE 'Y'                   TO PET-SUS-FLAG
101470        MOVE 230                   TO ER-CD-3-DIG (ER-INDX)
101480        SET ER-INDX UP BY 1.
      *
           MOVE MIS3-VS-PURCH-IDENT-FRMT TO KDA-PURCHASE-IDENT-FORMAT   02.53
                                            RCL-6-PRCH-ID-FMT.
           MOVE MIS3-VS-PURCH-IDENT      TO RCL-6-PRCH-ID-NO.           02.53
           IF MIS3-VS-PURCH-IDENT NOT = SPACES                          02.53
              IF MIS3-VS-PURCH-IDENT(1:1) = SPACE                       02.53
                 MOVE SPACES             TO HOLD2-FIELD
                 MOVE +1                 TO START-SUB
                 MOVE +25                TO END-SUB
                                            END2-SUB
                 MOVE MIS3-VS-PURCH-IDENT                               02.53
                                         TO HOLD-FIELD
                 PERFORM C-381-EDIT-MA-FIELDS
                    THRU C-381-EXIT
                 MOVE HOLD2-FIELD        TO MIS3-VS-PURCH-IDENT         02.53
                 MOVE '?'                TO RCL-6-PRCH-ID-NO-ERR-IND
              END-IF                                                    03.58
              IF MIS3-VS-PURCH-IDENT(1:1) = '[' OR ']'                  03.58
                 MOVE ONE-AST         TO RCL-6-PRCH-ID-NO-ERR-IND       03.41
                 MOVE 'Y'             TO PET-SUS-FLAG                   03.41
                 MOVE 214             TO ER-CD-3-DIG (ER-INDX)          03.41
                 SET ER-INDX UP BY 1                                    03.41
              END-IF
           END-IF.
101650*
           IF MR1-VALID-CASH AND                                        03.31
              MR1-VALID-MIS3-TRAN                                       03.31
101670        IF KDA-VC-PURCHASE-IDENT-CSH
101680           MOVE MIS3-VS-PURCH-IDENT-FRMT                          02.53
101690                                   TO PET-PURCHASE-IDENTIFIER
101700        ELSE
                 MOVE ONE-AST            TO RCL-6-PRCH-ID-FMT-ERR-IND
101720           MOVE 'Y'                TO PET-SUS-FLAG
101730           MOVE 227                TO ER-CD-3-DIG (ER-INDX)
101740           SET ER-INDX UP BY 1
101750     ELSE
101760        IF KDA-VC-PURCHASE-IDENT-FORMAT
101770           MOVE MIS3-VS-PURCH-IDENT-FRMT                          02.53
101780                                   TO PET-PURCHASE-IDENTIFIER
101790        ELSE
                 MOVE ONE-AST            TO RCL-6-PRCH-ID-FMT-ERR-IND
101810           MOVE 'Y'                TO PET-SUS-FLAG
101820           MOVE 213                TO ER-CD-3-DIG (ER-INDX)
101830           SET ER-INDX UP BY 1.
           IF MR1-VALID-CASH AND                                        03.31
              MR1-VALID-MIS3-TRAN                                       03.31
101850        IF MIS3-VS-PURCH-IDENT = SPACES                           02.53
101860           NEXT SENTENCE
101870        ELSE
                 MOVE ONE-AST            TO RCL-6-PRCH-ID-NO-ERR-IND
101890           MOVE 'Y'                TO PET-SUS-FLAG
101900           MOVE 214                TO ER-CD-3-DIG (ER-INDX)
101910           SET ER-INDX UP BY 1
101920     ELSE
101930        IF KDA-VC-PURCHASE-IDENT-FORMAT                           02.53
101940           IF MIS3-VS-PURCH-IDENT = SPACES
101940           AND KDA-VC-PURCHASE-IDENT-REQ
                    MOVE ONE-AST         TO RCL-6-PRCH-ID-NO-ERR-IND
101960              MOVE 'Y'             TO PET-SUS-FLAG
101970              MOVE 214             TO ER-CD-3-DIG (ER-INDX)
101980              SET ER-INDX UP BY 1
101990           ELSE
102000              MOVE MIS3-VS-PURCH-IDENT                            02.53
102010                                   TO PET-PURCHASE-IDENT.
           IF MR1-VALID-RETURN AND                                      03.31
              MR1-VALID-MIS3-TRAN                                       03.31
                NEXT SENTENCE                                           03.31
           ELSE
              IF (KDA-AUTH-RESP-CD-1 = SPACE OR
                  KDA-VC-AUTH-RESP-CD-1) AND
                 (KDA-AUTH-RESP-CD-2 = SPACE OR
                  KDA-VC-AUTH-RESP-CD-2)
                    NEXT SENTENCE
              ELSE
                 MOVE ONE-AST            TO RCL-5-AUTH-RESP-ERR-IND
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 217                TO ER-CD-3-DIG (ER-INDX)
                 SET ER-INDX UP BY 1
              END-IF
           END-IF.
      *
           MOVE MIS3-VS-VALID-CODE       TO RVS-1-VALID-CODE.           02.53
102280     IF MIS3-VS-VALID-CODE = SPACES AND                           02.53
             (MR1-VALID-SALE OR                                         03.31
              MR1-VALID-CASH) AND                                       03.31
              MR1-VALID-MIS3-TRAN                                       03.31
              IF KDA-VC-NOT-AC-PAY-SVC
102280           NEXT SENTENCE
102340        ELSE
                 MOVE ONE-AST            TO RVS-1-VALID-CODE-ERR-IND
102310           MOVE 'Y'                TO PET-SUS-FLAG
102320           MOVE 221                TO ER-CD-3-DIG (ER-INDX)
102330           SET ER-INDX UP BY 1
102340     ELSE
              IF MR1-VALID-RETURN AND                                   03.31
                 MR1-VALID-MIS3-TRAN                                    03.31
102360             MOVE SPACES           TO PET-VALID-CD
                   MOVE '?'              TO RVS-1-VALID-CODE-ERR-IND
102370         ELSE
                   MOVE MIS3-VS-VALID-CODE                              02.53
                                         TO PET-VALID-CD                02.53
              END-IF                                                    02.53
           END-IF.                                                      02.53
      *
           MOVE MIS3-VS-TRANS-IDENT-X    TO RVS-1-TRANS-IDENT-X.        02.53
           IF MIS3-VS-TRANS-IDENT-X = SPACES                            02.53
              MOVE ZEROS                 TO MIS3-VS-TRANS-IDENT-X       02.53
              MOVE '?'                   TO RVS-1-TRANS-IDENT-ERR-IND
           END-IF.
102190     IF MIS3-VS-TRANS-IDENT-X NUMERIC                             02.53
102200        MOVE MIS3-VS-TRANS-IDENT   TO PET-TRANS-IDNTFIER.         02.53
           IF MIS3-VS-TRANS-IDENT = ZEROS
              IF KDA-VC-AUTH-CHAR-N OR                                  03.31
                (MR1-VALID-RETURN AND                                   03.31
                 MR1-VALID-MIS3-TRAN)                                   03.31
                    GO TO U-300-TRANS-IDENT-DONE
              END-IF
              IF KDA-VISA-REF(1:1) = '2'
                 GO TO U-300-TRANS-IDENT-ERROR
              END-IF
              GO TO U-300-TRANS-IDENT-DONE
           END-IF.
           MOVE 'DKK'                    TO DC-OPERATION.
           MOVE ZEROS                    TO DC-SEND-DATEX.
           MOVE MIS3-VS-TRANS-IDENT-X(3:4)                              02.53
                                         TO DC-SEND-DATEX(5:4).         02.53
           MOVE HLD-REF-DATE             TO DC-SEND-NUM.
           PERFORM D-100-CALL-DATECONV
              THRU D-100-EXIT.
           IF DC-NOT-SUCCESSFUL OR
             (DC-RESULT = 01 AND                                        02.50
             (DC-RETURN-NUM > 1))                                       02.50
                 IF KDA-VISA-REF(1:1) = '2'                             02.50
                    GO TO U-300-TRANS-IDENT-ERROR                       02.50
                 END-IF                                                 02.50
                 MOVE ZEROS              TO PET-TRANS-IDNTFIER          02.50
                 MOVE '?'                TO RVS-1-TRANS-IDENT-ERR-IND   02.50
           END-IF.
      *
           GO TO U-300-TRANS-IDENT-DONE.
      *
       U-300-TRANS-IDENT-ERROR.
      *
           MOVE ONE-AST                  TO RVS-1-TRANS-IDENT-ERR-IND.
           MOVE 'Y'                      TO PET-SUS-FLAG.
           MOVE 218                      TO ER-CD-3-DIG(ER-INDX).
           SET ER-INDX UP BY 1.
      *
       U-300-TRANS-IDENT-DONE.
      *
           IF MIS3-VS-INFO-IND NOT = SPACE                              02.53
              MOVE MIS3-VS-INFO-IND      TO RVS-1-INFO-IND              02.53
              IF MIS3-VS-INFO-IND = 'Y' OR 'N'                          02.53
                 MOVE MIS3-VS-INFO-IND   TO PET-INFO-IND                02.53
              ELSE
                 MOVE ONE-AST            TO RVS-1-INFO-IND-ERR-IND
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 222                TO ER-CD-3-DIG (ER-INDX)
                 SET ER-INDX UP BY 1.
           IF MIS3-VS-INFO-IND = 'Y' OR 'N'                             02.53
             MOVE MIS3-TELE-NUM          TO RVS-1-TELE-NO
             IF HLD-INET-COUNTRY = 'CAN' OR 'USA'
               IF (MIS3-TELE-NUM(1:10) NUMERIC)      AND
                  (MIS3-TELE-NUM(1:3) NOT = ZEROS)   AND
                  (MIS3-TELE-NUM(4:3) NOT = ZEROS)
                 MOVE MIS3-TELE-NUM      TO PET-TELE-NUM
                 MOVE MIS3-TELE-NUM(1:10)
                                         TO KDA-CUST-SVC-PHONE
               END-IF
             ELSE
               MOVE MIS3-TELE-NUM        TO PET-TELE-NUM
               MOVE MIS3-TELE-NUM(1:10)  TO KDA-CUST-SVC-PHONE
             END-IF
             IF PET-TELE-NUM = SPACES
               MOVE ONE-AST              TO RVS-1-INFO-IND-ERR-IND
102520         MOVE 'Y'                  TO PET-SUS-FLAG
102530         MOVE 223                  TO ER-CD-3-DIG (ER-INDX)
102540         SET ER-INDX UP BY 1
             END-IF
           END-IF.
      *
           MOVE PET-TELE-NUM             TO RRD-CSP-PHONE.
           MOVE RRD-CSP-DATA             TO RCL-5-OPTIONAL-DATA.
           MOVE RESET-RRD-CSP-DATA       TO RRD-CSP-DATA.
      *
           MOVE '  AUTH AMT  '           TO RRD-AMT-ID.
           IF MIS3-AUTH-AMT-X = SPACES
              MOVE SPACES                TO RRD-AMT-X
              MOVE ZEROS                 TO MIS3-AUTH-AMT
           ELSE
           IF MIS3-AUTH-AMT NUMERIC
              MOVE MIS3-AUTH-AMT         TO RRD-AMT
                                            PET-AUTHORIZ-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-AUTH-AMT-X       TO RRD-AMT-X
              MOVE ONE-AST               TO RRD-AMT-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 219                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
           MOVE RRD-AMT-DATA             TO RCL-2-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           MOVE '  TOT AMT   '           TO RRD-AMT-ID.
           IF MIS3-VS-TOT-AUTH-AMT-X = SPACES                           02.53
              MOVE SPACES                TO RRD-AMT-X
              MOVE ZEROS                 TO MIS3-VS-TOT-AUTH-AMT        02.53
           ELSE
           IF MIS3-VS-TOT-AUTH-AMT NUMERIC                              02.53
              MOVE MIS3-VS-TOT-AUTH-AMT  TO RRD-AMT                     02.53
                                            PET-TOTAL-AUTH-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-VS-TOT-AUTH-AMT-X                               02.53
                                         TO RRD-AMT-X                   02.53
              MOVE ONE-AST               TO RRD-AMT-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 220                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
           MOVE RRD-AMT-DATA             TO RCL-3-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           MOVE '  CASH AMT  '           TO RRD-AMT-ID.
           IF MIS3-CASH-BACK-AMT-X = SPACES
              MOVE SPACES                TO RRD-AMT-X
              MOVE ZEROS                 TO MIS3-CASH-BACK-AMT
           ELSE
           IF MIS3-CASH-BACK-AMT NUMERIC
              MOVE MIS3-CASH-BACK-AMT    TO RRD-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-CASH-BACK-AMT-X  TO RRD-AMT-X
              MOVE ONE-AST               TO RRD-AMT-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 215                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
           IF MIS3-AMOUNT NUMERIC AND
              MIS3-CASH-BACK-AMT NUMERIC
                 IF MIS3-CASH-BACK-AMT < MIS3-AMOUNT
                    MOVE MIS3-CASH-BACK-AMT
                                         TO PET-CASH-BACK-AMT
                 ELSE
                    MOVE ONE-AST         TO RRD-AMT-ERR-IND
                    MOVE 'Y'             TO PET-SUS-FLAG
                    MOVE 229             TO ER-CD-3-DIG (ER-INDX)
                    SET ER-INDX UP BY 1.
           MOVE RRD-AMT-DATA             TO RCL-4-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           PERFORM U-700-SURCHARGE-EDITS THRU U-700-EXIT.               02.95
      *                                                                 02.95
           IF MR1-VALID-CASH AND                                        03.31
              MR1-VALID-MIS3-TRAN                                       03.31
              IF MIS3-VS-ATM-ACCT-SELECT = SPACES                       03.62V
                 MOVE '0'                TO MIS3-VS-ATM-ACCT-SELECT     03.62V
              END-IF                                                    03.62V
              MOVE MIS3-VS-ATM-ACCT-SELECT                              03.62V
103180                                   TO KDA-VISA-ACCOUNT-SELECT     03.62V
103180                                      RVS-4-ACCT-TYPE             03.62V
103200        IF KDA-VC-ATM-ACCOUNT-SELECT
                 MOVE MIS3-VS-ATM-ACCT-SELECT                           02.53
103220                                   TO PET-ATM-ACCT                03.62V
              ELSE                                                      03.62V
                 MOVE ONE-AST            TO RVS-4-ACCT-TYPE-ERR-IND     03.62V
                 MOVE 'Y'                TO PET-SUS-FLAG                03.62V
                 MOVE 271                TO ER-CD-3-DIG (ER-INDX)       03.62V
                 SET ER-INDX UP BY 1                                    03.62V
              END-IF                                                    03.62V
           ELSE                                                         03.62V
              MOVE MIS3-VS-ATM-ACCT-SELECT                              03.62V
103180                                   TO KDA-VISA-ACCOUNT-SELECT     03.62V
103180                                      RVS-4-ACCT-TYPE             03.62V
103200        IF KDA-VC-POS-ACCOUNT-SELECT                              03.62V
                 MOVE MIS3-VS-ATM-ACCT-SELECT                           03.62V
103220                                   TO PET-ATM-ACCT                03.62V
              ELSE                                                      03.62V
                 MOVE ONE-AST            TO RVS-4-ACCT-TYPE-ERR-IND     03.62V
                 MOVE 'Y'                TO PET-SUS-FLAG                03.62V
                 MOVE 271                TO ER-CD-3-DIG (ER-INDX)       03.62V
                 SET ER-INDX UP BY 1                                    03.62V
              END-IF                                                    03.62V
           END-IF.                                                      03.62V
      *
318563     PERFORM U-110-VALIDATE-AUTH
318563        THRU U-110-EXIT.
           IF AUTH-ERR
              MOVE 4                     TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE ONE-AST               TO RCL-2-AUTH-CODE-ERR-IND
           ELSE
              MOVE AUTH-SPACE-WORK       TO PET-AUTH-CD.
      *                                                                 02.23
           MOVE 'N'                      TO WS-INSTALL-LINE-SW.         02.23
           IF MIS3-VS-INSTL-INFO = SPACES                               02.23
              GO TO U-300-INSTALL-DONE.                                 03.42V
           IF NOT KDA-VC-POS-ENV-INSTALL                                02.29
              GO TO U-300-INSTALL-DONE.                                 03.42V
      *                                                                 02.23
           IF MIS3-VS-INSTL-FREQUENCY = SPACE AND                       02.23
              (MIS3-VS-INSTL-TOTAL-AMT-X = SPACES OR ZEROS) AND         02.23
              (MIS3-VS-INSTL-TOTAL-NO-X = SPACES OR ZEROS) AND          02.23
              (MIS3-VS-INSTL-NO-X = SPACES OR ZEROS)                    02.23
                 GO TO U-300-INSTALL-DONE                               03.42V
           END-IF.                                                      02.23
      *                                                                 02.23
           MOVE 'Y'                      TO WS-INSTALL-LINE-SW.         02.23
           MOVE MIS3-VS-INSTL-NO-X       TO RVS-3-INSTL-NO-X.           02.23
           MOVE MIS3-VS-INSTL-TOTAL-NO-X TO RVS-3-INSTL-TOTAL-NO-X.     02.23
      *                                                                 02.23
           IF MIS3-VS-INSTL-TOTAL-AMT-X = SPACES OR ZEROS               02.23
              MOVE MIS3-VS-INSTL-TOTAL-AMT-X                            02.23
                                         TO RVS-3-INSTL-TOTAL-AMT-X     02.23
              MOVE ONE-AST               TO RVS-3-INSTL-TOT-AMT-ERR-IND 02.23
              MOVE 'Y'                   TO PET-SUS-FLAG                02.23
              MOVE 215                   TO ER-CD-3-DIG (ER-INDX)       02.23
              SET ER-INDX UP BY 1                                       02.23
           ELSE                                                         02.23
              IF MIS3-VS-INSTL-TOTAL-AMT NUMERIC                        02.23
                 MOVE MIS3-VS-INSTL-TOTAL-AMT                           02.23
                                         TO PET-VS-INSTL-TOTAL-AMT      02.23
                                            RVS-3-INSTL-TOTAL-AMT       02.23
                 CALL BACONDEC USING BASCRATE-SD-BANK-KEY               02.23
                      C-TYPED  BASCRATE-SD-BATCH-CURR-DEC               02.23
                      C-TYPEA  RVS-3-INSTL-TOTAL-AMT  C-LGTH20          02.23
                      C-TYPEEND                                         02.23
              ELSE                                                      02.23
                 MOVE MIS3-VS-INSTL-TOTAL-AMT-X                         02.23
                                         TO RVS-3-INSTL-TOTAL-AMT-X     02.23
                 MOVE ONE-AST            TO RVS-3-INSTL-TOT-AMT-ERR-IND 02.23
                 MOVE 'Y'                TO PET-SUS-FLAG                02.23
                 MOVE 215                TO ER-CD-3-DIG (ER-INDX)       02.23
                 SET ER-INDX UP BY 1                                    02.23
              END-IF                                                    02.23
           END-IF.                                                      02.23
      *                                                                 02.23
           IF MIS3-VS-INSTL-TOTAL-NO NUMERIC                            02.23
              MOVE MIS3-VS-INSTL-TOTAL-NO                               02.23
                                         TO PET-VS-INSTL-TOTAL-NO       02.23
           ELSE                                                         02.23
              MOVE ONE-AST               TO RVS-3-INSTL-TOT-NO-ERR-IND  02.68
              MOVE 'Y'                   TO PET-SUS-FLAG                02.23
              MOVE 253                   TO ER-CD-3-DIG (ER-INDX)       02.23
              SET ER-INDX UP BY 1                                       02.23
           END-IF.                                                      02.23
      *                                                                 02.23
           MOVE MIS3-VS-INSTL-FREQUENCY  TO WS-VALID-VS-INSTL-FREQUENCY 02.23
                                            RVS-3-INSTL-FREQUENCY.      02.23
           IF VALID-VS-INSTL-FREQUENCY                                  02.23
              MOVE MIS3-VS-INSTL-FREQUENCY                              02.23
                                         TO PET-VS-INSTL-FREQUENCY      02.23
           ELSE                                                         02.23
              MOVE ONE-AST               TO RVS-3-INSTL-FREQ-ERR-IND    02.23
              MOVE 'Y'                   TO PET-SUS-FLAG                02.23
              MOVE 253                   TO ER-CD-3-DIG (ER-INDX)       02.23
              SET ER-INDX UP BY 1                                       02.23
           END-IF.                                                      02.23
      *                                                                 02.23
           IF MIS3-VS-INSTL-NO NUMERIC                                  02.23
              MOVE MIS3-VS-INSTL-NO      TO PET-VS-INSTL-NO             02.23
              IF PET-VS-INSTL-NO = ZERO OR                              02.23
                 PET-VS-INSTL-NO > PET-VS-INSTL-TOTAL-NO                02.23
                    MOVE ONE-AST         TO RVS-3-INSTL-NO-ERR-IND      02.68
                    MOVE 'Y'             TO PET-SUS-FLAG                02.23
                    MOVE 254             TO ER-CD-3-DIG (ER-INDX)       02.23
                    SET ER-INDX UP BY 1                                 02.23
              END-IF                                                    02.23
           ELSE                                                         02.23
              MOVE ONE-AST               TO RVS-3-INSTL-NO-ERR-IND      02.68
              MOVE 'Y'                   TO PET-SUS-FLAG                02.23
              MOVE 255                   TO ER-CD-3-DIG (ER-INDX)       02.23
              SET ER-INDX UP BY 1                                       02.23
           END-IF.                                                      02.23
      *                                                                 02.23
       U-300-INSTALL-DONE.                                              03.42V
      *                                                                 03.42V
           MOVE MIS3-VS-SPEND-QUAL-IND   TO PET-VS-SPEND-QUAL-IND       03.42V
                                            RVS-4-SPEND-QUAL-IND.       03.42V
           IF PET-VS-SPEND-QUAL-IND = ' ' OR 'Q' OR 'N' OR 'B'          03.62V
              CONTINUE                                                  03.42V
           ELSE                                                         03.42V
              MOVE ONE-AST               TO RVS-4-SPEND-QUAL-ERR-IND    03.42V
              MOVE 'Y'                   TO PET-SUS-FLAG                03.42V
              MOVE 255                   TO ER-CD-3-DIG (ER-INDX)       03.42V
              SET ER-INDX UP BY 1                                       03.42V
           END-IF.                                                      03.42V
      *                                                                 03.42V
           IF MIS3-VS-MULTI-CLR-SEQ-NO NOT NUMERIC                      03.42V
              MOVE ZEROES                TO MIS3-VS-MULTI-CLR-SEQ-NO    03.42V
              MOVE '?'                   TO RVS-1-MCS-ERR-IND.          03.42V
                                                                        03.42V
           IF MIS3-VS-MULTI-CLR-SEQ-CNT NOT NUMERIC                     03.42V
              MOVE ZEROES                TO MIS3-VS-MULTI-CLR-SEQ-CNT   03.42V
              MOVE '?'                   TO RVS-1-MCS-ERR-IND.          03.42V
                                                                        03.42V
           MOVE MIS3-VS-MULTI-CLR-SEQ-NO TO PET-MULT-CLEARING-SEQ-NUM   03.42V
                                            RVS-1-MCS-NO.               03.42V
           MOVE MIS3-VS-MULTI-CLR-SEQ-CNT TO PET-MULT-CLEARING-SEQ-CNT  03.42V
                                            RVS-1-MCS-CNT.              03.42V
           MOVE '/'                      TO RVS-1-SLASH.                03.42V
      *                                                                 03.46
           MOVE MIS3-VS-TOKEN-ASSURE-LEVEL                              03.46
                                         TO PET-VS-TOKEN-ASSURE-LVL-X   03.46
                                            RVS-4-TOKEN-ASSURE-LVL.     03.46
      *                                                                 03.46
103510 U-300-EXIT.
103520     EXIT.
100230 U-301-SPCL-VISA-NO-EDIT.
           MOVE KDA-CUST-SVC-PHONE       TO PET-TELE-NUM
                                            RRD-CSP-PHONE.
           MOVE RRD-CSP-DATA             TO RCL-5-OPTIONAL-DATA.
           MOVE RESET-RRD-CSP-DATA       TO RRD-CSP-DATA.
           MOVE KDA-PROPERTY-PHONE       TO PET-PROPERTY-PHONE.
           MOVE PET-ACQ-CURR-CODE        TO SRCH-CURR-CODE.
           MOVE SRCH-CURR-CODE-X         TO PET-AUTHORIZ-CURR-CD.
           MOVE HOLD-MERCH-ID            TO PET-TMP-CARD-ACCEPTOR.
           MOVE MIS3-VS-SPEC-COND-IND    TO KDA-SPEC-COND-IND           02.53
                                            PET-SPEC-COND
                                            RCL-5-SPC-COND.
100290     MOVE HLD-VOLUME-TIER-IND      TO PET-VOLUME-TIER-IND.
           MOVE MIS3-VS-DYNAM-CURR-CONV  TO PET-VS-DYNAM-CURR-CONV.     02.61
           MOVE MIS3-VS-NO-PYMT-FORMS    TO PET-NO-PYMT-FORMS.          03.16V
           MOVE MIS3-VS-TRAN-CD-QUAL-X   TO RVS-2-TRAN-QUAL.            02.53
           IF MIS3-VS-TRAN-CD-QUAL NUMERIC                              02.53
              MOVE MIS3-VS-TRAN-CD-QUAL  TO PET-TRAN-CODE-QUAL.         02.53
           MOVE MIS3-VS-POS-ENVIRONMENT  TO KDA-POS-ENV                 02.53
                                            PET-POS-ENVIRONMENT
                                            RVS-2-POS-ENV.
           MOVE MIS3-PHONE-ORD           TO KDA-PHONE-ORD
                                            PET-MAIL-PHONE-IND
                                            RCL-2-MOTO-ECOM
                                            RCL-2-MOTO-ECOM-OUT.
           MOVE MIS3-AUTHORIZE-SRCE      TO KDA-AUTH-SRCE
                                            PET-TMP-AUTHOR-SRCE
                                            RCL-3-AUTH-SRC.
           MOVE MIS3-POS-TERM            TO KDA-POS-TERM
                                            PET-TMP-POS-TERM-CAP
                                            RCL-3-POS-TRM-CAP.
           MOVE MIS3-POS-ENTRY-MODE      TO KDA-POS-ENTRY-MODE
                                            PET-TMP-POS-ENTRY-MOD
                                            RCL-3-POS-E-MOD.
           MOVE MIS3-CARDHLDR-ID         TO KDA-CARDHLDR-ID
                                            PET-TMP-CARDHLDR-ID
                                            RCL-4-CRD-ID-MTHD.
           MOVE SPACE                    TO KDA-PAY-SVC-IND
                                            PET-PAY-SVC-IND.
           MOVE MIS3-VS-AUTH-CHAR-IND    TO KDA-AUTH-CHAR-IND           02.53
                                            PET-AUTH-CHAR-IND
                                            RCL-4-AUTH-CHAR
                                            RCL-4-AUTH-CHAR-OUT.
           MOVE MIS3-CAT-TERM-LVL        TO KDA-CAT-TERM-LVL
                                            RCL-5-CAT-TRM
                                            PET-CATM-IND.
           MOVE MIS3-VS-SERV-DEVELOP     TO KDA-SERV-DEVELOP            02.53
                                            PET-SERV-DEVELOP
                                            RVS-2-SVC-DEVEL.
           MOVE MIS3-VS-CRD-VER-RESULT   TO KDA-CVV2-RESULT             02.53
                                            RVS-2-CRD-VER-RES.
101410     IF KDA-VC-CVV2-RESULT
              MOVE MIS3-VS-CRD-VER-RESULT                               02.53
                                         TO PET-CVV2-RESULT-CODE        02.53
101430     ELSE
              MOVE MIS3-VS-CRD-VER-RESULT                               02.53
                                         TO PET-CVV-RESULT-CODE         02.53
           END-IF.                                                      02.53
           MOVE MIS3-VS-CHIP-COND-CD     TO KDA-CHIP-COND-CODE          02.53
                                            PET-CHIP-COND-CODE
                                            RVS-2-CHIP-COND.
           MOVE MIS3-VS-MKT-SPC-AUTH-DATA                               02.53
                                         TO KDA-MARKET-SPC-AUTH-DATA-IND
                                            PET-SPC-AUTH-DATA-IND
                                            RVS-1-MKT-SPC-DAT.
           MOVE MIS3-VS-PURCH-IDENT-FRMT TO KDA-PURCHASE-IDENT-FORMAT   02.53
                                            RCL-6-PRCH-ID-FMT.
           MOVE MIS3-VS-PURCH-IDENT      TO RCL-6-PRCH-ID-NO.           02.53
           MOVE MIS3-VS-ECGI             TO KDA-ELEC-COMM-GOODS-IND     02.53
                                            PET-VISA-ECGI
                                            RVS-2-ECGI.
101650*
           IF MR1-VALID-CASH AND                                        03.31
              MR1-VALID-MIS3-TRAN                                       03.31
                 IF KDA-VC-PURCHASE-IDENT-CSH                           03.31
                    MOVE MIS3-VS-PURCH-IDENT-FRMT                       03.31
101690                                   TO PET-PURCHASE-IDENTIFIER
101750        ELSE
101750           NEXT SENTENCE
101750     ELSE
              MOVE MIS3-VS-PURCH-IDENT-FRMT                             02.53
101780                                   TO PET-PURCHASE-IDENTIFIER.
           IF MR1-VALID-CASH AND                                        03.31
              MR1-VALID-MIS3-TRAN                                       03.31
                 MOVE MIS3-VS-PURCH-IDENT                               03.31
                                         TO PET-PURCHASE-IDENT.         03.31
           MOVE MIS3-VS-TRANS-IDENT-X    TO RVS-1-TRANS-IDENT-X.        02.53
102200     MOVE MIS3-VS-TRANS-IDENT      TO PET-TRANS-IDNTFIER.         02.53
102260 U-301-SPCL-VALID-CODE.
           MOVE MIS3-VS-VALID-CODE       TO RVS-1-VALID-CODE.           02.53
           IF MR1-VALID-RETURN AND                                      03.31
              MR1-VALID-MIS3-TRAN                                       03.31
                 MOVE MIS3-VS-VALID-CODE TO PET-VALID-CD.               03.31
           MOVE MIS3-VS-INFO-IND         TO RVS-1-INFO-IND              02.53
                                            PET-INFO-IND.
      *
           PERFORM U-900-LOAD-AMTS
              THRU U-900-EXIT.
      *                                                                 02.23
           PERFORM U-700-SURCHARGE-EDITS THRU U-700-EXIT.               02.95
      *                                                                 02.95
           IF MIS3-VS-INSTL-INFO = SPACES                               02.23
              GO TO U-301-CHECK-ATM.                                    02.23
      *                                                                 02.23
           MOVE MIS3-VS-INSTL-TOTAL-NO-X TO RVS-3-INSTL-TOTAL-NO.       02.68
           IF MIS3-VS-INSTL-TOTAL-NO NUMERIC                            02.23
              MOVE MIS3-VS-INSTL-TOTAL-NO                               02.23
                                         TO PET-VS-INSTL-TOTAL-NO.      02.23
           MOVE MIS3-VS-INSTL-NO-X       TO RVS-3-INSTL-NO.             02.23
           MOVE MIS3-VS-INSTL-FREQUENCY  TO PET-VS-INSTL-FREQUENCY.     02.23
           IF MIS3-VS-INSTL-NO NUMERIC                                  02.23
              MOVE MIS3-VS-INSTL-NO      TO PET-VS-INSTL-NO.            02.23
      *
103150 U-301-CHECK-ATM.
           IF MR1-VALID-CASH AND                                        03.31
              MR1-VALID-MIS3-TRAN                                       03.31
                 IF MIS3-VS-ATM-ACCT-SELECT = SPACES                    03.62V
                    MOVE '0'             TO MIS3-VS-ATM-ACCT-SELECT     03.62V
                 END-IF.                                                03.62V
           MOVE MIS3-VS-ATM-ACCT-SELECT                                 03.62V
                                         TO KDA-VISA-ACCOUNT-SELECT     03.62V
                                            PET-ATM-ACCT.
           IF MR1-VALID-RETURN AND                                      03.31
              MR1-VALID-MIS3-TRAN                                       03.31
                 MOVE '000000'           TO PET-AUTH-CD.                03.31
      *                                                                 03.42V
           MOVE MIS3-VS-SPEND-QUAL-IND   TO PET-VS-SPEND-QUAL-IND       03.42V
                                            RVS-4-SPEND-QUAL-IND.       03.42V
      *                                                                 03.42V
           MOVE MIS3-VS-MULTI-CLR-SEQ-NO TO PET-MULT-CLEARING-SEQ-NUM   03.42V
                                            RVS-1-MCS-NO.               03.42V
           MOVE MIS3-VS-MULTI-CLR-SEQ-CNT TO PET-MULT-CLEARING-SEQ-CNT  03.42V
                                            RVS-1-MCS-CNT.              03.42V
           MOVE '/'                      TO RVS-1-SLASH.                03.42V
      *                                                                 03.42V
103510 U-301-EXIT.
103520     EXIT.
103530*
103540 U-400-SPCL-MC-EDIT.
           MOVE KDA-CUST-SVC-PHONE       TO PET-TELE-NUM.
           MOVE KDA-PROPERTY-PHONE       TO PET-PROPERTY-PHONE.
           MOVE KDA-CHD-ICA-RATE-IND     TO PET-MC-RATE-IND             02.68
                                            RMC-2-RATE-IND.             02.68
103550     MOVE HOLD-MERCH-ID            TO PET-MERCH-ID.
           MOVE WS-MC-ACCEPT-BRAND       TO RMC-2-ACCEPT-BRND.          03.42M
           IF MIS3-TERM-ID = SPACES OR ZEROS
              IF KDA-MMERCAT-MC-ATM
                 MOVE ONE-AST            TO RCL-4-TERM-ID-ERR-IND
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 216                TO ER-CD-3-DIG (ER-INDX)
                 SET ER-INDX UP BY 1
              ELSE
                 NEXT SENTENCE
           ELSE
           IF MIS3-TERM-ID(1:1) = SPACE
              MOVE SPACES                TO HOLD2-FIELD
              MOVE +1                    TO START-SUB
              MOVE +25                   TO END-SUB
                                            END2-SUB
              MOVE MIS3-TERM-ID          TO HOLD-FIELD
              PERFORM C-381-EDIT-MA-FIELDS
                 THRU C-381-EXIT
              MOVE HOLD2-FIELD(1:8)      TO PET-TERM-ID.
           MOVE MIS3-CAT-TERM-LVL        TO KDA-CAT-TERM-LVL
                                            RCL-5-CAT-TRM.
           IF KDA-VC-CAT-TERM-LVL-MC-ATM
              IF MR1-VALID-CASH AND                                     03.31
                 KDA-MMERCAT-MC-ATM
                    NEXT SENTENCE
              ELSE
                 MOVE ONE-AST            TO RCL-5-CAT-TRM-ERR-IND
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 148                TO ER-CD-3-DIG (ER-INDX)
                 SET ER-INDX UP BY 1
           ELSE
           IF KDA-VC-CAT-TERM-LVL-MC
              MOVE MIS3-CAT-TERM-LVL     TO PET-CAT-TERM-LVL
           ELSE
              MOVE ONE-AST               TO RCL-5-CAT-TRM-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 148                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
      *
           MOVE MIS3-MC-CHD-SERVICE-CD-X TO KDA-VALID-SERVICE-CD-X      02.53
                                            RMC-2-SVC-CODE.
           IF KDA-VALID-SERVICE-CD-X = SPACES OR ZEROS
              NEXT SENTENCE
           ELSE
           IF KDA-VC-SVC-CD-1 AND
              KDA-VC-SVC-CD-2 AND
              KDA-VC-SVC-CD-3
                 MOVE MIS3-MC-CHD-SERVICE-CD-X                          02.53
                                         TO PET-MC-CHD-SERVICE-CD-X     02.74
           ELSE
              MOVE ONE-AST               TO RMC-2-SVC-CODE-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 231                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
      *
           MOVE WS-MC-BANKNET-REF-NO     TO RMC-1-BANKNET-REF-OUT
                                            PET-BANKNET-REF-NO.
      *
           MOVE WS-MC-BANKNET-DATE       TO RMC-1-BANKNET-DT
                                            PET-BANKNET-DATE.
      *
           MOVE MIS3-MC-PROMOTION-CODE   TO RMC-2-PROM-CD.              02.53
           IF MIS3-MC-PROMOTION-CODE = SPACES OR ZEROS                  02.53
              NEXT SENTENCE
           ELSE
              MOVE MIS3-MC-PROMOTION-CODE                               02.53
                                         TO PET-PROMOTION-CODE.         02.53
      *
           PERFORM U-110-VALIDATE-AUTH
              THRU U-110-EXIT.
           IF AUTH-ERR
              MOVE 4                     TO ER-CD (ER-INDX)
              SET ER-INDX UP BY 1
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE ONE-AST               TO RCL-2-AUTH-CODE-ERR-IND
           ELSE
              MOVE AUTH-SPACE-WORK       TO PET-AUTH-CD.
           MOVE +0                       TO KDA-AUTH-MC-USD-AMT.
      *
           MOVE '  AUTH AMT  '           TO RRD-AMT-ID.
           IF MIS3-AUTH-AMT NOT NUMERIC
              MOVE +0                    TO RRD-AMT
           ELSE
              MOVE MIS3-AUTH-AMT         TO RRD-AMT
                                            PET-AUTHORIZ-AMT.
           CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                C-TYPEA  RRD-AMT  C-LGTH20
                C-TYPEEND.
           MOVE RRD-AMT-DATA             TO RCL-2-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           MOVE '  CASH AMT  '           TO RRD-AMT-ID.
           IF MIS3-CASH-BACK-AMT-X = SPACES
              MOVE SPACES                TO RRD-AMT-X
              MOVE ZEROS                 TO MIS3-CASH-BACK-AMT
           ELSE
           IF MIS3-CASH-BACK-AMT NUMERIC
              MOVE MIS3-CASH-BACK-AMT    TO RRD-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-CASH-BACK-AMT-X  TO RRD-AMT-X
              MOVE ONE-AST               TO RRD-AMT-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 215                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
           IF MIS3-AMOUNT NUMERIC AND
              MIS3-CASH-BACK-AMT NUMERIC
                 IF MIS3-CASH-BACK-AMT < MIS3-AMOUNT
                    MOVE MIS3-CASH-BACK-AMT
                                         TO PET-CASH-BACK-AMT
                 ELSE
                    MOVE ONE-AST         TO RRD-AMT-ERR-IND
                    MOVE 'Y'             TO PET-SUS-FLAG
                    MOVE 229             TO ER-CD-3-DIG (ER-INDX)
                    SET ER-INDX UP BY 1.
      *
           PERFORM U-700-SURCHARGE-EDITS THRU U-700-EXIT.               02.95
      *                                                                 02.95
           IF MR1-VALID-RETURN                                          03.31
              COMPUTE KDA-TRAN-MC-CSH-BK-USD-AMT = +0
           ELSE
              IF PET-ACQ-CURR-CODE = +840
                 COMPUTE KDA-TRAN-MC-CSH-BK-USD-AMT = PET-CASH-BACK-AMT
              ELSE
                 COMPUTE KDA-TRAN-MC-CSH-BK-USD-AMT = PET-CASH-BACK-AMT
                                    * BASCRATE-RD-MCBS-USD-RATE
                 CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
                             C-TYPED  C-DECI02
                             C-TYPER  KDA-TRAN-MC-CSH-BK-USD-AMT
                             C-TYPEEND
              END-IF
           END-IF.
           IF KDA-TRAN-MC-CSH-BK-USD-AMT > +0                           02.39
              IF NOT KDA-CHD-ICA-IS-PWCB                                02.39
                 MOVE ONE-AST            TO RRD-AMT-ERR-IND             02.39
                 MOVE 'Y'                TO PET-SUS-FLAG                02.39
                 MOVE 237                TO ER-CD-3-DIG (ER-INDX)       02.39
                 SET ER-INDX UP BY 1                                    02.39
              END-IF                                                    02.39
           END-IF.                                                      02.39
      *
           PERFORM U-410-SET-POS-DATA
              THRU U-410-EXIT.
           PERFORM U-430-DEFAULT-PROCESS-CODE                           02.53
              THRU U-430-EXIT.                                          02.53
      *
           MOVE RRD-AMT-DATA             TO RCL-4-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           IF PET-AUTHORIZ-AMT > +0
              MOVE PET-AUTHORIZ-AMT      TO PET-TOTAL-AUTH-AMT          02.53
              COMPUTE KDA-AUTH-MC-USD-AMT = PET-AUTHORIZ-AMT
                                 * BASCRATE-RD-MCBS-USD-RATE
              CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
                   C-TYPED  C-DECI02
                   C-TYPER  KDA-AUTH-MC-USD-AMT
                   C-TYPEEND.
      *
           IF MIS3-TELE-NUM(1:10) NOT = SPACES
             IF HLD-INET-COUNTRY = 'CAN' OR 'USA'
                IF NOT KDA-VC-CRDHLDR-PHONE-REQ
                    IF MIS3-TELE-NUM(1:1) = '0' OR '1'
                       MOVE MIS3-TELE-NUM(2:10) TO MIS3-TELE-NUM(1:10)  03.16B
                    END-IF                                              03.16B
                    IF (MIS3-TELE-NUM(1:10) NUMERIC)     AND            03.16B
                       (MIS3-TELE-NUM(1:3) NOT = ZEROS)  AND            03.16B
                       (MIS3-TELE-NUM(4:3) NOT = ZEROS)                 03.16B
                       MOVE MIS3-TELE-NUM(1:10) TO PET-TELE-NUM         03.16B
                                                   KDA-CUST-SVC-PHONE   03.16B
                    END-IF                                              03.16B
                ELSE IF (MIS3-TELE-NUM(1:10) NUMERIC)     AND           03.16B
                        (MIS3-TELE-NUM(1:3) NOT = ZEROS)  AND           03.16B
                        (MIS3-TELE-NUM(4:3) NOT = ZEROS)                03.16B
                        MOVE MIS3-TELE-NUM        TO PET-TELE-NUM       03.16B
                        MOVE MIS3-TELE-NUM(1:10)  TO KDA-CUST-SVC-PHONE 03.16B
                     END-IF
                END-IF                                                  03.16B
             ELSE
               MOVE MIS3-TELE-NUM        TO PET-TELE-NUM
               MOVE MIS3-TELE-NUM(1:10)  TO KDA-CUST-SVC-PHONE
             END-IF
           END-IF.
      *
           IF HLD-INET-COUNTRY = 'CAN' OR 'USA'
              IF KDA-VC-CRDHLDR-PHONE-REQ
                 IF PET-TELE-NUM(1:10) NUMERIC AND
                    PET-TELE-NUM(11:4) = SPACES
                       NEXT SENTENCE
                 ELSE
                    MOVE ONE-AST         TO RRD-CSP-PHONE-ERR-IND
                    MOVE 'Y'             TO PET-SUS-FLAG
                    MOVE 223             TO ER-CD-3-DIG (ER-INDX)
                    SET ER-INDX UP BY 1
                 END-IF
              END-IF
           END-IF.
      *
           MOVE PET-TELE-NUM             TO RRD-CSP-PHONE.
           MOVE RRD-CSP-DATA             TO RCL-5-OPTIONAL-DATA.
           MOVE RESET-RRD-CSP-DATA       TO RRD-CSP-DATA.
      *
           IF PET-CAT-TERM-LVL = SPACE
              IF KDA-VC-DTA-INP-MOD-ECOM
                 MOVE '?'                TO RCL-5-CAT-TRM-ERR-IND
                 MOVE '6'                TO PET-CAT-TERM-LVL
                                            RCL-5-CAT-TRM
                                            KDA-CAT-TERM-LVL
              END-IF
           END-IF.
           IF KDA-VC-DTA-INP-MOD-ECOM
              IF NOT KDA-VC-CAT-TERM-LVL-6
                 MOVE ONE-AST          TO RCL-5-CAT-TRM-ERR-IND
                                          RMC-2-POS-DATA-CD-ERR-IND(7)
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 238                TO ER-CD-3-DIG (ER-INDX)
                 SET ER-INDX UP BY 1
              END-IF
           END-IF.
           IF KDA-VC-CAT-TERM-LVL-6
              IF NOT KDA-VC-DTA-INP-MOD-ECOM
                 MOVE ONE-AST          TO RCL-5-CAT-TRM-ERR-IND
                                          RMC-2-POS-DATA-CD-ERR-IND(7)
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 238                TO ER-CD-3-DIG (ER-INDX)
                 SET ER-INDX UP BY 1
              END-IF
           END-IF.
      *
           MOVE MIS3-MC-TRAN-CAT-ID-X    TO RMC-1-TRN-CAT-IND-IN        03.46M
                                            WS-MC-TRAN-CAT-IND          03.46M
                                            PET-MC-TRAN-CAT-IND.        02.33
           IF WS-MC-TRAN-CAT-IND-00                                     02.33
              MOVE SPACES                TO WS-MC-TRAN-CAT-IND          02.33
              MOVE '?'                   TO RMC-1-TRN-CAT-IND-ERR-IND   02.33
           END-IF.                                                      02.33
           MOVE WS-MC-TRAN-CAT-IND       TO PET-MC-TRAN-CAT-IND         02.33
                                            RMC-1-TRN-CAT-IND-OUT.      02.33
           IF NOT WS-VC-MC-TRAN-CAT-IND                                 02.33
              MOVE ONE-AST               TO RMC-1-TRN-CAT-IND-ERR-IND   02.33
              MOVE 'Y'                   TO PET-SUS-FLAG                02.33
              MOVE 236                   TO ER-CD-3-DIG (ER-INDX)       02.33
              SET ER-INDX UP BY 1                                       02.33
           END-IF.                                                      02.33
      *
           MOVE MIS3-MC-UCAF-COLL-IND    TO RMC-1-UCAF-COL-CD
                                            RMC-1-UCAF-COL-CD-OUT
                                            KDA-MC-UCAF-COLL-IND.
           MOVE MIS3-MC-SEC-PROTOCOL     TO RMC-1-SEC-PROT              02.53
                                            RMC-1-SEC-PROT-OUT
                                            KDA-MC-SEC-PROTOCOL.        02.53
           MOVE MIS3-MC-CHDHLDR-AUTHEN   TO RMC-1-CHD-AUTHEN
                                            RMC-1-CHD-AUTHEN-OUT
                                            KDA-MC-CHDHLDR-AUTHEN.
           IF KDA-VC-UCAF-COLL-IND-1-3 OR                               03.62M
              KDA-VC-UCAF-COLL-IND-5   OR                               03.62M
              KDA-VC-UCAF-COLL-IND-6                                    03.62M
              IF NOT KDA-VC-SEC-PROTOCOL                                02.53
                 IF KDA-VC-DTA-INP-MOD-ECOM
                    MOVE '1'             TO KDA-MC-SEC-PROTOCOL         02.53
                                            RMC-1-SEC-PROT-OUT
                 END-IF
              END-IF
              IF NOT KDA-VC-CHDHLDR-AUTHEN
                 IF KDA-VC-DTA-INP-MOD-ECOM
                    MOVE '1'             TO KDA-MC-CHDHLDR-AUTHEN
                                            RMC-1-CHD-AUTHEN-OUT
                 END-IF
              END-IF
           ELSE
              IF KDA-VC-DTA-INP-MOD-ECOM AND
                 KDA-VC-CAT-TERM-LVL-6
                    IF NOT KDA-VC-UCAF-COLL-IND-0
                       MOVE '0'          TO KDA-MC-UCAF-COLL-IND
                                            RMC-1-UCAF-COL-CD-OUT
                    END-IF
                    IF NOT KDA-VC-SEC-PROTOCOL                          02.53
                       MOVE '9'          TO KDA-MC-SEC-PROTOCOL         02.53
                                            RMC-1-SEC-PROT-OUT
                    END-IF
                    IF NOT KDA-VC-CHDHLDR-AUTHEN
                       MOVE '1'          TO KDA-MC-CHDHLDR-AUTHEN
                                            RMC-1-CHD-AUTHEN-OUT
                    END-IF
              ELSE
                 IF KDA-MC-UCAF-COLL-IND NOT = SPACE
                    MOVE SPACE           TO KDA-MC-UCAF-COLL-IND
                                            RMC-1-UCAF-COL-CD-OUT
                 END-IF
                 IF KDA-MC-SEC-PROTOCOL NOT = SPACE                     02.53
                    MOVE SPACE           TO KDA-MC-SEC-PROTOCOL         02.53
                                            RMC-1-SEC-PROT-OUT
                 END-IF
                 IF KDA-MC-CHDHLDR-AUTHEN NOT = SPACE
                    MOVE SPACE           TO KDA-MC-CHDHLDR-AUTHEN
                                            RMC-1-CHD-AUTHEN-OUT
                 END-IF
              END-IF
           END-IF.
           MOVE KDA-MC-E-COMM-SEC-LVL-IND
                                         TO PET-MC-E-COMM-SEC-LVL-IND.
      *
           IF KDA-VC-DTA-INP-MOD-ECOM
              IF NOT KDA-VC-UCAF-COLL-IND
                 MOVE ONE-AST            TO RMC-1-UCAF-COL-CD-ERR-IND
                                            RMC-2-POS-DATA-CD-ERR-IND(7)
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 239                TO ER-CD-3-DIG (ER-INDX)
                 SET ER-INDX UP BY 1
              END-IF
           ELSE
              IF KDA-MC-UCAF-COLL-IND = SPACE AND
                 KDA-MC-SEC-PROTOCOL = SPACE AND                        02.53
                 KDA-MC-CHDHLDR-AUTHEN = SPACE
                    NEXT SENTENCE
              ELSE
                 MOVE ONE-AST            TO RMC-1-UCAF-COL-CD-ERR-IND
                                            RMC-2-POS-DATA-CD-ERR-IND(7)
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 239                TO ER-CD-3-DIG (ER-INDX)
                 SET ER-INDX UP BY 1
              END-IF
           END-IF.
      *
           MOVE MIS3-POS-ENTRY-MODE      TO PET-MC-POS-ENTRY-MOD
                                            RCL-3-POS-E-MOD.
           MOVE MIS3-PHONE-ORD           TO PET-MC-MAIL-PHONE-IND
                                            RCL-2-MOTO-ECOM
                                            RCL-2-MOTO-ECOM-OUT.
101430     MOVE MIS3-MC-CRD-VER-RESULT   TO PET-CVV-RESULT-CODE.        02.53
           MOVE MIS3-POS-TERM            TO RCL-3-POS-TRM-CAP.
           MOVE MIS3-CARDHLDR-ID         TO RCL-4-CRD-ID-MTHD.
      *                                                                 03.53
           IF MIS3-MC-RISK-MGMT-APPRV-CD-X NOT EQUAL SPACES             03.62M
              MOVE MIS3-MC-RISK-MGMT-APPRV-CD                           03.53
                                         TO RMC-3-RISK-MGMT-APPRV-CD    03.53
              IF MIS3-MC-RISK-MGMT-APPRV-CD NUMERIC AND                 03.53
                 MIS3-MC-RISK-MGMT-APPRV-CD  NOT EQUAL ZEROS            03.53
                 MOVE MIS3-MC-RISK-MGMT-APPRV-CD                        03.53
                                         TO PET-MC-RISK-MGMT-APPRV-CD   03.53
              ELSE                                                      03.53
                 MOVE ONE-AST            TO RMC-3-RISK-MGMT-ERR-IND     03.53
                 MOVE 'Y'                TO PET-SUS-FLAG                03.53
                 MOVE 258                TO ER-CD-3-DIG (ER-INDX)       03.53
              END-IF                                                    03.53
           END-IF.                                                      03.53
      *
           MOVE MIS3-MC-PPOL-PGM-DATA    TO PET-MC-PPOL-PGM-DATA.       03.62M
      *                                                                 03.62M
      * TOKEN FIELD EDITS                                               03.62M
           MOVE 'N'                      TO WS-ERROR-SW.                03.62M
           IF MIS3-MC-TOKEN-ASSURE-LEVEL-X = SPACES                     03.62M
              NEXT SENTENCE                                             03.62M
           ELSE                                                         03.62M
              MOVE MIS3-MC-TOKEN-ASSURE-LEVEL-X                         03.62M
                                         TO RMC-3-TOKEN-ASSURE-LEVEL    03.62M
              IF MIS3-MC-TOKEN-ASSURE-LEVEL NUMERIC                     03.62M
                   MOVE MIS3-MC-TOKEN-ASSURE-LEVEL                      03.62M
                                         TO PET-MC-TOKEN-ASSURE-LEVEL   03.62M
              ELSE                                                      03.62M
                 MOVE ONE-AST            TO RMC-3-TOKEN-ASR-L-ERR-IND   03.62M
                 MOVE 'Y'                TO WS-ERROR-SW                 03.62M
              END-IF                                                    03.62M
           END-IF.                                                      03.62M
      *                                                                 03.62M
           MOVE MIS3-MC-TOKEN-REQSTR-ID-X TO RMC-3-TOKEN-REQSTR-ID      03.62M
           IF MR1-VALID-SALE AND KDA-CHD-MAP-SVC-IND-IS-DIG-ENB         03.62M
              IF MIS3-MC-TOKEN-REQSTR-ID NUMERIC AND                    03.62M
                 MIS3-MC-TOKEN-REQSTR-ID NOT EQUAL ZEROS                03.62M
                   MOVE MIS3-MC-TOKEN-REQSTR-ID                         03.62M
                                          TO PET-MC-TOKEN-REQSTR-ID     03.62M
              ELSE                                                      03.62M
                   MOVE ONE-AST           TO RMC-3-TOKEN-RQSTR-ERR-IND  03.62M
                   MOVE 'Y'               TO WS-ERROR-SW                03.62M
              END-IF                                                    03.62M
           ELSE                                                         03.62M
             IF MIS3-MC-TOKEN-REQSTR-ID-X = SPACES                      03.62M
                NEXT SENTENCE                                           03.62M
             ELSE                                                       03.62M
                IF MIS3-MC-TOKEN-REQSTR-ID NUMERIC                      03.62M
                   MOVE MIS3-MC-TOKEN-REQSTR-ID                         03.62M
                                          TO PET-MC-TOKEN-REQSTR-ID     03.62M
                ELSE                                                    03.62M
                   MOVE ONE-AST           TO RMC-3-TOKEN-RQSTR-ERR-IND  03.62M
                   MOVE 'Y'               TO WS-ERROR-SW                03.62M
                END-IF                                                  03.62M
             END-IF                                                     03.62M
           END-IF.                                                      03.62M
           IF WS-ERROR-SW = 'Y'                                         03.62M
              MOVE 'Y'                     TO PET-SUS-FLAG              03.62M
              MOVE 270                     TO ER-CD-3-DIG (ER-INDX)     03.62M
              SET ER-INDX UP BY 1                                       03.62M
           END-IF.                                                      03.62M
      *                                                                 03.62M
           IF MIS3-MC-INSTL-INFO = SPACES                               02.23
              GO TO U-400-CONTINUE.                                     03.52
      *
           MOVE MIS3-MC-INSTL-NO-X       TO RMC-2-INSTALL-NO.           02.23
           MOVE MIS3-MC-INSTL-TOTAL-NO-X TO RMC-2-NO-INSTALL.           02.23
           IF MIS3-MC-INSTL-TOTAL-NO-X = ZEROS                          02.23
              GO TO U-400-CONTINUE.                                     03.52
      *
           IF MIS3-MC-INSTL-TOTAL-NO NUMERIC                            02.23
              MOVE MIS3-MC-INSTL-TOTAL-NO                               02.23
                                         TO PET-MC-INSTL-TOTAL-NO       02.23
           ELSE
              MOVE ONE-AST               TO RMC-2-NO-INSTALL-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 253                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1
           END-IF.
      *
           IF MIS3-MC-INSTL-OPTION NUMERIC                              02.23
              MOVE MIS3-MC-INSTL-OPTION  TO PET-MC-INSTL-OPTION.        02.23
      *
           IF MIS3-MC-INSTL-NO NUMERIC                                  02.23
              MOVE MIS3-MC-INSTL-NO      TO PET-MC-INSTL-NO             02.23
              IF PET-MC-INSTL-NO = ZERO OR
                 PET-MC-INSTL-NO > PET-MC-INSTL-TOTAL-NO
                    MOVE ONE-AST         TO RMC-2-INSTALL-NO-ERR-IND
                    MOVE 'Y'             TO PET-SUS-FLAG
                    MOVE 254             TO ER-CD-3-DIG (ER-INDX)
                    SET ER-INDX UP BY 1
              END-IF
           ELSE
              MOVE ONE-AST               TO RMC-2-INSTALL-NO-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 255                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1
           END-IF.
      *
       U-400-CONTINUE.                                                  03.52
           MOVE MIS3-MC-DEVICE-TYPE      TO WS-VALID-MC-DEVICE-TYPE     03.16M
                                            RMC-3-DEV-TYP.              03.16M
           IF VALID-MC-DEVICE-TYPE                                      03.16M
              MOVE MIS3-MC-DEVICE-TYPE   TO PET-MC-DEVICE-TYPE          03.16M
           ELSE                                                         03.16M
              MOVE ONE-AST               TO RMC-3-DEV-TYP-ERR-IND       03.16M
              MOVE 'Y'                   TO PET-SUS-FLAG                03.16M
              MOVE 255                   TO ER-CD-3-DIG (ER-INDX)       03.16M
              SET ER-INDX UP BY 1                                       03.16M
           END-IF.                                                      03.16M
      *                                                                 03.16M
           MOVE MIS3-MC-TRANSIT-PGM      TO WS-VALID-MC-TRANSIT-PGM     03.16M
                                            RMC-3-TRANSIT-PGM.          03.16M
           IF VALID-MC-TRAN-TYPE AND VALID-MC-TRAN-MODE                 03.16M
              MOVE MIS3-MC-TRANSIT-PGM                                  03.16M
                                         TO PET-MC-TRANSIT-PGM          03.16M
           ELSE                                                         03.16M
              MOVE ONE-AST               TO RMC-3-TRANSIT-PGM-ERR-IND   03.16M
              MOVE 'Y'                   TO PET-SUS-FLAG                03.16M
              MOVE 255                   TO ER-CD-3-DIG (ER-INDX)       03.16M
              SET ER-INDX UP BY 1                                       03.16M
           END-IF.                                                      03.16M
      *                                                                 03.16M
104580 U-400-EXIT.
104590     EXIT.
104600*
103540 U-401-SPCL-MC-NO-EDIT.
           MOVE KDA-CUST-SVC-PHONE       TO PET-TELE-NUM
                                            RRD-CSP-PHONE.
           MOVE KDA-CHD-ICA-RATE-IND     TO RMC-2-RATE-IND              02.68
                                            PET-MC-RATE-IND.            02.68
           MOVE RRD-CSP-DATA             TO RCL-5-OPTIONAL-DATA.
           MOVE RESET-RRD-CSP-DATA       TO RRD-CSP-DATA.
           MOVE HOLD-MC-PROG-REGIST-ID   TO PET-MC-PROG-REGIST-ID.
           MOVE HOLD-MC-ASSIGN-MRCH-ID   TO PET-MC-TIER-MRCH-ID.        02.39
103550     MOVE HOLD-MERCH-ID            TO PET-MERCH-ID.
           MOVE MIS3-CAT-TERM-LVL        TO KDA-CAT-TERM-LVL
                                            RCL-5-CAT-TRM.
           IF KDA-VC-CAT-TERM-LVL-MC
              MOVE MIS3-CAT-TERM-LVL     TO PET-CAT-TERM-LVL
           ELSE
              MOVE SPACES                TO PET-CAT-TERM-LVL.
           MOVE MIS3-MC-TRAN-CAT-ID-X    TO PET-MC-TRAN-CAT-IND.        02.33
           MOVE MIS3-MC-UCAF-COLL-IND    TO RMC-1-UCAF-COL-CD
                                            RMC-1-UCAF-COL-CD-OUT.
           MOVE MIS3-MC-SEC-PROTOCOL     TO RMC-1-SEC-PROT              02.53
                                            RMC-1-SEC-PROT-OUT.
           MOVE MIS3-MC-CHDHLDR-AUTHEN   TO RMC-1-CHD-AUTHEN
                                            RMC-1-CHD-AUTHEN-OUT.
      *
           MOVE MIS3-MC-CHD-SERVICE-CD-X TO KDA-VALID-SERVICE-CD-X      02.53
                                            PET-MC-CHD-SERVICE-CD-X     02.74
                                            RMC-2-SVC-CODE.
      *
           MOVE MIS3-MC-BANKNET-REF-NO   TO PET-BANKNET-REF-NO          02.53
                                            RMC-1-BANKNET-REF-IN.
           MOVE MIS3-MC-BANKNET-DATE     TO RMC-1-BANKNET-DT.           02.53
           IF MIS3-MC-BANKNET-DATE NUMERIC                              02.53
              MOVE MIS3-MC-BANKNET-DATE  TO PET-BANKNET-DATE.           02.53
           MOVE MIS3-MC-PROMOTION-CODE   TO PET-PROMOTION-CODE          02.53
                                            RMC-2-PROM-CD.
           MOVE MIS3-AUTHORIZE           TO PET-AUTH-CD.                02.39
      *
           MOVE '  AUTH AMT  '           TO RRD-AMT-ID.
           IF MIS3-AUTH-AMT NOT NUMERIC
              MOVE +0                    TO RRD-AMT
           ELSE
              MOVE MIS3-AUTH-AMT         TO RRD-AMT
                                            PET-AUTHORIZ-AMT.
           CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                C-TYPEA  RRD-AMT  C-LGTH20
                C-TYPEEND.
           MOVE RRD-AMT-DATA             TO RCL-2-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           MOVE '  CASH AMT  '           TO RRD-AMT-ID.
           IF MIS3-CASH-BACK-AMT NOT NUMERIC
              MOVE +0                    TO RRD-AMT
           ELSE
              MOVE MIS3-CASH-BACK-AMT    TO RRD-AMT
                                            PET-CASH-BACK-AMT.
           CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                C-TYPEA  RRD-AMT  C-LGTH20
                C-TYPEEND.
           MOVE RRD-AMT-DATA             TO RCL-4-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           PERFORM U-700-SURCHARGE-EDITS THRU U-700-EXIT.               02.95
      *                                                                 02.95
           MOVE MIS3-POS-ENTRY-MODE      TO PET-MC-POS-ENTRY-MOD
                                            RCL-3-POS-E-MOD.
           MOVE MIS3-PHONE-ORD           TO PET-MC-MAIL-PHONE-IND
                                            RCL-2-MOTO-ECOM
                                            RCL-2-MOTO-ECOM-OUT.
           MOVE MIS3-MC-CRD-VER-RESULT   TO PET-CVV-RESULT-CODE.        02.53
           MOVE MIS3-CARDHLDR-ID         TO RCL-4-CRD-ID-MTHD.
           IF MIS3-MC-POS-DATA-CODES NOT = SPACES                       02.53
              MOVE MIS3-MC-POS-DATA-CODES                               02.53
                                         TO PET-MC-POS-DTA-CODE.        02.53
      *                                                                 03.53
           IF MIS3-MC-RISK-MGMT-APPRV-CD NOT EQUAL SPACES               03.53
              MOVE MIS3-MC-RISK-MGMT-APPRV-CD                           03.53
                                         TO RMC-3-RISK-MGMT-APPRV-CD    03.53
              IF MIS3-MC-RISK-MGMT-APPRV-CD NUMERIC AND                 03.53
                 MIS3-MC-RISK-MGMT-APPRV-CD  NOT EQUAL ZEROS            03.53
                 MOVE MIS3-MC-RISK-MGMT-APPRV-CD                        03.53
                                         TO PET-MC-RISK-MGMT-APPRV-CD.  03.53
      *
           IF MIS3-MC-INSTL-INFO = SPACES
              GO TO U-401-CONTINUE.                                     03.52
      *
           MOVE MIS3-MC-INSTL-NO-X       TO RMC-2-INSTALL-NO.           02.23
           MOVE MIS3-MC-INSTL-TOTAL-NO-X TO RMC-2-NO-INSTALL.           02.23
           IF MIS3-MC-INSTL-TOTAL-NO NUMERIC                            02.23
              MOVE MIS3-MC-INSTL-TOTAL-NO                               02.23
                                         TO PET-MC-INSTL-TOTAL-NO.      02.23
           IF MIS3-MC-INSTL-OPTION NUMERIC                              02.23
              MOVE MIS3-MC-INSTL-OPTION  TO PET-MC-INSTL-OPTION.        02.23
           IF MIS3-MC-INSTL-NO NUMERIC                                  02.23
              MOVE MIS3-MC-INSTL-NO      TO PET-MC-INSTL-NO.            02.23
      *                                                                 03.52
       U-401-CONTINUE.                                                  03.52
           MOVE MIS3-MC-DEVICE-TYPE      TO PET-MC-DEVICE-TYPE          03.16M
                                            RMC-3-DEV-TYP.              03.16M
           MOVE MIS3-MC-TRANSIT-PGM      TO PET-MC-TRANSIT-PGM          03.16M
                                            RMC-3-TRANSIT-PGM.          03.16M
      *
104580 U-401-EXIT.
104590     EXIT.
      *
       U-410-SET-POS-DATA.
      *
           MOVE MIS3-POS-ENTRY-MODE      TO KDA-POS-ENTRY-MODE.
           MOVE MIS3-POS-TERM            TO KDA-POS-TERM.
           MOVE MIS3-PHONE-ORD           TO KDA-PHONE-ORD.
           IF MIS3-MC-POS-DATA-CODES NOT = SPACES                       02.53
              MOVE MIS3-MC-POS-DATA-CODES                               02.53
                                         TO PET-MC-POS-DTA-CODE         02.53
           END-IF.                                                      02.53
           MOVE PET-MC-POS-DTA-CODE      TO KDA-POS-DTA-CODE.           02.53
      *                                                                 02.53
           PERFORM
             VARYING SUB1 FROM +1 BY +1
             UNTIL   SUB1 > +12
               MOVE PET-MC-POS-DTA-CODE(SUB1:1)
                                         TO RMC-2-POS-DATA-CD(SUB1)
           END-PERFORM.
      *
           MOVE 'N'                      TO WS-ERROR-SW.
           IF NOT KDA-VC-CRD-DTA-INP-CAP
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(1).
           IF NOT KDA-VC-CRDHLDR-ATHN-CAP
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(2).
           IF NOT KDA-VC-CRD-CAPTURE-CAP
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(3).
           IF NOT KDA-VC-OPER-ENV
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(4).
           IF NOT KDA-VC-CRDHLDR-PRSNT
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(5).
           IF NOT KDA-VC-CRD-PRSNT
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(6).
           IF NOT KDA-VC-DTA-INP-MOD
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(7).
           IF NOT KDA-VC-CRDHLDR-ATHN-MTHD
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(8).
           IF NOT KDA-VC-CRDHLDR-ATHN-ENT
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(9).
           IF NOT KDA-VC-CRD-DTA-OUT-CAP
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(10).
           IF NOT KDA-VC-TRM-DTA-OUT-CAP
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(11).
           IF NOT KDA-VC-PIN-CAPTURE-CAP
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(12).
      *
           IF ERROR-FOUND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 241                   TO ER-CD-3-DIG(ER-INDX)
              SET ER-INDX UP BY 1.
      *
           MOVE 'N'                      TO WS-ERROR-SW.
           IF KDA-VC-DTA-INP-MOD-ECOM
              IF KDA-VC-CRDHLDR-PRSNT-4 OR
                 KDA-VC-CRDHLDR-PRSNT-ECOM
                    NEXT SENTENCE
              ELSE
                 MOVE 'Y'                TO WS-ERROR-SW
              END-IF
           ELSE
              IF KDA-VC-CRDHLDR-PRSNT-ECOM
                 MOVE 'Y'                TO WS-ERROR-SW
              END-IF
           END-IF.
      *
           IF ERROR-FOUND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 239                   TO ER-CD-3-DIG(ER-INDX)
              MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(5)
                                          RMC-2-POS-DATA-CD-ERR-IND(7)
              SET ER-INDX UP BY 1
           END-IF.
      *                                                                 03.50
           IF KDA-CHD-MAP-SVC-IND-IS-TOKEN                              03.50
              IF KDA-VC-MC-DTA-INP-MOD-TOKEN                            03.50
                 NEXT SENTENCE                                          03.50
              ELSE                                                      03.50
                MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(7)03.50
                MOVE 'Y'                 TO PET-SUS-FLAG                03.50
                MOVE 269                 TO ER-CD-3-DIG (ER-INDX)       03.50
                SET ER-INDX UP BY 1                                     03.50
              END-IF                                                    03.50
            END-IF.                                                     03.50
      *                                                                 03.62M
           IF MR1-VALID-SALE AND KDA-CHD-MAP-SVC-IND-IS-DIG-ENB         03.62M
              IF KDA-VC-DTA-INP-MOD-ECOM                                03.62M
                 NEXT SENTENCE                                          03.62M
              ELSE                                                      03.62M
                MOVE ONE-AST             TO RMC-2-POS-DATA-CD-ERR-IND(7)03.62M
                MOVE 'Y'                 TO PET-SUS-FLAG                03.62M
                MOVE 270                 TO ER-CD-3-DIG (ER-INDX)       03.62M
                SET ER-INDX UP BY 1                                     03.62M
              END-IF                                                    03.62M
           END-IF.                                                      03.62M
      *
       U-410-EXIT.
           EXIT.
      *
       U-430-DEFAULT-PROCESS-CODE.
      *
           MOVE ZEROS                    TO KDA-PROCESS-CODE.
           MOVE '?'                      TO RCL-5-PROC-CD-ERR-IND.
      *
           IF MR1-VALID-RETURN                                          03.31
              MOVE 20                    TO KDA-PC-TRAN-TYPE
           ELSE
           IF MR1-VALID-CASH                                            03.31
              IF KDA-MMERCAT-MC-CASH
                  MOVE 12                TO KDA-PC-TRAN-TYPE
              END-IF
              IF KDA-MMERCAT-MC-ATM
                  MOVE 01                TO KDA-PC-TRAN-TYPE
              END-IF
           ELSE
           IF MR1-VALID-SALE                                            03.31
              IF KDA-MMERCAT-MC-UNIQUE
                  MOVE 18                TO KDA-PC-TRAN-TYPE
              END-IF
              IF KDA-MMERCAT-MC-PAYMNT
                  MOVE 28                TO KDA-PC-TRAN-TYPE
              END-IF
           END-IF.
           IF KDA-PC-TRAN-IS-PURCH
              IF KDA-CHD-ICA-IS-MC-DEBIT AND
                (KDA-VC-CRDHLDR-PRSNT-0 OR
                 KDA-VC-CRDHLDR-PRSNT-9)
                 IF PET-CASH-BACK-AMT > +0
                    MOVE 09              TO KDA-PC-TRAN-TYPE
                 ELSE
                    IF PET-AUTHORIZ-RESP = '87'
                       MOVE 09           TO KDA-PC-TRAN-TYPE
                    END-IF
                 END-IF
              END-IF
           END-IF.
      *
           IF KDA-CHD-ICA-IS-MC-CREDIT
              IF KDA-PC-TRAN-IS-CSH-BK OR
                 PET-CASH-BACK-AMT > +0
                    MOVE ONE-AST         TO RCL-5-PROC-CD-ERR-IND
                    MOVE 'Y'             TO PET-SUS-FLAG
                    MOVE 232             TO ER-CD-3-DIG(ER-INDX)
                    SET ER-INDX UP BY 1
              END-IF
           ELSE
              IF PET-CASH-BACK-AMT > +0
                 IF NOT KDA-PC-TRAN-IS-CSH-BK
                    MOVE ONE-AST         TO RCL-5-PROC-CD-ERR-IND
                    MOVE 'Y'             TO PET-SUS-FLAG
                    MOVE 232             TO ER-CD-3-DIG(ER-INDX)
                    SET ER-INDX UP BY 1
                 END-IF
              END-IF
           END-IF.
      *
      * FOR NOW, SET ALL MC PROCESS CODE FROM TYPES TO ZERO
      *    IF KDA-CHD-ICA-IS-MC-CREDIT
      *       MOVE 30                    TO KDA-PC-FROM-TYPE.
      *
           MOVE KDA-PROCESS-CODE         TO PET-MC-PROC-CD.
           MOVE KDA-PROCESS-CODE-X       TO RCL-5-PROC-CD.
      *
       U-430-EXIT.
           EXIT.
      *
      *
       U-500-SPCL-PL-EDIT.                                              02.61
      *                                                                 02.61
           MOVE MIS3-AUTHORIZE           TO PET-AUTH-CD.                02.61
           IF NOT KDA-CHD-IS-VALID-PD                                   02.61
              GO TO U-500-EXIT.                                         02.61
      *                                                                 02.61
           MOVE '  CASH AMT  '           TO RRD-AMT-ID.                 02.61
           IF MIS3-CASH-BACK-AMT-X = SPACES                             02.61
              MOVE SPACES                TO RRD-AMT-X                   02.61
              MOVE ZEROS                 TO MIS3-CASH-BACK-AMT          02.61
           ELSE                                                         02.61
              IF MIS3-CASH-BACK-AMT NUMERIC                             02.61
                 MOVE MIS3-CASH-BACK-AMT TO RRD-AMT                     02.61
                 CALL BACONDEC USING BASCRATE-SD-BANK-KEY               02.61
                      C-TYPED  BASCRATE-SD-BATCH-CURR-DEC               02.61
                      C-TYPEA  RRD-AMT  C-LGTH20                        02.61
                      C-TYPEEND                                         02.61
              ELSE                                                      02.61
                 MOVE MIS3-CASH-BACK-AMT-X                              02.61
                                         TO RRD-AMT-X                   02.61
                 MOVE ONE-AST            TO RRD-AMT-ERR-IND             02.61
                 MOVE 'Y'                TO PET-SUS-FLAG                02.61
                 MOVE 215                TO ER-CD-3-DIG(ER-INDX)        02.61
                 SET ER-INDX UP BY 1                                    02.61
              END-IF                                                    02.61
           END-IF.                                                      02.61
           IF MIS3-AMOUNT NUMERIC AND                                   02.61
              MIS3-CASH-BACK-AMT NUMERIC                                02.61
                 IF MIS3-CASH-BACK-AMT < MIS3-AMOUNT                    02.61
                    MOVE MIS3-CASH-BACK-AMT                             02.61
                                         TO PET-CASH-BACK-AMT           02.61
                 ELSE                                                   02.61
                    MOVE ONE-AST         TO RRD-AMT-ERR-IND             02.61
                    MOVE 'Y'             TO PET-SUS-FLAG                02.61
                    MOVE 229             TO ER-CD-3-DIG(ER-INDX)        02.61
                    SET ER-INDX UP BY 1                                 02.61
                 END-IF                                                 02.61
           END-IF.                                                      02.61
           MOVE RRD-AMT-DATA             TO RCL-4-OPTIONAL-DATA.        02.61
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.               02.61
      *                                                                 02.61
           PERFORM U-700-SURCHARGE-EDITS THRU U-700-EXIT.               02.95
      *                                                                 02.95
       U-500-EXIT.                                                      02.61
           EXIT.                                                        02.61
      *                                                                 02.61
103540 U-550-SPCL-PL-NO-EDIT.
103550     MOVE HOLD-MERCH-ID            TO PET-MERCH-ID.
           MOVE MIS3-AUTHORIZE           TO PET-AUTH-CD.                02.39
103870     MOVE ZEROS                    TO PET-CHGEBACK-REF-NMBR.
      *
           PERFORM U-900-LOAD-AMTS
              THRU U-900-EXIT.
      *
           PERFORM U-700-SURCHARGE-EDITS THRU U-700-EXIT.               02.95
      *                                                                 02.95
104580 U-550-EXIT.
104590     EXIT.
      *
       U-600-SPCL-DS-EDIT.
      *
           MOVE MIS3-PHONE-ORD           TO KDA-PHONE-ORD
                                            RCL-2-MOTO-ECOM.
           MOVE MIS3-AUTHORIZE-SRCE      TO KDA-AUTH-SRCE
                                            RCL-3-AUTH-SRC.
           MOVE MIS3-POS-TERM            TO KDA-POS-TERM
                                            RCL-3-POS-TRM-CAP.
           MOVE MIS3-CAT-TERM-LVL        TO KDA-CAT-TERM-LVL
                                            RCL-5-CAT-TRM.
           MOVE MIS3-CARDHLDR-ID         TO KDA-CARDHLDR-ID
                                            RCL-4-CRD-ID-MTHD.
      *
           MOVE KDA-CHD-DS-REGULATION-IND                               02.68
                                         TO RDS-1-REG-IND.              02.68
      *                                                                 02.68
           MOVE MIS3-DS-LOCAL-DATE-X     TO RDS-1-LOCAL-DATE.
           IF MIS3-DS-LOCAL-DATE NUMERIC
              MOVE MIS3-DS-LOCAL-DATE    TO DC-SEND-DATE
              MOVE 'CDD'                 TO DC-OPERATION
              PERFORM D-100-CALL-DATECONV
                 THRU D-100-EXIT
              IF DC-SUCCESSFUL
                 MOVE DC-RETURN-DATE     TO PET-DS-LOCAL-DATE
              ELSE
                 MOVE ONE-AST            TO RDS-1-LOCAL-DATE-ERR-IND
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 242                TO ER-CD-3-DIG(ER-INDX)
                 SET ER-INDX UP BY 1
              END-IF
           ELSE
              MOVE ONE-AST               TO RDS-1-LOCAL-DATE-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 242                   TO ER-CD-3-DIG(ER-INDX)
              SET ER-INDX UP BY 1
           END-IF
      *
           IF MIS3-DS-LOCAL-TIME = SPACES                               03.60
              MOVE ZEROES                TO MIS3-DS-LOCAL-TIME          03.60
           END-IF.                                                      03.60
           IF MIS3-DS-LOCAL-TIME NUMERIC
              MOVE MIS3-DS-LOCAL-TIME    TO WK-TIMESTAMP-HHMMSS
              MOVE WK-TIMESTAMP-HH       TO RDS-1-LOCAL-TIME(1:2)
              MOVE WK-TIMESTAMP-MM       TO RDS-1-LOCAL-TIME(4:2)
              MOVE WK-TIMESTAMP-SS       TO RDS-1-LOCAL-TIME(7:2)
              MOVE ':'                   TO RDS-1-LOCAL-TIME(3:1)
                                            RDS-1-LOCAL-TIME(6:1)
              IF WK-TIMESTAMP-HHMMSS > 0                                02.53
                 IF WK-TIMESTAMP-HH > 23 OR
                    WK-TIMESTAMP-MM > 59 OR
                    WK-TIMESTAMP-SS > 59                                02.53
                       MOVE ONE-AST      TO RDS-1-LOCAL-TIME-ERR-IND
                       MOVE 'Y'          TO PET-SUS-FLAG
                       MOVE 243          TO ER-CD-3-DIG(ER-INDX)
                       SET ER-INDX UP BY 1
                 ELSE
                    MOVE WK-TIMESTAMP-HHMMSS
                                         TO PET-DS-LOCAL-TIME
                 END-IF
              END-IF
           ELSE
              MOVE MIS3-DS-LOCAL-TIME-X  TO RDS-1-LOCAL-TIME
              MOVE ONE-AST               TO RDS-1-LOCAL-TIME-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 243                   TO ER-CD-3-DIG(ER-INDX)
              SET ER-INDX UP BY 1
           END-IF.
      *                                                                 02.43
           PERFORM U-110-VALIDATE-AUTH                                  02.43
              THRU U-110-EXIT.                                          02.43
           IF AUTH-ERR                                                  02.43
              MOVE 4                     TO ER-CD (ER-INDX)             02.43
              SET ER-INDX UP BY 1                                       02.43
              MOVE 'Y'                   TO PET-SUS-FLAG                02.43
              MOVE ONE-AST               TO RCL-2-AUTH-CODE-ERR-IND     02.43
           ELSE                                                         02.43
              MOVE AUTH-SPACE-WORK       TO PET-AUTH-CD.                02.43
      *                                                                 02.43
           MOVE MIS3-DS-AUTH-STAN-X      TO RDS-2-AUTH-STAN.
           IF MIS3-DS-AUTH-STAN-X = SPACES                              02.81
              MOVE ZEROS                 TO MIS3-DS-AUTH-STAN-X.        02.81
           IF MIS3-DS-AUTH-STAN NUMERIC
              MOVE MIS3-DS-AUTH-STAN     TO PET-DS-AUTH-STAN
           ELSE
              MOVE ONE-AST               TO RDS-2-AUTH-STAN-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 244                   TO ER-CD-3-DIG(ER-INDX)
              SET ER-INDX UP BY 1
           END-IF.
      *
           MOVE MIS3-DS-PART-SHIP-IND    TO RDS-2-PART-SHIP-IND
                                            WS-VALID-DIS-PART-SHIP-IND.
           IF VALID-DIS-PART-SHIP-IND
              MOVE MIS3-DS-PART-SHIP-IND TO PET-DS-PART-SHIP-IND
           ELSE
              MOVE ONE-AST               TO RDS-2-PART-SHIP-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 245                   TO ER-CD-3-DIG(ER-INDX)
              SET ER-INDX UP BY 1
           END-IF.
      *
           MOVE MIS3-DS-TRK-COND-CD-X    TO KDA-DIS-TRK-COND-CD.
           MOVE MIS3-DS-TRK-COND-CD-X(1:1)
                                         TO RDS-2-TRK-COND-CD-1.
           MOVE MIS3-DS-TRK-COND-CD-X(2:1)
                                         TO RDS-2-TRK-COND-CD-2.
           IF MIS3-AUTHORIZE NOT = SPACES
              IF KDA-VC-DIS-TRK-1-COND-CD AND
                 KDA-VC-DIS-TRK-2-COND-CD
                    MOVE MIS3-DS-TRK-COND-CD-X
                                         TO PET-DS-TRK-COND-CD-X
              ELSE
                 IF NOT KDA-VC-DIS-TRK-1-COND-CD
                    MOVE ONE-AST         TO RDS-2-TRK-COND-CD-1-ERR-IND
                 END-IF                                                 02.39
                 IF NOT KDA-VC-DIS-TRK-2-COND-CD                        02.39
                    MOVE ONE-AST         TO RDS-2-TRK-COND-CD-2-ERR-IND 02.39
                 END-IF                                                 02.39
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 246                TO ER-CD-3-DIG(ER-INDX)
                 SET ER-INDX UP BY 1
              END-IF
           END-IF.
      *
           MOVE MIS3-POS-ENTRY-MODE      TO KDA-POS-ENTRY-MODE
                                            RCL-3-POS-E-MOD.
           IF KDA-VC-POS-ENTRY-DIS
              MOVE MIS3-POS-ENTRY-MODE   TO PET-DS-POS-PAN-ENTRY-MOD
           ELSE
              MOVE ONE-AST               TO RCL-3-POS-E-MOD-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 206                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1
           END-IF.
      *
           MOVE MIS3-DS-POS-PIN-ENTRY-CAP
                                         TO KDA-POS-PIN-ENTRY-CAP
                                            RDS-2-PIN-E-CAP.
           IF KDA-VC-POS-PIN-ENTRY-CAP-DIS
              MOVE MIS3-DS-POS-PIN-ENTRY-CAP
                                         TO PET-DS-POS-PIN-ENTRY-CAP
           ELSE
              MOVE ONE-AST               TO RDS-2-PIN-E-CAP-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 240                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1
           END-IF.
      *
           MOVE MIS3-DS-TRANS-ID         TO RRD-DS-TRANS-ID.            03.62D
           MOVE MIGR-MERCH-NMBR          TO PET-DS-TRANS-ID.            03.62D
           MOVE MIS3-DS-NETWORK-REF-ID   TO RDS-2-NETWORK-REF-ID
                                            PET-DS-NETWORK-REF-ID.
      *
           IF MIS3-DS-SPECIALTY-USE-X = SPACES
              MOVE SPACES                TO RRD-DS-AMT-X
           ELSE
           IF MIS3-DS-SPECIALTY-USE-X NUMERIC
              MOVE MIS3-DS-SPECIALTY-USE TO RRD-DS-AMT
                                            PET-DS-SPECIALTY-USE
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-DS-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-DS-SPECIALTY-USE-X
                                         TO RRD-DS-AMT-X
              MOVE ONE-AST               TO RRD-DS-AMT-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 252                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
           MOVE RRD-DS-DATA              TO RCL-6-PURCHASE-IDENT.
           MOVE RESET-RRD-DS-DATA        TO RRD-DS-DATA.
      *
           MOVE +0                       TO KDA-AUTH-DS-USD-AMT.
           MOVE '  AUTH AMT  '           TO RRD-AMT-ID.
           IF MIS3-AUTH-AMT-X = SPACES
              MOVE SPACES                TO RRD-AMT-X
              MOVE ZEROS                 TO MIS3-AUTH-AMT
           ELSE
           IF MIS3-AUTH-AMT NUMERIC
              MOVE MIS3-AUTH-AMT         TO RRD-AMT
                                            KDA-AUTH-DS-USD-AMT
                                            PET-AUTHORIZ-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-AUTH-AMT-X       TO RRD-AMT-X
              MOVE ONE-AST               TO RRD-AMT-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 219                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
           MOVE RRD-AMT-DATA             TO RCL-2-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           MOVE '  SALES TAX '           TO RRD-AMT-ID.
           IF MIS3-DS-SALES-TAX-AMT-X = SPACES
              MOVE SPACES                TO RRD-AMT-X
              MOVE ZEROS                 TO MIS3-DS-SALES-TAX-AMT
           ELSE
           IF MIS3-DS-SALES-TAX-AMT NUMERIC
              MOVE MIS3-DS-SALES-TAX-AMT TO RRD-AMT
                                            PET-DS-SALES-TAX-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-DS-SALES-TAX-AMT-X
                                         TO RRD-AMT-X
              MOVE ONE-AST               TO RRD-AMT-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 247                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
           MOVE RRD-AMT-DATA             TO RCL-3-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           MOVE '  CASH OVER '           TO RRD-AMT-ID.
           IF MIS3-CASH-BACK-AMT-X = SPACES
              MOVE SPACES                TO RRD-AMT-X
              MOVE ZEROS                 TO MIS3-CASH-BACK-AMT
           ELSE
           IF MIS3-CASH-BACK-AMT NUMERIC
              MOVE MIS3-CASH-BACK-AMT    TO RRD-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-CASH-BACK-AMT-X  TO RRD-AMT-X
              MOVE ONE-AST               TO RRD-AMT-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 215                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
           IF MIS3-AMOUNT NUMERIC AND
              MIS3-CASH-BACK-AMT NUMERIC
                 IF MIS3-CASH-BACK-AMT > +0                             02.39
                    IF MIS3-CASH-BACK-AMT < MIS3-AMOUNT                 02.39
                       IF KDA-DMERCAT-IS-CASH-BACK                      02.39
                          MOVE MIS3-CASH-BACK-AMT                       02.39
                                         TO PET-CASH-BACK-AMT           02.39
                       ELSE                                             02.39
                          MOVE ONE-AST   TO RRD-AMT-ERR-IND             02.39
                          MOVE 'Y'       TO PET-SUS-FLAG                02.39
                          MOVE 237       TO ER-CD-3-DIG(ER-INDX)        02.39
                          SET ER-INDX UP BY 1                           02.39
                       END-IF                                           02.39
                    ELSE                                                02.39
                       MOVE ONE-AST      TO RRD-AMT-ERR-IND             02.39
                       MOVE 'Y'          TO PET-SUS-FLAG                02.39
                       MOVE 229          TO ER-CD-3-DIG (ER-INDX)       02.39
                       SET ER-INDX UP BY 1                              02.39
                    END-IF                                              02.39
                 END-IF                                                 02.39
           END-IF.                                                      02.39
      *
           PERFORM U-700-SURCHARGE-EDITS THRU U-700-EXIT.               02.95
      *                                                                 02.95
           IF MR1-VALID-RETURN                                          03.31
              COMPUTE KDA-TRAN-DS-CSH-BK-USD-AMT = +0
           ELSE
              IF PET-ACQ-CURR-CODE = +840
                 COMPUTE KDA-TRAN-DS-CSH-BK-USD-AMT = PET-CASH-BACK-AMT
              ELSE
                 COMPUTE KDA-TRAN-DS-CSH-BK-USD-AMT = PET-CASH-BACK-AMT
                                    * BASCRATE-RD-MCBS-USD-RATE
                 CALL BACONDEC USING  BASCRATE-SD-BANK-KEY
                             C-TYPED  C-DECI02
                             C-TYPER  KDA-TRAN-DS-CSH-BK-USD-AMT
                             C-TYPEEND
              END-IF
           END-IF.
      *
           MOVE MIS3-DS-PROCESS-CODE-X   TO KDA-PROCESS-CODE-X.         02.53
           IF MIS3-DS-PROCESS-CODE-X = SPACES OR MR1-VALID-1-SIDED      03.60
              MOVE ZEROS                 TO KDA-PROCESS-CODE
                                            RCL-5-PROC-CD
              MOVE '?'                   TO RCL-5-PROC-CD-ERR-IND
              IF MR1-VALID-RETURN                                       03.31
                 MOVE 20                 TO KDA-PC-TRAN-TYPE
              END-IF
              IF MR1-VALID-CASH                                         03.31
                 MOVE 01                 TO KDA-PC-TRAN-TYPE
              END-IF
              IF MR1-VALID-SALE AND                                     03.31
                 PET-CASH-BACK-AMT > +0                                 02.56
                    MOVE 09              TO KDA-PC-TRAN-TYPE            02.56
              END-IF                                                    02.56
           ELSE
              IF ((MR1-VALID-RETURN AND                                 03.31
                   KDA-PC-DS-TRAN-IS-RETURN) OR
                  (MR1-VALID-SALE AND                                   03.31
                   KDA-PC-DS-TRAN-IS-SALE) OR
                  (MR1-VALID-SALE AND                                   03.31
                   KDA-PC-DS-TRAN-IS-RECUR-PAY AND                      02.56
                   KDA-DMERCAT-IS-RECUR-PAY) OR                         02.56
                  (MR1-VALID-CASH AND                                   03.31
                   KDA-PC-DS-TRAN-IS-CASH)) AND
                   KDA-PC-DS-FROM-IS-VALID AND
                   KDA-PC-DS-TO-IS-VALID                                02.82
                    CONTINUE
              ELSE
                 MOVE ONE-AST            TO RCL-5-PROC-CD-ERR-IND
                 MOVE 'Y'                TO PET-SUS-FLAG
                 MOVE 232                TO ER-CD-3-DIG(ER-INDX)
                 SET ER-INDX UP BY 1
              END-IF
           END-IF.
           MOVE KDA-PROCESS-CODE-X       TO RCL-5-PROC-CD
                                            PET-DS-PROC-CD.
           MOVE RRD-AMT-DATA             TO RCL-4-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           MOVE '  TIP AMT   '           TO RRD-AMT-ID.
           IF MIS3-DS-TIP-AMT-X = SPACES
              MOVE SPACES                TO RRD-AMT-X
              MOVE ZEROS                 TO MIS3-DS-TIP-AMT
           ELSE
           IF MIS3-DS-TIP-AMT NUMERIC
              MOVE MIS3-DS-TIP-AMT       TO RRD-AMT
                                            PET-DS-TIP-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-DS-TIP-AMT-X     TO RRD-AMT-X
              MOVE ONE-AST               TO RRD-AMT-ERR-IND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 256                   TO ER-CD-3-DIG (ER-INDX)
              SET ER-INDX UP BY 1.
           MOVE RRD-AMT-DATA             TO RCL-5-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           IF MIS3-DS-POS-DATA = SPACES                                 02.53
              MOVE PET-DS-POS-DATA       TO MIS3-DS-POS-DATA            02.53
           ELSE
              IF MIS3-DS-POS-DATA(9:1) = SPACE                          02.53
                 MOVE ZERO               TO MIS3-DS-POS-DATA(9:1)       02.53
              END-IF
              IF MIS3-DS-POS-DATA(10:1) = SPACE                         02.53
                 MOVE ZERO               TO MIS3-DS-POS-DATA(10:1)      02.53
              END-IF
              IF MIS3-DS-POS-DATA(12:1) = SPACE                         02.53
                 MOVE ZERO               TO MIS3-DS-POS-DATA(12:1)      02.53
              END-IF
              IF MIS3-DS-POS-DATA(13:1) = SPACE                         02.53
                 MOVE ZERO               TO MIS3-DS-POS-DATA(13:1)      02.53
              END-IF
           END-IF.
           MOVE MIS3-DS-POS-DATA         TO KDA-POS-DTA-CODE.           02.53
      *
           PERFORM
             VARYING SUB1 FROM +1 BY +1
             UNTIL   SUB1 > +13
               MOVE KDA-POS-DTA-CODE(SUB1:1)
                                         TO RDS-2-POS-DATA-CD(SUB1)
           END-PERFORM.
      *
           MOVE 'N'                      TO WS-ERROR-SW.
           IF NOT KDA-VC-DS-ATTEND-IND
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RDS-2-POS-DATA-CD-ERR-IND(1).
           IF NOT KDA-VC-DS-PART-APPROVE-IND
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RDS-2-POS-DATA-CD-ERR-IND(2).
           IF NOT KDA-VC-DS-LOC-IND
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RDS-2-POS-DATA-CD-ERR-IND(3).
           IF NOT KDA-VC-DS-CRDHLDR-PRSNT
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RDS-2-POS-DATA-CD-ERR-IND(4).
           IF NOT KDA-VC-DS-CRD-PRSNT
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RDS-2-POS-DATA-CD-ERR-IND(5).
           IF NOT KDA-VC-DS-CRD-CAPTURE-CAP
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RDS-2-POS-DATA-CD-ERR-IND(6).
           IF NOT KDA-VC-DS-TRAN-STAT-IND
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RDS-2-POS-DATA-CD-ERR-IND(7).
           IF NOT KDA-VC-DS-TRAN-SEC-IND
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RDS-2-POS-DATA-CD-ERR-IND(8).
           IF NOT KDA-VC-DS-CRD-INP-CAP
              MOVE 'Y'                 TO WS-ERROR-SW
              MOVE ONE-AST             TO RDS-2-POS-DATA-CD-ERR-IND(11).
      *
           IF ERROR-FOUND
              MOVE 'Y'                   TO PET-SUS-FLAG
              MOVE 241                   TO ER-CD-3-DIG(ER-INDX)
              SET ER-INDX UP BY 1
           ELSE
              MOVE KDA-POS-DTA-CODE      TO PET-DS-POS-DATA
           END-IF.
      *
       U-600-EXIT.
           EXIT.
      *
       U-601-SPCL-DS-NO-EDIT.
      *
           MOVE MIS3-PHONE-ORD           TO KDA-PHONE-ORD
                                            RCL-2-MOTO-ECOM.
           MOVE MIS3-AUTHORIZE-SRCE      TO KDA-AUTH-SRCE
                                            RCL-3-AUTH-SRC.
           MOVE MIS3-POS-TERM            TO KDA-POS-TERM
                                            RCL-3-POS-TRM-CAP.
           MOVE MIS3-CAT-TERM-LVL        TO KDA-CAT-TERM-LVL
                                            RCL-5-CAT-TRM.
           MOVE MIS3-CARDHLDR-ID         TO KDA-CARDHLDR-ID
                                            RCL-4-CRD-ID-MTHD.
      *
           MOVE MIS3-DS-LOCAL-DATE-X     TO RDS-1-LOCAL-DATE.
           IF MIS3-DS-LOCAL-DATE NUMERIC
              MOVE MIS3-DS-LOCAL-DATE    TO PET-DS-LOCAL-DATE
           END-IF
      *
           IF MIS3-DS-LOCAL-TIME = SPACES                               03.60
              MOVE ZEROES                TO MIS3-DS-LOCAL-TIME          03.60
           END-IF.                                                      03.60
           IF MIS3-DS-LOCAL-TIME NUMERIC
              MOVE MIS3-DS-LOCAL-TIME    TO WK-TIMESTAMP-HHMMSS
              MOVE WK-TIMESTAMP-HH       TO RDS-1-LOCAL-TIME(1:2)
              MOVE WK-TIMESTAMP-MM       TO RDS-1-LOCAL-TIME(4:2)
              MOVE WK-TIMESTAMP-SS       TO RDS-1-LOCAL-TIME(7:2)
              MOVE ':'                   TO RDS-1-LOCAL-TIME(3:1)
                                            RDS-1-LOCAL-TIME(6:1)
              MOVE WK-TIMESTAMP-HHMMSS   TO PET-DS-LOCAL-TIME
           END-IF.
      *
           MOVE MIS3-DS-AUTH-STAN-X      TO RDS-2-AUTH-STAN.
           IF MIS3-DS-AUTH-STAN-X = SPACES                              02.81
              MOVE ZEROS                 TO MIS3-DS-AUTH-STAN-X.        02.81
           IF MIS3-DS-AUTH-STAN NUMERIC
              MOVE MIS3-DS-AUTH-STAN     TO PET-DS-AUTH-STAN
           END-IF.
      *
           MOVE MIS3-DS-PART-SHIP-IND    TO RDS-2-PART-SHIP-IND
                                            PET-DS-PART-SHIP-IND.
      *
           MOVE MIS3-DS-TRK-COND-CD-X    TO PET-DS-TRK-COND-CD-X.
           MOVE MIS3-DS-TRK-COND-CD-X(1:1)
                                         TO RDS-2-TRK-COND-CD-1.
           MOVE MIS3-DS-TRK-COND-CD-X(2:1)
                                         TO RDS-2-TRK-COND-CD-2.
      *
           MOVE MIS3-POS-ENTRY-MODE      TO RCL-3-POS-E-MOD.
           IF MIS3-POS-ENTRY-MODE NUMERIC
              MOVE MIS3-POS-ENTRY-MODE   TO PET-DS-POS-PAN-ENTRY-MOD
           END-IF.
      *
           MOVE MIS3-DS-POS-PIN-ENTRY-CAP
                                         TO RDS-2-PIN-E-CAP.
           IF MIS3-DS-POS-PIN-ENTRY-CAP NUMERIC
              MOVE MIS3-DS-POS-PIN-ENTRY-CAP
                                         TO PET-DS-POS-PIN-ENTRY-CAP
           END-IF.
      *
           MOVE MIS3-DS-NETWORK-REF-ID   TO RDS-2-NETWORK-REF-ID
                                            PET-DS-NETWORK-REF-ID.
      *
           IF MIS3-DS-SPECIALTY-USE-X = SPACES
              MOVE SPACES                TO RRD-DS-AMT-X
           ELSE
           IF MIS3-DS-SPECIALTY-USE-X NUMERIC
              MOVE MIS3-DS-SPECIALTY-USE TO RRD-DS-AMT
                                            PET-DS-SPECIALTY-USE
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-DS-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-DS-SPECIALTY-USE-X
                                         TO RRD-DS-AMT-X.
           MOVE RRD-DS-DATA              TO RCL-6-PURCHASE-IDENT.
           MOVE RESET-RRD-DS-DATA        TO RRD-DS-DATA.
      *
           MOVE '  AUTH AMT  '           TO RRD-AMT-ID.
           IF MIS3-AUTH-AMT-X = SPACES
              MOVE SPACES                TO RRD-AMT-X
              MOVE ZEROS                 TO MIS3-AUTH-AMT
           ELSE
           IF MIS3-AUTH-AMT NUMERIC
              MOVE MIS3-AUTH-AMT         TO RRD-AMT
                                            PET-AUTHORIZ-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-AUTH-AMT-X       TO RRD-AMT-X.
           MOVE RRD-AMT-DATA             TO RCL-2-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           MOVE '  SALES TAX '           TO RRD-AMT-ID.
           IF MIS3-DS-SALES-TAX-AMT-X = SPACES
              MOVE SPACES                TO RRD-AMT-X
              MOVE ZEROS                 TO MIS3-DS-SALES-TAX-AMT
           ELSE
           IF MIS3-DS-SALES-TAX-AMT NUMERIC
              MOVE MIS3-DS-SALES-TAX-AMT TO RRD-AMT
                                            PET-DS-SALES-TAX-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-DS-SALES-TAX-AMT-X
                                         TO RRD-AMT-X.
           MOVE RRD-AMT-DATA             TO RCL-3-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           MOVE '  CASH OVER '           TO RRD-AMT-ID.
           IF MIS3-CASH-BACK-AMT-X = SPACES
              MOVE SPACES                TO RRD-AMT-X
              MOVE ZEROS                 TO MIS3-CASH-BACK-AMT
           ELSE
           IF MIS3-CASH-BACK-AMT NUMERIC
              MOVE MIS3-CASH-BACK-AMT    TO RRD-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-CASH-BACK-AMT-X  TO RRD-AMT-X.
           IF MIS3-AMOUNT NUMERIC AND
              MIS3-CASH-BACK-AMT NUMERIC
                 MOVE MIS3-CASH-BACK-AMT TO PET-CASH-BACK-AMT.
           MOVE RRD-AMT-DATA             TO RCL-4-OPTIONAL-DATA.
      *
           PERFORM U-700-SURCHARGE-EDITS THRU U-700-EXIT.               02.95
      *                                                                 02.95
           MOVE '  TIP AMT   '           TO RRD-AMT-ID.
           IF MIS3-DS-TIP-AMT-X = SPACES
              MOVE SPACES                TO RRD-AMT-X
              MOVE ZEROS                 TO MIS3-DS-TIP-AMT
           ELSE
           IF MIS3-DS-TIP-AMT NUMERIC
              MOVE MIS3-DS-SALES-TAX-AMT TO RRD-AMT
                                            PET-DS-TIP-AMT
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                   C-TYPEA  RRD-AMT  C-LGTH20
                   C-TYPEEND
           ELSE
              MOVE MIS3-DS-TIP-AMT-X     TO RRD-AMT-X.
           MOVE RRD-AMT-DATA             TO RCL-5-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           MOVE MIS3-DS-PROCESS-CODE-X   TO KDA-PROCESS-CODE-X.         02.56
           IF MIS3-DS-PROCESS-CODE-X = SPACES OR MR1-VALID-1-SIDED      03.60
              MOVE ZEROS                 TO KDA-PROCESS-CODE            02.56
                                            RCL-5-PROC-CD               02.56
              MOVE '?'                   TO RCL-5-PROC-CD-ERR-IND       02.56
              IF MR1-VALID-RETURN                                       03.31
                 MOVE 20                 TO KDA-PC-TRAN-TYPE            02.56
              END-IF                                                    02.56
              IF MR1-VALID-CASH                                         03.31
                 MOVE 01                 TO KDA-PC-TRAN-TYPE            02.56
              END-IF                                                    02.56
              IF MR1-VALID-SALE AND                                     03.31
                 PET-CASH-BACK-AMT > +0                                 02.56
                    MOVE 09              TO KDA-PC-TRAN-TYPE            02.56
              END-IF                                                    02.56
           END-IF.                                                      02.56
           MOVE KDA-PROCESS-CODE-X       TO RCL-5-PROC-CD
                                            PET-DS-PROC-CD.
      *
           IF MIS3-DS-POS-DATA = SPACES                                 02.53
              MOVE PET-DS-POS-DATA       TO MIS3-DS-POS-DATA            02.53
           ELSE
              IF MIS3-DS-POS-DATA(9:1) = SPACE                          02.53
                 MOVE ZERO               TO MIS3-DS-POS-DATA(9:1)       02.53
              END-IF
              IF MIS3-DS-POS-DATA(10:1) = SPACE                         02.53
                 MOVE ZERO               TO MIS3-DS-POS-DATA(10:1)      02.53
              END-IF
              IF MIS3-DS-POS-DATA(12:1) = SPACE                         02.53
                 MOVE ZERO               TO MIS3-DS-POS-DATA(12:1)      02.53
              END-IF
              IF MIS3-DS-POS-DATA(13:1) = SPACE                         02.53
                 MOVE ZERO               TO MIS3-DS-POS-DATA(13:1)      02.53
              END-IF
           END-IF.
           MOVE MIS3-DS-POS-DATA         TO KDA-POS-DTA-CODE            02.53
                                            PET-DS-POS-DATA.
      *
           PERFORM
             VARYING SUB1 FROM +1 BY +1
             UNTIL   SUB1 > +13
               MOVE KDA-POS-DTA-CODE(SUB1:1)
                                         TO RDS-2-POS-DATA-CD(SUB1)
           END-PERFORM.
      *
       U-601-EXIT.
           EXIT.
      *
       U-700-SURCHARGE-EDITS.                                           02.95
      *                                                                 02.95
           MOVE 'N'   TO WS-ERROR-SW.                                   02.95
           IF MIS3-SURCHG-AMT-X = SPACES                                02.95
              MOVE SPACES                TO RCL-9-SUR-AMT-X             02.95
              MOVE ZEROS                 TO MIS3-SURCHG-AMT             02.95
           ELSE                                                         02.95
           IF MIS3-SURCHG-AMT NUMERIC                                   02.95
              MOVE MIS3-SURCHG-AMT       TO RCL-9-SUR-AMT               02.95
                                            PET-SURCHARGE-AMT           02.95
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY                  02.95
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC                  02.95
                   C-TYPEA  RCL-9-SUR-AMT  C-LGTH11                     02.95
                   C-TYPEEND                                            02.95
           ELSE                                                         02.95
              MOVE MIS3-SURCHG-AMT-X     TO RCL-9-SUR-AMT-X             02.95
              MOVE ONE-AST               TO RCL-9-SUR-AMT-ERR-IND       02.95
              MOVE 'Y'                   TO WS-ERROR-SW                 02.95
                                            PET-SUS-FLAG.               02.95
      *                                                                 02.95
           IF MIS3-SURCHG-IND = ' '   AND                               02.95
              MIS3-SURCHG-AMT NUMERIC AND                               02.95
              MIS3-SURCHG-AMT = ZEROES                                  02.95
                MOVE MIS3-SURCHG-IND     TO RCL-9-SUR-IND               02.95
                                            PET-SURCHARGE-IND           02.95
                GO TO U-700-EXIT                                        02.95
           ELSE                                                         02.95
           IF (MIS3-SURCHG-IND = 'C' OR 'D') AND                        02.95
               MIS3-SURCHG-AMT NUMERIC       AND                        02.95
               MIS3-SURCHG-AMT > ZEROES                                 02.95
                MOVE MIS3-SURCHG-IND     TO RCL-9-SUR-IND               02.95
                                            PET-SURCHARGE-IND           02.95
           ELSE                                                         02.95
              MOVE MIS3-SURCHG-IND       TO RCL-9-SUR-IND               02.95
              MOVE ONE-AST               TO RCL-9-SUR-IND-ERR-IND       02.95
                                            RCL-9-SUR-AMT-ERR-IND       02.95
              MOVE 'Y'                   TO WS-ERROR-SW                 02.95
                                            PET-SUS-FLAG                02.95
           END-IF                                                       02.95
           END-IF.                                                      02.95
      *                                                                 02.95
           IF ERROR-FOUND                                               02.95
              MOVE 473                   TO ER-CD-3-DIG (ER-INDX)       02.95
              SET ER-INDX UP BY 1                                       02.95
              GO TO U-700-EXIT.                                         02.95
      *                                                                 02.95
       U-700-EXIT.                                                      02.95
           EXIT.                                                        02.95
      *                                                                 02.95
       U-900-LOAD-AMTS.
      *
           MOVE '  AUTH AMT  '           TO RRD-AMT-ID.
           IF MIS3-AUTH-AMT NOT NUMERIC
              MOVE +0                    TO RRD-AMT
           ELSE
              MOVE MIS3-AUTH-AMT         TO RRD-AMT
                                            PET-AUTHORIZ-AMT.
           CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                C-TYPEA  RRD-AMT  C-LGTH20
                C-TYPEEND.
           MOVE RRD-AMT-DATA             TO RCL-2-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
           IF PET-CARD-TYPE-VISA                                        03.27
              MOVE '  TOT AMT   '        TO RRD-AMT-ID                  02.53
              IF MIS3-VS-TOT-AUTH-AMT NOT NUMERIC                       02.53
                 MOVE +0                 TO RRD-AMT                     02.53
              ELSE                                                      02.53
                 MOVE MIS3-VS-TOT-AUTH-AMT                              02.53
                                         TO RRD-AMT                     02.53
                                            PET-TOTAL-AUTH-AMT          02.53
              END-IF                                                    02.53
              CALL BACONDEC USING BASCRATE-SD-BANK-KEY                  02.53
                   C-TYPED  BASCRATE-SD-BATCH-CURR-DEC                  02.53
                   C-TYPEA  RRD-AMT  C-LGTH20                           02.53
                   C-TYPEEND                                            02.53
              MOVE RRD-AMT-DATA          TO RCL-3-OPTIONAL-DATA         02.53
              MOVE RESET-RRD-AMT-DATA    TO RRD-AMT-DATA                02.53
           ELSE                                                         02.53
              MOVE PET-AUTHORIZ-AMT      TO PET-TOTAL-AUTH-AMT          02.53
           END-IF.                                                      02.53
      *                                                                 02.53
           MOVE '  CASH AMT  '           TO RRD-AMT-ID.
           IF MIS3-CASH-BACK-AMT NOT NUMERIC
              MOVE +0                    TO RRD-AMT
           ELSE
              MOVE MIS3-CASH-BACK-AMT    TO RRD-AMT
                                            PET-CASH-BACK-AMT.
           CALL BACONDEC USING BASCRATE-SD-BANK-KEY
                C-TYPED  BASCRATE-SD-BATCH-CURR-DEC
                C-TYPEA  RRD-AMT  C-LGTH20
                C-TYPEEND.
           MOVE RRD-AMT-DATA             TO RCL-4-OPTIONAL-DATA.
           MOVE RESET-RRD-AMT-DATA       TO RRD-AMT-DATA.
      *
       U-900-EXIT.
           EXIT.
      *
104610****************INST REPORT     **********************
104620 V-105-INST-REPORT.
104630     CLOSE SYSTEM-INST-WORK.
104640     SORT SORT-FILE-2
104650         ON ASCENDING SORT-CURR-CODE
104660                      SORT-BANK-KEY
104670         USING SYSTEM-INST-WORK
104680         GIVING SYSTEM-INST-WORK.
104690     PERFORM V-110-CREATE-INST
104700        THRU V-110-EXIT.
104710     MOVE 99       TO WS-RPT-LINE-CNT.
104720 V-105-EXIT.
104730     EXIT.
104740*
104750 V-110-CREATE-INST.
104760     OPEN INPUT SYSTEM-INST-WORK.
104770     MOVE 0          TO WS-IS-INST-ENDED.
104780     MOVE 1          TO WS-IS-FIRST-RECORD.
104790     MOVE ZEROS      TO WS-PREV-ASSN-CURR.
104800     READ SYSTEM-INST-WORK
104810          INTO  SORTED-INST-REC
104820          AT END MOVE 1 TO WS-IS-INST-ENDED.
104830     MOVE SIR-BANK-KEY   TO WS-BANK-2.
104840     MOVE 999            TO WS-BANK-ASSN.
104850     MOVE WS-BANK        TO HL6-BANK.
104860     PERFORM V-500-INST-HEADERS
104870        THRU V-500-EXIT.
104880     PERFORM V-120-LOOP
104890        THRU V-120-EXIT
104900            UNTIL WS-END-OF-INST.
104910     PERFORM V-501-ASSN-CURR-TTL
104920        THRU V-501-EXIT.
104930     PERFORM V-510-INST-FINAL-TTL
104940        THRU V-510-EXIT.
104950 V-110-EXIT.
104960     EXIT.
104970*
104980 V-120-LOOP.
104990     IF SIR-CURR-CODE NOT EQUAL WS-PREV-ASSN-CURR
105000     AND NOT WS-FIRST-RECORD
105010        PERFORM V-501-ASSN-CURR-TTL
105020           THRU V-501-EXIT.
105030     IF SIR-CURR-CODE NOT EQUAL WS-PREV-ASSN-CURR
105040        PERFORM V-502-CURR-LINE
105050           THRU V-502-EXIT.
105060     PERFORM V-503-ASSN-DETAIL
105070        THRU V-503-EXIT.
105080     READ SYSTEM-INST-WORK
105090          INTO  SORTED-INST-REC
105100          AT END MOVE 1 TO WS-IS-INST-ENDED.
105110     MOVE 0          TO WS-IS-FIRST-RECORD.
105120 V-120-EXIT.
105130     EXIT.
105140*
105150 V-500-INST-HEADERS.
105160     PERFORM R-815-WRITE-HEADERS
105170        THRU R-815-EXIT.
105180     MOVE HEAD-LINE-SUM-TTL     TO RLW-DETAIL-LINE.
105190     PERFORM R-920-WRITE-REPORT-RECORD
105200        THRU R-920-EXIT.
105210     PERFORM R-900-WRITE-TOTAL-RECORD
105220        THRU R-900-EXIT.
105230     MOVE HEAD-LINE-SUM-TTL-B   TO RLW-DETAIL-LINE.
105240     PERFORM R-920-WRITE-REPORT-RECORD
105250        THRU R-920-EXIT.
105260     PERFORM R-900-WRITE-TOTAL-RECORD
105270        THRU R-900-EXIT.
105280     MOVE HEAD-LINE-6           TO RLW-DETAIL-LINE.
105290     PERFORM R-920-WRITE-REPORT-RECORD
105300        THRU R-920-EXIT.
105310     PERFORM R-900-WRITE-TOTAL-RECORD
105320        THRU R-900-EXIT.
105330 V-500-EXIT.
105340     EXIT.
105350*
105360 V-501-ASSN-CURR-TTL.
105370     MOVE HLD-BANK-KEY TO WS-BANK-2
105380                          SB-BANK-KEY.
105390     MOVE 999          TO WS-BANK-ASSN.
105400     MOVE WS-BANK      TO HLC-CURR-BANK.
105410     MOVE SPACES       TO SCD3-LIT.
105420     ADD  WS-IC-BATCH-CNT      TO WS-IT-BATCH-CNT.
105430     ADD  WS-IC-ITEM-CNT       TO WS-IT-ITEM-CNT.
105440     ADD  WS-IC-SETTL-AMT      TO WS-IT-SETTL-AMT.
105450     ADD  WS-IC-BATCH-AMT      TO WS-IT-BATCH-AMT.
105460     ADD  WS-IC-INST-AMT       TO WS-IT-INST-AMT.
105470     MOVE WS-IC-BATCH-CNT      TO SCD3-BATCH-CNT.
105480     MOVE WS-IC-ITEM-CNT       TO SCD3-ITEM-CNT.
105490     MOVE WS-IC-BATCH-AMT      TO SCD3-BATCH-AMT.
105500     MOVE WS-IC-INST-AMT       TO SCD3-SETTLE-AMT.
105590     CALL BACONDEC USING  WS-BANK-999999
105530              C-TYPED  SB-IIIAAA-CURR-DEC
105540              C-TYPEA  SCD3-BATCH-AMT          C-LGTH24
105550              C-TYPEC  SCD3-ITEM-CNT           C-LGTH13
105560                       SCD3-BATCH-CNT          C-LGTH07
105570              C-TYPEEND.
105590     CALL BACONDEC USING  WS-BANK-999999
105530              C-TYPED  SB-III999-CURR-DEC
105610              C-TYPEA  SCD3-SETTLE-AMT         C-LGTH24
105620              C-TYPEEND.
105630     MOVE SCD1-CURR-TTL         TO RLW-DETAIL-LINE.
105640     PERFORM R-920-WRITE-REPORT-RECORD
105650        THRU R-920-EXIT.
105660     PERFORM R-900-WRITE-TOTAL-RECORD
105670        THRU R-900-EXIT.
105680     MOVE SCD3-DETAIL           TO RLW-DETAIL-LINE.
105690     PERFORM R-920-WRITE-REPORT-RECORD
105700        THRU R-920-EXIT.
105710     PERFORM R-900-WRITE-TOTAL-RECORD
105720        THRU R-900-EXIT.
105730     COMPUTE WS-IC-BATCH-CNT = +0.
105740     COMPUTE WS-IC-ITEM-CNT  = +0.
105750     COMPUTE WS-IC-SETTL-AMT = +0.
105760     COMPUTE WS-IC-BATCH-AMT = +0.
105770     COMPUTE WS-IC-INST-AMT  = +0.
105780 V-501-EXIT.
105790     EXIT.
105800*
105810 V-502-CURR-LINE.
105820     MOVE SIR-CURR-CODE     TO HLC-CURR-CODE-1.
105930     MOVE SIR-IIIAAA-CURR-NAME     TO HLC-CODE-NAME-1.
104830     MOVE SIR-BANK-KEY             TO WS-BANK-2.
104840     MOVE 999                      TO WS-BANK-ASSN.
104850     MOVE WS-BANK                  TO HLC-CURR-BANK.
106040     MOVE SIR-III999-CURR-CODE     TO HLC-CURR-CODE-2.
106060     MOVE SIR-III999-CURR-NAME     TO HLC-CODE-NAME-2.
106120     MOVE HEAD-LINE-CURR        TO RLW-DETAIL-LINE.
106130     PERFORM R-920-WRITE-REPORT-RECORD
106140        THRU R-920-EXIT.
106150     PERFORM R-900-WRITE-TOTAL-RECORD
106160        THRU R-900-EXIT.
106170 V-502-EXIT.
106180     EXIT.
106190*
106200 V-503-ASSN-DETAIL.
106210     ADD SIR-CNT            TO WS-IC-BATCH-CNT.
106220     ADD SIR-BATCH-ORIG-AMT        TO WS-IC-ITEM-CNT.
106230     ADD SIR-IIIAAA-AMT            TO WS-IC-BATCH-AMT.
106240     ADD SIR-CENTER-AMT            TO WS-IC-SETTL-AMT.
106250     ADD SIR-III999-AMT            TO WS-IC-INST-AMT.
106260     MOVE SIR-CNT                  TO SCD3-BATCH-CNT.
106270     MOVE SIR-BATCH-ORIG-AMT       TO BREAK-AMOUNT.
106280     MOVE BRK-AMOUNT-10            TO SCD3-ITEM-CNT.
106290     MOVE SIR-IIIAAA-AMT           TO SCD3-BATCH-AMT.
106300     MOVE SIR-III999-AMT           TO SCD3-SETTLE-AMT.
106310     MOVE SIR-BANK-KEY      TO SCD3-LIT-1.
106320     MOVE 'TOTALS'          TO SCD3-LIT-2.
106370     CALL BACONDEC USING  WS-BANK-999999
106380              C-TYPED  SIR-IIIAAA-CURR-DEC
106390              C-TYPEA  SCD3-BATCH-AMT          C-LGTH24
106400              C-TYPEC  SCD3-ITEM-CNT           C-LGTH13
106410                       SCD3-BATCH-CNT          C-LGTH07
106420              C-TYPEEND.
106440     CALL BACONDEC USING  WS-BANK-999999
106450              C-TYPED  SIR-III999-CURR-DEC
106460              C-TYPEA  SCD3-SETTLE-AMT         C-LGTH24
106470              C-TYPEEND.
106480     MOVE SCD3-DETAIL           TO RLW-DETAIL-LINE.
106490     PERFORM R-920-WRITE-REPORT-RECORD
106500        THRU R-920-EXIT.
106510     PERFORM R-900-WRITE-TOTAL-RECORD
106520        THRU R-900-EXIT.
106530     MOVE SIR-CURR-CODE    TO WS-PREV-ASSN-CURR.
106540 V-503-EXIT.
106550     EXIT.
106560*
106570 V-510-INST-FINAL-TTL.
106580     PERFORM V-500-INST-HEADERS
106590        THRU V-500-EXIT.
106610     MOVE SIR-III999-CURR-CODE     TO HLC-CURR-CODE-1.
106820     MOVE SIR-III999-CURR-NAME     TO HLC-CODE-NAME-1.
106600     MOVE 999999                   TO HLC-CURR-BANK.
106610     MOVE SIR-CENTER-CURR-CODE     TO HLC-CURR-CODE-2.
106820     MOVE SIR-CENTER-CURR-NAME     TO HLC-CODE-NAME-2.
106900     MOVE HEAD-LINE-CURR           TO RLW-DETAIL-LINE.
106910     PERFORM R-920-WRITE-REPORT-RECORD
106920        THRU R-920-EXIT.
106930     PERFORM R-900-WRITE-TOTAL-RECORD
106940        THRU R-900-EXIT.
106950     MOVE SCD1-CURR-TTL         TO RLW-DETAIL-LINE.
106960     PERFORM R-920-WRITE-REPORT-RECORD
106970        THRU R-920-EXIT.
106980     PERFORM R-900-WRITE-TOTAL-RECORD
106990        THRU R-900-EXIT.
107000     MOVE WS-IT-BATCH-CNT      TO SCD3-BATCH-CNT.
107010     MOVE WS-IT-ITEM-CNT       TO SCD3-ITEM-CNT.
107020     MOVE WS-IT-BATCH-AMT      TO SCD3-BATCH-AMT.
107030     MOVE WS-IT-SETTL-AMT      TO SCD3-SETTLE-AMT.
107050     CALL BACONDEC USING  WS-BANK-999999
107060              C-TYPED  SIR-IIIAAA-CURR-DEC
107070              C-TYPEA  SCD3-BATCH-AMT          C-LGTH24
107080              C-TYPEC  SCD3-ITEM-CNT           C-LGTH13
107090                       SCD3-BATCH-CNT          C-LGTH07
107100              C-TYPEEND.
107120     CALL BACONDEC USING  WS-BANK-999999
107060              C-TYPED  SIR-CENTER-CURR-DEC
107140              C-TYPEA  SCD3-SETTLE-AMT         C-LGTH24
107150              C-TYPEEND.
107160     MOVE SCD3-DETAIL           TO RLW-DETAIL-LINE.
107170     PERFORM R-920-WRITE-REPORT-RECORD
107180        THRU R-920-EXIT.
107190     PERFORM R-900-WRITE-TOTAL-RECORD
107200        THRU R-900-EXIT.
107210     COMPUTE SB-CNT          = WS-IT-BATCH-CNT.
107220     COMPUTE SB-BATCH-ORIG-AMT = WS-IT-ITEM-CNT.
107230     COMPUTE SB-III999-AMT     = WS-IT-INST-AMT.
107240     COMPUTE SB-CENTER-AMT    = WS-IT-SETTL-AMT.
107250     MOVE HL6-BANK             TO SB-BANK-KEY.
107260     MOVE HLC-CURR-CODE-1      TO SB-CURR-CODE.
107270     WRITE SYS-TTL-REC FROM SB-TOTAL-REC.
107280     COMPUTE  WS-IT-BATCH-CNT   = +0.
107290     COMPUTE  WS-IT-ITEM-CNT    = +0.
107300     COMPUTE  WS-IT-SETTL-AMT   = +0.
107310     COMPUTE  WS-IT-BATCH-AMT   = +0.
107320     COMPUTE  WS-IT-INST-AMT    = +0.
107330     COMPUTE  SB-CNT            = +0.
107340     COMPUTE  SB-BATCH-ORIG-AMT   = +0.
107350     COMPUTE  SB-III999-AMT       = +0.
107360     COMPUTE  SB-CENTER-AMT      = +0.
107370 V-510-EXIT.
107380     EXIT.
107390*
107400 V-900-HEADINGS-ASSN-BREAK.
107410     PERFORM R-815-WRITE-HEADERS
107420        THRU R-815-EXIT.
107430     MOVE HEAD-LINE-SUM-TTL     TO RLW-DETAIL-LINE.
107440     PERFORM R-920-WRITE-REPORT-RECORD
107450        THRU R-920-EXIT.
107460     PERFORM R-900-WRITE-TOTAL-RECORD
107470        THRU R-900-EXIT.
107480     MOVE HEAD-LINE-SUM-TTL-B   TO RLW-DETAIL-LINE.
107490     PERFORM R-920-WRITE-REPORT-RECORD
107500        THRU R-920-EXIT.
107510     PERFORM R-900-WRITE-TOTAL-RECORD
107520        THRU R-900-EXIT.
107530     MOVE 'TOTALS'       TO HL6-LIT.
107540     MOVE HEAD-LINE-6           TO RLW-DETAIL-LINE.
107550     PERFORM R-920-WRITE-REPORT-RECORD
107560        THRU R-920-EXIT.
107570     PERFORM R-900-WRITE-TOTAL-RECORD
107580        THRU R-900-EXIT.
107590     MOVE SPACE          TO HL6-LIT.
107600 V-900-EXIT.
107610     EXIT.
107620*
107630**************** FINAL REPORT         ***************************
107640 W-100-FINAL-REPORT.
107650     CLOSE SYSTEM-TTL-WORK.
107660     SORT SORT-FILE-2
107670         ON ASCENDING SORT-CURR-CODE
107680                      SORT-BANK-KEY
107690         USING SYSTEM-TTL-WORK
107700         GIVING SYSTEM-TTL-WORK.
107710     PERFORM W-110-CREATE-FINAL
107720        THRU W-110-EXIT.
107730     CLOSE SYSTEM-TTL-WORK.
107740     CLOSE SYSTEM-ASSN-WORK.
107750     SORT SORT-FILE-2
107760         ON ASCENDING SORT-BATCH-NMBR
107770                      SORT-BANK-KEY
107780         USING SYSTEM-ASSN-WORK
107790         GIVING SYSTEM-ASSN-WORK.
107800     PERFORM W-600-BATCH-FINAL
107810        THRU W-600-EXIT.
107820 W-100-EXIT.
107830     EXIT.
107840*
107850 W-110-CREATE-FINAL.
107860     OPEN INPUT SYSTEM-TTL-WORK
107870     COMPUTE SIR-CNT          = +0.
107880     COMPUTE SIR-BATCH-ORIG-AMT = +0.
107890     COMPUTE SIR-IIIAAA-AMT     = +0.
107900     MOVE 0          TO WS-IS-TTL-ENDED.
107910     MOVE 1          TO WS-IS-FIRST-RECORD.
107920     READ SYSTEM-TTL-WORK
107930          INTO  SORTED-TTL-REC
107940          AT END MOVE 1 TO WS-IS-TTL-ENDED.
107950     MOVE 999999                TO HL6-BANK.
107960     MOVE WS-REPORT-LIT-2       TO HL2-TITLE.
107970     MOVE ZEROS                 TO WS-PREV-ASSN-CURR.
107980     PERFORM V-500-INST-HEADERS
107990        THRU V-500-EXIT.
108000     PERFORM W-120-LOOP
108010        THRU W-120-EXIT
108020           UNTIL WS-END-OF-TTL.
108030     PERFORM W-501-ASSN-CURR-TTL
108040        THRU W-501-EXIT.
108050     PERFORM W-200-GRAND-FINALE
108060        THRU W-200-EXIT.
108070 W-110-EXIT.
108080     EXIT.
108090*
108100 W-120-LOOP.
108110     IF STR-CURR-CODE NOT EQUAL WS-PREV-ASSN-CURR
108120     AND NOT WS-FIRST-RECORD
108130        PERFORM W-501-ASSN-CURR-TTL
108140           THRU W-501-EXIT.
108150     IF STR-CURR-CODE NOT EQUAL WS-PREV-ASSN-CURR
108160        PERFORM W-502-CURR-LINE
108170           THRU W-502-EXIT.
108180     PERFORM W-503-ASSN-DETAIL
108190        THRU W-503-EXIT.
108200     READ SYSTEM-TTL-WORK
108210          INTO  SORTED-TTL-REC
108220          AT END MOVE 1 TO WS-IS-TTL-ENDED.
108230     MOVE 0          TO WS-IS-FIRST-RECORD.
108240 W-120-EXIT.
108250     EXIT.
108260*
108270 W-200-GRAND-FINALE.
108280     MOVE SPACES               TO HL6-LIT.
108290     MOVE HEAD-LINE-6           TO RLW-DETAIL-LINE.
108300     PERFORM R-920-WRITE-REPORT-RECORD
108310        THRU R-920-EXIT.
108320     PERFORM R-900-WRITE-TOTAL-RECORD
108330        THRU R-900-EXIT.
108340     MOVE HLC-CURR-CODE-2      TO HLC-CURR-CODE-1.
108350     MOVE HLC-CODE-NAME-2      TO HLC-CODE-NAME-1.
108360     MOVE SPACES               TO HLC-CURR-CODE-2
108370                                  HLC-CODE-NAME-2
108380                                  HLC-CURR-BANK-X
108390                                  HLC-DASH
108400                                  HLC-CURR-CODE-LIT.
108410     MOVE HEAD-LINE-CURR        TO RLW-DETAIL-LINE.
108420     PERFORM R-920-WRITE-REPORT-RECORD
108430        THRU R-920-EXIT.
108440     PERFORM R-900-WRITE-TOTAL-RECORD
108450        THRU R-900-EXIT.
108460     MOVE SPACES               TO SCD3-BATCH-AMT-X.
108470     MOVE WS-IC-BATCH-CNT      TO SCD3-BATCH-CNT.
108480     MOVE WS-IC-ITEM-CNT       TO SCD3-ITEM-CNT.
108490     MOVE WS-IC-SETTL-AMT      TO SCD3-SETTLE-AMT.
108510     CALL BACONDEC USING  WS-BANK-999999
108520              C-TYPED  STR-CENTER-CURR-DEC
108530              C-TYPEA  SCD3-SETTLE-AMT         C-LGTH24
108540              C-TYPEC  SCD3-ITEM-CNT           C-LGTH13
108550                       SCD3-BATCH-CNT          C-LGTH07
108560              C-TYPEEND.
108570*
108580     MOVE SCD1-CURR-TTL         TO RLW-DETAIL-LINE.
108590     PERFORM R-920-WRITE-REPORT-RECORD
108600        THRU R-920-EXIT.
108610     PERFORM R-900-WRITE-TOTAL-RECORD
108620        THRU R-900-EXIT.
108630     MOVE SCD3-DETAIL           TO RLW-DETAIL-LINE.
108640     PERFORM R-920-WRITE-REPORT-RECORD
108650        THRU R-920-EXIT.
108660     PERFORM R-900-WRITE-TOTAL-RECORD
108670        THRU R-900-EXIT.
108680 W-200-EXIT.
108690     EXIT.
108700*
108710 W-501-ASSN-CURR-TTL.
108720     MOVE SPACES       TO SCD3-LIT.
108730     ADD  WS-IT-BATCH-CNT      TO WS-IC-BATCH-CNT.
108740     ADD  WS-IT-ITEM-CNT       TO WS-IC-ITEM-CNT.
108750     ADD  WS-IT-SETTL-AMT      TO WS-IC-SETTL-AMT.
108760     MOVE WS-IT-BATCH-CNT      TO SCD3-BATCH-CNT.
108770     MOVE WS-IT-ITEM-CNT       TO SCD3-ITEM-CNT.
108780     MOVE WS-IT-BATCH-AMT      TO SCD3-BATCH-AMT.
108790     MOVE WS-IT-SETTL-AMT      TO SCD3-SETTLE-AMT.
108810     CALL BACONDEC USING  WS-BANK-999999
108820              C-TYPED  STR-III999-CURR-DEC
108830              C-TYPEA  SCD3-BATCH-AMT          C-LGTH24
108840              C-TYPEC  SCD3-ITEM-CNT           C-LGTH13
108850                       SCD3-BATCH-CNT          C-LGTH07
108860              C-TYPEEND.
108880     CALL BACONDEC USING  WS-BANK-999999
108890              C-TYPED  STR-CENTER-CURR-DEC
108900              C-TYPEA  SCD3-SETTLE-AMT         C-LGTH24
108910              C-TYPEEND.
108920     MOVE SCD1-CURR-TTL         TO RLW-DETAIL-LINE.
108930     PERFORM R-920-WRITE-REPORT-RECORD
108940        THRU R-920-EXIT.
108950     PERFORM R-900-WRITE-TOTAL-RECORD
108960        THRU R-900-EXIT.
108970     MOVE SCD3-DETAIL           TO RLW-DETAIL-LINE.
108980     PERFORM R-920-WRITE-REPORT-RECORD
108990        THRU R-920-EXIT.
109000     PERFORM R-900-WRITE-TOTAL-RECORD
109010        THRU R-900-EXIT.
109020     MOVE +0           TO WS-IT-BATCH-CNT.
109030     MOVE +0           TO WS-IT-ITEM-CNT.
109040     MOVE +0           TO WS-IT-BATCH-AMT.
109050     MOVE +0           TO WS-IT-SETTL-AMT.
109060 W-501-EXIT.
109070     EXIT.
109080*
109090 W-502-CURR-LINE.
109100     MOVE STR-CURR-CODE     TO HLC-CURR-CODE-1.
109100     MOVE STR-III999-CURR-NAME     TO HLC-CODE-NAME-1.
109110     MOVE 999999                   TO HLC-CURR-BANK
109120                                      WS-BANK-2.
109100     MOVE STR-CENTER-CURR-CODE     TO HLC-CURR-CODE-2.
109100     MOVE STR-CENTER-CURR-NAME     TO HLC-CODE-NAME-2.
109330     MOVE HEAD-LINE-CURR        TO RLW-DETAIL-LINE.
109340     PERFORM R-920-WRITE-REPORT-RECORD
109350        THRU R-920-EXIT.
109360     PERFORM R-900-WRITE-TOTAL-RECORD
109370        THRU R-900-EXIT.
109380 W-502-EXIT.
109390     EXIT.
109400*
109410 W-503-ASSN-DETAIL.
109420     ADD STR-CNT                   TO WS-IT-BATCH-CNT.
109430     ADD STR-BATCH-ORIG-AMT        TO WS-IT-ITEM-CNT.
109440     ADD STR-III999-AMT            TO WS-IT-BATCH-AMT.
109450     ADD STR-CENTER-AMT            TO WS-IT-SETTL-AMT.
109460     MOVE STR-CNT                  TO SCD3-BATCH-CNT.
109470     MOVE STR-BATCH-ORIG-AMT       TO BREAK-AMOUNT.
109480     MOVE BRK-AMOUNT-10            TO SCD3-ITEM-CNT.
109490     MOVE STR-III999-AMT           TO SCD3-BATCH-AMT.
109500     MOVE STR-CENTER-AMT           TO SCD3-SETTLE-AMT.
109510     MOVE STR-BANK-KEY             TO SCD3-LIT-1.
109520     MOVE 'TOTALS'         TO SCD3-LIT-2.
109550     CALL BACONDEC USING  WS-BANK-999999
109560              C-TYPED  STR-III999-CURR-DEC
109570              C-TYPEA  SCD3-BATCH-AMT          C-LGTH24
109580              C-TYPEC  SCD3-ITEM-CNT           C-LGTH13
109590                       SCD3-BATCH-CNT          C-LGTH07
109600              C-TYPEEND.
109630     CALL BACONDEC USING  WS-BANK-999999
109640              C-TYPED  STR-CENTER-CURR-DEC
109650              C-TYPEA  SCD3-SETTLE-AMT         C-LGTH24
109660              C-TYPEEND.
109670     MOVE SCD3-DETAIL           TO RLW-DETAIL-LINE.
109680     PERFORM R-920-WRITE-REPORT-RECORD
109690        THRU R-920-EXIT.
109700     PERFORM R-900-WRITE-TOTAL-RECORD
109710        THRU R-900-EXIT.
109720     MOVE STR-CURR-CODE    TO WS-PREV-ASSN-CURR.
109730 W-503-EXIT.
109740     EXIT.
109750*
109760 W-600-BATCH-FINAL.
055550     IF NOT WS-HAVE-ASSN-RECS
109760        GO TO W-600-WRITE-HEADERS.
109770     OPEN INPUT SYSTEM-ASSN-WORK.
109780     MOVE +0 TO WS-BR-BATCH-CNT
109790                WS-BR-ITEM-CNT
109800                WS-BR-SETTLE-AMT
109810                WS-BD-BATCH-CNT
109820                WS-BD-ITEM-CNT
109830                WS-BD-SETTLE-AMT
109840                WS-BA-BATCH-CNT
109850                WS-BA-ITEM-CNT
109860                WS-BA-SETTLE-AMT.
109870     MOVE 0  TO WS-END-OF-ASSN.
109960     READ SYSTEM-ASSN-WORK
109970          INTO  SORTED-ASSN-REC
109980          AT END MOVE 1   TO WS-END-OF-ASSN.
109990     PERFORM W-620-WRITE-HEADERS
110000        THRU W-620-EXIT.
110010     PERFORM W-610-LOOP
110020        THRU W-610-EXIT
110030             UNTIL WS-END-OF-ASSN = 1.
109760 W-600-WRITE-HEADERS.
110040     IF WS-RPT-LINE-CNT GREATER THAN 50
110050        PERFORM W-620-WRITE-HEADERS
110060           THRU W-620-EXIT.
110070     MOVE TRAILER-BATCH-HEAD    TO RLW-DETAIL-LINE.
110080     PERFORM R-920-WRITE-REPORT-RECORD
110090        THRU R-920-EXIT.
110100     PERFORM R-900-WRITE-TOTAL-RECORD
110110        THRU R-900-EXIT.
110120     MOVE 'BATCHES READ     '   TO TBT-DISC.
110130     MOVE WS-BR-BATCH-CNT       TO TBT-NUM-BTCHS.
110140     MOVE WS-BR-ITEM-CNT        TO TBT-ITEMS.
110150     MOVE WS-BR-SETTLE-AMT      TO TBT-SETTLE-AMT.
110170     CALL BACONDEC USING  WS-BANK-999999
110180              C-TYPED     BASCRATE-SD-CENTER-CURR-DEC
110190              C-TYPEA     TBT-SETTLE-AMT C-LGTH24
110200              C-TYPEC     TBT-NUM-BTCHS  C-LGTH07
110210                          TBT-ITEMS      C-LGTH13
110220              C-TYPEEND.
110230     MOVE SPACE TO TBT-CC.
110240     MOVE TRAILER-BATCH-TOTAL   TO RLW-DETAIL-LINE.
110250     PERFORM R-920-WRITE-REPORT-RECORD
110260        THRU R-920-EXIT.
110270     PERFORM R-900-WRITE-TOTAL-RECORD
110280        THRU R-900-EXIT.
           MOVE TBT-DISC                 TO RCN-BSL-DESCR.
           MOVE TBT-ITEMS-X              TO RCN-BSL-ITMS.
           MOVE TBT-NUM-BTCHS-X          TO RCN-BSL-NUM-BTCHS.
           MOVE TBT-SETTLE-AMT-X         TO RCN-BSL-SETTLE-AMT.
           MOVE RECN-BATCH-SUMMARY-LINE  TO WS-RECN-RECORD.
           IF WS-HAVE-ASSN-RECS
              PERFORM S-451-WRITE-RECN-REC
                 THRU S-451-EXIT.
110290     MOVE 'BATCHES DELETED  '   TO TBT-DISC.
110300     MOVE WS-BD-BATCH-CNT       TO TBT-NUM-BTCHS.
110310     MOVE WS-BD-ITEM-CNT        TO TBT-ITEMS.
110320     MOVE WS-BD-SETTLE-AMT      TO TBT-SETTLE-AMT.
110330     CALL BACONDEC USING  WS-BANK-999999
110180              C-TYPED     BASCRATE-SD-CENTER-CURR-DEC
110350              C-TYPEA     TBT-SETTLE-AMT C-LGTH24
110360              C-TYPEC     TBT-NUM-BTCHS  C-LGTH07
110370                          TBT-ITEMS      C-LGTH13
110380              C-TYPEEND.
110390     MOVE TRAILER-BATCH-TOTAL   TO RLW-DETAIL-LINE.
110400     PERFORM R-920-WRITE-REPORT-RECORD
110410        THRU R-920-EXIT.
110420     PERFORM R-900-WRITE-TOTAL-RECORD
110430        THRU R-900-EXIT.
           MOVE TBT-DISC                 TO RCN-BSL-DESCR.
           MOVE TBT-ITEMS-X              TO RCN-BSL-ITMS.
           MOVE TBT-NUM-BTCHS-X          TO RCN-BSL-NUM-BTCHS.
           MOVE TBT-SETTLE-AMT-X         TO RCN-BSL-SETTLE-AMT.
           MOVE RECN-BATCH-SUMMARY-LINE  TO WS-RECN-RECORD.
           IF WS-HAVE-ASSN-RECS
              PERFORM S-451-WRITE-RECN-REC
                 THRU S-451-EXIT.
110440     MOVE 'BATCHES ACCEPTED '   TO TBT-DISC.
110450     MOVE WS-BA-BATCH-CNT       TO TBT-NUM-BTCHS.
110460     MOVE WS-BA-ITEM-CNT        TO TBT-ITEMS.
110470     MOVE WS-BA-SETTLE-AMT      TO TBT-SETTLE-AMT.
110480     CALL BACONDEC USING  WS-BANK-999999
110180              C-TYPED     BASCRATE-SD-CENTER-CURR-DEC
110500              C-TYPEA     TBT-SETTLE-AMT C-LGTH24
110510              C-TYPEC     TBT-NUM-BTCHS  C-LGTH07
110520                          TBT-ITEMS      C-LGTH13
110530              C-TYPEEND.
110540     MOVE TRAILER-BATCH-TOTAL   TO RLW-DETAIL-LINE.
110550     PERFORM R-920-WRITE-REPORT-RECORD
110560        THRU R-920-EXIT.
110570     PERFORM R-900-WRITE-TOTAL-RECORD
110580        THRU R-900-EXIT.
           MOVE TBT-DISC                 TO RCN-BSL-DESCR.
           MOVE TBT-ITEMS-X              TO RCN-BSL-ITMS.
           MOVE TBT-NUM-BTCHS-X          TO RCN-BSL-NUM-BTCHS.
           MOVE TBT-SETTLE-AMT-X         TO RCN-BSL-SETTLE-AMT.
           MOVE RECN-BATCH-SUMMARY-LINE  TO WS-RECN-RECORD.
           IF WS-HAVE-ASSN-RECS
              PERFORM S-451-WRITE-RECN-REC
                 THRU S-451-EXIT.
110590 W-600-EXIT.
110600     EXIT.
110610*
110620 W-610-LOOP.
110630     ADD +1                    TO WS-BR-BATCH-CNT.
110640     ADD SAR-CNT               TO WS-BR-ITEM-CNT.
110650     ADD SAR-CENTER-AMT        TO WS-BR-SETTLE-AMT.
110660     MOVE SAR-REJ              TO TBL-REJ.
110670     MOVE SAR-BATCH-FRST-2     TO TBL-PRE.
110680     MOVE '-'                  TO TBL-DASH.
110690     MOVE SAR-BATCH-LAST-4     TO TBL-MAIN.
110700     MOVE SAR-BANK-KEY         TO TBL-BANK-KEY.
110710     MOVE SAR-REF              TO TBL-REF.
110720     MOVE SAR-CNT              TO TBL-ITMS.
110730     MOVE SAR-BATCH-ORIG-AMT   TO TBL-ORIG-AMT.
110740     MOVE SAR-BATCH-AMT        TO TBL-NET-AMT.
110750     MOVE SAR-CURR-CODE        TO TBL-NET-CURR.
110760     MOVE SAR-CENTER-AMT       TO TBL-SETTLE-AMT.
110770     IF  SAR-REJ  =  '**'
110780         ADD SAR-CNT           TO WS-BD-ITEM-CNT
110790         ADD +1                TO WS-BD-BATCH-CNT
110800         ADD SAR-CENTER-AMT    TO WS-BD-SETTLE-AMT
110810     ELSE
110820         ADD SAR-CNT           TO WS-BA-ITEM-CNT
110830         ADD +1                TO WS-BA-BATCH-CNT
110840         ADD SAR-CENTER-AMT    TO WS-BA-SETTLE-AMT.
110850     MOVE SAR-CENTER-CURR-CODE TO TBL-SETL-CURR.
110960     CALL BACONDEC USING WS-BANK-999999
110970              C-TYPED    SAR-BATCH-CURR-DEC
110980              C-TYPEA    TBL-ORIG-AMT   C-LGTH24
110990                         TBL-NET-AMT    C-LGTH24
111000              C-TYPEC    TBL-ITMS       C-LGTH07
111010              C-TYPEEND.
111030     CALL BACONDEC USING WS-BANK-999999
111040              C-TYPED    SAR-CENTER-CURR-DEC
111050              C-TYPEA    TBL-SETTLE-AMT C-LGTH24
111060              C-TYPEEND.
111070     IF WS-RPT-LINE-CNT GREATER THAN 56
111080         PERFORM W-620-WRITE-HEADERS
111090            THRU W-620-EXIT.
111100     IF FIRST-BATCHREC-SW EQUAL 'Y'
111110         MOVE 'N' TO FIRST-BATCHREC-SW
111120         MOVE '0' TO TBL-CC
111130     ELSE
111140         MOVE SPACE TO TBL-CC.
111150     MOVE TOTAL-BATCH-LINE      TO RLW-DETAIL-LINE.
111160     PERFORM R-920-WRITE-REPORT-RECORD
111170        THRU R-920-EXIT.
111180     PERFORM R-900-WRITE-TOTAL-RECORD
111190        THRU R-900-EXIT.
           MOVE TBL-BTCH                 TO RCN-BDL-BTCH.
           MOVE TBL-REJ(1:1)             TO RCN-BDL-REJ.
           MOVE TBL-BANK-KEY             TO RCN-BDL-BANK-KEY.
           MOVE TBL-ITMS-X               TO RCN-BDL-ITMS.
           MOVE TBL-NET-AMT-X            TO RCN-BDL-NET-AMT.
           MOVE TBL-NET-CURR             TO RCN-BDL-NET-CURR.
           MOVE TBL-SETTLE-AMT-X         TO RCN-BDL-SETTLE-AMT.
           MOVE TBL-SETL-CURR            TO RCN-BDL-SETL-CURR.
           MOVE RECN-BATCH-DETAIL-LINE   TO WS-RECN-RECORD.
           IF WS-RCN-LINE-CNT > 50
              MOVE 99                    TO WS-RCN-LINE-CNT.
           PERFORM S-451-WRITE-RECN-REC
              THRU S-451-EXIT.
           MOVE SPACE                    TO RCN-BDL-CC.
111200     READ SYSTEM-ASSN-WORK
111210          INTO  SORTED-ASSN-REC
111220          AT END MOVE 1   TO WS-END-OF-ASSN.
111230 W-610-EXIT.
111240     EXIT.
111250*
111260 W-620-WRITE-HEADERS.
111270     PERFORM R-815-WRITE-HEADERS.
111280     MOVE 'Y' TO FIRST-BATCHREC-SW.
111290     MOVE TOTAL-BATCH-HEAD-2    TO RLW-DETAIL-LINE.
111300     PERFORM R-920-WRITE-REPORT-RECORD
111310        THRU R-920-EXIT.
111320     PERFORM R-900-WRITE-TOTAL-RECORD
111330        THRU R-900-EXIT.
111340     MOVE TOTAL-BATCH-HEAD-3    TO RLW-DETAIL-LINE.
111350     PERFORM R-920-WRITE-REPORT-RECORD
111360        THRU R-920-EXIT.
111370     PERFORM R-900-WRITE-TOTAL-RECORD
111380        THRU R-900-EXIT.
111390 W-620-EXIT.
111400     EXIT.
111410*
111640 X-120-CHECK-IMBED-SPACE.
111650     MOVE +1                       TO SUB.
111660     PERFORM X-125-SEARCH-FOR-IMBED
111670        THRU X-125-EXIT
111680           VARYING SUB1 FROM +2 BY +1
111690           UNTIL   SUB1 > +6.
111700 X-120-EXIT.
111710     EXIT.
111720*
111730 X-125-SEARCH-FOR-IMBED.
111740     IF ASW-SW-POS (SUB) = SPACE
111750        IF ASW-SW-POS (SUB1) NOT = SPACE
111760           MOVE 'Y'                TO AUTH-ERR-SW.
111790     ADD +1                        TO SUB.
111800 X-125-EXIT.
111810     EXIT.
111820*
       X-130-CHECK-VISA-AUTH-CODE.
           PERFORM X-135-CHECK-EACH-BYTE
              THRU X-135-EXIT
                 VARYING SUB FROM +1 BY +1
                 UNTIL   SUB > LENGTH OF AUTH-SPACE-WORK.
       X-130-EXIT.
           EXIT.
      *
       X-135-CHECK-EACH-BYTE.
      *
           MOVE ASW-SW-POS(SUB)          TO WS-LC2UC-CHAR.
           PERFORM X-995-CONVERT-LOWER-TO-UPPER
              THRU X-995-EXIT.
           MOVE WS-LC2UC-CHAR            TO ASW-SW-POS(SUB).
      *
           MOVE ASW-SW-POS(SUB)          TO AUTH-CHAR-WORK
           IF NOT AUTH-CHAR-VALID
              MOVE 'Y'                   TO AUTH-ERR-SW
           END-IF.
      *
       X-135-EXIT.
           EXIT.
      *
       X-995-CONVERT-LOWER-TO-UPPER.
      *
           IF WS-LC2UC-CHAR NOT = SPACE
              IF WS-LC2UC-CHAR ALPHABETIC-LOWER
                 IF WS-LC2UC-EBCDIC
                    ADD 64               TO WS-LC2UC-ORD
                 ELSE
                    SUBTRACT 32        FROM WS-LC2UC-ORD
                 END-IF
              END-IF
           END-IF.
      *
       X-995-EXIT.
           EXIT.
      *
       Z-800-READ-FEICF.
      *
           READ FEICF-FILE INTO FRONT-END-CONTROL-RECORD
             KEY FEICF-KEY-X.
           IF FEICF-BYTES = '00'
              NEXT SENTENCE
           ELSE
              DISPLAY 'BAD READ ON FEICF'
              DISPLAY 'KEY ' FEICF-KEY
              DISPLAY 'FILE STATUS ====> ' FEICF-BYTES.
      *
       Z-800-EXIT.
           EXIT.
111820*
111830 Z-900-READ-EFR.
           MOVE SPACES                   TO BAS10002-CALL-PARAMETERS.   02.23
           MOVE 'X'                      TO BAS10002-EFR-PROB.          02.23
           MOVE EFR-REC-KEY              TO BAS10002-PASSED-KEY.        02.23
           MOVE 'R'                      TO BAS10002-CALL-TYPE.         02.23
111880     PERFORM Z9998-CALL-BAS10002
111890        THRU Z9998-EXIT.
           IF BAS10002-EFR-GOOD                                         02.23
              MOVE BAS10002-EDDATA-AREA  TO EDIT-FILE-REC.              02.23
111920 Z-900-EXIT.
111930     EXIT.
111940*
       Z-910-CALL-MESNMERD.                                             02.77
      *                                                                 02.77
           MOVE SPACE                    TO MESNMERD-RETURN-CODE.       02.77
           CALL MESNMERD USING MESNMERD-CALL-PARAMETERS                 02.77
                               NME-RECORD.                              02.77
      *                                                                 02.77
       Z-910-EXIT.                                                      02.77
           EXIT.                                                        02.77
      *                                                                 02.77
111950 Z999-CALL-TCR2-PROC.
111960     IF BE-SETTL-PARTIC = 0
111970         GO TO Z999-EXIT.
111980     MOVE 'N'          TO     TCR2-CALL-TYPE.
111990     CALL  BAS10001    USING  BCSETPAR-PASSAREA
112000                              POST-EDIT-TRANS
112010                              FRONT-END-CONTROL-RECORD.
112020 Z999-EXIT.
112030     EXIT.
      *
       Z9ADM-CALL-BASDADDM.                                             02.88
      *                                                                 02.88
           IF PARM-IS-REJECT-REPAIR                                     02.88
              CALL BASDADDM USING BASDADDM-CALL-PARAMETERS              02.88
                                  ADDENDUM-WORK-RECORD                  02.88
                                  ADDENDUM-VERSION-CONTROL              02.88
                                  ADDENDUM-LENGTH-TABLE                 02.88
              IF BASDADDM-RC-ERROR                                      02.88
                 MOVE 25                 TO HLD-RETURN-CD               02.88
              END-IF                                                    02.88
           END-IF.                                                      02.88
      *                                                                 02.88
       Z9ADM-EXIT.                                                      02.88
           EXIT.                                                        02.88
      *                                                                 02.88
       Z9TDAT-CALL-BASDTDTA.                                            03.13
      *                                                                 03.13
           IF PARM-IS-BALANCE-RECON                                     03.13
              CALL BASDTDTA USING BASDTDTA-CALL-PARAMETERS              03.13
                                  POST-EDIT-TRANS                       03.13
              IF BASDTDTA-RC-ERROR                                      03.13
                 MOVE 14                 TO HLD-RETURN-CD               03.13
              END-IF                                                    03.13
           END-IF.                                                      03.13
      *                                                                 03.13
       Z9TDAT-EXIT.                                                     03.13
           EXIT.                                                        03.13
      *                                                                 03.13
       Z9TRN-CALL-BASDTRAN.                                             02.88
      *                                                                 02.88
           IF PARM-IS-REJECT-REPAIR                                     02.88
              CALL BASDTRAN USING BASDTRAN-CALL-PARAMETERS              02.88
                                  MRCHTRAN-INPUT-RECORDS                02.88
                                  MRCHTRAN-INPUT-VERSIONS               02.88
              IF BASDTRAN-RC-ERROR                                      02.88
                 MOVE 15                 TO HLD-RETURN-CD               02.88
              END-IF                                                    02.88
           END-IF.                                                      02.88
      *                                                                 02.88
       Z9TRN-EXIT.                                                      02.88
           EXIT.                                                        02.88
      *                                                                 02.88
       Z9TRNR-CALL-BASDTRAN-NO-REJ.                                     03.54
      *                                                                 03.54
           IF NOT PARM-IS-REJECT-REPAIR                                 03.54
              CALL BASDTRAN USING BASDTRAN-CALL-PARAMETERS              03.54
                                  MRCHTRAN-INPUT-RECORDS                03.54
                                  MRCHTRAN-INPUT-VERSIONS               03.54
              IF BASDTRAN-RC-ERROR                                      03.54
                 MOVE 15                 TO HLD-RETURN-CD               03.54
              END-IF                                                    03.54
           END-IF.                                                      03.54
      *                                                                 03.54
       Z9TRNR-EXIT.                                                     03.54
           EXIT.                                                        03.54
      *                                                                 03.54
       Z99VU-CALL-BAS110VU.                                             02.51
      *                                                                 02.51
           CALL BAS110VU USING KMCINTEP-DATA-AREA                       02.51
                               PACKAGE-PASS-AREA                        02.51
                               VISA-STALE-DATE-RECORD                   02.51
                               POST-EDIT-TRANS                          02.51
                               VU-PLAN-DATA.                            02.51
      *                                                                 02.51
       Z99VU-EXIT.                                                      02.51
           EXIT.                                                        02.51
      *                                                                 02.51
       Z99VI-CALL-BAS110VI.                                             02.51
      *                                                                 02.51
           CALL BAS110VI USING KMCINTEP-DATA-AREA                       02.51
                               PACKAGE-PASS-AREA                        02.51
                               VISA-STALE-DATE-RECORD                   02.51
                               POST-EDIT-TRANS                          02.51
                               VI-PLAN-DATA.                            02.51
      *                                                                 02.51
       Z99VI-EXIT.                                                      02.51
           EXIT.                                                        02.51
      *                                                                 02.51
       Z99MU-CALL-BAS110MU.                                             02.51
      *                                                                 02.51
           CALL BAS110MU USING KMCINTEP-DATA-AREA                       02.51
                               PACKAGE-PASS-AREA                        02.51
                               KMCSDATE-STALE-DATE-DATA                 02.51
                               KMCMCCPW-CAB-PROG-WORK                   02.51
                               POST-EDIT-TRANS                          02.51
                               KMCINTBL-INTCHG-TABLES                   02.95
                               MU-PLAN-DATA.                            02.51
      *                                                                 02.51
       Z99MU-EXIT.                                                      02.51
           EXIT.                                                        02.51
      *                                                                 02.51
       Z99MI-CALL-BAS110MI.                                             02.51
      *                                                                 02.51
           CALL BAS110MI USING KMCINTEP-DATA-AREA                       02.51
                               PACKAGE-PASS-AREA                        02.51
                               KMCSDATE-STALE-DATE-DATA                 02.51
                               KMCMCCPW-CAB-PROG-WORK                   02.51
                               POST-EDIT-TRANS                          02.51
                               MI-PLAN-DATA.                            02.51
      *                                                                 02.51
       Z99MI-EXIT.                                                      02.51
           EXIT.                                                        02.51
      *                                                                 02.51
       Z99DU-CALL-BAS110DU.                                             02.51
      *                                                                 02.51
           CALL BAS110DU USING KMCINTEP-DATA-AREA                       02.51
                               PACKAGE-PASS-AREA                        02.51
                               DISCOVER-STALE-DATE-RECORD               02.51
                               POST-EDIT-TRANS                          02.51
                               DU-PLAN-DATA.                            02.51
      *                                                                 02.51
       Z99DU-EXIT.                                                      02.51
           EXIT.                                                        02.51
      *                                                                 02.51
       Z99AU-CALL-BAS110AU.                                             02.51
      *                                                                 02.51
           CALL BAS110AU USING KMCINTEP-DATA-AREA                       02.51
                               PACKAGE-PASS-AREA                        02.51
                               POST-EDIT-TRANS                          02.51
                               AU-PLAN-DATA.                            02.51
      *                                                                 02.51
       Z99AU-EXIT.                                                      02.51
           EXIT.                                                        02.51
      *                                                                 02.51
       Z99AE-CALL-BAS110AE.                                             03.16A
      *                                                                 03.16A
           CALL BAS110AE USING KMCINTEP-DATA-AREA                       03.16A
                               PACKAGE-PASS-AREA                        03.16A
                               POST-EDIT-TRANS                          03.16A
                               AE-PLAN-DATA.                            03.16A
      *                                                                 03.16A
       Z99AE-EXIT.                                                      03.16A
           EXIT.                                                        03.16A
      *                                                                 03.16A
       Z99PU-CALL-BAS110PU.                                             02.51
      *                                                                 02.51
           CALL BAS110PU USING KMCINTEP-DATA-AREA                       02.51
                               PACKAGE-PASS-AREA                        02.51
                               POST-EDIT-TRANS                          02.51
                               PDN-PLAN-DATA.                           02.51
      *                                                                 02.51
       Z99PU-EXIT.                                                      02.51
           EXIT.                                                        02.51
      *                                                                 02.51
       Z9996-CALL-BAS10004.
           CALL BAS10004 USING BAS10004-CALL-PARAMETERS.
           IF BAS10004-RETURN-CODE = 'F'
             MOVE 99                     TO HLD-RETURN-CD
             GO TO A-100-FINISHUP.
           IF BAS10004-CT-OPEN OR BAS10004-CT-CLOSE
             NEXT SENTENCE
           ELSE
           IF BAS10004-RC-NORMAL
             MOVE BAS10004-MCEDFILE-REC  TO MC-EDIT-REC.
       Z9996-EXIT.
           EXIT.
      *
112050 Z9997-CALL-BASCRATE.
112060     CALL BASCRATE
112060          USING BASCRATE-CALL-PARAMETERS.
112070 Z9997-EXIT.
112080     EXIT.
112090*
112050 Z9998-CALL-BAS10002.
           CALL  BAS10002       USING BAS10002-CALL-PARAMETERS.         02.23
112070 Z9998-EXIT.
112080     EXIT.
112090*
112100 Z9999-ABEND-PGM.
112110     CALL ABEND    USING    ABEND-CODE.
112120 Z9999-EXIT.
112130     EXIT.
112140*
112150*================================================================*
112160*                     PROGRAM CHANGE HISTORY                     *
112170*  DATE     CHANGE                                               *
112180* REVISED   REQUEST  REVISION DESCRIPTION                        *
112190* -------------------------------------------------------------- *
      * 09/30/06   01.71   FALL 2006 LEGAL & REG                       *
      *                    AMEX CHANGES                                *
      * 10/17/06   01.72   MODIFY PET MERCH NUMBER MOVES AND CORRECT   *
      *                    THE GROUP HEADER ERROR ON REPORTS           *
      * 11/07/06   01.73   MODIFY CORP ADDENDUM CREATION               *
      * 11/21/06   01.74   CHANGE PET-PARTIAL-AMT TO PET-CB-AMT        *
      *                    MODIFY AUTOMATIC REF NO CREATION            *
      *                    ADD NEW DOWNGRADE FILE                      *
      * 12/05/06   01.75   ADD TT SCREEN SETTLE FILE                   *
      *                    CORRECT CASH INTERCHANGE FEE                *
      * 12/12/06   01.76   MODIFY AUTH CHAR AND ECOM LOAD              *
      * 01/09/07   01.77   EDIT PURCHASE IDENTIFIER FIELD              *
      *                    MODIFY CITY DESCR FOR MOTO RECUR            *
      *                    DON'T ALLOW SALE OR RETURN ON CASH MCC      *
      * 01/10/07   01.78   REMOVE MC ELEC CARD DEDIT FOR NOW           *
      * 01/23/07   01.79   LOAD MC MCC/DMC TABLES CORRECTLY            *
      * 02/14/07   01.80   CHANGE THE LENGTH OF TT SETTLE FILE         *
      * 04/08/07   01.81   SPRING 2007 LEGAL & REG                     *
      * 03/23/07   01.82   SPRING 2007 LEGAL & REG - CITY PHONE NUMBER *
      * 03/30/07   01.83   SPRING 2007 LEGAL & REG - MISSING RPT LINES *
      * 04/09/07   01.84   SPRING 2007 LEGAL & REG - FIX RPT NO RECS   *
      * 04/25/07   01.85   ALLOW VISA LU ADDENDUM IF OTHERS REJECT     *
      * 05/08/07   01.86   ADD AMEX CPS ADDENDUM                       *CPS
      * 05/22/07   01.87   MC AUTH CODE OF 999999 STD ONLY             *
      * 06/06/07   01.88   DO NOT USE MULTIPLES OF 100 AS ERROR CODES  *
      * 06/15/07   01.89   ADD DELETED CNT/AMT TO RECON REPORT         *
      *                    ADD MC ENHANCED                             *
      * 06/22/07   01.90   CORRECT MC ENHANCED BANKNET DATE            *
      * 07/03/07   01.91   ADD MIS3 PHONE FOR AMEX                     *
      * 07/10/07   01.92   CORRECT UCAF, ECOM, AND TERM CAT RELATION   *
      *                    ADD TRAN DATE TO ENHANCED DATE CHECK (ER236)*
      *                    ADD PURCHASE IDENT TO AMEX PET REC          *
      * 07/17/07   01.93   INSERT DASHES IN AMEX PHONE                 *
      *                    MODIFY MC EHNANCED AUTH EDITS               *
      * 07/18/07   01.94   MODIFY MC UCAF PROCESS                      *
      * 07/19/07   01.95   MODIFY MC UCAF PROCESS AGAIN                *
      * 08/14/07   01.96   ADD DISCOVER AND AMEX PROCESSING CHANGES    *
      * 09/12/07   01.97   FALL 2007 LEGAL & REG                       *
      * 10/12/07   01.98   FALL 2007 LEGAL & REG                       *
      *                    MODIFY PRODICT ID CHECKS                    *
      *                    CHANGE TIP ERROR REASON TO 256              *
      *                    REMOVE MIN AMOUNT CHEKC FOR DISCOVER        *
      *                    CORRECT DISCOVER POS PIN ENTRY CAP          *
      * 10/12/07   01.99   FIX 0601 VISA TRANS                         *
      * 10/23/07   02.01   FIX 0601 VISA TRANS KDA DEFAULTS            *
      *                    MODIFY MRCH ADDR CHECKS FOR MC              *
      *                    PROPERLY LOAD VISA MVV TO PRINT LINE        *
      * 11/27/07   02.02   FIX BANKNET REF NO CHECK FOR ENHANCED       *
      * 12/12/07   02.03   FIX BANKNET REF NO CHECK FOR ENHANCED       *
      * 01/16/08   02.04   FIX EDITS ON VISA TELE NUMBER               *
      * 01/29/08   02.05   ADD MIS3 ITEMS TO DISCOVER REPORT           *
      * 02/13/08   02.06   BANKNET REF CHECKS FOR ENHANCED AND PRD GRAD*
      * 02/13/08   02.07   REMOVE MPE/BANKNET REF EQUAL CHECK          *
      * 02/15/08   02.08   MODIFIED BANKNET REF CHECKS                 *
      * 02/18/08   02.09   MODIFIED TRAN DATE CHECKS                   *
      * 04/04/08   02.10   SPRING 2008 LEGAL & REG                     *
      * 04/05/08   02.11   CORRECT PEM DISC NON-SETL FLAG              *
      * 04/06/08   02.12   CORRECT EBVP AND PRODUCT GRAD FOR MC        *
      * 04/08/08   02.13   ADD LIC PROD ID CONVERSION TO PROD ID       *
      * 04/16/08   02.14   CAPTURE PROD ID FROM MPE IF NOT ALM         *
      * 04/29/08   02.15   UPDATE MIS3-TELE-NUM EDITS, POS. 7-10 CAN   *
      *                    BE ZEROS.  ALL POS. MUST BE NUMERIC         *
      * 05/13/08   02.16   VALIDATE COUNTRY CODE FROM MEDNAME          *
      * 05/25/08   02.17   CORRECT 3000/3100 NO-SETL-REIMB-AMT         *
      * 06/03/08   02.18   SPRING 2008 LEGAL & REG - MASTERCARD        *
      * 06/25/08   02.19   HOT FIX TO ADD 13 MC PROD LIC IDS           *02.19
      * 06/30/08   02.20   CORRECT DUP COUNT FOR NON-SETL ON RECON RPT *02.20
      *                    SET INDUSTRY CODE TO ZERO FOR MC SIM ADDM   *02.20
      * 07/01/08   02.21   SET DEPOSIT CORR GROUP TYPE                 *02.21
      * 07/16/08   02.22   CORRECT AMEX ADDENDA CROSS-EDITS            *02.22
      * 10/03/08   02.23   FALL 2008 LEGAL & REG                       *02.23
      * 10/21/08   02.24   ADD MC & VS REIMB RATE                      *02.24
      *                    MODIFY VISA Q1 PRODUCT ID CHECKS            *02.24
      *                    MODIFY VISA ELECTRON POS TERM               *02.24
      * 11/18/08   02.25   TEST PRODUCT ID FIX                         *02.25
      * 12/02/08   SB.SB   ADD CODE TO ACCEPT CARD TYPE 'L' AND PRODUCT*SB.SB
      *                    ID OF 'Q1' FOR VISA PREPAID CARDS.          *SB.SB
      * 01/13/09   02.27   INCREASE T75 TABLE SIZE TO 70               *02.27
      * 04/17/09   02.28   INCREASE BATCH COUNT TO 6 DIGITS            *02.28
      * 04/17/09   02.29   SPRING 2009 LEGAL & REG                     *02.29
      * 04/19/09   02.30   CORRECT POS ENV FOR RETURNS                 *02.30
      * 04/21/09   02.31   CORRECT DEPOSIT CORR FIELDS                 *02.31
      *                    UPDATE AMEX CAT CODE VALIDATION             *02.31
      *                    CORRECT MC ACCEPTANCE BRAND SETTING         *02.31
      *                    ADD AMEX TO RECON REPORT                    *02.31
      * 05/09/09   02.32   CORRECT MOTO FOR DIRECT MKT RETURNS         *02.32
      * 06/01/09   02.33   ADD EDITS FOR MC TRAN CAT INDICATOR         *02.33
      * 07/10/09   02.34   CORRECT DISC & AMEX NON-SETL QUALIFICATION  *02.34
      * 07/27/09   02.35   CORRECT VISA AMOUNT CHECKS                  *02.35
      * 07/30/09   02.36   ADD VISA DESCR OVERRIDE OPTION ON MIS3      *02.36
      *                    MODIFY DEFAULT OF NON-US MC ACCEPT BRAND    *02.36
      * 08/24/09   02.37   ADD AMEX DESCR OVERRIDE OPTION              *02.37
      * 08/15/09   02.38   ADD AUTO PLAN GENERATION                    *02.38
      * 10/17/09   02.39   FALL 2009 LEGAL & REG                       *02.39
      * 10/17/09   02.40   CORRECT NON-ALM REJECTS                     *02.40
      * 10/24/09   02.41   CHANGE EDITFILE Q TO MC ACQ PREFIX          *02.41
      *                    REMOVE DINERS AND EUROPAY                   *02.41
      * 11/03/09   02.42   CORRECT DISCOVER/JCB                        *02.42
      * 11/04/09   02.43   CORRECT DISCOVER AUTH LOAD                  *02.43
      * 12/01/09   02.44   CORRECT MRCH NUMBER EDITS                   *02.44
      * 12/10/09   02.45   CORRECTLY SET BANKNET DATA FOR MIS1 CASH    *02.45
      * 12/10/09   02.45   INITIALIZE HOLD FIELDS TO CORRECTLY LOAD    *02.45
      *            02.45   AMEX CONTACT INFORMATION WITH PHONE #'S     *02.45
      * 01/31/10   02.46   CORRECT AMEX 1PT CAT CODE VALIDATION        *02.46
      * 01/31/10   02.46   ZERO OUT AMEX TRANS IDENT ON CREDIT TRANS   *02.46
      * 02/28/10   02.47   CORRECT AMEX 1-POINT SETL VS NON-SETL       *02.47
      *                    CORRECT VISA PRIVATE LABEL Q1               *02.47
      * 04/16/10   02.48   SPRING 2010 LEGAL & REG                     *02.48
      * 05/31/10   02.49   REPLACE LOW VALUES WITH SPACE               *02.49
      *                    CORRECT AMEX RANGE CHECK                    *02.49.01
      * 06/30/10   02.50   MODIFY VISA AUTH & PROCESS DATE CHECK       *02.50
      * 10/15/10   02.51   MODIFY RATE PROCESSING                      *02.51
      * 10/15/10   02.52   FALL 2010 LEGAL & REG                       *02.52
      * 10/15/10   02.53   MODIFY MIS3 INPUT FORMAT                    *02.53
      * 10/15/10   02.54   REMOVE NAF S MKT AND KDA REDUCED INTCH      *02.54
      * 10/15/10   02.55   INITIALIZE PRINT FIELD VALUES               *02.55
      * 10/26/10   02.56   MODIFY DS RECUR PAY EDITS                   *02.56
      * 10/28/10   02.57   CORRECT VS SETTLE NET SETTINGS              *02.57
      * 11/01/10   02.58   ADD REJ CNT & AMT TO BATCH                  *02.58
      * 01/28/11   02.59   ADD CHAIN PROP FLAG                         *02.59
      * 04/15/11   02.60   ERROR CODE CLARIFICATION                    *02.60
      * 04/15/11   02.61   SPRING 2011 LEGAL & REG                     *02.61
      * 05/09/11   02.62   CORRECT MC WRLD ELITE SPEND SHORTFALL       *02.62
      * 05/09/11   02.63   ADD AUTO CREATE FOR AMEX AD ADDENDUM        *02.63
      * 05/31/11   02.64   ADD BALANCING FILE                          *02.64
      * 05/31/11   02.65   CORRECT MC WRLD ELITE SPEND SHORTFALL       *02.65
      * 06/30/11   02.66   CORRECT EB CARD TYPE FOLLOWED BY NON-EB     *02.66
      * 07/31/11   02.67   ADD NEW AMEX DISCOUNT VOLUME FLAG FOR 11.2  *02.67
      * 10/01/11   02.68   DEBIT REGULATORY CHANGES                    *02.68
      * 10/11/11   02.69   DEBIT REGULATORY CHANGE CORRECTIONS         *02.69
      * 10/17/11   02.70   SET VISA PRODUCT ID FOR INTERNATIONAL       *02.70
      * 11/17/11   02.71   DEFAULT REJECT REASON 466 TO MPE ENTRY 1    *02.71
      * 04/13/12   02.72   SPRING 2012 LEGAL & REG - AMEX         MILNE*02.72
      * 04/13/12   02.73   CORRECT/IMPROVE BATCH REJECT REPORTING.     *02.73
      *                    INCREASE MC MCC & DMC PROD TBL SIZES   MILNE*02.73
      * 04/13/12   02.74   SPRING 2012 LEGAL & REG - MC           MILNE*02.74
      * 04/13/12   02.75   SPRING 2012 LEGAL & REG - VISA         MILNE*02.75
      * 06/05/12   02.76   ADD PIN DEBIT FIELDS                        *02.76
      * 06/30/12   02.77   ADD NEW MEDNME FILE                         *02.77
      * 06/30/12   02.78   ADD FRONT-END ERROR PROCESSING              *02.78
      * 08/17/12   02.79   MC ACCEPT BRAND VALIDATION                  *02.79
      *            02.80   EXPAND SOURCE ID TABLE WITH COPYBOOK        *02.80
      * 10/14/12   02.81   FALL 2012 LEGAL & REG                       *02.81
      * 10/14/12   02.82   FIX DISCOVER ISSUE WHERE "TO" ACCT IN       *02.82
      *                    DISCOVER PROCESS CODE CAN ONLY BE '00'      *02.82
      * 10/29/12   02.83   CORRECT AMOUNT ERROR CODE AND REPORTING     *02.83
      * 11/01/12   02.84   ADD CUSTOM PLAN                             *02.84
      * 10/19/12   02.85   CORRECT VISA PRODUCT ID                     *02.85
      * 11/01/12   02.86   ADD NON-SETL COUNT                          *02.86
      * 11/05/12   02.87   ADD ADDITONAL RECON/BALANCE FILES           *02.87
      * 11/15/12   02.88   ADD DATA BASE TRANSACTION CREATION          *02.88
      * 11/28/12   02.89   CORRECT NON-SETL GROUP AMT                  *02.89
      * 01/01/13   02.90   CORRECT ALM DATE CALLS FROM DAK TO DAJ      *02.90
      * 01/23/13   02.91   ADD NON-SETTLE/NON-CLEAR AMEX AND DISCOVER  *02.91
      * 02/16/13   02.92   DEBIT PLAN RESTRUCTURE                      *02.92
      * 02/16/13   02.93   CLEANUP BATCH CURRENCY LINE ON EDIT REPORT  *02.93
      * 02/28/13   02.94   CORRECT BALANCE RECORD                      *02.94
      *            02.94A  CORRECT AMEX AND DISCOVER NON-SETTLE FLAGS  *02.94A
      * 04/19/13   02.95   SPRING 2013 LEGAL & REG                     *02.95
      * 04/19/13   02.96   CORRECT DEBIT GROUP IND                     *02.96
      * 04/19/13   02.97   TEMPORARILY REMOVE MC ALM DATE EDIT         *TEMP
      * 04/25/13   02.97F  TEMP CORRECTION FOR BUSINESS ENHANCE CHECK  *02.97F
      * 04/25/13   02.98   ADD WRITE BAL FILE REC IF NO INPUT          *02.98
      * 04/30/13   02.98F  TEMP CORRECTION FOR BUSINESS ENHANCE CHECK  *02.98F
      * 05/08/13   02.99   CORRECT POPULATION OF CARD TYPE FOR TR&R.   *02.99
      * 06/04/13   03.00   ADD NON-SETTLE TO DEPOSIT RECORDS           *03.00
      * 06/04/13   03.01   DEFAULT TO A360 MCC FOR AMEX & DISCOVER     *03.01
      *                    TRANSACTIONS IF INCOMING VALUE IS DIFFERENT *03.01
      * 06/04/13   03.02   DUPLICATE TRAN CHECKING/SUSPEND NEG DEP     *03.02
      * 06/04/13   03.03   ADD AX & DS AIRLINE ADDENDUM                *03.03
      * 06/04/13   03.04A  TICKET AS0001-721. RECLASS FROM CONSUMER    *03.04A
      *                    STD TO SIG PREF STD.  RECLASS FROM BUS STD  *03.04A
      *                    TO BUS ENH STD.                             *03.04A
      * 06/04/13   03.04B  ALLOW STAND-ALONE PA AND XA ADDENDA         *03.04B
      * 06/14/13   03.05   CORRECT POPULATION OF CARD TYPE FOR TR&R.   *03.05
      * 06/20/13   03.06   REJECT CASH/ATM TRANSACTIONS FOR PAYPAL     *03.06
      * 06/28/13   03.07   FIX REJECT CODES IN TR&R FILE               *03.07
      * 07/15/13   03.08   EXPAND CARD TYPE FOR TR&R FILE              *03.08
      * 07/16/13   03.09   FIX CARD TYPES FOR AMEX AND DISCOVER        *03.09
      * 07/23/13   03.10   ADD NON-SETTLED REJECT TOTALS TO BATCH      *03.10
      * 07/25/13   03.11   CORRECT MC REJECTS                          *03.11F
      * 07/25/13   03.11T  CORRECT MC REJECTS - TEMP - CAN REMOVE      *03.11T
      *                    WHEN MPE/EDIT FILE IS CORRECTED             *03.11T
      * 08/09/13   03.12   AS0001-1628 -  4511 MCC, ONLY USE 1ST 9 POS *03.12
      *                    OF MERCHANT NAME TO PASS TO PET-DESCR/DE43S1*03.12
      * 08/21/13   03.13   ADD INST/ASSN ACTIVITY BY CARD TYPE RECS    *03.13
      * 08/27/13   03.14   FIX DISCOVER TRANS TO WRITE TO REJECT FILE  *03.14
      * 09/09/13   03.15   REMOVE TEMP 03.11T CODE FOR MC '289' REJECTS*03.15
      * 10/18/13   03.16   FALL 2013 LEGAL & REG                       *03.16
      * 10/18/13   03.16A  AMEX EAP                                    *03.16A
      * 10/18/13   03.16B  ACCEPT ONLY 10 DIGIT PHONE FOR MC AS-1787   *03.16B
      * 10/18/13   03.16C  AS0001-1473 FIX CARDTYPE & PLAN FOR BASDTDTA*03.16C
      * 10/20/13   03.17   AS0001-1844/1845: FIX ISSUE WHERE MC PRODUCT*03.17
      *            03.17   ID'S MWB/MAB CAN NOT QUAL FOR CORE IRD'S    *03.17
      * 10/21/13   03.17F  AS0001-1844/1845:ADD SAME FIX TO ALL NON ALM*03.17F
      * 10/21/13   03.18   AS0001-1851 ADD SPACES AS VALID FOR MC       03.18
      *                    DEVICE, TRANSIT PGM AND TRANSMIT MODE        03.18
      * 10/22/13   03.19   FIX VISA KMCVSMAX LOGIC SO THAT ERROR 42     03.19
      *                    IS NOT RECEIVED IF PRODUCT ID IS NOT IN TBL  03.19
      * 10/18/13   03.20   AS0001-1805: AMEX LD ADDENDA DEFAULTING     *03.20
      * 10/28/13   03.21   AS0001-1844/1845:ADDITIONAL FIX FOR AUTH SRC*03.21
      *                    =P AND NON ALM'S WHEN BANKREF IS NOT SENT   *03.21
      * 10/31/13   03.22   PREVENT NON-SETTLE DEPOSIT CORRECTIONS FROM *03.22
      *                    GOING TO ACH.                               *03.22
      * 10/31/13   03.23   DELETE NON-SETTLE PACKAGE RANGE             *03.23
      * 11/01/13   03.24   AD0001-786 FIX SORT KEY TO ALLOW MULTIPLE   *03.24
      *                    BAC00110'S TO RUN AT THE SAME TIME.         *03.24
      * 11/14/13   03.25   AS0001-1821 FLEET/PETROLEUM SUPPORT         *03.25
      * 11/15/13   03.26   AS0001-1788 ALLOW SURCHG ON DEBIT TRANS     *03.26
      *                    COMMENTING OUT CODE ONLY                    *03.26
      * 12/17/13   03.27   AS0001-1808 EXPAND KMCPETRC                 *03.27
      * 12/17/13   03.28   TD0001-752 REMOVED ALL REFERENCES TO        *03.28
      *            HOLD-3RD-PROPRIETARY-BANK-NO AND HOLD-3RD- BANK-NO  *03.28
      * 12/17/13   03.29   AS0001-1946: FIX AMEX INV REF NBR           *03.29
      * 12/17/13   03.30   AS-1333 EOV SETL/NON-SETL INDICATOR         *03.30
      * 11/01/13   03.31   AS0001-1664 PROCESS 1-SIDED AS WELL AS      *03.31
      *                    TWO-SIDED TRANS                             *03.31
      * 01/07/14   03.32   AS0001-1333 - FIX NON-SETL CODE TO SET THE  *03.32
      *                    AMEX/DISC SETTLE FLAG CORRECTLY             *03.32
      * 01/07/14   03.33   AS0001-1951 FIX SETTINGS OF AMEX VALIND SW  *03.33
      * 01/08/14   03.34   AS0001-1333 - FIX NON-SETL CODE TO SET THE  *03.34
      *                    AMEX/DISC SETTLE FLAG BASED ON BATCH HDR    *03.34
      * 01/08/14   03.34F  AS0001-1333 - FIX NON-SETL CODE TO SET THE  *03.34F
      *                    AMEX/DISC SETTLE FLAG BASED ON BATCH HDR    *03.34F
      * 01/08/14   03.34G  AS0001-2058 - FIX AMEX/DISCOVER CODE SO THAT*03.34G
      *                    CATCH ALL PACKAGES ARE CONSIDERED ALONG     *03.34G
      *                    WITH THE DEFAULT PLANS.                     *03.34G
      * 01/08/14   03.35   AS0001-1951 FIX RESET OF VALIND FLAGS       *03.35
      * 02/11/14   03.36   AS0001-1372 TELECOM ADDENDUM SUPPORT        *03.36
      * 02/11/14   03.37   AS0001-1333 FIX AMEX/DISC SETTLE FLAGS      *03.37
      * 02/11/14   03.38   AS0001-1333 ADD AMEX/DISC SETTLE BACK COMP  *03.38
      * 02/19/14   03.39   TS0001-552 ADD AMEX/DISC NON-SETL NON-CLEAR *03.39
      * 04/11/14   03.40   AS0001-2054 ADD EDITS ON ACI/PH-ORD COMBOS  *03.40
      *                    COMMENTED OUT 4/11/14, UNCOMMENTED 6/2/14   *03.40
      * 04/11/14   03.41   AS0001-2065 ADD EDITS ON VS PURCH ID        *03.41
      *                    COMMENTED OUT 4/11/14, UNCOMMENTED 6/2/14   *03.41
      * 04/11/14   03.42   SPRING 2014 LEGAL & REG                     *03.42
      * 04/11/14   03.43   AS0001-2217, WHEN MC PROD=MCW & APPR CD=W/Y *03.43
      *                                 MUST FOLLOW ENH QUAL NOT WORLD *03.43
      * 04/21/14   03.44   AS0001-2216. CHECK FOR AMEX AIRLINE ADDENDA *03.44
      * 05/14/14   03.45   AS0001-2292 FIX 1PT/EAP INDUSTRY INDICATOR  *03.45
      *                    WHEN SETTLE FLAG NOT USED.                  *03.45
      * 06/02/14   03.46   JUNE 2014 LEGAL & REG                       *03.46
      * 06/02/14   03.47   PAYPAL 1.5                                  *03.47
      * 06/02/14   03.47F  REPLACE PLAN 0108 WITH 0106                 *03.47F
      * 06/02/14   03.48   AS0001-2168 MC US ACQ FLAG NOW SET IN 110MI *03.48
      * 06/02/14   03.49   AS0001-2304 PAYPAL TRANS REJECTING          *03.49
      * 07/18/14   03.50   AD0001-992 - ADD POS DATA EDIT FOR TOKEN CRD*03.50
      * 07/22/14   03.51   AD0001-998 ADD PGM VER TO BAC00110 EDIT RPT *03.51
      * 07/22/14   03.52   TS0001-643: CORRECT GO TO ERRORS IN U-400/01*03.52
      * 07/22/14   03.53   AS0001-2174 RISK MGMT CD FOR MC LARGE TICKET*03.53
      * 07/22/14   03.54   AD0001-770 - REJ & REP PARM SET TO 'N' ABEND*03.54
      * 07/22/14   03.55   AS0001-2261 MODIFY DISC MCC TO WORK LIKE    *03.55
      *                    MASTERCARD AND VISA (I.E. PRIOR TO 3.01)    *03.55
      * 07/22/14   03.56   AMEX TOKENIZATION                           *03.56
      * 07/22/14   03.57   AS0001-2352 FIX VISA MAX BY PROD ID CHECK   *03.57
      * 07/01/14   03.58   AS0001-2335 -ONLY EDITING NOW ON ACTUAL     *03.58
      *                    REJECTED CHARS IN AS0001-2065 "[" AND "]"   *03.58
      *                    (CHANGE TO VERSION 3.10 CODE)               *03.58
      * 07/01/14   03.59   AS0001-2334 -LOOSENED UP EDITS ON VALID     *03.59
      *                    ACI/MOTO COMBINATIONS ON V1089 ERROR        *03.59
      *                    ONLY EDITING WHEN MOTO IS 5/6/7, AS WE      *03.59
      *                    BELIEVE THIS IS WHAT VISA IS DOING IN EP    *03.59
      * 08/06/14   03.60   FC-114 FIX 1-SIDED EDIT FOR DISCOVER PROC   *03.60
      *                    CODE AND INITIALIZE TRAN AND LOCAL TIME     *03.60
      * 08/06/14   03.61   AS0001-2347 USE CORRECT OWNING AMEX INACC   *03.61
      * 10/17/14   03.62   AD0001-854 FALL 2014 LEGAL & REGS           *03.62
      * 10/17/14   03.63   AS0001-2355 - SUPPORT VISA PARTNER PROGRAM  *03.63
      * 10/17/14   03.64   AS0001-2332 FIX PAGE TRUNCATION FOR EDTRPT  *03.64
      * 10/17/14   03.65   AS-2413 FIX AMEX REJECT CODE 33 LOGIC       *03.65
      * 10/17/14   03.66   AS0001-2363 WHEN TRAN IS EIRF ONLY (CANNOT  *03.66 HOTFIXED VERS 8/26/14
      *                    QUAL AS STD), EDIT CHK COMMON EIRF DATA,    *03.66
      *                    IF DWNGR SET FLG TO REJ TRN IN BAC00110     *03.66
